function start(t,e){MOTOR.start(t,e)}function startFixed(t){MOTOR.fixed(t)}function startSteady(t){MOTOR.steady(t)}function startSteadyFixed(t){MOTOR.steadyFixed(t)}function stop(t){MOTOR.stop(t)}function startInterval(t){MOTOR.startInterval(t)}function startPostUpdate(t){MOTOR.startPostUpdate(t)}var MOTOR,isPaused,fixed=startFixed,dt=1,dtFixed=1,DT=1,Motor=pc.createScript("motor");Motor.prototype.initialize=function(){var t=this;MOTOR=t,t.dt=1,t.dtFixed=1;var e=0,o=1/60,a=DATE.getNow(),n=DATE.getNow(),d=0;t.onUpdate=function(i){if(dt=t.dt=i,(DT=60*dt)>1.3&&(DT=1.3),isPaused||fire("MOTOR:onUpdate",dt),fire("MOTOR:onSteady",dt),MOTION.onFixed(),CONFIG.GAME.defaultTweenUpdate&&fire("MOTOR:onTween",dt),!((e+=i)<o)){e-=o;var O=DATE.getNow(),r=(O-n)/1e3;r=pc.math.clamp(r,0,APP.maxDeltaTime),r*=APP.timeScale,dtFixed=t.dtFixed=60*r,n=O,isPaused||fire("MOTOR:onFixed",r),fire("MOTOR:onSteadyFixed",dt);var s=O-a;s<1e3||(a=O+(s-1e3),isPaused||(fire("MOTOR:onInterval"),MOTION.onInterval()),QUALITY.quality&&(dtFixed<1.1?d=0:++d>120&&QUALITY.low()))}},t.onPostUpdate=function(t){fire("MOTOR:onPostUpdate",t)},t.fixed=function(e){t.start(e,"Fixed")},t.start=function(e,o){t.stop(e),on("MOTOR:on"+(o||"Update"),e)},t.steady=function(e){t.start(e,"Steady")},t.steadyFixed=function(e){t.start(e,"SteadyFixed")},t.startPostUpdate=function(e){t.start(e,"PostUpdate")},t.startInterval=function(e){t.start(e,"Interval")},t.stop=function(t){off("MOTOR:onUpdate",t),off("MOTOR:onPostUpdate",t),off("MOTOR:onFixed",t),off("MOTOR:onSteady",t),off("MOTOR:onSteadyFixed",t),off("MOTOR:onInterval",t)}},Motor.prototype.update=function(t){this.onUpdate(t)},Motor.prototype.postUpdate=function(t){this.onPostUpdate(t)};var SIGNAL=pc.app;function on(n,o,f){off(n,o,f),SIGNAL.on(n,o,f)}function onDataUpdate(n,o,f){on(n,o,f),o(get(n))}function once(n,o,f){on(n,(function onceFunction(c,i,t,e){SIGNAL.off(n,onceFunction,f),o(c,i,t,e)}),f)}function off(n,o,f){SIGNAL.off(n,o,f)}function fire(n,o,f,c,i,t){SIGNAL.fire(n,o,f,c,i,t)}function onLabel(n,o,f,c){on(n+":"+o,f,c)}function fireLabel(n,o,f,c,i,t,e,u){fire(n+":"+o,f,c,i,t,e,u)}pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();function replace(e,i,t){return STRING.replace(e,i,t)}var STRING=new function(){var e=this;e.ALPHABET="#ABCDEFGHIJKLMNOPQRSTUVWXYZ";var i=["k","M","B","T","qd","Qn","sx","Sp","O","N","decillion","undecillion","duodecillion","tredecillion","quattuordecillion","quindecillion","sexdecillion","septdecillion","octodecillion","novemdecillion","vigintillion","unvigintillion","duovigintillion","trevigintillion","quattuorvigintillion","quinvigintillion","sexvigintillion","septvigintillion","octovigintillion","novemvigintillion","trigintillion","untrigintillion","duotrigintillion","googol","tretrigintillion","quattuortrigintillion","quintrigintillion","sextrigintillion","septtrigintillion","octotrigintillion","novemtrigintillion","quadragintillion","unquadragintillion","duoquadragintillion","trequadragintillion","quattuorquadragintillion","quinquadragintillion","sexquadragintillion","septquadragintillion","octoquadragintillion","novemquadragintillion","quinquagintillion","unquinquagintillion","duoquinquagintillion","trequinquagintillion","quattuorquinquagintillion","quinquinquagintillion","sexquinquagintillion","septquinquagintillion","octoquinquagintillion","novemquinquagintillion","sexagintillion","unsexagintillion","duosexagintillion","tresexagintillion","quattuorsexagintillion","quinsexagintillion","sexsexagintillion","septsexagintillion","octosexagintillion","novemsexagintillion","septuagintillion","unseptuagintillion","duoseptuagintillion","treseptuagintillion","quattuorseptuagintillion","quinseptuagintillion","sexseptuagintillion","septseptuagintillio","octoseptuagintillion","novemseptuagintillion","octogintillion","unoctogintillion","duooctogintillion","treoctogintillion","quattuoroctogintillion","quinoctogintillion","sexoctogintillion","septoctogintillion","octooctogintillion","novemoctogintillion","nonagintillion","unnonagintillion","duononagintillion","trenonagintillion","quattuornonagintillion","quinnonagintillion","sexnonagintillion","septnonagintillion","octononagintillion","novemnonagintillion","centillion"];e.contains=function(e,i){return-1!=e.toLowerCase().indexOf(i.toLowerCase())},e.containsStrict=function(e,i){return-1!=e.indexOf(i)},e.split=function(e,i){return e.toLowerCase().split(i.toLowerCase())[0]},e.displaySign=function(e,i){var t=e>0?"+"+e:e;return i&&(t+=" "+i),t},e.trim=function(e){for(;" "==e.charAt(0);)e=e.substr(1);for(;" "==e.charAt(e.length-1);)e=e.substr(0,-1);return e},e.lTrim=function(e){for(;" "==e.charAt(0);)e=e.substr(1);return e},e.rTrim=function(e){for(;" "==e.charAt(e.length-1);)e=e.substr(0,-1);return e},e.string=function(e,i){if(i<=0)return"";for(var t="",o=0;o<i;o++)t+=e;return t},e.validateEmail=function(e){return e.match(/^[A-Z0-9._%+-]+@(?:[A-Z0-9-]+\.)+[A-Z]{2,4}$/i)},e.beginsWith=function(e,i){return i==e.substring(0,i.length)},e.getPrefix=function(e,i,t){i=i||"_";var o=e.split(i)[0];return t&&o.toLowerCase(),o},e.endsWith=function(e,i){return i==e.substring(e.length-i.length)},e.getArray=function(i,t){if(!i)return[];t=t||",";var o=e.doReplace(i+""," ","").split(t);for(var n in o)o[n]=MATH.tryParseInt(o[n]);return o},e.doReplace=function(e,i,t){return e.split(i).join(t)},e.removeVowels=function(e,i){return i=i||3,e.length<=i?e:e.replace(/[AEIOUaeiou-]/gi,"")},e.getFileExtension=function(e){return e.substring(e.lastIndexOf(".")+1,e.length).toLowerCase()},e.containsKeys=function(e,i){if(!i)return!1;var t=i.split(","),o=e.toLowerCase();for(var n in t)if(-1!=o.indexOf(t[n]))return!0},e.replace=function(i,t,o){if(!i)return null;if("string"==typeof t&&o)return e.doReplace(i,t,o);for(var n in t){var s="",a="";"percent"==n&&(s="%"),"USD"==n&&(a="$"),i=e.doReplace(i,"{"+n+"}",a+t[n]+s)}return i},e.excludeChars=function(e,i){for(var t,o="",n=(i=i||":,<>-'{}[]/*-+!;8!@#$%.^&*()",0);n<e.length;n++){t=!0;for(var s=0;s<i.length;s++)if(e.charAt(n)==i.charAt(s)){t=!1;break}t&&(o+=e.charAt(n))}return o},e.hasBadCharacters=function(e,i){i=i||"/@#$%^& ";for(var t=0;t<i.length;t++)if(e.includes(i.charAt(t)))return!0;return!1};let t=["2 girls 1 cup","2g1c","4r5e","5h1t","5hit","a_s_s","a55","a55hole","acrotomophilia","aeolus","ahole","alabama hot pocket","alaskan pipeline","anal","analprobe","anilingus","anus","apeshit","ar5e","areola","areole","arian","arrse","arse","arsehole","aryan","ass","ass hole","assbag","assbandit","assbang","assbanged","assbanger","assbangs","assbite","assclown","asscock","asscracker","asses","assface","assfuck","assfucker","ass-fucker","assfukka","assgoblin","assh0le","asshat","ass-hat","asshead","assho1e","asshole","assholes","asshopper","ass-jabber","assjacker","asslick","asslicker","assmaster","assmonkey","assmunch","assmuncher","assnigger","asspirate","ass-pirate","assshit","assshole","asssucker","asswad","asswhole","asswipe","asswipes","auto erotic","autoerotic","axwound","azazel","azz","b!tch","b00bs","b17ch","b1tch","babe","babeland","babes","baby batter","baby juice","balls","ball gag","ball gravy","ball kicking","ball licking","ball sack","ball sucking","ballbag","ballsack","bampot","bang","bangbros","banger","bareback","barely legal","barenaked","barf","bastard","bastardo","bastards","bastinado","bawdy","bbw","bdsm","beaner","beaners","beardedclam","beastial","beastiality","beatch","beater","beaver cleaver","beaver lips","beeyotch","bellend","beotch","bestial","bestiality","bi+ch","biatch","big black","big breasts","big knockers","big tits","bigtits","bimbo","bimbos","birdlock","bitch","bitchass","bitched","bitcher","bitchers","bitches","bitchin","bitching","bitchtits","bitchy","black cock","blonde action","blonde on blonde action","blow job","blow your load","blowjob","blowjobs","blue waffle","blumpkin","bod","bodily","boink","boiolas","bollock","bollocks","bollok","bollox","bondage","boned","boner","boners","bong","boob","boobies","boobs","booby","booger","bookie","booobs","boooobs","booooobs","booooooobs","bootee","bootie","booty","booty call","booze","boozer","boozy","bosom","bosomy","bra","brassiere","breast","breasts","breeder","brotherfucker","brown showers","brunette action","buceta","bugger","bukkake","bull shit","bulldyke","bullet vibe","bullshit","bullshits","bullshitted","bullturds","bum","bumblefuck","bung","bung hole","bunghole","bunny fucker","busty","butt","butt fuck","butt plug","buttcheeks","buttfuck","buttfucka","buttfucker","butthole","buttmuch","butt-pirate","buttplug","c.0.c.k","c.o.c.k.","c.u.n.t","c0ck","c-0-c-k","c0cksucker","caca","cahone","camel toe","cameltoe","camgirl","camslut","camwhore","carpet muncher","carpetmuncher","cawk","cervix","chesticle","chinc","chincs","chink","choad","chocolate rosebuds","chode","chodes","cipa","circlejerk","cl1t","cleveland steamer","climax","clit","clitface","clitfuck","clitoris","clitorus","clits","clitty","clover clamps","clusterfuck","cnut","cocain","cocaine","cock","c-o-c-k","cock sucker","cockass","cockbite","cockblock","cockburger","cockeye","cockface","cockfucker","cockhead","cockholster","cockjockey","cockknocker","cockknoker","cocklump","cockmaster","cockmongler","cockmongruel","cockmonkey","cockmunch","cockmuncher","cocknose","cocknugget","cocks","cockshit","cocksmith","cocksmoke","cocksmoker","cocksniffer","cocksuck","cocksucked","cocksucker","cock-sucker","cocksucking","cocksucks","cocksuka","cocksukka","cockwaffle","coital","cok","cokmuncher","coksucka","commie","condom","coochie","coochy","coon","coons","cooter","coprolagnia","coprophilia","corksucker","cornhole","cox","crabs","crack","crackwhore","crap","crappy","creampie","crotte","cum","cumbubble","cumdumpster","cumguzzler","cumjockey","cummer","cummin","cumming","cums","cumshot","cumshots","cumslut","cumstain","cumtart","cunilingus","cunillingus","cunnie","cunnilingus","cunny","cunt","c-u-n-t","cuntass","cuntface","cunthole","cunthunter","cuntlick","cuntlicker","cuntlicking","cuntrag","cunts","cuntslut","cyalis","cyberfuc","cyberfuck","cyberfucked","cyberfucker","cyberfuckers","cyberfucking","d0ng","d0uch3","d0uche","d1ck","d1ld0","d1ldo","dago","dagos","darkie","damn","damned","dammit","date rape","daterape","dawgie-style","deep throat","deepthroat","deggo","dendrophilia","dick","dickbag","dickbeaters","dickdipper","dickface","dickflipper","dickfuck","dickfucker","dickhead","dickheads","dickhole","dickish","dick-ish","dickjuice","dickmilk ","dickmonger","dickripper","dicks","dicksipper","dickslap","dick-sneeze","dicksuck","dicksucker","dicksucking","dicktickler","dickwad","dickweasel","dickweed","dickwhipper","dickwod","dickzipper","diddle","dike","dildo","dildos","diligaf","dillweed","dimwit","dingle","dingleberries","dingleberry","dink","dinks","dipship","dipshit","dirsa","dirty pillows","dirty sanchez","dlck","dog style","dog-fucker","doggie style","doggiestyle","doggie-style","doggin","dogging","doggy style","doggystyle","doggy-style","dolcett","domination","dominatrix","dommes","dong","donkey punch","donkeyribber","doochbag","doofus","dookie","doosh","dopey","double dong","double penetration","doublelift","douch3","douche","douchebag","douchebags","douche-fag","douchewaffle","douchey","dp action","drunk","dry hump","duche","dumass","dumb ass","dumbass","dumbasses","dumbcunt","dumbfuck","dumbshit","dummy","dumshit","dvda","dyke","dykes","eat my ass","ecchi","ejaculate","ejaculated","ejaculates","ejaculating","ejaculatings","ejaculation","ejakulate","enlargement","erect","erection","erotic","erotism","escort","essohbee","eunuch","extacy","extasy","f u c k","f u c k e r","f.u.c.k","f_u_c_k","f4nny","fack","fag","fagbag","fagfucker","fagg","fagged","fagging","faggit","faggitt","faggot","faggotcock","faggs","fagot","fagots","fags","fagtard","faig","faigt","fanny","fannybandit","fannyflaps","fannyfucker","fanyy","fartknocker","fatass","fcuk","fcuker","fcuking","fecal","feck","fecker","felch","felcher","felching","fellate","fellatio","feltch","feltcher","female squirting","femdom","figging","fingerbang","fingerfuck","fingerfucked","fingerfucker","fingerfuckers","fingerfucking","fingerfucks","fingering","fisted","fistfuck","fistfucked","fistfucker","fistfuckers","fistfucking","fistfuckings","fistfucks","fisting","fisty","flamer","flange","floozy","foad","foah","fondle","foobar","fook","fooker","foot fetish","footjob","foreskin","freex","frigg","frigga","frotting","fubar","fuck","f-u-c-k","fuck buttons","fuck off","fucka","fuckass","fuckbag","fuckboy","fuckbrain","fuckbutt","fuckbutter","fucked","fucker","fuckers","fuckersucker","fuckface","fuckhead","fuckheads","fuckhole","fuckin","fucking","fuckings","fuckingshitmotherfucker","fuckme","fucknugget","fucknut","fucknutt","fuckoff","fucks","fuckstick","fucktard","fuck-tard","fucktards","fucktart","fucktwat","fuckup","fuckwad","fuckwhit","fuckwit","fuckwitt","fudge packer","fudgepacker","fuk","fuker","fukker","fukkin","fuks","fukwhit","fukwit","futanari","fux","fux0r","fvck","fxck","gae","gai","gang bang","gangbang","gangbanged","gangbangs","ganja","gay","gay sex","gayass","gaybob","gaydo","gayfuck","gayfuckist","gaylord","gays","gaysex","gaytard","gaywad","genitals","gey","gfy","ghay","ghey","giant cock","gigolo","girl on","girl on top","girls gone wild","glans","goatcx","goatse","god damn","godamn","godamnit","goddam","god-dam","goddammit","goddamn","goddamned","god-damned","goddamnit","gokkun","golden shower","goldenshower","gonad","gonads","goo girl","gooch","goodpoop","gook","gooks","goregasm","gringo","grope","group sex","gspot","g-spot","gtfo","guido","guro","h0m0","h0mo","hand job","handjob","hard core","hard on","hardcore","hardcoresex","he11","heeb","hemp","hentai","heroin","herp","herpes","herpy","heshe","hitler","hiv","ho","hoar","hoare","hobag","hoe","hoer","hom0","homey","homo","homodumbshit","homoerotic","homoey","honkey","honky","hooch","hookah","hooker","hoor","hootch","hooter","hooters","hore","horniest","horny","hot carl","hot chick","hotsex","how to kill","how to murder","huge fat","hump","humped","humping","hussy","hymen","inbred","incest","injun","intercourse","j3rk0ff","jack Off","jackass","jackhole","jackoff","jack-off","jaggi","jagoff","jail bait","jailbait","jap","japs","jelly donut","jerk","jerk off","jerk0ff","jerkass","jerked","jerkoff","jerk-off","jigaboo","jiggaboo","jiggerboo","jism","jiz","jizm","jizz","jizzed","juggs","jungle bunny","junglebunny","junkie","junky","kawk","kike","kikes","kinbaku","kinkster","kinky","kkk","knob","knobbing","knobead","knobed","knobend","knobhead","knobjocky","knobjokey","kock","kondum","kondums","kooch","kooches","kootch","kraut","kum","kummer","kumming","kums","kunilingus","kunja","kunt","kyke","l3i+ch","l3itch","labia","lameass","lardass","leather restraint","leather straight jacket","lech","lemon party","leper","lesbian","lesbians","lesbo","lesbos","lez","lezbian","lezbians","lezbo","lezbos","lezzie","lezzies","lezzy","lmao","lmfao","loin","loins","lolita","lovemaking","lube","lust","lusting","lusty","m0f0","m0fo","m45terbate","ma5terb8","ma5terbate","make me come","male squirting","mams","masochist","massa","masterb8","masterbat","masterbat3","masterbate","master-bate","masterbating","masterbation","masterbations","masturbate","masturbating","masturbation","maxi","mcfagget","menage a trois","menses","menstruate","menstruation","meth","m-fucking","mick","milf","minge","missionary position","mof0","mofo","mo-fo","molest","moolie","moron","mothafuck","mothafucka","mothafuckas","mothafuckaz","mothafucked","mothafucker","mothafuckers","mothafuckin","mothafucking","mothafuckings","mothafucks","mother fucker","motherfuck","motherfucka","motherfucked","motherfucker","motherfuckers","motherfuckin","motherfucking","motherfuckings","motherfuckka","motherfucks","mound of venus","mr hands","mtherfucker","mthrfucker","mthrfucking","muff","muff diver","muffdiver","muffdiving","munging","murder","mutha","muthafecker","muthafuckaz","muthafucker","muthafuckker","muther","mutherfucker","mutherfucking","muthrfucking","n1gga","n1gger","nad","nads","naked","nambla","napalm","nappy","nawashi","nazi","nazism","negro","neonazi","nig nog","nigaboo","nigg3r","nigg4h","nigga","niggah","niggas","niggaz","nigger","niggers","niggle","niglet","nimphomania","nimrod","ninny","nipple","nipples","nob","nob jokey","nobhead","nobjocky","nobjokey","nooky","nsfw images","nude","nudity","numbnuts","nut sack","nutsack","nympho","nymphomania","octopussy","omorashi","one cup two girls","one guy one jar","opiate","opium","oral","orally","organ","orgasim","orgasims","orgasm","orgasmic","orgasms","orgies","orgy","ovary","ovum","ovums","p.u.s.s.y.","p0rn","paddy","paedophile","paki","panooch","pantie","panties","panty","pastie","pasty","pawn","pcp","pecker","peckerhead","pedo","pedobear","pedophile","pedophilia","pedophiliac","peepee","pegging","penetrate","penetration","penial","penile","penis","penisbanger","penisfucker","penispuffer","perversion","peyote","phalli","phallic","phone sex","phonesex","phuck","phuk","phuked","phuking","phukked","phukking","phuks","phuq","piece of shit","pigfucker","pillowbiter","pimp","pimpis","pinko","piss pig","pissed","pissed off","pisser","pissers","pisses","pissflaps","pissin","pissing","pissoff","piss-off","pisspig","playboy","pleasure chest","pms","polack","pole smoker","polesmoker","pollock","ponyplay","poof","poon","poonani","poonany","poontang","poop","poop chute","poopchute","poopuncher","porch monkey","porchmonkey","porn","porno","pornography","pornos","potty","prick","pricks","prig","prince albert piercing","pron","prostitute","prude","pthc","pube","pubes","pubic","pubis","punanny","punany","punkass","punky","punta","puss","pusse","pussi","pussies","pussy","pussylicking","pussypounder","pussys","pust","puto","queaf","queef","queer","queerbait","queerhole","queero","queers","quicky","quim","racy","raghead","raging boner","rape","raped","raper","raping","rapist","raunch","rectal","rectum","rectus","reefer","reetard","reich","renob","retard","retarded","reverse cowgirl","revue","rimjaw","rimjob","rimming","ritard","rosy palm","rosy palm and her 5 sisters","rtard","r-tard","rump","rumprammer","ruski","rusty trombone","s hit","s&m","s.h.i.t.","s.o.b.","s_h_i_t","s0b","sadism","sadist","sand nigger","sandler","sandnigger","sanger","santorum","scag","scantily","scat","schizo","schlong","scissoring","screw","screwed","screwing","scroat","scrog","scrot","scrote","scrotum","scrud","scum","seaman","seamen","seduce","seks","semen","sex","sexo","sexual","sexy","sh!+","sh!t","sh1t","s-h-1-t","shag","shagger","shaggin","shagging","shamedame","shaved beaver","shaved pussy","shemale","shi+","shibari","shit","s-h-i-t","shitass","shitbag","shitbagger","shitblimp","shitbrains","shitbreath","shitcanned","shitcunt","shitdick","shite","shiteater","shited","shitey","shitface","shitfaced","shitfuck","shitfull","shithead","shithole","shithouse","shiting","shitings","shits","shitspitter","shitstain","shitt","shitted","shitter","shitters","shittiest","shitting","shittings","shitty","shiz","shiznit","shota","shrimping","sissy","skag","skank","skeet","skullfuck","slag","slanteye","slave","sleaze","sleazy","slut","slutbag","slutdumper","slutkiss","sluts","smeg","smegma","smut","smutty","snatch","snowballing","snuff","s-o-b","sodom","sodomize","sodomy","son-of-a-bitch","souse","soused","spac","sperm","spic","spick","spik","spiks","splooge","splooge moose","spooge","spook","spread legs","spunk","steamy","stfu","stiffy","stoned","strap on","strapon","strappado","strip","strip club","stroke","stupid","style doggy","suck","suckass","sucked","sucking","suckmydick","sucks","suicide girls","sultry women","sumofabiatch","swastika","swinger","t1t","t1tt1e5","t1tties","tainted love","tampon","tard","taste my","tawdry","tea bagging","teabagging","teat","teets","teez","terd","teste","testee","testes","testical","testicle","testis","threesome","throating","thrust","thug","thundercunt","tied up","tight white","tinkle","tit","titfuck","titi","tits","titt","tittie5","tittiefucker","titties","titty","tittyfuck","tittyfucker","tittywank","titwank","toke","tongue in a","toots","topless","tosser","towelhead","tramp","tranny","transsexual","trashy","tribadism","tub girl","tubgirl","turd","tush","tushy","tw4t","twat","twathead","twatlips","twats","twatty","twatwaffle","twink","twinkie","two girls one cup","twunt","twunter","ugly","unclefucker","undies","undressing","unwed","upskirt","urethra play","urinal","urine","urophilia","uterus","uzi","v14gra","v1gra","vag","vagina","vajayjay","va-j-j","valium","venus mound","viagra","vibrator","violet wand","virgin","vixen","vjayjay","vodka","vomit","vorarephilia","voyeur","vulgar","vulva","w00se","wad","wang","wank","wanker","wankjob","wanky","wazoo","wedgie","weed","weenie","weewee","weiner","weirdo","wench","wet dream","wetback","wh0re","wh0reface","white power","whitey","whiz","whoar","whoralicious","whore","whorealicious","whorebag","whored","whoreface","whorehopper","whorehouse","whores","whoring","wigger","willies","willy","womb","woody","wop","wrapping men","wrinkled starfish","wtf","xrated","x-rated","xxx","yaoi","yeasty","yellow showers","yiffy","yobbo","zoophile","zoophilia","zubb","(ock","[ock",".f uc k","@rse","@rsehol","@unt","[unt","< unt","<.unt","<loth head","<lothhead","<nuts","<o(k","<o<&nbsp;k","<o<ksu<ka","<o<ksu<ker","<oon","<u&nbsp;nt","<u&nbsp;nts","<u*t","<unt","<unt's","<vnt","<vnts","a$$hole","a$$hole$","a$$holes","a.rse","a+*hole","ar$ehole","ar$hole","ar$holes","ar5h0le","ar5h0les","ars3","arse hole","arseh0le","arseh0les","arseho","arsehol","arseholes","arsewipe","arsh0le","arshole","arsholes","ashole","ass h0le","assh0les","b.astard","b.ollocks","b.ugger","b@st@rd","b@st@rds","b00tha","b00thas","b0ll0cks","b0llocks","b3llend","basterd","basyard","basyards","batty boy","batty&nbsp;boi","batty&nbsp;boy","beef curtains","belend","bell end","bell.end","bell-end","bin dippers","bin-dippers","bo11ocks","boabie sooking","boaby sooking","boll0cks","bolocks","bolox","bootha","boothas","bum bandit","bum hole","bumbandit","bum-bandit","bumh0l3","bumh0le","bumhol3","bumhole","c *nt!","c *nts!","c u n t","c u n t.","c#nt","c&nbsp;u&nbsp;n&nbsp;t","c* nt","c.unt","c.untyb.ollocks","c_u_n_t","c00n","c0cksucka","cahnt","cahnts","clunge","cnuts","co(k","coc&nbsp;k","cocksucka","cocksuckers","cocksuckers.","cossor ali","cretin","cripple","critest","cu&nbsp;nt","cu&nbsp;nts","cunting","cunt's","cvnt","cvnts","d1ck!","d1ckh@ed","darky","dick&nbsp;head","dumbfucker","dxxkhead","ethnics","f ck","f o a d","f off","f u c ked","f uc k","f uc king","f uck","f###","f##k","f##king","f#cked","f$cks","f&nbsp;cked","f&nbsp;u&nbsp;c&nbsp;k","f&nbsp;uck","f&nbsp;ucker","f&nbsp;ucking","f()()k","f()()ker","f()()king","f*#kin'","f*&k","f*&k!ng","f.o.a.d","f.o.a.d.","f.u.c.k.","f.uck","f@@@in","f@@@ing","f@ck","f@g","f@gs","f[_]cker","f[_]cking","f^^k","f^^ked","f^^ker","f^^king","f^ck","f^cker","f^cking","f__kin","f__king","f<uk","f>>k","f00k","f00ked","f0oked","fackin","facking","f4ggot","f4gg0t","fagg0t","faggits","fagits","fck","f'ck","fck&nbsp;ing","fck1ng","fckeud","fckin","fcking","fcks","fckw1t","fckwit","fcuked","fcukin","fcuks","feckin","fecking","f---ed","fekking","felched","feltching","f-----g","f---ing","f--k","fkin","fking","flucknuts","fo0ked","f-o-a-d","fookd","fooked","fookin","fookin'","fooking","frig","frigging","frigin","friging","fu <k","fu&kin","fu&king","fu&nbsp;ck","fu&nbsp;cked","fu&nbsp;cker","fu&nbsp;cking","fu(k","fu(ker","fu(kers","fu.ck","fu@k","fu@ker","fu^k","fu^ker","fu^king","fu< kin","fu<k","f-u-<-k","fu<ked","fu<ker","fu<kin","fu<king","fu<kker","fu<kr","fu<ks","fuc&nbsp;ked","fuc&nbsp;ker","fuc&nbsp;king","f-uck","fúck","fúçk","fùck","fûck","fück","fuck&nbsp;ed","fuck&nbsp;ing","fucke&nbsp;d","fucki&nbsp;ng","fúcking","fuckinghell","fuckk","fuckw1t","fuck-wit","fuckwits","fucw1t","fucwit","fudge p@cker","fudgep@cker","fudge-p@cker","fudge-packer","fudgpacker","fukced","fuked","fukin","fuking","fukk","fukked","fukking","fuukn","fvckup","fvck-up","fvckw1t","fvckwit","gang-bang","gash","gayhole","gimp","girlie-gardening","goris","gypo","gypos","gyppo","gyppos","hvns","israelians","ities","k@ffir","k@ffirs","k@fir","k@firs","kaf1r","kaff1r","kaffir","kaffirs","kafir","kafirs","kafr","kants","khunt","kiddie fiddler","kiddie fiddling","kiddie-fiddler","kiddie-fiddling","kiddy fiddler","kiddyfiddler","kiddy-fiddler","kn0b","knob&nbsp;head","knobber","kuffar","m.inge","m.otherf.ucker","m1nge","mofuccer","mofucker","mofuckers","mofucking","mofukcer","mohterfuccer","mohterfuccers","mohterfuck","mohterfucker","mohterfuckers","mohterfucking","mohterfucks","mohterfuk","mohterfukcer","mohterfukcers","mohterfuking","mohterfuks","moterfuccer","moterfuck","moterfucker","moterfuckers","moterfucking","moterfucks","mothafuccer","motha-fucka","mother f---ers","motherfuccer","motherfuccers","motherfukkker","mthafucca","mthafuccas","mthafucka","mthafuckas","mthafukca","mthafukcas","muff-diver","muff-diving","muffs","muth@fucker","muthafuccer","muthafuck","muthafuck@","muthafucka","muthafuckers","muthafucking","muthafucks","muthafukas","niga","nignog","nig-nog","nob&nbsp;head","nonce","p.iss-flaps","p@ki","p@kis","p00f","p00fs","p00fter","p00fters","p0of","paedo","paedophiles","pak1","pakis","peado","peadofile","peadofiles","peedo","peedofile","peedofiles","peedophile","peedophiles","peedos","pench0d","pench0ds","penchod","penchods","phanny","phanny.","pheck","phecking","phelching","pheque","phequing","phucker","phuckin","phucking","phucks","pikey","pillow biter","pillow-biter","piss off","po0f","poff","ponce","poo stabber","poo stabbers","poofs","poofter","pr!ck","pr!ck.","pr1ck","pr1ck!","pr1cks","pr1cks!","prik","pu$$y","ragheads","ret@rd","rim job","s.hit","s1ut","sc u m!","sc um","sh hit","sh!te","sh!tes","sh1te","shirtlifter","shirtlifters","shit stabber","shit stabbers","shitstabber","shitstabbers","spastic","spaz","spaz.","spit roasting","spitroast","spit-roast","spit-roasting","spunking","ß0ll0çk5","t w a t","t wat","t&nbsp;w&nbsp;a&nbsp;t","t&nbsp;w&nbsp;a&nbsp;t&nbsp;s","t.wat","t0$$er","t0sser","t0ssers","tea-bagging","to55er","to55ers","tosser,","tossers","tossurs","towel head","tvvat","tvvats","tw at","tw&nbsp;at","tw@","tw@t","tw@ts","tw_t","twa t","twatt","twattish","twunts","up the gary","w anker","w ankers","w#nker","w#nkers","w*nkers, 0","w.ank","w@nk","w@nker","w@nkers","w@nks","w0g","w0gs","w4nker!","w4nkers!","wa nker","wan k er","wan k ers","wan ker","wanka","wanke r","wanked","wankers","wanking","wanks","wank's","wet spam","whanker","whankers","wog","xrse","xrseh","xrsehol","xrsehole","xxxhole","y!ddo!","y!ddo!!","yid","yido","zachariah bishop","blow-job","boner:deboner","bonk:bonkers","candy-ass","chuffnuts","cojones","dipstick","feak","furbox","furburger","gayboy","ginch","gnikcuf","hardon","honkers","kcid","kcuf","lactoids","lesbyterian","lezzo","man-root","nestlecock","onanism","pusy","queve","quimsteak","qveer","sappho","scumbag","scumber","sexpot","shagbucket","shagstress","snarf","sodomite","strollop","suckster","tnuc","toggaf","tribadist","twank","wiseass","wizzer"];e.hasBadWords=function(e){e=e.toLowerCase();for(let i in t)if(e.includes(t[i]))return!0;return!1},e.extractKeywords=function(e,i){for(var t=[],o=e.length,n=(e=e.toLowerCase(),""),s=0;s<o;s++){var a=e.charAt(s);-1!="abcdefghijklmnopqrstuvwxyz".indexOf(a)?n+=a:(n.length>i&&t.push(n),n="")}return t},e.fillZero=function(e,i){for(var t=e+"",o=i||1;t.length<=o;)t="0"+t;return"0"==t&&(t="00"),t},e.formatRank=function(e){var i="th";return 1==e&&(i="st"),2==e&&(i="nd"),3==e&&(i="rd"),e+i},e.commas=function(e,i){i=i||3;for(var t,o="",n=0,s=(e=e+"").length-1;s>=0;s--)t="",++n>=i&&s>0&&(n=0,t=" "),o=(t+=e.charAt(s))+o;return o},e.toDollars=function(i,t,o){var n=i<0,s=(o=o||1,(t="$"|t)+e.commas(Math.abs(Math.round(i/o))));return n&&(s="-"+s),s},e.simplify=function(e){var i="";e=e.toLowerCase();for(var t in e)-1=="aeiou".indexOf(e[t])&&(i+=e[t]);return i},e.toArray=function(e,i){var t=[];if(!e)return t;for(var o in e){var n=e[o];i&&(n=parseInt(n)),t.push(n)}return t},e.commarize=function(t,o){if(!MATH.isNumber(t))return t;var n=Math.round(t),s="";if(n>=1e3){var a=3*Math.floor((t.toFixed(0).length-1)/3);n=Math.floor(n/("1e"+a)*100)/100,s=e.capitalize(i[Math.floor(a/3)-1])}else n=Math.floor(100*n)/100;var r={number:n,value:n,unit:s||""};s&&(s=""+s);var c=n+s;return r.formatted=c,o?r:c},e.capitalize=function(e){return"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1)},e.stringify=function(e){var i;try{i=JSON.stringify(e)}catch(e){return log("JSON ENCODE FAILED")}return i},e.random=function(i=10){let t="",o=e.ALPHABET.length;for(let n=0;n<i;n++)t+=e.ALPHABET.charAt(Math.floor(Math.random()*o));return t}};function Cue(e,t){var n=this,u=n._pool=[],o=n.data=[],r=n.pool=[];function getLength(){return n.length=u.length,n.length}function setSelected(e){return n.selected=Array.isArray(e)?n.isShuffle?shuffle(e):copy(e):e,n.selected}n.id=t,n.position=0,n.isRandom=e,n.isShuffle=e,n.selected=null,n.length=0,n.reset=function(){n.position=0,r=n.pool=n.isRandom?shuffle(u):copy(u),n.selected=null},n.push=function(e){return u.push(e),getLength(),e},n.pushUnique=function(e){return pushUnique(u,e),getLength(),e},n.copy=function(e){return u=n._pool=e,getLength(),n},n.pushArray=function(e){return push(e,u),getLength(),n},n.clone=function(){return new Cue(n.isRandom,t+"clone").copy(u)},n.fillChance=function(e){var t;for(e*=10,n.isRandom=!0,t=0;t<e;t++)n.push(!0);for(t=e;t<10;t++)n.push(!1);return n},n.getLength=getLength,n.add=function(e,t){return n[e+=""]=o[e]=t,n.push(t)},n.get=function(e){return null!=e?setSelected(o[e]):(r.length||n.reset(),setSelected(r.shift()))},n.shift=n.get,n.getNext=function(){return r[0]},n.setShuffle=function(e){return n.isShuffle=e,n},n.consume=function(){if(null!==n.selected||void 0!==n.selected){var e=n.selected;if(Array.isArray(e)){if(e.length)return e.shift();e=null}else n.position++;return n.selected=null,e}},n.removeItem=function(e){return removeItem(r,e),n.selected==e&&(n.selected=null),e},n.clear=function(){r=n.pool=[],n.selected=null},n.getPosition=function(e){if(e&&!(e<0)){for(n.reset();e>u.length;)e-=r.length;for(var t;n.position<e;)t=n.get();return t}}}var FriendFake=pc.createScript("friendFake");FriendFake.prototype.cue=(new Cue).fillChance(.1),FriendFake.prototype.initialize=function(){var e=this.entity,t=e.findByName("Bubble"),a=FriendFake.prototype.cue.get();if(t.enabled=!1,a){var i=FRIENDS.getOrBot().userPhoto;ASSETS.loadAvatar(i,(function onLoaded(){t.enabled=!0,fill(t,{userPhoto:i}),ANIMATION.bounceScaleTo(e)}))}};var TEXT3D;function FX3DPresets(){var e=FX3D,a=!1;function processVars(a){if((a=a||{})._processed)return a;a._processed=!0,a.space3D=null==a.space3D||a.space3D,a.parent=a.parent||e;var t=a.entity?a.entity.getPosition().clone():a.position||new pc.Vec3(a.x||0,a.y||0,a.z||0);return a.offset&&t.add(a.offset),a.x=t.x,a.y=t.y,a.z=t.z,delete a.position,delete a.entity,delete a.offset,a}function getParticleColor(e){if(!e)return"WHITE_Particle";var a=e.toUpperCase()+"_Particle";return ASSETS.find(a)?a:"WHITE_Particle"}e.init=function(){a||(a=!0,on("FX3D",(function(a){e[a.template]&&e[a.template](a.vars)})))},e.play=function(a){if(UIFX.isEnabled)return(a=processVars(a)).time=a.time||1,a.times>1&&(a.times--,delay((()=>e.play(a)),a.time/2)),a.sound&&SFX.play(a.sound),UIFX.spawn(a)},e.CONFETTI={},e.CONFETTI.play=function(a){if(UIFX.isEnabled){var t=(a=processVars(a)).amount||15,i=a.radius||2,l=a.scale||2,s=a.speed||5,c=a.gravity||.1,n=a.radiusY||1,r=a.radiusZ||1,o=new pc.Vec3;a.time=a.time||10;for(var p=a.particles||["ConfettiRed","ConfettiBlue","ConfettiGreen","ConfettiYellow","ConfettiFucsia"],d=0;d<t;d++)for(var u=0;u<p.length;u++){o.x=spectrumDecimal(i),o.z=spectrumDecimal(i),o.y=spectrumDecimal(i),o.normalize();var m={x:a.x+o.x*i,y:a.y+o.y*i*n,z:a.z+o.z*i*r,particle:p[u],scale:decimal(l,.25*l),scaleIn:.2,sinVelX:decimal(),sinVelZ:decimal(),speedX:o.x*s,speedY:Math.abs(o.y*s*3),speedZ:o.z*s,rotation:new pc.Vec3(spectrumDecimal(360),spectrumDecimal(360),spectrumDecimal(360)),rotationVel:new pc.Vec3(spectrumDecimal(10),spectrumDecimal(10),spectrumDecimal(10)),gravity:decimal(c,.1*c),time:a.time||10};e.play(merge(m,a))}}},e.CONFETTI.inYourFace=function(a){(a=processVars(a)).speed=a.speed||.7,a.gravity=a.gravity||.05,a.scale=a.scale||.6,a.radius=a.radius||.7,a.radiusY=a.radiusY||4,e.CONFETTI.play(a)},e.CONFETTI.sides=function(a={}){if(void 0!==a.z||void 0!==a.y){let e=CAMERA.Front.pos.clone();e.z=a.z||e.z,e.y=a.y||e.y,CAMERA.Front.setLocalPosition(e)}function doSide(a,t){(t=extract(t)).parent=a,t.radiusY=t.radiusY||2,t.scale=t.scale||.5,t.radius=t.radius||1,t.amount=t.amount||7,t.speed=t.speed||.7,t.gravity=t.gravity||.05,e.CONFETTI.play(t)}delete a.z,delete a.y,doSide(CAMERA.Left,a),doSide(CAMERA.Right,a),resetLocals(CAMERA.Front)},e.CONFETTI.smaller=function(a){if(!(a=processVars(a)).x&&!a.y&&!a.z){var t=CAMERA.getPosition().clone();a.z=t.z-5,a.y=t.y-2}a.speed=a.speed||2.5,a.gravity=a.gravity||.05,a.scale=a.scale||.7,e.CONFETTI.play(a)},e.CONFETTI.tiny=function(a){if(!(a=processVars(a)).x&&!a.y&&!a.z){var t=CAMERA.getPosition().clone();a.z=t.z-5,a.y=t.y-2}a.amount=10,a.speed=a.speed||1.5,a.gravity=a.gravity||.03,a.scale=a.scale||.5,a.radiusY=a.radiusY||2,a.forceY=a.forceY||.1,e.CONFETTI.play(a)},e.CONFETTI.spark=function(a){if(!(a=processVars(a)).x&&!a.y&&!a.z){var t=CAMERA.getPosition().clone();a.z=t.z-5,a.y=t.y-2}a.amount=10,a.speed=a.speed||1.5,a.gravity=a.gravity||.03,a.scale=a.scale||.5,a.radius=.1,a.radiusY=a.radiusY||1,a.forceY=a.forceY||.1,e.CONFETTI.play(a)},e.TEXT=TEXT3D={},e.TEXT.play=function(a){if(!UIFX.isEnabled)return;(a=processVars(a)).time=a.time||1,a.text=a.text||"Text",a.color=a.color||"#FFFFFF",a.particle=a.particle||"TEXT_Particle",a.alpha=a.alpha||1,a.endAlpha=a.endAlpha||0,a.scale=a.scale||2.5,a.billboard=!0;let t=e.play(a);function onUpdate(){t.entity&&t.entity.element&&(t.entity.element.outlineThickness=t.entity.element.opacity)}return startFixed(onUpdate),delay((()=>stop(onUpdate)),a.time),t},e.TEXT.pop=function(a){if(UIFX.isEnabled){(a=processVars(a)).speedY=a.speedY||4;var t=e.TEXT.play(a),i=a.bounce||.5;return ANIMATION.bounceScale(t.entity,null,i,i,i,a.time),t}},e.TEXT.popOut=function(a){if(UIFX.isEnabled){(a=processVars(a)).speedY=a.speedY||4;var t=e.TEXT.play(a);return ANIMATION.bounceScaleTo(t.entity,.5,1,.4,EASING.SineOut),delay((function(){ANIMATION.bounceScaleTo(t.entity,1,.3,2,EASING.SineOut)}),.4),t}},e.TEXT.right=function(a){if(UIFX.isEnabled){(a=processVars(a)).speedX=a.speedX||3,a.scale=a.scale||.7;var t=e.TEXT.play(a);a.bounce;return t}},e.DUST={},e.DUST.play=function(a){if(UIFX.isEnabled){var t=(a=processVars(a)).scaling||1;a.radius=a.radius||.5,a.x+=RANDOM.spectrumDecimal(a.radius)*t,a.z+=RANDOM.spectrumDecimal(a.radius)*t,a.particle=a.particle||getParticleColor(a.color),a.time=(a.time||.4)*RANDOM.decimal(1,.5),a.speedY=a.speedY||-1,a.scale=(a.scale||1.7)*t*RANDOM.decimal(1,.5),a.endScale=0,e.play(a)}},e.DUST.small=function(a){UIFX.isEnabled&&((a=processVars(a)).time=a.time||.2,a.scale=a.scale||1.3,e.DUST.play(a))},e.DUST.orange=function(a){UIFX.isEnabled&&((a=processVars(a)).time=a.time||.6,a.scale=a.scale||2,a.particle=a.particle||chance()?"YELLOW_Particle":"ORANGE_Particle",e.DUST.play(a))},e.DUST.fire=function(a){UIFX.isEnabled&&((a=processVars(a)).time=a.time||.6,a.scale=a.scale||2,a.particle="FIRE_Particle",e.DUST.play(a))},e.SPLATT={},e.SPLATT.play=function(a){if(UIFX.isEnabled){(a=processVars(a)).time=a.time||5,a.amount=a.amount||25,a.scale=a.scale||.6,a.velX=a.velX||40,a.velY=a.velY||40,a.velZ=a.velZ||40,a.forceX=a.forceX||0,a.forceY=a.forceY||0,a.forceZ=a.forceZ||0,a.time=a.time||2.5,a.gravity=a.gravity||1,a.friction=.99,a.endScale=a.endScale||.001*a.scale,a.particle=a.particle||getParticleColor(a.color);for(var t=0;t<a.amount;t++){var i={};i.rotation=new pc.Vec3(spectrumDecimal(360),spectrumDecimal(360),spectrumDecimal(360)),i.speedX=Math.cos(i.rotation.x)*a.velX*.5,i.speedY=Math.sin(i.rotation.y)*a.velY*.5,i.speedZ=Math.sin(i.rotation.z)*a.velZ*.5,i.offsetX=i.speedX*Math.random(),i.offsetY=i.speedY*Math.random(),i.scale=a.scale*decimal(2,.5),i.forceY=a.isFountain?random(a.forceY,a.forceY/2):a.forceY,i.rotationVel=new pc.Vec3(.01*i.rotation.x,.01*i.rotation.y,.01*i.rotation.z),i.time=random(a.time,.5*a.time),e.play(merge(i,a))}}},e.SPLATT.fountain=function(a){UIFX.isEnabled&&((a=processVars(a)).y=a.y||.2,a.z=a.z||7,a.scale=a.scale||1,a.velX=a.velX||20,a.velY=a.velY||80,a.isFountain=!0,e.SPLATT.play(a))},e.SPLATT.small=function(a){UIFX.isEnabled&&((a=processVars(a)).amount=a.amount||5,e.SPLATT.play(a))},e.SPLATT.burst=function(a){UIFX.isEnabled&&((a=processVars(a)).amount=a.amount||10,a.time=a.time||2,a.scale=a.scale||1,a.velX=a.velX||20,a.velY=a.velY||20,a.velZ=a.velZ||20,a.forceY=a.forceY||10,e.SPLATT.play(a))},e.SPLATT.explosion=function(a){UIFX.isEnabled&&((a=processVars(a)).particle="EXPLOSION_Particle",a.velX=a.velX||20,a.velY=a.velY||20,a.velZ=a.velZ||20,a.scale=a.scale||.3,e.SPLATT.play(a))},e.STARS={},e.STARS.play=function(a){if(UIFX.isEnabled){(a=processVars(a)).amount=a.amount||7,a.scale=a.scale||.05,a.velX=a.velX||6,a.velY=a.velY||6,a.velZ=a.velZ||6,a.time=a.time||1,a.alpha=a.alpha||1,a.endAlpha=a.endAlpha||0,a.sprite=a.sprite||"FX_Star",a.billboard=!0;for(var t=0;t<a.amount;t++){var i={},l=360*t/a.amount,s=decimal(1,.25);i.speedX=Math.cos(l)*a.velX*s,i.speedY=Math.sin(l)*a.velY*s,i.offsetX=i.speedX,i.offsetY=i.speedY,i.scale=a.scale*decimal(2,.5),i.forceY=a.isFountain?random(a.forceY,a.forceY/2):a.forceY,i.time=random(a.time,.5*a.time),e.play(merge(i,a))}}},e.EXPLOSION={},e.EXPLOSION.boom=function(a){if(!UIFX.isEnabled)return;let t=a.entity;if(!t)return;a=processVars(a);let i,l={};i=UISIZE.worldToScreen(t);for(var s=0;s<4;s++)shockwave(s);function shockwave(e){delay((function(){l.x=i.x+spectrumDecimal(40),l.y=i.y+spectrumDecimal(40),l.z=0,l.scale=1,FX2D.SMOKE.play(l)}),.3*e)}for(s=0;s<4;s++)explosion(s);function explosion(i){delay((function(){e.play({particle:"FIRE_Particle",x:spectrumDecimal(.4),y:spectrumDecimal(.4),z:spectrumDecimal(.4),time:.2,scale:3,endScale:.5,parent:t}),a.amount=2,a.velY=50,a.velX=10,a.velZ=10,e.SPLATT.explosion(a)}),.3*i)}},e.EXPLOSION.radial=function(e){if(UIFX.isEnabled)for(var a=(e=e||{}).x||0,t=e.y||0,i=e.speed||10,l=e.time||1,s=e.amount||10,c=e.scale||1,n=decimal(360),r=0;r<=s;r++){var o=360/s*r+n,p={x:a,y:t,scale:c,endScale:c,speedX:Math.cos(o)*i,speedY:Math.sin(o)*i,rotationVel:new pc.Vec3(0,0,spectrumDecimal(7,3)),time:l};UIFX.spawn(merge(p,e))}},e.EXPLOSION.boom=function(a){if(!UIFX.isEnabled)return;(a=processVars(a)).particle=a.particle||"FIRE_Particle",a.scale=a.scale||2,a.endScale=a.endScale||3*a.scale,a.time=a.time||.14,e.play(a)},e.SPARKS={},e.SPARKS.play=function(a){if(!UIFX.isEnabled)return;let t=a.scale||.025;a.scale=t*decimal(1,.5);let i=a.positionScale||t;a.offset=a.offset||new pc.Vec3(spectrumDecimal(20*i),decimal(20*i),spectrumDecimal(40*i)),(a=processVars(a)).sprite=a.sprite||["FX_Particle","FX_Ninja","FX_Ninja_1"],a.blend=1,a.time=(a.time||4)*decimal(1,.5),a.endScale=.1*a.scale,a.speedY=(a.speedY||.15)*decimal(1,.3)*6,a.rotation=new pc.Vec3(0,0,decimal(360)),a.rotationVel=new pc.Vec3(0,0,spectrumDecimal(1)),a.scaleIn=.2,e.FADE.out(a)},e.FADE={},e.FADE.out=function(a){if(UIFX.isEnabled)return(a=processVars(a)).alpha=a.alpha||1,a.endAlpha=0,e.play(a)},e.FADE.inOut=function(a){return(a=processVars(a)).alpha=null!=a.alpha?a.alpha:0,a.endAlpha=null!=a.endAlpha?a.endAlpha:0,a.midAlpha=null!=a.midAlpha?a.midAlpha:.75,e.play(a)},e.FADE.vanish=function(a){if(UIFX.isEnabled){(a=processVars(a)).time=a.time||.4,a.isStandalone=!0;var t=e.play(a);return ANIMATION.scaleTo(t.entity,new pc.Vec3,a.time,EASING.SineOut),t}},e.SHOCKWAVE={},e.SHOCKWAVE.play=function(a){if(UIFX.isEnabled)return(a=processVars(a)).blend=null!=a.blend?a.blend:1,a.scale=a.scale||.2,a.endScale=a.endScale||8*a.scale,a.rotation=a.rotation||new pc.Vec3(0,0,decimal(360)),a.rotationVel=a.rotationVel||new pc.Vec3(0,0,spectrumDecimal(1,.25)),a.sprite=a.sprite||"FX_Shockwave",e.FADE.inOut(a)},e.SHOCKWAVE.land=function(a){if(UIFX.isEnabled)return(a=processVars(a)).scale=a.scale||.2,a.endScale=a.endScale||5*a.scale,a.blend=1,a.rotation=a.rotation||new pc.Vec3(-90,0,0),a.rotationVel=pc.Vec3.ZERO,a.time=a.time||.4,e.FADE.out(a)},e.SHOCKWAVE.dust=function(a){if(UIFX.isEnabled)return(a=processVars(a)).blend=1,a.scale=a.scale||.2,a.endScale=a.endScale||.1*a.scale,a.time=a.time||.2,a.sprite=a.sprite||"FX_Blur",e.FADE.out(a)},e.SHOCKWAVE.expand=function(a){UIFX.isEnabled&&((a=processVars(a)).scale=a.scale||1,a.endScale=a.endScale||4*a.scale,e.SHOCKWAVE.play(a))},e.SHOCKWAVE.condense=function(a){UIFX.isEnabled&&((a=processVars(a)).sprite=a.sprite||"FX_Shockwave",a.time=a.time||.6,a.blend=a.blend||0,a.scale=a.scale||2,a.endScale=a.endScale||.05*a.scale,e.SHOCKWAVE.play(a))},e.SHOCKWAVE.halo=function(a){UIFX.isEnabled&&((a=processVars(a)).sprite=a.sprite||"FX_Halo",a.time=a.time||.7,e.SHOCKWAVE.expand(a))},e.SHOCKWAVE.bounce=function(a){if(UIFX.isEnabled){(a=processVars(a)).scale=a.scale||.2,a.endScale=a.scale;var t=e.SHOCKWAVE.expand(a),i=a.bounce||.5;return ANIMATION.bounceScale(t.entity,null,i,i,i,a.time),t}}}var Fxaura=pc.createScript("fxaura");Fxaura.attributes.add("id",{type:"string"}),Fxaura.prototype.initialize=function(){var n=this,e=n.entity,o=e.findByName("Shockwave"),a=e.findByName("Condense");function doCommand(e,o){n[e]&&n[e](o)}function show(e,o){n.Hide(),(e.element||e.sprite).opacity=1,e.enabled=!0,e.motion.fill(o)}n.setId=function(n){n&&onLabel(n,"Command",doCommand)},n.setId(n.id),n.Hide=function(){o.enabled=a.enabled=!1},n.Pop=function(n){show(o,n);var e=o.sca.x,a=.3*e,i=.2;ANIMATION.fadeFromTo(o,.3,.6,i),ANIMATION.bounceScaleTo(o,.8*e,e,i,EASING.SineOut,(function(){ANIMATION.fadeTo(o,0,i),ANIMATION.bounceScaleTo(o,e,a,i,EASING.SineIn)}))},n.Explode=function(n){n.isBurstingB=2,n.color="WHITE",show(a,n)}};var MultiplayerConfig=pc.createScript("multiplayerConfig");MultiplayerConfig.attributes.add("mode",{title:"Mode",type:"string",enum:[{Realtime:"Realtime"},{TurnBased:"TurnBased"},{Disabled:"Disabled"}],default:"TurnBased"}),MultiplayerConfig.attributes.add("module",{title:"Module",type:"string",enum:[{VS:"VS"},{Lobby:"Lobby"},{Disabled:"Disabled"}],default:"Disabled"}),MultiplayerConfig.attributes.add("minPlayers",{title:"Min Players",type:"number",default:2}),MultiplayerConfig.attributes.add("maxPlayers",{title:"Max Players",type:"number",default:2}),MultiplayerConfig.attributes.add("canSpectate",{title:"Can Spectate",type:"boolean",default:!1}),MultiplayerConfig.attributes.add("realMultiplayer",{title:"Real Multiplayer",type:"boolean",default:!1}),MultiplayerConfig.prototype.postInitialize=function(){CONFIG.add("GAME.MULTIPLAYER",this)};var ScenesConfig=pc.createScript("scenesConfig");ScenesConfig.attributes.add("instancing",{title:"Hardware Instancing",type:"boolean",default:!0}),ScenesConfig.attributes.add("checkBatchGroups",{title:"Instancing BatchGroups",type:"boolean",default:!0}),ScenesConfig.attributes.add("enableShadows",{title:"Instancing Enable Shadows",type:"boolean",default:!1}),ScenesConfig.attributes.add("skipPreload",{title:"Skip Preload",type:"boolean",default:!1}),ScenesConfig.prototype.initialize=function(){var e=this;CONFIG.add("SCENES",e),e.instancing&&(TOY.entity.script.create("uranusInstancerLite"),UranusInstancerLite.api.setShadows(e.enableShadows),UranusInstancerLite.api.setCheckBatchGroups(e.checkBatchGroups));var n=APP.root.findByName("GAMEPLAY");function onLoaded(e){ANALYTICS&&ANALYTICS.onPreloadEnd(),(n=e).enabled=!1;var a=n.findByName("SCENES");if(a.addComponent("script"),a.script.create("scenes"),UI.scan(n.findByName("UI")),!ASSETS.findScene("UI"))return onReady();ASSETS.getScene("UI",(function(e){let n=e.findByName("UI");n.enabled=!1,UI.scan(n);let a=e.findByName("SCENES");a.enabled=!1,SCENES.scan(a),onReady()}))}function onReady(){log("==SCENES:onInit"),fire("SCENES:onInit")}n?(n.enabled=!1,onLoaded(n)):ASSETS.find("GAMEPLAY","template")?ASSETS.loadTemplate("GAMEPLAY",APP.root,onLoaded,!0):ASSETS.getScene("GAMEPLAY",onLoaded),on("TOY:onFinalize",(function(){log("SCENESConfig finalizing"),UISIZE.adjustResolution(),addChild(n,root),PLATFORM.getTournament((function(e){if(e)return GAME.play();!function doGo(){var e=CONFIG.SCENES.Launch;if("Disabled"==e)return;if("Game"==e)return GAME.play();if("Shop"==e)return TOP.show(),SCREENS.show("Shop");if("Home"==e)return SCREENS.show("Home");if("Auto"==e)return XP.value?SCREENS.show("Home"):GAME.play();SCREENS.show(e)}()}))}))};var TEXT2D;function FX2DPresets(){var e=FX2D,a=!1;function processVars(a){if((a=a||{})._processed)return a;a._processed=!0,a.space3D=null!=a.space3D&&a.space3D,a.parent=a.parent||e,a.color=a.color||"#FFFFFF";var t=a.entity?UISIZE.worldToScreen(a.entity):a.position||new pc.Vec3(a.x||0,a.y||0,a.z||0);return a.offset&&t.add(a.offset),a.x=t.x,a.y=t.y,a.z=t.z,delete a.position,delete a.entity,delete a.offset,a}e.init=function(){a||(a=!0,on("FX2D",(function(a){e[a.template]&&e[a.template](a.vars)})))},e.play=function(a){if(UIFX.isEnabled)return(a=processVars(a)).time=a.time||1,a.times>1&&(a.times--,delay((()=>e.play(a)),a.time/2)),UIFX.spawn(a)},e.DAMAGE={},e.DAMAGE.play=function(e){if(UIFX.isEnabled){(e=processVars(e)).sprite="Background_Gradient2",e.isStandalone=!0;var a=UIFX.spawn(e),t=a.entity.element;t.color=COLOR.get("#ee2162"),t.width=UISIZE.WIDTH+250,t.height=UISIZE.HEIGHT+250,ANIMATION.fadeFromTo(a.entity,.6,0,e.time,EASING.SineOut)}},e.DAMAGE.white=function(e){UIFX.isEnabled&&((e=processVars(e)).color=e.color||"White")},e.CONFETTI={},e.CONFETTI.play=function(a){if(UIFX.isEnabled)for(var t=(a=processVars(a)).y||UISIZE._HEIGHT,n=a.speedY||8,l=a.amount||60,c=a.sprite||"FX_Squircle",i=a.scale||.1,s=["#26a9fc","#f62323","#00d300","#ffdc00","#ee29ff","#00ddff"],o=0;o<l;o++){var r={x:spectrumDecimal(UISIZE._WIDTH/2),y:t+spectrumDecimal(UISIZE._HEIGHT),sprite:c,scale:decimal(i,.4*i),sinVelX:decimal(),sinVelZ:decimal(),speedY:-decimal(n,.5*n),rotation:new pc.Vec3(0,spectrumDecimal(360),spectrumDecimal(360)),rotationVel:new pc.Vec3(0,spectrumDecimal(5),spectrumDecimal(5)),color:ARRAY.getRandomItem(s),time:20};e.play(ARRAY.merge(r,a))}},e.TEXT=TEXT2D={scale:1,y:0,x:0,time:0},e.TEXT.play=function(a){if(!UIFX.isEnabled)return;(a=processVars(a)).time=a.time||1,a.text=a.text||"Text",a.particle=a.particle||"TEXT_Particle",a.alpha=a.alpha||1,a.endAlpha=a.endAlpha||0,a.scale=a.scale||.02,a.x+=e.TEXT.x,a.y+=e.TEXT.y,a.scale*=e.TEXT.scale,e.time&&(a.time=e.time);let t=e.play(a);function onUpdate(){t.entity&&t.entity.element&&(t.entity.element.outlineThickness=t.entity.element.opacity)}return startFixed(onUpdate),delay((()=>stop(onUpdate)),a.time),t},e.TEXT.up=function(a){if(UIFX.isEnabled)return(a=processVars(a)).speedY=a.speedY||4,a.time=a.time||.6,e.TEXT.play(a)},e.TEXT.pop=function(a){if(!UIFX.isEnabled)return;(a=processVars(a)).speedY=a.speedY||.6,a.time=1.5,a.endAlpha=1,a.y=a.y||500,a.scale=a.scale||.01;var t=e.TEXT.play(a),n=t.entity;toFront(n);return ANIMATION.bounceScaleTo(n,.5,1,.6,EASING.SineOut,(function(){t.setEndAlpha(0),t.setSpeedY(3),ANIMATION.bounceScaleTo(n,1,.3,1,EASING.SineIn)})),t},e.FRIEND={},e.FRIEND.lines=[],e.FRIEND.getLine=function(){return e.FRIEND.lines||(e.FRIEND.lines=ARRAY.shuffle(["Awesome!","Wow!","Boom!","Haha X-)",";-)","Good job!","Beautiful!","Nice","Nice!","Cheers","I like it","Wow","Cool!"])),e.FRIEND.lines.shift()},e.FRIEND.play=function(a,t){UIFX.isEnabled&&((a=processVars(a)).time=a.time||2,a.scale=a.scale||1,a.particle=a.particle||"FRIENDFACE_Particle",a.data={userPhoto:a.userPhoto,text:a.text||e.FRIEND.getLine(),score:a.score,color:a.color,fullName:a.fullName},ASSETS.loadUserPhoto(a.data.userPhoto,(function onLoaded(){var n=e.play(a);t&&t(n)})))},e.FRIEND.pop=function(a){UIFX.isEnabled&&((a=processVars(a)).speedY=a.speedY||2,a.x=a.x||30*spectrum(10,5),a.y=a.y||30*spectrum(5)+300,e.FRIEND.play(a,(function onFriend(e){ANIMATION.bounceScaleTo(e.entity,0,1.3,1.6),delay((function(){e.entity&&(ANIMATION.bounceScaleTo(e.entity,1.3,1.4,.2,EASING.CubicOut),delay((function(){e.entity&&ANIMATION.bounceScaleTo(e.entity,1.4,.6,.2,EASING.CubicIn)}),.2))}),1.8)})))},e.FRIEND.eliminated=function(a,t){UIFX.isEnabled&&(t=processVars(t),a=a||FRIENDS.get(),extract({userPhoto:a.userPhoto,score:a.score,color:a.color,fullName:a.fullName},t),t.x=t.x||30*spectrum(10,5),t.y=t.y||30*spectrum(5)-300,t.particle=t.particle||"FRIENDELIMINATED_Particle",t.color=a.color,e.FRIEND.play(t,(function onFriend(a){if(!a.entity)return;ANIMATION.bounceScaleTo(a.entity,.6,1,2),SFX.play("Emote");let n={x:t.x,y:t.y,time:.3,scale:.2,endScale:1,color:"RED"};delay((function(){conquer.Haptic.fadeOut(),ANIMATION.shakeIncrease(a.entity,null,3,2),delay((function(){e.SHOCKWAVE.play(n),SFX.play("Kill"),delay((function(){n.sprite="FX_Condense",e.SHOCKWAVE.play(n)}),.2)}),.9),delay((function(){a.entity&&(a.entity.enabled=!1)}),1.1)}),.5)})))},e.COLLECT={},e.COLLECT.play=function(a){if(UIFX.isEnabled)for(var t=null!=(a=processVars(a)).x?a.x:TOUCH.x,n=null!=a.y?a.y:TOUCH.y,l=a.speed||10,c=a.time||1.5,i=a.amount||value(10,8),s=a.scale||.15,o=decimal(360),r=0;r<i;r++){var p=360/i*r+o,d=l*decimal(1,.3),u=Math.cos(p)*d,m=Math.sin(p)*d,E={x:t+u,y:n+m,friction:.95-decimal(.05),scale:s,fOffset:{x:spectrum(10),y:spectrum(10)},speedX:u,speedY:m,time:c+decimal(.5*c)};e.play(ARRAY.merge(E,a))}},e.FADE={},e.FADE.out=function(a){if(UIFX.isEnabled)return(a=processVars(a)).alpha=a.alpha||1,a.endAlpha=0,e.play(a)},e.FADE.inOut=function(a){return(a=processVars(a)).alpha=null!=a.alpha?a.alpha:0,a.endAlpha=null!=a.endAlpha?a.endAlpha:0,a.midAlpha=null!=a.midAlpha?a.midAlpha:.75,e.play(a)},e.FADE.vanish=function(a){if(UIFX.isEnabled){(a=processVars(a)).time=a.time||.4,a.isStandalone=!0;var t=e.play(a);return ANIMATION.scaleTo(t.entity,new pc.Vec3,a.time,EASING.SineOut),t}},e.SHOCKWAVE={},e.SHOCKWAVE.play=function(a){if(UIFX.isEnabled)return(a=processVars(a)).blend=null!=a.blend?a.blend:1,a.scale=a.scale||.2,a.endScale=a.endScale||8*a.scale,a.rotation=new pc.Vec3(0,0,decimal(360)),a.rotationVel=new pc.Vec3(0,0,spectrumDecimal(1,.25)),a.sprite=a.sprite||"FX_Shockwave",e.FADE.inOut(a)},e.SHOCKWAVE.expand=function(a){UIFX.isEnabled&&((a=processVars(a)).scale=a.scale||1,a.endScale=a.endScale||4*a.scale,e.SHOCKWAVE.play(a))},e.SHOCKWAVE.condense=function(a){UIFX.isEnabled&&((a=processVars(a)).sprite=a.sprite||"FX_Shockwave",a.time=a.time||.6,a.scale=a.scale||2,a.endScale=a.endScale||.05*a.scale,e.SHOCKWAVE.play(a))},e.SHOCKWAVE.halo=function(a){UIFX.isEnabled&&((a=processVars(a)).sprite=a.sprite||"FX_Glow",a.time=a.time||.7,e.SHOCKWAVE.expand(a))},e.SHOCKWAVE.bounce=function(a){if(UIFX.isEnabled){(a=processVars(a)).scale=a.scale||.2,a.endScale=a.scale;var t=e.SHOCKWAVE.expand(a),n=a.bounce||.5;return ANIMATION.bounceScale(t.entity,null,n,n,n,a.time),t}},e.SPARKS={},e.SPARKS.play=function(a){UIFX.isEnabled&&((a=processVars(a)).sprite=a.sprite||["FX_Ninja_1","FX_Ninja","FX_Star"],a.blend=1,a.scale=a.scale||.075,a.endScale=.5*a.scale,e.FADE.out(a))},e.SPARKS.magic=function(a){if(UIFX.isEnabled){(a=processVars(a)).amount=a.amount||7,a.speedY=a.speedY||3,a.scale=a.scale||.075,a.color=a.color||"#FFFFFF";for(var t=0;t<a.amount;t++)spawnItem()}function spawnItem(){var t={};t.x=a.x+10*spectrumDecimal(20),t.y=a.y+10*spectrumDecimal(15),t.speedY=decimal(a.speedY,.25*a.speedY),t.scale=decimal(a.scale,.25*a.scale),t.sinVelX=decimal(),DELAY.start((function(){e.SPARKS.play(ARRAY.merge(t,a))}),decimal(.5,.1))}},e.SMOKE={},e.SMOKE.play=function(a){UIFX.isEnabled&&((a=processVars(a)).sprite=a.sprite||"FX_Blur",a.scale=(a.scale||.5)*decimal(1,.2),a.x+=spectrumDecimal(80),a.y+=spectrumDecimal(50),a.time=(a.time||1)*decimal(1,.5),a.sinVelS=decimal(),a.endScale=a.scale*decimal(2,1),a.speedY=(a.speedY||5)*decimal(1,.4),a.color=a.color||["BLACK","GRAY","GRAY_LIGHT"],a.rotation=new pc.Vec3(0,0,decimal(360)),a.rotationVel=new pc.Vec3(0,0,spectrumDecimal(1)),a.scaleIn=.5,e.FADE.out(a))},e.SMOKE.black=function(a){UIFX.isEnabled&&((a=processVars(a)).time=a.time||3,a.scale=a.scale||.2,a.speedY=a.speedY||6,a.speedX=a.speedX||.34,a.alpha=decimal(1,.5),a.forceY=a.forceY||.001,a.color=a.color||["#ffcc00","#fff000","#ffc12c"],e.SMOKE.play(a))},e.SMOKE.blackBurst=function(a){if(UIFX.isEnabled){a=processVars(a);var t=0,n=0,l=a.amount||5;start((function spawn(){n||e.SMOKE.black(a);++n>1&&(n=0);++t>l&&stop(animateSmoke)}))}}}var LivesConfig=pc.createScript("livesConfig");LivesConfig.attributes.add("value",{title:"Lives",type:"number",default:1}),LivesConfig.attributes.add("max",{title:"Max Lives",type:"number",default:1}),LivesConfig.attributes.add("revive",{title:"Has Revive Modal",type:"boolean",default:!0}),LivesConfig.attributes.add("symbol",{title:"Symbol",type:"string",default:"Symbol_Head"}),LivesConfig.attributes.add("margin",{title:"Symbol",type:"number",default:75}),LivesConfig.prototype.postInitialize=function(){CONFIG.add("GAME.LIVES",this)};var ScreenCorners=pc.createScript("screenCorners");ScreenCorners.prototype.initialize=function(){var t=this,e=t.entity;t.Center=e,t.Left=e.findByName("Left"),t.Right=e.findByName("Right"),t.Top=e.findByName("Top"),t.Bottom=e.findByName("Bottom"),t.TopLeft=e.findByName("TopLeft"),t.TopRight=e.findByName("TopRight"),t.BottomLeft=e.findByName("BottomLeft"),t.BottomRight=e.findByName("BottomRight"),t.addChild=function(e,i){addChild(e,t[i])}};var PreloadConfig=pc.createScript("preloadConfig");PreloadConfig.attributes.add("tag",{title:"Force preload Tag",type:"string"}),PreloadConfig.attributes.add("mainAtlas",{title:"Preload MAIN ATLAS",type:"boolean",default:!0}),PreloadConfig.attributes.add("basis",{title:"Preload Basis",type:"boolean",default:!1}),PreloadConfig.attributes.add("assets",{title:"Assets",type:"asset",array:!0}),PreloadConfig.prototype.postInitialize=function(){var a=this,t=new Callback(-1,(function onComplete(){fire("PRELOAD:onInit")}));a.basis&&ASSETS.loadLib("BASIS","basis.wasm.js","basis.wasm.wasm","basis.js",t.listen()),a.mainAtlas&&ASSETS.preload(["MAIN_ATLAS.png"],t.listen()),ASSETS.preload(["_ATLAS.png"],t.listen()),ASSETS.loadScripts(CONFIG.id,t.listen()),a.tag&&ASSETS.preloadTags([a.tag],t.listen()),ASSETS.preloadTags([CONFIG.id]),ASSETS.preload(CONFIG.PRELOAD);var s=[];for(var e in a.assets)a.assets[e]&&s.push(a.assets[e]);s.length&&ASSETS.loadAssets(s,t.listen())};var DailyRewardConfig=pc.createScript("dailyRewardConfig");DailyRewardConfig.attributes.add("days",{type:"json",schema:[{name:"varName",type:"string",default:"Coin"},{name:"value",type:"number",default:100},{name:"getShop",type:"boolean"}],array:!0}),DailyRewardConfig.prototype.initialize=function(){var a=this;if(!CONFIG.DEBUG.hideAllRewards){for(var e in a.days)a.days[e].symbol=CONFIG.id+a.days[e].varName;CONFIG.DAILYREWARD=a.days}};var TimeConfig=pc.createScript("timeConfig");TimeConfig.attributes.add("duration",{title:"Game Duration",type:"number",default:0}),TimeConfig.attributes.add("extraTime",{title:"Extra Time Modal",type:"number",default:0}),TimeConfig.attributes.add("countDown",{title:"CountDown before start",type:"boolean",default:!1}),TimeConfig.attributes.add("useTimer",{title:"Use Timer",type:"boolean",default:!1}),TimeConfig.attributes.add("usTimerBar",{title:"Use Timer Bar",type:"boolean",default:!1}),TimeConfig.prototype.postInitialize=function(){CONFIG.add("GAME.TIME",this)};var FOG=new function(){var e,n=this;n.set=function(e){if(!(e=e||{}).color||!e.fog){if(!APP.scene.fog)return;return APP.scene.fog=null}let o=e.fog;"linear"==o&&(APP.scene.fog=o,APP.scene.fogStart=e.start||10,APP.scene.fogEnd=e.end||60),"exponential"==o&&(o="exp"),"exp"!=o&&"exp2"!=o||(APP.scene.fog=o,APP.scene.fogDensity=e.density||.01),n.setColor(e.color)},n.setColor=function(n){if(!n)return APP.scene.fog=null;let o=COLOR.get(n);e||(e=new DelayUnique),e.start((function(){APP.scene.fogColor=o}),.02)}};var CONFIG=new function(){var i=this;i.initialized=!1,i.id="CUSTOM_",i.init=function(){i.add(null,{id:TOY.id+"_",gameName:TOY.gameName,buildVersion:TOY.buildVersion}),i.add("SCENES",{Launch:TOY.LaunchCustom||TOY.LaunchDefault})},i.add=function(a,n){var d=i,e=i;if(a){if(a.includes(".")){var t=a.split("."),u=t[0],c=t[1];i[u]||(i[u]={}),e=i[u],a=t[1],t.length>2&&(a=t[2],i[u][c]||(i[u][c]={}),e=i[u][c])}e[a]||(e[a]={}),d=e[a]}d.isProtected||extract(n,d)}};var UpsaleConfig=pc.createScript("upsaleConfig");UpsaleConfig.attributes.add("goShopping",{title:"Has GoShopping",type:"boolean",default:!0}),UpsaleConfig.attributes.add("rewardBonus",{title:"Reward Bonus",type:"string",enum:[{RewardBonus:"RewardBonus"},{Disabled:"Disabled"}],default:"RewardedBonus"}),UpsaleConfig.prototype.initialize=function(){CONFIG.add("UPSALE",CONFIG.DEBUG.hideAllRewards?{}:this)};var GameConfig=pc.createScript("gameConfig");GameConfig.attributes.add("globalPause",{title:"Global Pause",type:"boolean",default:!0}),GameConfig.attributes.add("fillGamePlayers",{title:"Fill GamePlayers",type:"boolean",default:!1}),GameConfig.attributes.add("hasLevels",{title:"Has Levels",type:"boolean",default:!1}),GameConfig.attributes.add("useGrayscale",{title:"Grayscale on Death",type:"boolean",default:!0}),GameConfig.attributes.add("useRivalsLadder",{title:"Rivals Ladder",type:"boolean",default:!0}),GameConfig.attributes.add("usePositionDisplayer",{title:"Position Displayer",type:"boolean",default:!1}),GameConfig.attributes.add("useRivalBar",{title:"Rival Bar",type:"boolean",default:!1}),GameConfig.attributes.add("useUpgradeBox",{title:"Upgrade Box",type:"boolean",default:!1}),GameConfig.attributes.add("useKillFeed",{title:"Kill Feed",type:"boolean",default:!0}),GameConfig.attributes.add("delayGameOverTime",{title:"Delay GameOver",type:"number",default:4}),GameConfig.attributes.add("defaultTweenUpdate",{title:"Default Tween Update",type:"boolean",default:!0,description:'If unchecked, you will need to manually fire("MOTOR:onTween", dt) when you want your tweens to update.This is useful, for example, if you want APP.tween to update in a "post update" method, instead of the default "update".'}),GameConfig.attributes.add("showMissions",{title:"Show Missions",type:"boolean",default:!0}),GameConfig.attributes.add("allowExitGame",{title:"Allow Exit",type:"boolean",default:!0}),GameConfig.prototype.initialize=function(){CONFIG.add("GAME",this),CONFIG.add("GAME.JOYSTICK",{}),CONFIG.add("GAME.SCORING",{}),CONFIG.add("GAME.LIVES",{}),CONFIG.add("GAME.TIME",{}),CONFIG.add("GAME.REWARDED",{}),log("CONFIG.GAME",CONFIG.GAME)};var RewardedConfig=pc.createScript("rewardedConfig");RewardedConfig.attributes.add("rewarded",{title:"Has Rewarded Mode",type:"boolean",default:!1}),RewardedConfig.attributes.add("rewardedMultiplier",{title:"Rewarded X2 Bonus",type:"boolean",default:!1}),RewardedConfig.prototype.postInitialize=function(){CONFIG.DEBUG.hideAllRewards||CONFIG.add("GAME.REWARDED",this)};var UifxcacheConfig=pc.createScript("uifxcacheConfig");UifxcacheConfig.attributes.add("cache",{type:"json",schema:[{name:"particle",type:"string",default:"WHITE_Particle"},{name:"amount",type:"number",default:20}],array:!0}),UifxcacheConfig.prototype.initialize=function(){var a=this;on("SCENES:onInit",(function(){delay((function(){UIFX.cache(a.cache)}),1)}))};function LuminosityEffect(t){pc.PostEffect.call(this,t),this.luminosityValue=0,this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","uniform float uLuminosityValue;","","varying vec2 vUv0;","","void main() {","    vec4 texel = texture2D(uColorBuffer, vUv0);","    vec3 luma = vec3(0.299, 0.587, 0.114);","    float v = dot(texel.xyz, luma);","    vec3 blendedColor = mix(texel.rgb, vec3(v), uLuminosityValue);","    gl_FragColor = vec4(blendedColor.rgb, texel.w);","}"].join("\n")})}LuminosityEffect.prototype=Object.create(pc.PostEffect.prototype),LuminosityEffect.prototype.constructor=LuminosityEffect,Object.assign(LuminosityEffect.prototype,{render:function(t,e,i){var o=this.device,s=o.scope;s.resolve("uColorBuffer").setValue(t.colorBuffer),s.resolve("uLuminosityValue").setValue(this.luminosityValue),pc.drawFullscreenQuad(o,e,this.vertexBuffer,this.shader,i)}});var Luminosity=pc.createScript("luminosity");Luminosity.attributes.add("animationSpeed",{type:"number",default:1,title:"Animation Speed"}),Luminosity.prototype.initialize=function(){this.currentValue=0,this.targetValue=0,this.active=!1,this.effect=new LuminosityEffect(this.app.graphicsDevice),this.effect.luminosityValue=this.currentValue;var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)})),this.app.on("effect:luminosity:state",this.setState,this)},Luminosity.prototype.setState=function(t){this.active=t,this.targetValue=t?1:0},Luminosity.prototype.update=function(t){this.currentValue=pc.math.lerp(this.currentValue,this.targetValue,t*this.animationSpeed),this.effect.luminosityValue=this.currentValue};var Camerafx=pc.createScript("camerafx");Camerafx.prototype.initialize=function(){var e=this,t=e.entity.script.luminosity,a=[t],n=null;function reset(){for(var e in a)a[e].enabled=!1;n=!1,cancel("cameraFX")}e.reset=reset,e.stop=function stop(){n&&(n.enabled=!0,n.setState(!1),unique("cameraFX",reset,2))},e.grayscale=function(){!function enable(e){QUALITY.quality&&(reset(),(n=e).enabled=!0,n.setState(!0))}(t)}};function Callback(a,c,e,n){var l=this;l.max=a||0,l.value=0;function increase(){l.value++,check()}function check(){n&&log(n,"check",l.value,l.max),l.value<l.max||(!0,c&&c(e))}l.increase=increase,l.listen=function(){return l.max<0&&(l.max=0),l.max++,n&&log(n,"addCallback",l.max),increase},-1!=a&&check()}var WorldToscreen=pc.createScript("worldToscreen");WorldToscreen.attributes.add("target",{type:"entity"}),WorldToscreen.prototype.initialize=function(){var t=this,e=t.entity;t.onUpdate=function(){t.target&&ANIMATION.A2BFrictionLocalPosition(e,UISIZE.worldToScreen(t.target))}},WorldToscreen.prototype.postUpdate=function(){this.onUpdate()};var FxRepair=pc.createScript("fxRepair");FxRepair.attributes.add("id",{type:"string"}),FxRepair.attributes.add("event",{type:"string"}),FxRepair.attributes.add("animation",{type:"string",default:"Hammer",enum:[{Hammer:"Hammer"},{Shovel:"Shovel"}]}),FxRepair.prototype.initialize=function(){var e,t=this,n=t.entity;t.counter=random(30),t.Clouds=n.findByName("Clouds"),t.Items=n.findByName("Items"),t.pool=[],t.counter=0,t.count5=random(10),t.sinCount=0;var o=t.animation;getLocals(n);var a=getChildren(t.Items);for(var i in a)t.pool.push(new RepairItem(a[i]));function RepairItem(e){var t=this,n=decimal(),a=decimal(),i=e.findByName("Image"),r=e.getLocalEulerAngles().z;t.update=function(){"Hammer"==o&&(n+=.4,a+=.1,i.setLocalEulerAngles(0,0,30+30*Math.sin(n)),e.setLocalEulerAngles(0,0,r+25*Math.sin(a)),i.setLocalPosition(0,10*Math.sin(a),0)),"Shovel"==o&&(n+=.2,i.setLocalEulerAngles(0,0,Math.abs(70*Math.sin(n))))},t.show=function(){e.enabled=i.enabled=!0,n=decimal(),a=decimal(),ANIMATION.grow(i,.3),t.update()},t.hide=function(){!1,ANIMATION.shrink(i,.2)},e.enabled=!1}t.show=function(n,a,i){SFX.playPitchSmall("BuildConstruct"),!0,t.isShowing=!0,t.duration=60;var r=t.entity;for(var l in(e=i)&&(n=UISIZE.worldToScreen(e)),n&&r.setLocalPosition(n),t.pool)t.pool[l].show();if(toFront(r),"Hammer"==o){FX2D.SPARKS.magic({parent:r,y:-40});var s=new pc.Vec3(0,0,spectrumDecimal(20));t.Items.setLocalEulerAngles(s),ANIMATION.bounceAngleZ(t.Items,15,5)}delay((()=>SFX.play("Reveal")),1),a&&DELAY.unique("FriendFace",FX2D.FRIEND.pop,2.5)},t.hide=function(){t.isShowing=!1;var e=t.entity;for(var n in t.pool)t.pool[n].hide();delay((function(){FX2D.SHOCKWAVE.condense({parent:e}),FX2D.SHOCKWAVE.halo({parent:e})}),.3)},t.onUpdate=function(){if(--t.duration<=0)return t.hide();for(var a in e&&n.setLocalPosition(UISIZE.worldToScreen(e)),t.pool)t.pool[a].update();if(++t.counter>=8){let e="WHITE";"Shovel"==o&&(e="BROWN"),FX2D.SMOKE.play({parent:t.Clouds,color:e}),t.counter=random(6)}},t.event&&on(t.event,t.show,t)},FxRepair.prototype.update=function(){this.isShowing&&this.onUpdate()};var HorizontalGallery=pc.createScript("horizontalGallery");HorizontalGallery.attributes.add("id",{type:"string"}),HorizontalGallery.attributes.add("animateIn",{type:"boolean",default:!0}),HorizontalGallery.prototype.postInitialize=function(){var l,e=this,t=e.entity,i=t,n=t.findByName("Content"),a=e.Gallery=getChild(t,"Gallery","gallery");function onGalleryDown(t){l&&l(t),e.id&&fire(e.id+":onClick",t.data,t)}e.id&&on(e.id+":Fill",(function(l){e.fill(l)})),e.fill=function(t,o){l=o,a.fill(t,onGalleryDown);var r=a.posX;n.element.width=r+150,a.entity.setLocalPosition(-n.element.width/2+40,a.entity.pos.y,0),e.animateIn&&a.animateIn(),n.setLocalPosition(pc.Vec3.ZERO),ANIMATION.moveTo(n,pc.Vec3.ZERO,.1),i.scrollview.enabled=!1,i.scrollview.enabled=!0}};var OVERLAYS=new function(){this.show=function(n,e,i){UI.reveal("OVERLAY",n,e,i)},this.hide=function(n,e){UI.unReveal(n||UI.Layers.OVERLAY.current,e)}};on("OVERLAYS",OVERLAYS.show);var SCREENS=new function(){this.show=function(n,E,e,S){UI.reveal("SCREEN",n,E,e,S)},this.hide=function(n,E){UI.unReveal(n||UI.Layers.SCREEN.current,E)}};on("SCREENS",SCREENS.show);var POPUPS=new function(){var P=this;P.show=function(P,n,o){UI.reveal("POPUP",P,n,o)},P.hide=function(P,n){UI.unReveal(P||UI.Layers.POPUP.current,n)},P.hideAll=function(){UI.hidePopups()}};on("POPUPS",POPUPS.show),on("POPUPS:Show",POPUPS.show);var UNDERLAYS=new function(){this.show=function(n,e,U){UI.reveal("UNDERLAY",n,e,U)},this.hide=function(n,e){UI.unReveal(n||UI.Layers.UNDERLAY.current,e)}};on("UNDERLAYS",UNDERLAYS.show);var BACKGROUNDS=new function(){this.show=function(n,e,U,i){UI.reveal("BACKGROUND",n,e,U,i)},this.hide=function(n,e){UI.unReveal(n||UI.Layers.SCREEN.current,e)}};on("BACKGROUNDS",BACKGROUNDS.show);var ScreenConnectionError=pc.createScript("screenConnectionError");ScreenConnectionError.prototype.initialize=function(){SCREEN.call(this),this.onShow=function(){UI.lock()}};var SliderBar=pc.createScript("sliderBar");SliderBar.attributes.add("id",{type:"string"}),SliderBar.prototype.initialize=function(){var e,t,n=this,o=n.entity,i=o.findByName("Head"),a=o.findByName("Fill"),l=new pc.Vec3,s=new pc.Vec3,r=o.parent,c=getChildScript(o,"Bar","bar"),d=o.findByName("Button"),p=getChildScript(d,"Button","simpleButton"),f=d.element.width>d.element.height,u=a.element.width,b=!1,y=new pc.Vec2;function setPercent(t,n){show(),e=t,c.setPercent(t,n);const o=u*(t/100);f?i.setLocalPosition(o,i.pos.y,0):i.setLocalPosition(i.pos.x,o,0)}function hide(){o.enabled=!1}function show(){o.enabled=!0}function disable(){p.hide(),b=!0}function enable(){p.show(),b=!1}function dragUpdate(){r&&r.element&&s.copy(r.getLocalPosition()),l.x=MATH.clamp(TOUCH.x-s.x-o.pos.x,u,0),l.y=MATH.clamp(TOUCH.y-s.y-o.pos.y,u,0),e=MATH.clamp(100*(f?l.x:l.y)/u,100,0),c.setPercent(e),f?l.y=i.pos.y:l.x=i.pos.x,i.setLocalPosition(l),t&&fireLabel(t,"onUpdate",e/100)}getLocals(o),getLocals(i),n.setId=function(e){e&&(t=e,onLabel(t,"SetPercent",setPercent),onLabel(t,"Hide",hide),onLabel(t,"Show",show),onLabel(t,"Disable",disable),onLabel(t,"Enable",enable))},n.setId(n.id),n.onMousePress=function(e){b||(fireLabel(t,"onStart"),y.x=TOUCH.x,y.y=TOUCH.y,function startDrag(){log("S TART DRTAG"),start(dragUpdate)}())},n.onMouseRelease=function(){log("RELEASE"),function stopDrag(){stop(dragUpdate);var n=e/100;t&&(fireLabel(t,"onRelease",n),fireLabel(t,"onSelection",n))}()}},SliderBar.prototype.update=function(e){};var ScrollGallery=pc.createScript("scrollGallery");ScrollGallery.attributes.add("id",{type:"string"}),ScrollGallery.prototype.postInitialize=function(){var e=this,t=e.entity,l=t.findByName("ScrollView"),o=l.scrollview,i=t.findByName("Content");getLocals(t);var n,a=e.Gallery=getChild(t,"Gallery","gallery"),c=new pc.Vec2(-i.element.width/2-a.entity.pos.x,i.element.height/2-a.entity.pos.y);function onResize(){e.width=l.element.width-20,e.height=l.element.height,i.element.width=e.width;var t=Math.floor((e.width+2*c.x)/a.marginX);a.top=a.pad.y+c.y,a.bottom=-e.height-a.pad.y-c.y,t!=a.columns&&(a.columns=t,a.sort()),i.element.height=-a.posY+a.pad.y,a.entity.setLocalPosition(-t*a.marginX/2,i.element.height/2-c.y,0),i.setLocalPosition(pc.Vec3.ZERO),ANIMATION.moveTo(i,pc.Vec3.ZERO,.1),o.enabled=!0}function onGalleryDown(t){n&&n(t),e.id&&fire(e.id+":onClick",t.data,t)}onResize(),e.id&&on(e.id+":Fill",(function(t){e.fill(t)})),e.fill=function(e,t){n=t,a.fill(e,onGalleryDown),onResize()},e.setSize=function(e,t){e&&(l.element.width=e),t&&(l.element.height=t),onResize()},e.onUpdate=function(){var e=i.getLocalPosition();i.setLocalPosition(0,e.y,0)},e.scrollTo=function(t){var l=MATH.clamp(-localToLocal(t,i).y-e.height/2,i.element.height-e.height,0);ANIMATION.moveTo(i,new pc.Vec3(0,l,0),.3,EASING.SineOut)},e.scrollToItem=function(t){var l=a.getButton(t);l&&e.scrollTo(l.entity)}},ScrollGallery.prototype.update=function(){this.onUpdate()};function ResizeMargins(t){var n=this;function refresh(e){var i=t.pos;n.right=540-i.x,n.left=-540-i.x,n.top=960-i.y,n.bottom=-960-i.y,n.signX=MATH.getSign(i.x),n.signY=MATH.getSign(i.y),n.x=n.signX>0?n.right:n.left,n.y=n.signY>0?n.top:n.bottom}getLocals(t),on("UI:onOrientationChange",refresh),refresh(UISIZE.isLandscape)}var Tabs=pc.createScript("tabs");Tabs.attributes.add("useCloseButton",{title:"CloseButton",type:"boolean",default:!0}),Tabs.prototype.initialize=function(){var t=this,e=t.entity,l=t.Gallery=getChildScript(e,"Gallery","gallery"),o=e.findByName("CloseButton"),i=t.useCloseButton&&o?o.element.width+4:0,n=e.findByName("SelectedBar");t.fill=function(e,a){l.fill(e,(function onGalleryDown(t){setColor(n,t.data.color),a(t)}));var r=(-l.pool.length*l.marginX-i)/2;if(l.entity.setLocalPosition(r,0,0),o){if(t.useCloseButton)return o.setLocalPosition(l.pool.length*l.marginX+i/2,-l.pad.y,0);o.enabled=!1}},t.click=function(t){l.click(t)}};var FxExplosion=pc.createScript("fxExplosion");FxExplosion.attributes.add("autoStart",{type:"number",default:0}),FxExplosion.prototype.initialize=function(){if(this.autoStart)return this.start()},FxExplosion.prototype.start=function(){for(var t=this,e=0;e<4;e++)DELAY.start((function(){FX3D.SHOCKWAVE.expand({sprite:["FX_Cloud_1","FX_Cloud_2","FX_Cloud_3","FX_Cloud_4"],x:RANDOM.spectrum(3),y:RANDOM.decimal(1),z:RANDOM.spectrum(2),color:["#ffcc00","#fff000","#ffc12c"],parent:t.entity,space3D:!0,scale:RANDOM.decimal(.4,.3)})}),.1*e);FX3D.SHOCKWAVE.expand({x:0,y:0,z:0,color:["#ffea00"],parent:t.entity,space3D:!0,scale:.6}),FX3D.SPLATT.play({particle:"ExplosionParticle",velY:70,floorY:1,parent:t.entity,scale:1})};var Timer=pc.createScript("timer");Timer.attributes.add("id",{type:"string"}),Timer.attributes.add("daysFormat",{type:"boolean"}),Timer.attributes.add("varIncrement",{type:"string"}),Timer.attributes.add("duration",{type:"number",default:6e4}),Timer.attributes.add("startTime",{type:"number",default:0}),Timer.attributes.add("increment",{type:"number",default:5}),Timer.attributes.add("max",{type:"number"}),Timer.attributes.add("prefix",{type:"string"}),Timer.attributes.add("readyText",{type:"string",default:"ready!"}),Timer.attributes.add("autoStart",{type:"boolean",default:!1}),Timer.attributes.add("isAuto",{type:"boolean",default:!1}),Timer.attributes.add("killOnReach",{type:"boolean",default:!1}),Timer.attributes.add("fillFirstTime",{type:"number",default:0}),Timer.attributes.add("varMultiplier",{type:"string"}),Timer.attributes.add("sound",{type:"string"}),Timer.attributes.add("animateOnEnd",{type:"boolean",default:!0}),Timer.prototype.initialize=function(){var t=this,e=t.entity,a=e.findByName("timerBar"),i=e.findByName("textField"),r=t.id,n=t.prefix?t.prefix+" ":"";i&&getLocals(i),updateText(),t.fillFirstTime&&!get(r)&&set(t.varIncrement,t.fillFirstTime);var d={id:r,varIncrement:t.varIncrement,duration:t.duration,increment:t.increment,max:t.max,startTime:t.startTime,autoStart:t.autoStart,isAuto:t.isAuto,varMultiplier:t.varMultiplier,killOnReach:t.killOnReach,sound:t.sound,onSecond:!0},u=t.timer=TIMER.spawn(d);function updateText(t){i&&(i.element.text=t)}on(r+":onSecond",(function(e){updateText(n+(t.daysFormat?DATE.days(1e3*e):DATE.seconds(e))),e<=10&&i&&t.animateOnEnd&&ANIMATION.bounceScaleTo(i,.1*i.sca.x,i.sca.x)})),t.onUpdate=function(){u.isPlaying&&a&&a.script.bar.setPercent(u.percent)},on(r+":onTimeUp",(function(){updateText("")}))},Timer.prototype.postUpdate=function(){this.onUpdate()};var TextDisplayer=pc.createScript("textDisplayer");TextDisplayer.attributes.add("varName",{type:"string"}),TextDisplayer.attributes.add("text",{type:"string"}),TextDisplayer.attributes.add("prefix",{type:"string",default:""}),TextDisplayer.attributes.add("suffix",{type:"string",default:""}),TextDisplayer.attributes.add("symbol",{type:"string"}),TextDisplayer.attributes.add("autoHide",{type:"boolean",default:!0}),TextDisplayer.attributes.add("autoReach",{type:"boolean",default:!1}),TextDisplayer.attributes.add("dontCommarize",{type:"boolean",default:!1}),TextDisplayer.attributes.add("plusOne",{type:"boolean",default:!1}),TextDisplayer.attributes.add("hasDots",{type:"boolean",default:!1}),TextDisplayer.attributes.add("animateOnUpdate",{type:"boolean",default:!1}),TextDisplayer.attributes.add("isTime",{type:"boolean",default:!1}),TextDisplayer.attributes.add("isMilliseconds",{type:"boolean",default:!1}),TextDisplayer.attributes.add("isRank",{type:"boolean",default:!1}),TextDisplayer.prototype.initialize=function(){var e=this,t=e.entity,a=0,i=t.findByName("Content"),s=t.findByName("textField");getLocals(t),e.symbol&&CONTENT.fill(t,{symbol:e.symbol});var l={value:a,prefix:e.prefix,postfix:e.postfix,commarize:!e.dontCommarize,autoReach:e.autoReach};function hide(){s.enabled=!1,i&&(i.enabled=!1),l.lastValue=a}function onData(o){return a=l.value=o,e.plusOne&&a++,!a&&e.autoHide?hide():(e.animateOnUpdate&&ANIMATION.bounceScaleTo(t,.3*t.sca.x,t.sca.x,1.3),function show(){s.enabled=!0,i&&(i.enabled=!0)}(),l.suffix=e.suffix,dotCount=99,e.hasDots?animateDots():void fillField())}function fillField(){e.isMilliseconds?s.element.text=DATE.seconds(a/1e3):e.isTime?s.element.text=DATE.seconds(a):ANIMATION.fillField(s,l)}function animateDots(){e.hasDots&&MOTION.change30&&(l.suffix=MOTION.dotsText,fillField())}e.text&&onData(e.text),e.setVarName=function(t){t&&(e.varName=t,on(t,onData),onData(get(t)))},e.autoHide&&hide(),e.setVarName(e.varName),this.onUpdate=function(){animateDots()}},TextDisplayer.prototype.update=function(){this.onUpdate()};var TIMER=new function(){var n=this;n.pool={};var r=0;n.spawn=function(r){return function getInstance(r){for(var o in n.pool)if(n.pool[o].id==r.id)return n.pool[o];return new TimerData(r)}(r)},n.push=function(o){var t=o.varIncrement||o.id;n.pool[t]=o,n[t]=o,r++},n.getID=function(){return"TID_"+r},n.refresh=function(){}};var AnimationController=pc.createScript("animationController");AnimationController.attributes.add("default",{title:"Default Animation",type:"string"}),AnimationController.attributes.add("animationLayers",{type:"json",array:!0,title:"Animation Layers",schema:[{name:"name",title:"ID",type:"string"},{name:"masks",title:"Masks",description:"Bone this layer will affect. (This will override the File Masks property if set)",type:"string",array:!0},{name:"fileMask",title:"File Masks",type:"string",placeholder:"None = Use Masks Array"},{name:"weight",type:"number"},{name:"blendType",type:"string",enum:[{ADDITIVE:pc.ANIM_LAYER_ADDITIVE},{OVERWRITE:pc.ANIM_LAYER_OVERWRITE}],default:"ADDITIVE"}]}),AnimationController.prototype.postInitialize=function(){var e=this,a=e.entity;a.anim||a.addComponent("anim");var t=a.anim;a.animationController=e;e.id=e.id||a.name;var n={},i=1;on("GAME:onPause",pause),on("GAME:onResume",resume),n.base=new AnimationLayerController,n.base.fill("base",t,e);for(const a of e.animationLayers)n[a.name]||(n[a.name]=new AnimationLayerController,n[a.name].fill(a.name,t,e,a));function pause(){i=t.speed,t.speed=0}function resume(){t.speed=i}e.play=function(e,a){a=a||{};let i=ANIMLIB.search(e),o=a.layer;if(o)n[o].play(i,a);else for(const e of Object.values(n))e.play(i,a);t.speed=a.speed||1},e.removeImportantMark=function(e){if(e)n[e].removeImportantMark();else for(const e of Object.values(n))e.removeImportantMark()},e.handlePlayonceFinish=function(a){if(n.base.isStopped||!n.base.label)return e.pause();n[a].play(n.base.label)},e.stop=function(){for(let e in n)n[e].stop()},e.pause=pause,e.resume=resume,e.default&&e.play(e.default)};var BarRadial=pc.createScript("barRadial");BarRadial.attributes.add("doColor",{type:"boolean",default:!1}),BarRadial.prototype.initialize=function(){var e=this;e.Fill=e.entity.findByName("Fill"),e.Marquee=e.entity.findByName("Marquee"),e.Segment=e.entity.findByName("Segment"),e.Segment2=e.entity.findByName("Segment2"),e.Segment3=e.entity.findByName("Segment3"),e.Segment4=e.entity.findByName("Segment4"),e.min=0,e.max=e.maxText=100,e.animatePercent=0,e.amount=0,e.isUpdating=!0,e.entity.barScript=e,e.percent=0,e.segments=[e.Fill,e.Segment2,e.Segment3,e.Segment4],e.onUpdate=function(n){if(e.isUpdating){if(e.animatePercent+=(e.percent-e.animatePercent)/2,Math.round(e.animatePercent)==e.percent)return e.reach();e.render()}},e.setAmount=function(n,t,a){null!=t&&(e.min=t),a&&(e.max=a),e.maxText=STRING.commarize(e.max),e.isUpdating=!0,e.amount=MATH.hardLimit(n,e.min);var r=e.max-e.min,i=e.amount-e.min;e.setPercent(100*i/r)},e.increase=function(n){n=n||1;e.setAmount(e.amount+n)},e.decrease=function(n){n=n||1;e.setAmount(e.amount-n)},e.reset=function(n){e.animatePercent=e.percent=e.amount=MATH.hardLimit(n||0,0,100),e.setPercent(e.animatePercent,!0)},e.stop=function(n){e.isUpdating=!1,e.element.opacity=1},e.setPercent=function(n,t){if(e.percent=MATH.hardLimit(n,0,100),t)return e.reach();e.isUpdating=!0},e.reach=function(){e.animatePercent=e.percent,e.render(),e.isUpdating=!1},e.render=function(){var n=e.percent;if(n>=100||0===n){if(e.Marquee.enabled)return;return e.Marquee.enabled=!0,ANIMATION.fadeIn(e.Marquee),void(e.Segment.enabled=e.Segment2.enabled=e.Segment3.enabled=e.Segment4.enabled=!1)}var t=0;n<=25&&e.renderFill(n),n>25&&n<=50&&(t=-90,e.renderFill(n-25)),n>50&&n<=75&&(t=-180,e.renderFill(n-50)),n>75&&(t=90,e.renderFill(n-75)),e.lastAngle=t,e.Segment.setLocalEulerAngles(0,0,t),e.Marquee.enabled=!1,e.Segment.enabled=!0,e.Segment2.enabled=n<25,e.Segment3.enabled=n<50,e.Segment4.enabled=n<75},e.renderFill=function(n){e.percent;e.Fill.setLocalEulerAngles(0,0,n/25*-90)},e.hide=function(){e.entity.enabled=!1},e.show=function(){e.entity.enabled=!0},e.forceColor=function(n,t,a){var r=e.animatePercent;return!(r<n||r>t)&&(e.setColor(a),!0)},e.interpolateColor=function(n,t,a,r){var i=parseInt(e.animatePercent);if(i<n||i>t)return!1;var m=100*(i-n)/(t-n),o=COLOR.interpolate(a,r,m);return e.setColor(o),!0},e.setColor=function(e){},e.varName&&(on(e.varName,e.setAmount,e),e.setAmount(get(e.varName))),e.render()},BarRadial.prototype.update=function(){this.onUpdate()};var PopupSettings=pc.createScript("popupSettings");PopupSettings.prototype.initialize=function(){var e=this,t=e.entity,o=t.findByName("Base"),n=t.findByName("ExitGameButton"),i=t.findByName("HomeButton"),a=t.findByName("VibrationButton");SCREEN.call(e),e.onMouseDown=function(e){let t=e.label;if("Fullscreen"==t)return document.body.requestFullscreen();if("Quality"==t)return QUALITY.setQuality(e.value);if("HomeButton"==t)return fire("GAME:AskExit");if("ExitGameButton"==t)return conquer.Signal.set("SKIN:Home");if("Vibration"==t)return conquer.Haptic.setEnabled(!e.value);if("ResetButton"==t)return DIALOG.reset((function onReset(){DATA.reset()}));if("BackButton"==t)return SCREENS.show("Home");if("Playstore"==t)return gotoURL("https://play.google.com/store/apps/details?id=com.sega.tokyo");if("Appstore"==t)return gotoURL("https://apps.apple.com/app/id1484836043");function gotoURL(e){window.location.href=e}"Close"==t&&POPUPS.hide()},e.onShow=function(){i.enabled=!1,n.enabled=!1,a.enabled=!1;let e,t;return pc.platform.mobile?(a.enabled=!0,e=640,t=790,n.setLocalPosition(0,-344,0),i.setLocalPosition(0,-344,0)):(e=493,t=640,n.setLocalPosition(0,-198,0),i.setLocalPosition(0,-198,0)),o.element.height=e,GAME.isActive?(i.enabled=!0,void(o.element.height=t)):"SuperSnappy"==PLATFORM.platform?(n.enabled=!0,void(o.element.height=t)):void 0}};var CANVASFONT=new function(){var t=this;t.init=function(){var n=APP.assets.find("CanvasFont.txt","text"),e=new FontFace("CanvasFont","url(data:application/font-ttf;charset=utf-8;base64,"+n.resource+")",{style:"normal",weight:"400"});document.fonts.add(e),e.load(),e.loaded.then((function(n){t.font=new pc.CanvasFont(APP,{fontName:"CanvasFont",fontSize:90,padding:20}),t.font.renderCharacter=function(t,n,e,o,a){t.fillStyle="#F4FF00",t.shadowColor="#000000",t.shadowOffsetX=0,t.shadowOffsetY=12,t.lineWidth=12,t.strokeStyle="#000000",t.strokeText(n,e,o),t.fillText(n,e,o)};t.font.createTextures("#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~")}))},t.apply=function(n,e){t.font&&e&&(t.font.updateTextures(e.toString()),n.element.font=t.font)}};var Bar=pc.createScript("bar");Bar.attributes.add("id",{type:"string"}),Bar.attributes.add("varName",{type:"string"}),Bar.attributes.add("percent",{type:"number",default:0}),Bar.attributes.add("prefix",{type:"string",default:""}),Bar.attributes.add("max",{type:"number",default:100}),Bar.attributes.add("animateOnFill",{type:"boolean",default:!1}),Bar.attributes.add("dontCommarize",{type:"boolean",default:!1}),Bar.prototype.initialize=function(){var e=this,t=e.entity,n=e.id;e.data={};var a,i=t.findByName("Fill"),r=t.findByName("Head"),o=i.sprite,l=i.element||i.sprite,m=t.findByName("amountField"),c=t.findByName("valueField"),u=t.findByName("percentField"),d=30,s=0;function render(){var e=s/100*a;o?(i.setLocalPosition(FillX*s/100,0,0),i.setLocalScale(e,FillScale.y,FillScale.z)):i&&i.element&&(i.element.width=e),r&&r.setLocalPosition(-a/2+e,0,0)}t.barScript=e,o?(FillX=i.getLocalPosition().x,FillScale=i.getLocalScale().clone(),a=FillScale.x):a=i.element.width,e.min=e.min||0,e.max=e.max||100,e.amount=e.amount||0,e.onUpdate=function(t){if(e.isPulsing)l.opacity=.5+.5*MOTION.SIN_A;else if(!(d<=0)){if(s+=(e.percent-s)/2,--d<=0)return e.reach();render()}},e.setAmount=function(t,n,a,i){null!=n&&(e.min=n),a&&(e.max=a),d=30,e.amount=MATH.hardLimit(t,e.min);var r=e.max-e.min,o=e.amount-e.min;return e.setPercent(100*o/r,i)},e.increase=function(t){return e.setAmount(e.amount+(t||1))},e.decrease=function(t){t=t||1;return e.setAmount(e.amount-t)},e.reset=function(t){return s=MATH.hardLimit(t||0,0,100),e.setPercent(s,!0)},e.stop=function(e){d=0,l.opacity=1},e.setPercent=function(t,n){return d=0,function renderText(){if(!u&&!m&&!c)return;e.data.percent=e.percent+"%";var t=e.max,n=e.amount;e.dontCommarize||(n=STRING.commarize(n),t=STRING.commarize(t));var a=e.prefix?e.prefix+" ":"";c&&c.element&&(c.element.text=n);m&&m.element&&(m.element.text=a+(n+" / ")+t)}(),e.percent=MATH.hardLimit(t,0,100),e.isPulsing=e.animateOnFill&&e.percent>=100,l.opacity=1,e.percent>=100&&(n=!0),n?e.reach():d=30},e.reach=function(){return s=e.percent,e.isPulsing=e.animateOnFill&&e.percent>=100,render(),d=0,e.percent},e.hide=function(){t.enabled=!1},e.show=function(){t.enabled=!0},e.varName&&""!=e.varName&&(on(e.varName,(function(t){e.setAmount(t)})),e.setAmount(get(e.varName))),e.setID=function(t){n=e.id=t,on(n+":setPercent",e.setPercent,e)},e.id&&e.setID(e.id),render()},Bar.prototype.update=function(){this.onUpdate()};var Slider3d=pc.createScript("slider3d");Slider3d.attributes.add("top",{type:"number",default:0}),Slider3d.attributes.add("bottom",{type:"number",default:1e3}),Slider3d.prototype.initialize=function(){var t=this,o=t.entity;t.startDragPos=getLocalPosition(o),t.dragSpeed=0,t.isEnabled=!0,t.pos=new pc.Vec3,getLocals(o)},Slider3d.prototype.enable=function(t){var o=this;o.isEnabled=t,o.isEnabled||(o.isDragging=!1,o.dragCount=0,o.dragSpeed=0)},Slider3d.prototype.update=function(t){var o=this;if(o.isEnabled){var e=o.entity;if(o.pos.copy(e.getLocalPosition()),CURSOR.isDown&&!o.isDragging&&(o.isDragging=!0,o.dragCount=0,o.dragSpeed=0,o.destPos=getLocalPosition(e).y),!CURSOR.isDown&&o.isDragging&&(o.isDragging=!1,DELAY.start((function(){UI.unblock()}),.1)),o.isDragging){if(!o.dragCount&&Math.abs(JOYSTICK.y)>.01)return UI.block(),o.dragCount=!0,void(o.startDragPos=getLocalPosition(e).y);if(!o.dragCount)return;var i=o.pos.y;o.pos.y=o.startDragPos+460*JOYSTICK.y,o.dragSpeed=1.2*(o.pos.y-i)}o.isDragging||(o.pos.y+=o.dragSpeed,o.dragSpeed*=.95),o.pos.y<o.top&&(o.dragSpeed*=.9,o.pos.y+=(o.top-o.pos.y)/2.5),o.pos.y>o.bottom&&(o.dragSpeed*=.9,o.pos.y+=(o.bottom-o.pos.y)/2.5),e.setLocalPosition(o.pos)}};var Background=pc.createScript("background"),BACKGROUND=new function(){this.show=function(e){UI.screens.BACKGROUND&&(BACKGROUNDS.show("BACKGROUND"),BACKGROUND.show(e))},this.hide=function(){}};Background.attributes.add("animateIn",{title:"Animate In",type:"boolean",default:!0}),Background.prototype.initialize=function(){var e,n,a=this,t=a.entity;SCREEN.call(a),BACKGROUND=a;var i=getChildrenNames(t);for(var o in i)i[o].enabled=!1;function delayIn(e){if(a.animateIn){e.enabled=!1,e.sca||getLocals(e);var n=.1*e.sca.x;e.setLocalScale(n,n,n),delay((function(){e.enabled=!0,ANIMATION.scaleTo(e,e.sca,2,EASING.ElasticOut),ANIMATION.fadeIn(e)}),RANDOM.decimal(.5))}else e.enabled=!0}a.show=function(t){if(i[t]&&n!=t){n=t,BACKGROUNDS.show("BACKGROUND");var o=i[t]||i.Default;o!=e&&(e&&function fadeOut(n){if(!a.animateIn)return void(n.enabled=!1);for(var t in ANIMATION.moveTo(n,{x:0,y:0,z:-1},1),n.children)ANIMATION.fadeOut(n.children[t]);DELAY.start((function(){n!=e&&(n.enabled=!1)}),1)}(e),function fadeIn(e){e.setLocalPosition(0,0,1),ANIMATION.moveTo(e,{x:0,y:0,z:0},1),e.enabled=!0,ANIMATION.fadeIn(e);var n=getChildren(e);for(var a in n)delayIn(n[a])}(e=o))}},a.hide=function(){n&&(e&&(e.enabled=!1),e=n=null,BACKGROUNDS.hide("BACKGROUND"))},a.show()};var BarStars=pc.createScript("barStars");BarStars.attributes.add("varName",{type:"string"}),BarStars.attributes.add("alignment",{title:"Aligment",type:"string",enum:[{Center:"Center"},{Left:"Left"},{Right:"Right"}],default:"Center"}),BarStars.attributes.add("max",{type:"number",default:4}),BarStars.attributes.add("progressMode",{type:"boolean",default:!1}),BarStars.attributes.add("amount",{type:"number",default:0}),BarStars.attributes.add("margin",{type:"number",default:0}),BarStars.attributes.add("skipAnimations",{type:"boolean"}),BarStars.attributes.add("hideInactive",{type:"boolean",default:!0}),BarStars.attributes.add("reversed",{type:"boolean",default:!1}),BarStars.prototype.initialize=function(){var e=this,t=e.entity;t.barScript=e;var a=[],n=t.findByName("Fill"),r=0,i=[],s=e.entity.findByName("Template");s.enabled=!1;var l=e.margin||90,o=0,d=0,m=e.max,u=0;if(n&&(getLocals(n),u=n.element.width,o=-u/2,n.setLocalPosition(o,n.pos.y,0)),e.setConfig=function(t){if(t){if(t.margin&&(l=t.margin),t.alignment&&(e.alignment=t.alignment),t.symbol){e.symbol=t.symbol;for(let e in i)i[e].destroy();for(let e in a)a[e].destroy();i=[],a=[]}t.value&&this.setAmount(t.value,t.min||0,t.max||t.value)}},e.setAmount=function(t,f,b){var y;for(t=t||0,null!=f&&(r=f),b&&(m=b),d=clamp(t,m,r),n?(l=u/(m-1),n.element.width=d?(d-1)*l:0):(o=0,"Center"==e.alignment&&(o=-(m-1)*l/2),"Left"==e.alignment&&(o=-(m-1)*l));i.length>m;){var c=i.shift();a.push(c),c.enabled=!1}for(y=0;y<m;y++)(c=i[y])||((c=a.shift())||(c=s.clone(),e.symbol&&(fillTexture(c.findByName("Active"),e.symbol),fillTexture(c.findByName("Inactive"),e.symbol))),c.enabled=!0,i.push(c),addChild(c,e.entity)),c.setLocalPosition(o+l*y,0,0);for(e.reversed&&i.reverse(),y=0;y<m;y++){var g=(c=i[y]).findByName("Active"),v=c.findByName("Inactive");g.enabled=!1,v.enabled=!0,y<=d-1&&(g.enabled=!0,e.hideInactive&&(v.enabled=!1),toFront(c))}d&&(c=i[d-1],e.skipAnimations||(c.setLocalScale(2,2,2),ANIMATION.scaleTo(c)))},e.increase=function(t){e.setAmount(d+(t||1))},e.decrease=function(t){e.setAmount(d-(t||1))},e.reset=function(t){e.setAmount(t)},!e.varName)return;let f=e.varName+"Config";on(f,e.setConfig),e.setConfig(get(f)),on(e.varName,e.setAmount,e),e.setAmount(get(e.varName))};function Rect(t,e,i,o){var n=this,l=t||0,r=e||0,h=i||100,f=o||100;n.hitTestCirc=function(t,e){var i=e||0;return!(t.x+i<n.left)&&(!(t.x-i>n.right)&&(!(t.y+i<n.y-n.height/2)&&(!(t.y-i>n.y+n.height/2)&&{x:n.centerX-t.x,y:n.centerY-t.y})))},n.hitTestPoint=function(t){return n.hitTestCirc(t)},n.hitTestRect=function(t){return MATH.isBetweenAABB(n.top,n.bottom,t.top,t.bottom,n.left,n.right,t.left,t.right)},n.isBetweenHorizontal=function(t){return MATH.isBetweenAB(n.left,n.right,t.left,t.right)},n.isBetweenVertical=function(t){return MATH.isBetweenAB(n.top,n.bottom,t.top,t.bottom)},n.collideHorizontal=function(t){return n.collideLeft(t)||n.collideRight(t)},n.collideFloor=function(t){if(MATH.isBetween(n.bottom,t.top,t.bottom)&&n.isBetweenHorizontal(t))return n.update(null,t.top-n.halfHeight),!0},n.collideRoof=function(t){if(MATH.isBetween(n.top,t.top,t.bottom)&&n.isBetweenHorizontal(t))return n.update(null,t.bottom+n.halfHeight),!0},n.collideRight=function(t){if(MATH.isBetween(n.right,t.left,t.right)&&n.isBetweenVertical(t))return n.update(t.left-n.halfWidth),!0},n.collideLeft=function(t){if(MATH.isBetween(n.left,t.left,t.right)&&n.isBetweenVertical(t))return n.update(t.right+n.halfWidth),!0},n.collideLeftValue=function(t,e){if(!(n.left>t))return e||n.update(t+n.halfWidth),!0},n.collideRightValue=function(t,e){if(!(n.right<t))return e||n.update(t-n.halfWidth),!0},n.collideTopValue=function(t,e){if(!(n.top>t))return e||n.update(null,t+n.halfHeight),!0},n.collideBottomValue=function(t,e){if(!(n.bottom<t))return e||n.update(null,t-n.halfHeight),!0},n.constrainHorizontal=function(t,e){return n.constrainLeft(t,e)||n.constrainRight(t,e)},n.constrainVertical=function(t,e){return n.constrainTop(t,e)||n.constrainBottom(t,e)},n.constrainLeft=function(t,e){return n.collideLeftValue(t.left,e)},n.constrainRight=function(t,e){return n.collideRightValue(t.right,e)},n.constrainTop=function(t,e){return n.collideTopValue(t.top,e)},n.constrainBottom=function(t,e){return n.collideBottomValue(t.bottom,e)},n.scanPoints=function(t){var e=1e20,i=-1e20,o=1e20,l=-1e20;for(var r in t){var h=t[r];h.x<e&&(e=h.x),h.y<o&&(o=h.y),h.x>i&&(i=h.x),h.y>l&&(l=h.y)}return n.width=i-e,n.height=l-o,n.halfWidth=n.width/2,n.halfHeight=n.height/2,n.x=e+n.halfWidth,n.y=o+n.halfHeight,n.update(),n},n.update=function(t,e,i,o){null!=t&&(n.x=t),null!=e&&(n.y=e),null!=i&&(n.width=i),null!=o&&(n.height=o),n.halfWidth=n.width/2,n.halfHeight=n.height/2,n.top=n.y-n.halfHeight,n.bottom=n.y+n.halfHeight,n.left=n.x-n.halfWidth,n.right=n.x+n.halfWidth,n.topLeft={x:n.left,y:n.top},n.topRight={x:n.right,y:n.top},n.bottomLeft={x:n.left,y:n.bottom},n.bottomRight={x:n.right,y:n.bottom},n.corners=[n.topLeft,n.topRight,n.bottomRight,n.bottomLeft]},n.getRANDOMCorner=function(){return ARRAY.getRANDOMItem(n.corners)},n.update(l,r,h,f)}var ScreenMatchVs=pc.createScript("screenMatchVs");ScreenMatchVs.prototype.postInitialize=function(){var t=this,e=t.entity;SCREEN.call(t);var i=getChild(e,"PLAYER","userBox"),o=getChild(e,"RIVAL","userBox"),n=getChild(e,"TextDisplayer","textDisplayer");function onRival(){o.fill(RIVALS.RIVAL),DIALOG.hide(),BUTTONS.hide("ExitMatchButton"),i.setColor(),o.setColor(),SFX.play("onMatch"),fire("MatchText","GET READY"),n.hasDots=!0,delay((function(){fire("MATCHVS:onMatch")}),2)}t.onShow=function(){n.hasDots=!1,fire("MatchText"," "),i.fill(PLAYERS.ME),o.spin(),t.onEvent("RIVALS:onRival",onRival),MATCHMAKING.join(),BUTTONS.show("ExitMatchButton")},t.onHide=function(){o.reset()}};var MISSIONLISTENERS=new function(){function onMission(n){new MissionDataListeners(n)}on("TOY:onFinalize",(function(){GAME.Missions.get().then(onMission)})),on("MISSION:onSet",onMission)};function MissionDataListeners(n){var o=this;function stop(){n.stop()}function pause(){n.pause()}function resume(){n.resume()}function onValue(o){n.setValue(o)}on(n.varName,onValue),o.remove=function(){off("GAME:onPause",pause),off("GAME:onResume",resume),off("GAME:onOver",stop),off("GAME:onExit",stop),off(n.varName,onValue)},o.start=function(){on("GAME:onPause",pause),on("GAME:onResume",resume),on("GAME:onOver",stop),on("GAME:onExit",stop),n.start()},n.onComplete=function(){o.remove(),n.remove(),fire("MISSION:onComplete",n)},n.onUpdate=function(){fire("MISSION:onUpdate",n)},n.onTimeUp=function(){log("MISSION ON TIME UP"),fire("MISSION:onTimeUp",n)}}function Path(e){var n=this,t=pc.CURVE_SPLINE,u=new pc.Curve,r=new pc.Curve,a=new pc.Curve;u.type=a.type=r.type=t;var i,o,c=0,p=[],v=new pc.Vec3;for(p.push(0),o=1;o<e.length;o++){var d=v.sub2(e[o-1],e[o]).length();c+=d,p.push(d)}n.duration=.03*c;var h=0;for(o=0;o<e.length;o++)h+=p[o]/c,i=e[o],u.add(h,i.x),r.add(h,i.y),a.add(h,i.z);n.getPositionTime=function(e){return n.getPosition(e/n.duration)},n.getPosition=function(e,n){return(i=n||new pc.Vec3).x=u.value(e),i.y=r.value(e),i.z=a.value(e),i}}var AutoShadows=pc.createScript("autoShadows");AutoShadows.attributes.add("counter",{type:"number",default:0}),AutoShadows.attributes.add("selfDisable",{type:"boolean",default:!1}),AutoShadows.attributes.add("disableShadows",{type:"boolean",default:!0}),AutoShadows.prototype.initialize=function(){var t=this,a=t.entity,o=a.light&&a.light.castShadows;function onQuality(e){t.disableShadows&&(t.light.castShadows=o=e),t.selfDisable&&(a.enabled=e)}t.light=a.light,on("Quality",onQuality),onQuality(get("Quality")),t.onUpdate=function(){t.light&&o&&++t.counter>1&&(t.counter=0)}},AutoShadows.prototype.postUpdate=function(){this.onUpdate()};var GalleryLayout=pc.createScript("galleryLayout");GalleryLayout.attributes.add("top",{type:"number",default:0}),GalleryLayout.attributes.add("bottom",{type:"number",default:0}),GalleryLayout.prototype.initialize=function(){var t=this,e=t.entity,a=t.galleries=[],o=getChildrenNames(e.findByName("Layouts"));Separator=e.findByName("Separator"),Separator.enabled=!1,getLocals(Separator);var l,r=Separator.element.height/2,i=60;function onGalleryDown(e){t.onGalleryDown(e)}t.posY=0,t.add=function(n){let p=GAME.Shop.find(n.shopItemKeys),y=GAME.Shop.tabs[n.tabKey];if(y&&extract(y.items,p),"InventoryDeals"==n.tabKey)for(;p.length<3;){let t=GAME.Shop.items[GAME.Inventory.getRarity(getRandomItem(["Rare","Epic"])).key];t&&pushUnique(p,t)}if(!p.length)return;var s=n.layout||"List",d=n.title;d&&(t.posY+=-r,(l=Separator.clone()).enabled=!0,addChild(l,e),CONTENT.fill(l,{title:d,titleShadow:d}),l.setLocalPosition(Separator.pos.x,t.posY,Separator.pos.z),t.posY+=-r-i);let u=o[s].clone();u.enabled=!0,addChild(u,e),u.setLocalPosition(0,t.posY,0),u.script.gallery.fill(p,onGalleryDown),t.posY+=u.script.gallery.bottomY-i,a.push(u)},t.fill=function(e,o){i=60,t.posY=0;for(let t in a){var l=a[t].script.gallery;l&&l.clear(),a[t].destroy()}for(var r in a=t.galleries=[],e)t.add(e[r]);t.onGalleryDown=o}},GalleryLayout.prototype.update=function(){var t=this,e=t.entity;if(e.enabled){var a,o,l,r,i,n,p,y=t.galleries;if(t.top)for(r in i=e.parent.getLocalPosition().y,y)for(l in n=i+(a=y[r]).getLocalPosition().y,o=a.script.gallery.pool){var s=o[l].entity,d=n+s.getLocalPosition().y;p=d<t.top&&d>t.bottom,s.enabled!=p&&(s.enabled=p)}}};var GESTURE,Gesture=pc.createScript("gesture");Gesture.prototype.initialize=function(){var e=this;GESTURE=e;var n,o,t=e.entity.findByName("GHead"),i=[],c=null,r=(new pc.Vec3,e.force=new pc.Vec3);let a,s;function onGestureDown(e){UI.isBlocked||n||o||(o=e||TOUCH.lastTouch,clear(),on("TOUCH:onMove",onMove),on("TOUCH:onRelease",onGestureUp))}function clear(){i.length=0,e.isDown=!1,c=null,r.x=r.y=r.z=0}function onMove(n){o&&n&&!e.isDown&&n.id==o.id&&(off("TOUCH:onMove",onMove),MOTOR.start(update),e.isDown=!0)}function onGestureUp(e){if(o&&e.id==o.id){if(UI.isBlocked||n)return hide();fire("GESTURE:onGesture",getForce()),hide()}}function getForce(){if(!o||i.length<4)return r;for(var e=i[0].x,n=i[1].x,t=n>e?1:-1,c=1;c<i.length-1;c++){if(e=i[c].x,((n=i[c+1].x)>e?1:-1)!=t){e-=o.anchor.x,r.z=r.x-1.5*e,r.x=e;break}}return r}function update(){var n=o.pos.clone();if(c||(c=n.clone()),t.setLocalPosition(n),function show(n){if(!e.isVisible)return;t.enabled=!0}(),!(MATH.hipotenusa(c,n)<10)&&(r.x=o.x-o.anchor.x,r.y=o.y-o.anchor.y,e.isVisible&&(FX2D.FADE.vanish({sprite:"FX_Particle",color:"#FFFFFF",x:n.x,y:n.y,z:0,scale:.07,parent:FX}),LINE.vanish({from:c,to:n,z:0})),i.push(n),c.copy(n),s||a)){const e=APP.graphicsDevice.clientRect,n=s&&Math.abs(o.rawTotalDistance.x/e.width)>s,t=a&&Math.abs(o.rawTotalDistance.y/e.height)>a;(n||t)&&(fire("GESTURE:onLimit",getForce(),o),hide())}}function hide(n){t.enabled=!1,o=null,e.isDown=!1,MOTOR.stop(update)}e.isVisible=!0,e.enable=function(n={}){e.disable(),clear(),a=n.verticalLimit||null,s=n.horizontalLimit||null,!0,on("TOUCH:onDown",onGestureDown)},e.disable=function(){!1,off("TOUCH:onDown",onGestureDown),off("TOUCH:onRelease",onGestureUp),hide()},e.getForce=getForce,e.getObject=function getObject(){return getForce(),{force:r.clone()}},e.block=function(){n=!0,hide()},e.unblock=function(){n=!1},hide()};var Pager=pc.createScript("pager");Pager.prototype.initialize=function(){},Pager.prototype.postInitialize=function(){var e=this,t=e.entity;e.Gallery=t.findByName("Gallery"),e.Pages=getChildren(t.findByName("Pages")),e.LeftButton=t.findByName("LeftButton"),e.RightButton=t.findByName("RightButton");for(var a=[],n=0;n<e.Pages.length;n++)a.push({id:n,page:n});e.Gallery.script.gallery.fill(a,(function(t){e.onGalleryDown(t)})),e.Gallery.script.gallery.click(0)},Pager.prototype.onMouseDown=function(e){var t=e.label;"LeftButton"==t&&this.Gallery.script.gallery.prev(),"RightButton"==t&&this.Gallery.script.gallery.next()},Pager.prototype.onGalleryDown=function(e){var t=this,a=e.data.page;for(var n in t.Pages)t.Pages[n].enabled=n==a;ANIMATION.bounceScale(t.Pages[a]),t.lastPage=a,t.LeftButton.element.opacity=0==a?.3:1,t.RightButton.element.opacity=a==t.Pages.length-1?.3:1};var ScreenTop=pc.createScript("screenTop"),TOP=new function(){on("UI:onHome",(function(){TOP.show("Wallet")})),on("UI:onGameOver",(function(){TOP.show("Wallet")})),on("UI:onShopInventory",(function(){TOP.show("Wallet")})),on("GAME:onReady",(function(){TOP.hide()})),on("GAME:onStart",(function(){TOP.show("Game")})),on("GAME:onSpectating",(function(){TOP.show("Game")})),on("GAME:onEnd",(function(){TOP.hide()})),on("UI:onMatchVS",(function(){TOP.hide()})),on("TOP:Show",(function(){TOP.show()})),on("TOP:Hide",(function(){TOP.hide()})),on("TOP:Hidden",(function(n){if(display("TOPHIDDEN",n),!n)return TOP.show();TOP.hide()})),this.show=function(n){get("TOPHIDDEN")||(addChild(UI.screens.TOP,UI.Layers.TOP),TOP.show(n))},this.hide=function(){}};ScreenTop.prototype.initialize=function(){var n=this,e=n.entity,o=e.findByName("Buttons"),i=getChildrenNames(o.findByName("Right")),t=getChildrenNames(o.findByName("Left")),a=e.findByName("Container");TOP=n,n.show=function show(n){for(var a in n=n||"Wallet",i)i[a].enabled=n==a;for(var a in t)t[a].enabled=n==a;o.enabled=!0,addChild(e,UI.Layers.TOP)},n.hide=function hide(){o.enabled=!1},n.disable=function disable(){a.enabled=!1}};var Gallery=pc.createScript("gallery");Gallery.attributes.add("id",{type:"string"}),Gallery.attributes.add("marginX",{type:"number",default:0}),Gallery.attributes.add("marginY",{type:"number",default:0}),Gallery.attributes.add("columns",{type:"number",default:0}),Gallery.attributes.add("autoSelect",{type:"boolean",default:!0}),Gallery.attributes.add("autoShow",{type:"boolean",default:!0}),Gallery.attributes.add("cascadeColumn",{type:"number",default:0}),Gallery.attributes.add("isHorizontal",{type:"boolean",default:!1}),Gallery.attributes.add("isCarousel",{type:"boolean",default:!1}),Gallery.attributes.add("carouselRot",{type:"number",default:0}),Gallery.attributes.add("disableJoystick",{type:"boolean",default:!1}),Gallery.attributes.add("elasticity",{type:"number",default:.7}),Gallery.attributes.add("carouselScale",{type:"number",default:.22}),Gallery.attributes.add("selectionMax",{type:"number",default:1}),Gallery.attributes.add("canDeselect",{type:"boolean",default:!0}),Gallery.attributes.add("canClickBlocked",{type:"boolean",default:!0}),Gallery.attributes.add("isTabs",{type:"boolean",default:!1}),Gallery.attributes.add("top",{type:"number",default:0}),Gallery.attributes.add("bottom",{type:"number",default:0}),Gallery.attributes.add("left",{type:"number",default:0}),Gallery.attributes.add("right",{type:"number",default:0}),Gallery.attributes.add("NextButton",{type:"entity"}),Gallery.attributes.add("PrevButton",{type:"entity"}),Gallery.attributes.add("ContentParent",{type:"entity"}),Gallery.prototype.initialize=function(){var t=this,o=t.entity;function addButton(o){o.posGallery=t.pool.length,null==o.id&&(o.id=t.pool.length);var e=new GalleryButtonScript(t,o);return t.pool.push(e),t.buttons[o.id]=e,sortButton(e),e}function sortButton(o){o.setLocalPosition(t.posX,t.posY,0),t.cascadeColumn&&0===t.colInc&&(t.posY+=t.marginY/4),t.bottomY=t.posY-t.pad.y,t.adjustPosXY()}getLocals(o),t.isEnabled=!0,t._unused=[],t.pool=[],o.galleryScript=t,t.Template=o.findByName("Template"),t.Template.enabled=!1,t.pad={x:t.Template.element.width/2,y:t.Template.element.height/2},o.parent&&o.parent.parent&&o.parent.parent.parent&&o.parent.parent.parent.scrollview&&(t.ScrollView=o.parent.parent.parent.scrollview),t.spring=0,t.id&&on(t.id+":Fill",(function(o){t.fill(o)})),t.clear=function(){for(var o in t.pool)t.pool[o].hide();t.pool=[],t.buttons={},t.selected=[],t.posX=t.pad.x,t.posY=-t.pad.y,t.bottomY=0,t.colInc=0},t.clear(),t.enable=function(){t.isEnabled=!0,t.isCarousel&&t.posContent&&o.parent.setLocalPosition(t.posContent)},t.disable=function(){t.isEnabled=!1,t.wasDown=!1,t.isCarousel&&(t.stopScrolling(),t.posContent=o.parent.getLocalPosition().clone())},t.fill=function(o,e){t.data=o,t.onGalleryDown=e,t.clear();var l=0;if(o&&o.length){for(var a in o)o[a].isUnlocked&&(l=a),addButton(o[a]);t.isCarousel&&t.scrollToPos(l,!0)}else log("Gallery empty",o)},t.push=function(o){t.data.push(o),addButton(o)},t.refresh=function(){for(var o in t.pool){t.pool[o].refresh()}},t.removeButton=function removeButton(o){var e=t.buttons[o.data.id];delete t.buttons[o.data.id],e&&(ARRAY.removeItem(t.pool,e),e.remove(),t.sort())},t.getButton=function(o){for(var e in t.pool)if(t.pool[e].data==o)return t.pool[e]},t.sort=function(){for(var o in t.posX=t.pad.x,t.posY=-t.pad.y,t.bottomY=0,t.colInc=0,t.pool)sortButton(t.pool[o])},t.adjustPosXY=function(){t.columns?++t.colInc>=t.columns?(t.colInc=0,t.posY-=t.marginY,t.posX=t.pad.x):t.posX+=t.marginX:(t.posX+=t.marginX,t.posY-=t.marginY)},t.onMouseDown=function(o){if(t.isEnabled&&(!o.data.isBlocked||t.canClickBlocked)){var e=t.pool.indexOf(o);if(t.isCarousel&&e!=t.itemPos)return t.scrollToPos(e);t.posGallery=o.data.posGallery,t.autoSelect&&t.select(o.data.id),t.id&&fire(t.id+":onClick",o.data,o),t.onGalleryDown&&t.onGalleryDown(o)}},t.select=function(o){var e=t.buttons[o];if(e){for(ARRAY.pushUnique(t.selected,e);t.selected.length>t.selectionMax;)t.selected.shift();var l;for(l in t.selected)t.selected[l].select();for(l in t.pool)-1==t.selected.indexOf(t.pool[l])&&t.pool[l].deselect()}},t.click=function(o){t.isEnabled&&t.buttons[o]&&t.buttons[o].click()},t.next=function(){var o=t.pool[t.posGallery+1];o&&o.click()},t.prev=function(){var o=t.pool[t.posGallery-1];o&&o.click()},t.scrollToAttribute=function(o,e,l,a,n){for(var r=0;r<t.pool.length;r++)if(t.pool[r].data[o]==e)return t.scrollToPos(r,l,a,n)},t.scrollTo=function(o,e){var l=t.buttons[o];l&&t.scrollToPos(t.pool.indexOf(l))},t.scrollToNext=function(){t.scrollToOffset(1)},t.scrollToPrev=function(){t.scrollToOffset(-1)},t.scrollToOffset=function(o){t.scrollToPos(t.itemPos+o)},t.scrollToPos=function(e,l,a,n){null!=e&&(t.itemPos=MATH.hardLimit(e,0,t.pool.length-1)),t.NextButton&&(t.NextButton.enabled=t.itemPos<t.pool.length-1),t.PrevButton&&(t.PrevButton.enabled=t.itemPos>0);var r=o.parent,i=r.getLocalPosition().clone(),s=t.pool[t.itemPos];s.show();var c=localToLocal(s.entity,r);if(t.isHorizontal&&(i.x=-c.x+t.ScrollView.entity.element.width/2),t.isHorizontal||(i.y=-c.y+t.ScrollView.entity.element.height/2),t.ScrollView._velocity.y=t.ScrollView._velocity.x=0,l)return function onComplete(){r.setLocalPosition(i.x,i.y,i.z),t.scaleGallery(),t.stopScrolling()}();ANIMATION.moveTo(r,i,a||.3,n||EASING.SineInOut)},t.stopScrolling=function(){t.scrollingCounter=30,t.scrollingTo=null},t.onUpdate=function(){var e,l;if(o.enabled&&t.isEnabled){var a=(t.ContentParent||o.parent).getLocalPosition();if(t.top&&t.bottom)for(l in t.pool){e=t.pool[l];var n=a.y+e.position.y;n<t.top&&n>t.bottom?e.show():e.hide()}if(t.left&&t.right)for(l in t.pool){e=t.pool[l];var r=a.x+e.position.x;r>t.left&&r<t.right?e.show():e.hide()}o.parent.getLocalPosition().clone();if(t.isCarousel&&(t.scrollingCounter&&t.scaleGallery(),!UI.isBlocked&&null==t.scrollingTo)){if(!t.wasDown&&CURSOR.isDown&&t.stopScrolling(),t.wasDown&&!CURSOR.isDown){var i=t.isHorizontal?JOYSTICK.x:-JOYSTICK.y;!t.disableJoystick&&Math.abs(i)>.3&&Math.abs(i)<2.8?t.scrollToOffset(-MATH.getSign(i)):t.scrollToPos()}t.wasDown=CURSOR.isDown}}},t.scaleGallery=function(){if(t.isCarousel){var e,l,a=o.parent.getLocalPosition().clone();if(t.isHorizontal)for(l=t.marginX,t.itemPos=-MATH.hardLimit(Math.round(a.x/l),-(t.pool.length-1),0),n=0;n<t.pool.length;n++)button=t.pool[n],e=MATH.hardLimit((a.x+n*l)/l,-1,1),scale=1-Math.abs(e)*t.carouselScale,button.setLocalScale(scale,scale,scale),t.carouselRot&&button.setLocalEulerAngles(0,t.carouselRot*e,0);else for(l=t.marginY,t.itemPos=MATH.hardLimit(Math.round(a.y/l),0,t.pool.length-1),n=0;n<t.pool.length;n++)button=t.pool[n],e=MATH.hardLimit((-a.y+n*l)/l,-1,1),scale=1-Math.abs(e)*t.carouselScale,button.setLocalScale(scale),t.carouselRot&&button.setLocalEulerAngles(t.carouselRot*e,0,0)}},getLocals(t.Template),t.animateIn=function(o){o=o||.024;for(var e=0;e<t.pool.length;e++)t.pool[e].animateIn(e*o)}},Gallery.prototype.update=function(){this.onUpdate()};var TEMPLATES=new function(){var e=this,t={};function getPool(n,o){return t[n]||e.register(n,null,o)}function TemplatesPool(e,t,n,o){let r=this;var l=[],i=ASSETS.getTemplate(e);if(i||log("TEMPLATE",e,"DOESN'T EXIST!"),t)i.script&&i.script[t]||(log("Template class not found",t),t=null);else if(i.script)for(var s in i.script._scriptsIndex)if(i.script._scriptsIndex[s]){t=s;break}return r.spawn=function(n,o){var r,i=l.shift()||ASSETS.getTemplate(e);let s=n&&n.isPreload;return i.label=e,!o&&n&&n.parent&&(o=n.parent),o&&addChild(i,o),t&&!s&&(r=i.script[t])&&r.spawn&&r.spawn(n),i.enabled=!s,r||i},r.preload=function(e,t){let n={isPreload:!0};for(let o=0;o<e;o++)r.spawn(n,t)},r.remove=function(e){var t=e.entity||e;t.setPosition(9999,9999,9999),t.enabled=!1;let n=t.findComponents("particlesystem");for(const e of n)e.reset();ARRAY.pushUnique(l,t)},r.destroy=function(){for(var e in l)l[e].destroy();l=[]},r}e.register=function(e,n,o,r){return t[e]?log("POOL FOR",e,"ALREADY EXISTS!"):t[e]=new TemplatesPool(e,n,o,r)},e.spawn=function(e,t,n){return getPool(e,n).spawn(t,n)},e.remove=function(e){var t=e.entity||e;getPool(t.label||t.name).remove(t)},e.preload=function(e,t,n){getPool(e,t).preload(n||1,t)},e.getPool=getPool};var UPSALE=new function(){var e=this;function show(e,o,n){POPUPS.show("Upsale",extract(n,{label:e,callback:o}))}e.rewardEnabled=!0,on("UPSALE:Show",show),e.show=show,e.goShopping=function(){CONFIG.UPSALE.goShopping&&INVENTORY.canPurchase()&&show("GoShopping")},e.huntIntro=function(e){show("HuntIntro",e)},e.poke=function(e,o){show("Poke",e,o)},e.incomingChallenge=function(e,o){show("IncomingChallenge",e,o)},e.challengeFriend=function(){var e=!1;function onContextChange(){off("CONTEXT:onChange",onContextChange),e=!0}function onStartGame(){off("GAME:onStart",onStartGame),e&&WALLET.Coin.collect(5e3,null,!0)}show("ChallengeFriend",(function(e){e&&(fire("BUTTON:onClick","PlayWithFriendsButton"),on("CONTEXT:onChange",onContextChange),on("GAME:onStart",onStartGame))}))},e.noAds=function(e){ANALYTICS.noAds(),show("NoAds",e)},e.playRewarded=function(e){show("PlayRewarded",e)},e.extraTime=function(e){show("ExtraTime",e)},e.revive=function(e){show("Revive",e)},e.noCoins=function(e){show("NoCoins",e)},e.noEnergy=function(e){show("NoEnergy",(function(o){o&&WALLET.Energy.collect(5,null,!0),e&&e()}))},e.collect=function(e){e.giveToPlayer(),POPUPS.show("UPSALE",{label:"Collect",title:e.title,symbol:e.symbol})},e.share=function(e,o,n){var t={label:"Share",symbol:n,title:o||" ",text:e||"That was awesome!",callback:function callback(e){e&&PLATFORM.share(t)}};POPUPS.show("UPSALE",t)},e.rewardBonus=function(e,o){if((o=o||{}).currency=o.currency||"Coin",o.profits=o.profits||COINS.get(),o.symbol=o.symbol||display("RewardCurrency","Symbol_"+o.currency),o.title=o.title||"MULTIPLY YOUR PROFITS!",!ADPLAYER.hasRewardedLoaded||"Disabled"==CONFIG.UPSALE.rewardBonus)return doCallback(!1);function doCallback(n){n||WALLET[o.currency].collect(o.profits,pc.Vec3,!0),e&&e(n)}show(CONFIG.UPSALE.rewardBonus,doCallback,o)},e.idleGains=function(e,o){e=e||function(){};var n="IGVC";if(!ADPLAYER.hasRewardedLoaded)return e();var t=DATE.fractionHoursFrom(get(n));if(!(t<16)){var i=IDLE.getHourlyProduction(t);i&&(set(n,DATE.getNow()),display("RewardCoins",i),show("RewardBonus",e,{symbol:display("RewardCurrency",o||"Coin"),title:"Multiply?"}))}},e.idleGainsCollect=function(e,o,n){if(e=e||function(){},!ADPLAYER.hasRewardedLoaded)return doCallback(!1);var t=IDLE.getDeployed();function doCallback(o){o?IDLE.resetDeployed():IDLE.collect(),e(o)}t&&(display("RewardCoins",t),show("RewardBonus",doCallback,{symbol:display("RewardCurrency",o||"Coin"),title:n||"Idle gains"}))},e.rewardOrCollect=function(e,o,n){if(n=n||function(){},o=o||"Coin",!ADPLAYER.hasRewardedLoaded)return doCallback();function doCallback(t){t||WALLET.get(o).increase(e),n(t)}display("RewardCoins",e),show("RewardBonus",doCallback,{symbol:display("RewardCurrency",o||"Coin"),title:"Multiply?"})},e.acceptedInvites=function(e){e=e||function(){},MESSENGER.get((function refresh(){var o=MESSENGER.InviteAccepted;if(!o.length)return e();var n=o.shift();show("Message",(function(){n.consume(),delay(refresh,.6)}),n)}))}},PopupUpsale=pc.createScript("popupUpsale");PopupUpsale.attributes.add("Coins",{type:"string"}),PopupUpsale.attributes.add("Gems",{type:"string"}),PopupUpsale.prototype.postInitialize=function(){var e,o,n,t,i,a=this,l=a.entity,r=["RewardBonus","MultiplyCash","Revive","ExtraTime","NoCoins","NoEnergy","AdBoost"];SCREEN.call(a);var s=getChildrenNames(getChild(l,"Screens"));for(var c in s)s[c].enabled=!1;function stopTimer(){fire("UPSALE_TIMER:Stop")}function exit(){stopTimer(),ANALYTICS.onShopExit(e),POPUPS.hide(),t&&("GoShopping"!=e&&"Collect"!=e||GAME.shop(),"NoCoins"==e&&WALLET.Coin.collect(1e3,null,!0)),n&&n(t),fire("UPSALE:on"+e+"Exit",t)}TIMER.spawn({id:"UPSALE_TIMER",duration:5e3,onSecond:!0,persistent:!1}),on("UPSALE_TIMER:onTimeUp",exit),a.onShow=function(a){for(var l in UPSALE.rewardEnabled=!0,n=(o=a).callback,e=o.label,t=!1,i=-1!=r.indexOf(e),ANALYTICS.onShopEnter(e),s)s[l].enabled=!1;var c=s[e];if(!c)return exit();c.setLocalPosition(0,0,0),c.enabled=!0,o.symbol||(o.symbol="Symbol_Coin"),CONTENT.fill(c,o),"Revive"!=e&&"ExtraTime"!=e||(display("UPSALE_TIMER:onSecond",5),fire("UPSALE_TIMER:Start")),fire("UPSALE:on"+e,o)},a.onMouseDown=function(o){return UI.block(),stopTimer(),(t="YesBtn"==o.label)?(fire("UPSALE:on"+e+"Accept"),ANALYTICS.onPurchase(e),i&&UPSALE.rewardEnabled?(ANIMATION.bounceScale(l),UI.block(),void steady((function(){UIFX.stop(),ADPLAYER.playRewarded((function(e){t=e,exit()}))}),1)):exit()):exit()}};var OnResize=pc.createScript("onResize");OnResize.attributes.add("scaleMode",{type:"string",enum:[{Disabled:"Disabled"},{Down:"Down"},{Up:"Up"},{Scale:"Scale"},{ScaleX:"ScaleX"}],default:"Disabled"}),OnResize.attributes.add("snapX",{type:"number",default:0}),OnResize.attributes.add("snapRight",{type:"number",default:0}),OnResize.attributes.add("snapLeft",{type:"number",default:0}),OnResize.attributes.add("snapY",{type:"number",default:0}),OnResize.attributes.add("snapTop",{type:"number",default:0}),OnResize.attributes.add("fillW",{type:"number",default:0}),OnResize.attributes.add("fillH",{type:"number",default:0}),OnResize.attributes.add("onLandscape",{title:"On Landscape",type:"boolean",default:!1}),OnResize.attributes.add("landscapePosition",{title:"Landscape Position",type:"vec3",default:[0,0,0]}),OnResize.attributes.add("onLandscapeRotation",{title:"On Landscape Rotation",type:"boolean",default:!1}),OnResize.attributes.add("landscapeRotation",{title:"Landscape Rotation",type:"vec3"}),OnResize.attributes.add("landscapeScale",{title:"Landscape Scale",type:"number",default:0}),OnResize.prototype.postInitialize=function(){var e=this,a=e.entity,t=a.element;getLocals(a);var s=a.sca.clone(),n=a.pos,i=new ResizeMargins(a);function refresh(){var l=ENTITY.getLocalPosition(a),d=s.clone(),o=a.rot.clone();if("Down"==e.scaleMode&&d.mulScalar(UISIZE.SCALED),"Up"==e.scaleMode&&(UISIZE.isLandscape?d.x=d.y=d.z=1:d.mulScalar(1/UISIZE.SCALED)),"Scale"==e.scaleMode&&d.mulScalar(UISIZE.SCALE),"ScaleX"==e.scaleMode&&(d.y*=1/UISIZE.SCALED,d.x*=UISIZE.SCALEU),e.fillW&&t&&(t.width=UISIZE.WIDTH+e.fillW*UISIZE.UISCALE),e.fillH&&t&&(t.height=UISIZE.HEIGHT+e.fillH*UISIZE.UISCALE),e.snapX&&(l.x=MATH.getSign(i.x)*UISIZE.RIGHT-i.x),e.snapLeft&&(l.x=UISIZE.LEFT-i.left),e.snapRight&&(l.x=UISIZE.RIGHT-i.right),e.snapY&&(l.y=MATH.getSign(i.y)*UISIZE.TOP-i.y),"Disabled"!=e.scaleMode&&a.setLocalScale(d),e.onLandscape&&(UISIZE.isLandscape?(l.x=e.landscapePosition.x,l.y=e.landscapePosition.y,l.z=e.landscapePosition.z):(l.x=n.x,l.y=n.y,l.z=n.z)),e.onLandscapeRotation&&(UISIZE.isLandscape?(o.x=e.landscapeRotation.x,o.y=e.landscapeRotation.y,o.z=e.landscapeRotation.z):(o.x=a.rot.x,o.y=a.rot.y,o.z=a.rot.z),a.setLocalEulerAngles(o)),e.landscapeScale){let t=UISIZE.isLandscape?e.landscapeScale:a.sca.x;a.setLocalScale(t,t,t)}a.setLocalPosition(l)}on("UI:onResize",refresh),refresh(),e.refresh=refresh};var UserBox=pc.createScript("userBox");UserBox.prototype.postInitialize=function(){var e=this,t=e.entity,o=t.findByName("Level"),a=t.findByName("fullNameField"),i=(t.findByName("Prize"),t.findByName("Container")),l=e.Picture=t.findByName("Picture"),c=t.findByName("Glow"),r=t.findByName("Winner");r&&(r.enabled=!1),c&&(c.enabled=!1);var s=t.findByName("ScoreField"),d=l.findByName("Base"),f=(d.element.color,e.Bar=t.findByName("Bar").barScript),m=getChildrenNames(t.findByName("States"));m.Blocked=t.findByName("Blocked"),m.Empty=t.findByName("Empty");var u,T,N,p,b=0;function spinning(){i.enabled=!0,N=MATH.cycle(N,100,0,.1),f.setPercent(N);let e=i.getLocalPosition().clone();e.y-=40,e.y<-500&&(e.y+=1e3,conquer.Bots.get(1).then((function(e){CONTENT.fill(i,{userPhoto:e[0].userPhoto})}))),i.setLocalPosition(0,e.y,0),a&&MOTION.change30&&(a.element.text="Matching"+MOTION.dotsText),(b+=dtFixed)<5||(b=0,c&&(c.enabled=!c.enabled))}function updateTimer(){var t=100*DATE.millisecondsFrom(u)/T;f.setPercent(t,!0),t<100||(e.stopTimer(),e.onTimeOut&&e.onTimeOut())}getLocals(t),getLocals(l),e.reset=function(t,n){p=e.data={},i.enabled=!1,o&&(o.enabled=!1),r&&(r.enabled=!1),c&&(c.enabled=!1),e.resetTimer(),e.setState("Empty"),i.setLocalScale(1,1,1),a&&(a.script.motion.enabled=!1,a.setLocalScale(1,1,1),a.element.text=t||" ",a.element.color=COLOR.get(n||"WHITE")),stop(spinning),0},e.fill=function(n){e.reset(),n.fullName||(n.fullName="NAME!"),p=e.data=n,e.setState(p.vars.state),i.setLocalPosition(pc.Vec3.ZERO),e.setColor(p.vars.color||(p==ME?"#1565b2":"#C80404")),p==ME&&f.setColor("#1e90ff"),i.enabled=!0,l.setLocalScale(l.sca),o&&(o.enabled=!0,ANIMATION.bounceScale(o),CONTENT.fill(o,p.vars)),CONTENT.fill(e,p),c&&(c.enabled=!1),ANIMATION.bounceScaleTo(t,.9*t.sca.x,t.sca.x,1)},e.spin=function(){e.reset(""),e.setState("Spectate"),i.enabled=!0,N=0,b=3,f.setPercent(N),d&&(d.element.color=COLOR.get("#C80404")),ANIMATION.bounceScaleTo(t,.1,t.sca.x,2),conquer.Bots.get(1).then((function(e){CONTENT.fill(i,{userPhoto:e[0].userPhoto})})),startFixed(spinning)},e.setWinner=function(){r&&(r.enabled=!0),ANIMATION.bounceScaleTo(r)},e.clearWinner=function(){r&&(r.enabled=!1)},e.setFound=function(t){e.fill(t),ANIMATION.bounceScale(l),c&&(c.enabled=!1)},e.startTimer=function(t,n){e.isPlaying=!0,u=DATE.getNow(),T=t,e.onTimeOut=n,MOTOR.start(updateTimer)},e.stopTimer=function(){e.isPlaying=!1,MOTOR.stop(updateTimer)},e.depleteTimer=function(){e.stopTimer(),f.setPercent(100)},e.hideTimer=function(){f.setPercent(100,!0)},e.resetTimer=function(){e.stopTimer(),f.setPercent(0),f.setColor("#FFFFFF")},e.setColor=function(e){(e=e||p.vars.color)&&(setColor(d,e),f.setColor(e))},e.setState=function(t){for(n in e.state=t,m)m[n]&&(m[n].enabled=n==t);l.enabled="Empty"!=t;var o="#FFFFFF";"Ready"==t&&(o="#ffcf00"),"Spectate"==t&&(o="#c600d6"),f.setColor(o),s&&"Spectate"==t&&(s.enabled=!1)},e.setScore=function(e){s&&(s.enabled=!0,s.element.text=e+"")}};var MaterialController=pc.createScript("materialController");MaterialController.prototype.initialize=function(){this.entity.model.meshInstances[0].material.opacity=.1;for(var t=this.entity.model.meshInstances,e=0;e<t.length;++e)t[e].setParameter("material_opacity",.1),t[e].material.update()},MaterialController.prototype.update=function(t){};var BlendType=pc.createScript("blendType");BlendType.attributes.add("type",{type:"number",default:0}),BlendType.prototype.initialize=function(){var e=this;MOTOR.start((function onloaded(){var t=e.entity,n=t.element||t.sprite;if(!n||!n._meshInstance)return;var a=n._material.clone();a.blendType=pc.BLEND_ADDITIVEALPHA,a.update(),n._meshInstance.material=a,MOTOR.stop(onloaded)}))};var COLLIDERS=new function(){var n=0;this.push=function(){return n++}},Collider=function(n,i,o,e){var l,t,r=this;r.owner=n,i=i||function(n,i){},o=o||function(n,i){},r.id=COLLIDERS.push(r);var a="Collider"+r.id;function findCollisionEntity(n){var i=n.findByName("Collider");if(i)return i;if(n.collision||n.col)return n;var o=getChildren(n);for(var e in o){var l=findCollisionEntity(o[e]);if(l)return l}}function onCollisionStart(n){r.onStart(n.entity||n.other,n)}function onCollisionEnd(n){r.onEnd(n)}function onTriggerEnter(n){r.onStart(n),n.collider&&(n.col&&n.rb||n.rigidbody)&&n.collider.onStart(r.entity)}function onTriggerLeave(n){r.onEnd(n),n.collider&&(n.col&&n.rb||n.rigidbody)&&n.collider.onEnd(r.entity)}function getLabel(n){return n.collider?n.collider.label:n.tags._list[0]}function getOwner(n){return n.collider?n.collider.owner:n}r.refresh=function(n){if(n!=l){r.isEnabled=!1;var i=findCollisionEntity(n);if(i){var o=(l=r.entity=i).collision?l.collision:l.col;o&&(l.collider=r,r.label?r.setLabel(r.label):r.label=l.tags._list[0],t&&(t.off("collisionstart",onCollisionStart,r),t.off("collisionend",onCollisionEnd,r),t.off("triggerenter",onTriggerEnter,r),t.off("triggerleave",onTriggerLeave,r)),(t=o).on("collisionstart",onCollisionStart,r),t.on("collisionend",onCollisionEnd,r),t.on("triggerenter",onTriggerEnter,r),t.on("triggerleave",onTriggerLeave,r),r.contacts={},r.isEnabled=!0)}}},r.refresh(e||n.entity),r.enable=function(){r.isEnabled=!0,cancel(a)},r.disable=function(){unique(a,(function(){r.isEnabled=!1}),.1)},r.reset=function(n){r.contacts={}},r.onStart=function(o,e){if(r.isEnabled&&(!o.collider||o.collider.isEnabled)){var l=getLabel(o);r.contacts[o._guid]=o;var t=getOwner(o);i(l,t,e),n.fire("onCollisionStart",l,t,e)}},r.onEnd=function(i){var e=getLabel(i);if(delete r.contacts[i._guid],r.isEnabled&&(!i.collider||i.collider.isEnabled)){var l=getOwner(i);o(e,l),n.fire("onCollisionEnd",e,l)}},r.setLabel=function(n){r.label=n,l&&l.tags.add(n)}};var LINE=new function(){var e=this;e.pool=[],e.spawn=function(e){var t=new Line;return t.reset(e),t},e.vanish=function(t){return e.spawn(t).vanish()},e.remove=function(t){ARRAY.removeItem(e.pool,t),t.entity.destroy()},e.reset=function(){for(;e.pool.length;)e.pool[0].remove()}};function Line(e){var t,o=this,n=o.entity=new pc.Entity,r=!0;o.thickness=1,o.color="#FFFFFF",LINE.pool.push(o),n.addComponent("element",{anchor:new pc.Vec4(.5,.5,.5,.5),pivot:new pc.Vec2(0,.5),width:20,height:30,type:"image"}),o.reset=function(e){r=!1,n.enabled=!0,n.element.opacity=1,t=e.parent||FX,o.from=e.from,o.to=e.to,o.color=e.color||o.color,o.thickness=e.thickness||o.thickness,t.addChild(n),n.element.layers=[APP.scene.layers.getLayerByName(e.layer||"UI").id],e.batchGroup&&(n.element.batchGroupId=e.batchGroup.id),o.draw()},o.draw=function(e,t,a,c){r=!1,e=e||o.from,t=t||o.to,n.setLocalPosition(e.x,e.y,e.z||0);var i=t.x-e.x,s=t.y-e.y,l=Math.sqrt(i*i+s*s);if(l){n.element.color=COLOR.get(o.color),o.scaleX=l/20*1;var h=1*(a||o.thickness),u=MATH.radiansToDegree(Math.atan2(s,i));n.setLocalScale(o.scaleX,h,1),n.setEulerAngles(0,0,u)}},o.remove=function(){if(r)return;r=!0;const e=n.element.batchGroupId;removeChild(n),LINE.remove(o),APP.batcher.markGroupDirty(e)},o.vanish=function(){ANIMATION.scaleTo(n,{x:o.scaleX,y:0,z:1},.4,EASING.SineOut),DELAY.start((function(){o.remove()}),.5)},e&&o.reset(e)}var ScrollingTexture=pc.createScript("scrollingTexture");ScrollingTexture.attributes.add("texture",{type:"asset"}),ScrollingTexture.attributes.add("speed",{type:"vec2"}),ScrollingTexture.prototype.postInitialize=function(){var e=this;e.tmp=new pc.Vec2,this.texture?e.material=this.texture.resource:e.entity.model?e.material=this.entity.model.meshInstances[0].material:e.entity.render?e.material=this.entity.render.meshInstances[0].material:e.entity.element&&(e.material=e.entity.element.material)},ScrollingTexture.prototype.update=function(e){if(this.material){var t=this.tmp;t.set(this.speed.x,this.speed.y),t.scale(e),this.material.diffuseMapOffset=this.material.diffuseMapOffset.add(t),this.material.normalMapOffset.add(t),this.material.update()}};function SinCount(){var t=this,n=0;function update(){n+=.1,t.sin=.1*Math.sin(n),t.cos=.1*Math.cos(n)}t.sin=0,t.cos=0,t.start=function(){MOTOR.start(update)},t.stop=function(){MOTOR.stop(update)},t.start()}var DIALOG=new function(){var t=this;function show(t,e){POPUPS.show("Dialog",{template:t,callback:e})}t.show=show,t.hide=function(){POPUPS.hide("Dialog")},t.email=function(t){show("Email",t)},t.customError=function(t){POPUPS.show("Dialog",{template:"Error",text:t})},t.customSuccess=function(t){POPUPS.show("Dialog",{template:"Success",text:t})},t.success=function(){POPUPS.show("Dialog",{template:"Success"})},t.lose=function(t){show("Lose",t)},t.noAds=function(t){show("NoAds",t)},t.reset=function(t){show("Reset",t)},t.permission=function(t){show("Permission",t)},t.error=function(t){show("Error",t)},t.poke=function(t){show("Poke",t)},t.missions=function(t){show("Missions",t)},on("SOCKET:onError",(function disconnect(){log("SOCKET ERROR!"),GAME.pause(),SOCKET.disconnect(),show("Disconnect",(function(){SOCKET.reconnect()}))}))},PopupDialog=pc.createScript("popupDialog");PopupDialog.prototype.initialize=function(){var t=this;SCREEN.call(t);var e,o={};function close(e){POPUPS.hide(),(t.data.callback||function(){})("ActionButton"==e)}o.default={action:"OK!",title:"default title",text:"Default text here"},o.sentCard={action:"OK!",title:"Success",text:"Card successfully sent"},o.sentGift={action:"OK!",title:"Success",text:"Gift successfully sent"},o.lootboxFull={action:"OK!",title:"Oh no!",text:"Lootboxes are full"},o.Email={action:"OK!",title:"Check your email",text:"We sent you an email, be sure to check your spam folder!"},o.NoAds={action:"OK!",title:"NO ADS",text:"No ads available, try again in a little while!"},o.Reset={action:"RESET",title:"Reset?",text:"Reset_Question"},o.Facebook={action:"PLAY",title:"Facebook",text:"Play_on_Facebook"},o.Quit={action:"YES",title:"Sure?",text:"End game and go back to home?"},o.Lose=o.Quit,o.FullHouse={action:"OK!",title:"Full House",text:"The room is full, check back later!"},o.Disconnect={action:"OK!",title:"Oh No!",text:"Connection lost, try again shortly"},o.NeedLevel={action:"OK!",title:"Level X",text:"Reach level X to unlock this location"},o.NoCoins={action:"OK!",title:"No funds!",text:"Earn more currency by playing games!"},o.Permission={action:"OK!",title:"Sure?",text:"Grant this game permission and play with friends!"},o.Error={action:"OK",title:"ERROR",text:"There was a network error, try again later!"},o.Ping={action:"Cool!",title:"Sent",text:"We sent a ping to your friend to play with you"},o.Missions={action:"COOL!",title:"UNLOCK REWARDS",text:"Complete more missions to collect your rewards!"},o.Success={action:"COOL",title:"SUCCESS",text:"The operation completed successfully"},t.onShow=function(i){e=!1,CONTENT.fill(t,function getTemplate(t){var e=extract(o[t.label||t.template]||o.default);return ARRAY.merge(t,e)}(i)),i.duration&&(e=!0,delay(close,i.duration))},t.onClick=function(t){e||close(t)}};var ScreenShop=pc.createScript("screenShop");ScreenShop.prototype.postInitialize=function(){var e=this,o=e.entity;SCREEN.call(e),ScrollView=o.findByName("ScrollView"),Content=ScrollView.findByName("Content"),GalleryLayout=e.entity.findByName("GalleryLayout"),getLocals(GalleryLayout),on("UI:onResize",onResize);let t=!0;function onResize(){ScrollView.element.height=UISIZE.HEIGHT,Content.element.height=GalleryLayout.pos.y-GalleryLayout.script.galleryLayout.posY-600,GalleryLayout.setLocalPosition(GalleryLayout.pos.x,Content.element.height/2-125-100,0)}e.onShow=function(){GalleryLayout.script.galleryLayout.fill(CONFIG.SHOPLAYOUT,(function(o){e.onGalleryDown(o)})),t=!1,TOP.show(),NAV.show(),ScrollView.enabled=!1,ScrollView.enabled=!0,MUSIC.play("Lounge"),ANALYTICS.onShopEnter("Shop"),onResize()},e.onExit=function(){ANALYTICS.onShopExit("Shop")}};var InviteBar=pc.createScript("inviteBar");InviteBar.prototype.postInitialize=function(){for(var n=this.entity.findByName("Gallery").script.gallery,o=[],i=0;i<6;i++)o.push({});function refill(){var o=ARRAY.shuffle(FRIENDS._pool);for(var i in o)n.pool[i]&&n.pool[i].fill(o[i])}n.fill(o,(function onDown(n){var o=n.data;if(!o.avatarID)return PLATFORM.sendInvite();PLATFORM.playWithFriend(o.avatarID,(function doSend(){"Ready"==ME.vars.status&&fire("BUTTON:onClick","PlayButton"),fire("BUTTON:onClick","PlayButton")}))})),on("UI:onHome",refill),on("FRIENDS:onData",refill),on("SESSION:onChange",(function(){n.refresh()})),on("UI:onHome",(function(){})),this.onMouseDown=function(n){PLATFORM.sendInvite()},refill()};var FriendButton=pc.createScript("friendButton");FriendButton.prototype.initialize=function(){var e=this,a=e.entity,n=a.findByName("Playing"),t=a.findByName("Base"),l=a.findByName("userPhotoTexture"),i=a.findByName("Plus"),d=a.findByName("Play"),r=a.getLocalScale().x;a.buttonScript=e,BUTTON.call(e),e.fill=function(o){if(CONTENT.fill(e,o),n.enabled=l.enabled=t.enabled=!1,i.enabled=!0,d.enabled=!1,e.data.avatarID){i.enabled=!1,l.enabled=t.enabled=!0;var c=COLOR.get(e.data.color);c&&(t.element.color=c),e.refresh(),ANIMATION.bounceScaleTo(a,1,r)}},e.refresh=function(){e.data.avatarID&&(d.enabled=!n.enabled)}};var AutoBar=pc.createScript("autoBar");AutoBar.prototype.initialize=function(){var t=this.entity;this.percent=0,t.element.width=0},AutoBar.prototype.update=function(){var t=this,e=t.entity;t.percent<1&&(t.percent+=.0025),t.percent>=1&&(t.percent=0),e.element.width=670*t.percent},AutoBar.prototype.setPercent=function(t){var e=this;e.entity;e.percent=t,e.update()};var Loader=pc.createScript("loader");Loader.prototype.initialize=function(){var e=this,r=e.entity;e.pool=[];var o=getChildren(r.findByName("Rays"));for(var t in o)e.pool.push(o[t].findByName("Shape").element);e.counter=0,e.current=0},Loader.prototype.update=function(e){var r=this;if(!(--r.counter>0)){r.counter=10,++r.current>=r.pool.length&&(r.current=0);for(var o=0;o<r.pool.length;o++)r.pool[o].opacity=o==r.current?.5:.9}};var DrawPad=pc.createScript("drawPad");DrawPad.prototype.initialize=function(){var n,o=this,e=o.entity,t=!1,i=[],a=[],c=null,r=null,u=new pc.Vec2,P=!1,l=e.findByName("Button"),s=.46*l.element.width,p=.46*l.element.height;function clearDrawing(){EffectPrettyGestures.api.clearPoints()}function onDown(o){t&&(onChange(o),i.length=0,a.length=0,c=null,r=null,n=SFX.loop("Draw"))}function onUp(){if(!t)return;n&&n.stop(),SFX.play("DrawFinish"),FINGER.hide(),t=!1;const o={screen:i,mesh:MATH.normalizeAndShiftPoints(a,690,2.4)};fire("DRAWPAD:onDrawing",o),EffectPrettyGestures.api.fadeOutPoints()}function onChange(n){if(t){var o=UISIZE.touchToScreen(n),i=e.getLocalPosition();u.x=o.x-i.x,u.y=o.y-i.y,u.x=MATH.clamp(u.x,s,-s),u.y=MATH.clamp(u.y,p,-p);var a=u.clone();a.x+=i.x,a.y+=i.y;var c=UISIZE.screenToTouch(a);EffectPrettyGestures.api.addPoint(c.x,c.y)}}function addPoint(n,o,e,t,i,a){MATH.hipotenusa(e,o)<i||(t.length===a&&t.shift(),t.push(o.clone()),e.copy(o))}APP.mouse.disableContextMenu(),APP.mouse.on(pc.EVENT_MOUSEDOWN,onDown),APP.mouse.on(pc.EVENT_MOUSEUP,onUp),APP.mouse.on(pc.EVENT_MOUSEMOVE,onChange),APP.touch&&(APP.touch.on(pc.EVENT_TOUCHSTART,(function(n){onDown(n.touches[0]),n.event.preventDefault()})),APP.touch.on(pc.EVENT_TOUCHEND,onUp),APP.touch.on(pc.EVENT_TOUCHMOVE,(function(n){onChange(n.touches[0])}))),o.onMousePress=function(){clearDrawing(),t=!0},on("DRAWPAD:Enable",(function(){P=!0;var n=e.getLocalPosition();FINGER.show({x:n.x,y:n.y,action:"circle"}),clearDrawing()})),on("DRAWPAD:Reset",clearDrawing),on("DRAWPAD:Disable",(function(){P=!1,FINGER.hide(),clearDrawing()})),o.onUpdate=function(n){if(t&&P){var o=u.clone();if(!c)return c=o.clone(),r=o.clone(),i.push(c),void a.push(r);addPoint(0,o,c,i,10,100),addPoint(0,o,r,a,50,50)}}},DrawPad.prototype.update=function(){this.onUpdate()};var SCREENGAME,ScreenGame=pc.createScript("screenGame");ScreenGame.prototype.initialize=function(){var e=this,o=e.entity;let t,i,a,n,l,s;function onResize(){let e=1,o=new pc.Vec3;UISIZE.isLandscape&&(e=1.4,o.x=100,o.y=100),s.setLocalScale(e,e,e),s.setLocalPosition(o)}SCREENGAME=e,SCREEN.call(e),ASSETS.loadTemplate("ScreenCorners",o,(function addComponents(o){t=e.Top=o.findByName("Top"),i=e.TopLeft=o.findByName("TopLeft"),TopRight=e.TopRight=o.findByName("TopRight"),a=e.Bottom=o.findByName("Bottom"),l=o.findByName("BottomRight"),n=o.findByName("BottomLeft"),s=e.TopLeftContainer=o.findByName("TopLeftContainer"),ASSETS.loadTemplate("ActiveFXDisplayer",TopRight,(function(e){e.setLocalPosition(-100,-450,0)})),LIVES.max>1&&ASSETS.loadTemplate("BarLives",TopRight,(function(e){e.setLocalPosition(-100,-300,0)}));CONFIG.GAME.useRivalsLadder&&ASSETS.loadTemplate("RivalsLadder",s,(function(e){e.setLocalPosition(855,-135,0)}));CONFIG.GAME.useRivalBar&&ASSETS.loadTemplate("RivalBar",t,(function(e){e.setLocalPosition(0,-150,0)}));CONFIG.GAME.TIME.useTimer&&ASSETS.loadTemplate("GameTimer",t,(function(e){e.setLocalPosition(0,-270,0)}));CONFIG.GAME.TIME.useTimerBar&&ASSETS.loadTemplate("GameTimerBar",t,(function(e){e.setLocalPosition(0,-270,0)}));CONFIG.GAME.useUpgradeBox&&ASSETS.loadTemplate("UpgradeBox",a,(function(e){e.setLocalPosition(0,412,0)}));CONFIG.GAME.useKillFeed&&ASSETS.loadTemplate("KillFeed",i,(function(e){e.setLocalPosition(0,-784,0)}));ASSETS.loadTemplate("EmoteLauncher",n,(function(e){e.setLocalPosition(100,840,0)})),ASSETS.loadTemplate("MissionDisplayer",s,(function(e){e.setLocalPosition(165,-135,0)}))})),e.onMouseDown=function(e){},e.onShow=function(){log("SHOW GAME SCREEN")},on("UI:onResize",onResize),onResize()};function Grid(e,r){var t=this,n=t.pool={},i=t.points={},o=t.positions={},u=0,f=0,l=0,c=0,a=[],s=new pc.Vec2(1,1);function pushPiece(e,r,i,o,u){var f=n[t.key(e,r)];f&&(o&&f.color!=o||u&&!f.canMove||i.push(f))}function getKeyNeighbour(e,r,n){var i=t.getKeyPoint(e);if(i)return t.key(i.x+r,i.y+n)}function pushIfNeighbour(e,r,t,i,o){var u=(o||n)[getKeyNeighbour(e,r,t)];return u&&i.push(u),u}t.setMargins=function(e,r){s.x=e,s.y=r},t.set=function(e,r,i){var a=t.key(e,r);return i?(e>f&&(f=e),e<u&&(u=e),r>l&&(l=r),r<c&&(c=r),n[a]=i,o[a]=new pc.Vec3(s.x*e,s.y*r,0),i):t.delete(e,r)},t.getPosition=function(e,r){var n=t.key(e,r);return o[n]||(o[n]=new pc.Vec3(s.x*e,s.y*r,0)),o[n]},t.delete=function(e,r){return t.remove(t.key(e,r))},t.get=function(e,r){return n[t.key(e,r)]},t.remove=function(e){if(!e)return;let r=n[e];return delete n[e],r},t.getKeyPoint=function(e){return i[e]},t.getArray=function(e){var r,n=[];for(var i in e)(r=e[i])&&(r=t.get(r.x,r.y))&&n.push(r);return n},t.clear=function(){n=t.pool={},i=t.points={}},t.key=function(e,r){var t=e+","+r;return i[t]||(i[t]=new pc.Vec2(e,r)),t},t.clone=function(){var e=new Grid;ARRAY.extract(i,e.points),ARRAY.extract(n,e.pool)},t.getAll=function(){var e=[];for(var r in n)e.push(n[r]);return e},t.getRandomPosition=function(){var e=[];for(var r in o)e.push(o[r]);return ARRAY.getRandomItem(e)},t.disable=function(){for(var e in n)n[e].disable()},t.enable=function(){for(var e in n)n[e].enable()},t.refresh=function(){for(var e in n)n[e].refresh()},t.getColor=function(e){var r=[];for(var t in n)"Color"!=n[t].type||e&&n[t].color!=e||r.push(n[t]);return r},t.getProperty=function(e,r){var t=[];for(var i in n)n[i][e]==r&&t.push(n[i]);return t},t.getIsland=function(e){let r=clone(n),o=[],u={},f=r[e].matchID,l=i[e];return function ripple(e,n){let i=t.key(e,n),l=r[i];if(!l||l.matchID!=f)return;u[i]=l,o.push(l),delete r[i],ripple(e+1,n),ripple(e-1,n),ripple(e,n+1),ripple(e,n-1)}(l.x,l.y),o},t.getIslands=function(){let e=clone(n),r=[];for(let r in e)rippleKey(r);return r=sort(r,"length"),r.reverse(),r;function rippleKey(n){e[n].island=[];let o=[],u=e[n].matchID,f=i[n];!function ripple(r,n){let i=t.key(r,n),f=e[i];if(!f||f.matchID!=u)return;o.push(f),delete e[i],ripple(r+1,n),ripple(r-1,n),ripple(r,n+1),ripple(r,n-1)}(f.x,f.y),r.push(o);for(let e in o)o[e].island=o}},t.getShore=function(e,r){let o=clone(n),u=[];for(let r in e)delete o[e[r].key];for(let r in e)rippleKey(e[r].key);return u;function rippleKey(e){let n=i[e],f=n.x,l=n.y;function ripple(e,n){let i=t.key(e,n),f=o[i];f&&(r&&!f.explodeOnProximity||(u.push(f),delete o[i]))}ripple(f+1,l),ripple(f-1,l),ripple(f,l+1),ripple(f,l-1)}},t.getLine=function(e,r){var n=i[e];return n?r?t.getLineHorizontal(n.y):t.getLineVertical(n.x):[]},t.getLineHorizontal=function(r){var t=[];for(let n=0;n<e;n++)pushPiece(n,r,t);return t},t.getLineVertical=function(e){var t=[];for(let n=0;n<r;n++)pushPiece(e,n,t);return t},t.gravity=function(){let i=clone(n);for(var o=r-1;o>=-r;o--)for(var u=0;u<e;u++){var f=i[t.key(u,o)];f&&f.gravity()}},t.getGravityKey=function(e,i,o){o=o||r;let u=e,f=i;for(var l=f+1;l<o&&!n[t.key(u,l)];l++)f=l;return u==e&&f==i?null:t.key(u,f)},t.getGravityPaths=function(i){let o=clone(n),u=t.gravityPaths={};for(let n=r-1;n>=0;n--)for(let r=0;r<e;r++){let e=t.key(r,n),i=o[e];i&&i.canMove&&processPath(e,r,n)}let f=u.newSpawns=[];var l=0;function processPath(e,r,n){e=e||t.key(r,n);let f=t.getGravityPath(r,n,o,i);if(f)return o[f.lastKey]=o[e],delete o[e],u[e]=f,f}return function doNewSpawns(){l--;let r=!1;for(let n=0;n<e;n++){if(o[t.key(n,0)])continue;let e=t.key(n,l);o[e]={},processPath(e,n,l),f.push(new pc.Vec2(n,l)),r=!0}r&&doNewSpawns()}(),u},t.getGravityPath=function(n,i,o,u){let f,l=[];t.key(n,i);function checkEmpty(r,u){if(offsetX=r,u){let e=o[t.key(offsetX+u,i-1)];if(!e||e.canMove)return;hadDiagonal=!0,offsetX+=u}if(offsetX<0||offsetX>=e||o[t.key(offsetX,i)])return!1;n=offsetX;let c=new pc.Vec2(n,i);return f=c,l.push(c),!0}if(function nextStep(){if(++i>r-1)return;if(checkEmpty(n,0))return nextStep();if(!u)return;if(i-2<=0)return;let e=ARRAY.shuffle([1,-1]);for(;e.length;)if(checkEmpty(n,e.shift()))return nextStep()}(),f)return l.lastPoint=f,l.lastKey=t.key(f.x,f.y),l},t.getRadius=function(e,r,t){r=r||1;for(var n=[],o=i[e],u=-r;u<=r;u++)for(var f=-r;f<=r;f++)0==u&&0==f||pushPiece(o.x+u,o.y+f,n,t);return n},t.getEmptyColumnCount=function(e){let i=0;for(var o=r-1;o>=0;o--){let r=n[t.key(e,o)];r||i++,r&&r.isLocked&&(i=0)}return i},t.isShape=function(e,r){return"Loop"==r?t.isLoop(e):"Line4"==r?t.isLine(e,4):"Line5"==r?t.isLine(e,5):void 0},t.isLoop=function(e){return e.length>2&&e[0]==e[e.length-1]},t.isLine=function(e,r){if(r&&e.length!=r)return!1;for(var t=i[e[0].key],n=!0,o=!0,u=1;u<e.length;u++){var f=i[e[u].key];f.x!=t.x&&(o=!1),f.y!=t.y&&(n=!1)}return n?"Horizontal":!!o&&"Vertical"},t.getCanMatch=function(){let e=clone(n);for(let r in e)e[r].canMatch||delete e[r];return e},t.getLineMatches=function(){let i=[],o=t.getCanMatch();return rippleLines(!0),rippleLines(!1),i=sort(i,"length"),i;function rippleLines(u){let f=clone(o);for(var l=0;l<e;l++)for(var c=0;c<r;c++){var a=t.key(l,c),s=n[a];s&&ripple(s.color,l,c,f,u)}function ripple(n,o,u,f,l){var c=[];if(l)for(var a=o;a<e&&pushIfMatch(a,u);a++);else for(var s=u;s<r&&pushIfMatch(o,s);s++);function pushIfMatch(e,r){let i=t.key(e,r);var o=f[i];return!(!o||o.color!=n)&&(c.push(o),delete f[i],!0)}c.length<3||i.push(c)}}},t.getCross=function(e,r,t){let n=[],o=i[e].x,u=i[e].y;return pushPiece(o+1,u,n,r,t),pushPiece(o-1,u,n,r,t),pushPiece(o,u+1,n,r,t),pushPiece(o,u-1,n,r,t),n},t.blinkPossible=function(){var e=ARRAY.getRandomItem(a);for(var r in e)e[r].blink()},t.isLineFull=function(r){for(var i=0;i<e;i++)if(n[t.key(i,r)])return!0;return!1},t.highlightFullColumns=function(){for(var i=[],o=0;o<e;o++)if(n[t.key(o,0)])for(var u=0;u<r;u++)pushPiece(o,u,i);for(var f in i)i[f].highlightFull()},t.countBombs=function(){for(var e in n)n[e].countBomb()},t.getColumn=function(e){for(var t=[],n=0;n<r;n++)pushPiece(e,n,t);return t},t.getLines=function(t,n,o){var u=[],f=i[t];if(o=o||0,f){if(n)for(let r=f.y-o;r<=f.y+o;r++)for(let t=0;t<e;t++)pushPiece(t,r,u);else for(let e=f.x-o;e<=f.x+o;e++)for(let t=0;t<r;t++)pushPiece(e,t,u);return u}},t.getCross_OLD=function(e,r,t){var n=[];if(r)for(let r=1;r<=3;r++)pushIfNeighbour(e,-1*r,-1*r,n,t),pushIfNeighbour(e,1*r,-1*r,n,t),pushIfNeighbour(e,-1*r,1*r,n,t),pushIfNeighbour(e,1*r,1*r,n,t);else for(let r=1;r<=3;r++)pushIfNeighbour(e,0,-1*r,n,t),pushIfNeighbour(e,1*r,0,n,t),pushIfNeighbour(e,0,1*r,n,t),pushIfNeighbour(e,-1*r,0,n,t);return n},t.getInsideSquare=function(i){var o=[];for(var u in i)o.push(i[u].key);for(var f=[],l=1;l<e-1;l++)for(var c=1;c<r-1;c++){var a=t.key(l,c);-1==o.indexOf(a)&&isInside(l,c,o)&&f.push(n[a])}return f;function isInside(n,i,o){return!!function raycastLeft(e,r,n){for(var i=e-1;i>=0;i--)if(-1!=n.indexOf(t.key(i,r)))return!0;return!1}(n,i,o)&&(!!function raycastRight(r,n,i){for(var o=r+1;o<e;o++)if(-1!=i.indexOf(t.key(o,n)))return!0;return!1}(n,i,o)&&(!!function raycastTop(e,r,n){for(var i=r-1;i>=0;i--)if(-1!=n.indexOf(t.key(e,i)))return!0;return!1}(n,i,o)&&!!function raycastBottom(e,n,i){for(var o=n+1;o<r;o++)if(-1!=i.indexOf(t.key(e,o)))return!0;return!1}(n,i,o)))}},t.isGroupSquare=function(e){var r=[];for(let t in e)r[e[t].key]=!0;for(let r in e)if(isTopLeftCorner(e[r].key))return!0;function isTopLeftCorner(e){return!!r[getKeyNeighbour(e,1,0)]&&(!!r[getKeyNeighbour(e,1,1)]&&!!r[getKeyNeighbour(e,0,1)])}return!1},t.getRandomKeys=function(e){var r=[],t=[];for(var n in grid)t.push(n);for(t=ARRAY.shuffle(t);r.length<e;)r.push(t.shift());return r},t.getMovableIslands=function(){var e=clone(n);for(var r in e)e[r].canMatch||delete e[r];return t.getIslands(e)}}function PathXY(e,n){var t=this,i=pc.CURVE_LINEAR,a=new pc.Curve,o=new pc.Curve;a.type=o.type=i;var r,l,u=0,c=[],s=new pc.Vec2,p=.03,g=t.points=e,d={};if(c.push(0),g[0]||log("================== PATXY has no point zero!",g.length),n)for(r=1;r<g.length-1;r++){var h=g[r],v=g[r]=new pc.Vec2(h.x,h.y);v.x+=spectrumDecimal(n),v.y+=spectrumDecimal(n),v.label=h.label}for(r=1;r<g.length;r++)s.sub2(g[r-1],g[r]),u+=s.length(),c.push(u);for(t.duration=u*p,r=0;r<g.length;r++){var f=c[r]/u;(l=g[r]).label&&(d[l.label]=c[r]*p),a.add(f,l.x),o.add(f,l.y)}t.getPositionTime=function(e){return 0===t.duration?(console.warn("Warning! Invalid duration value! time, distance, speed:",e,u,p),t.getPosition(0)):t.getPosition(e/t.duration)},t.getLabelTime=function(e){return d[e]||0},t.getPosition=function(e){return(l=new pc.Vec2).x=a.value(e),l.y=o.value(e),l},t.getLast=function(){return g[g.length-1]}}var FRIENDSBAR,FriendsBar=pc.createScript("friendsBar");FriendsBar.attributes.add("sortVar",{type:"string",default:"coins"}),FriendsBar.attributes.add("isPercent",{type:"boolean"}),FriendsBar.prototype.initialize=function(){var t,r=this,e=r.entity,a=e.findByName("Bar"),i=e.findByName("Template"),o=a.element.width>a.element.height,s=[i],n=[],l=o?a.element.width:a.element.height,d=l/2;function reset(){for(;n.length;)s.push(removeChild(n.shift()))}function setPositions(e){if(n.length){var a,i,s=t,f=t;for(a in n)(i=n[a]).sort=PLAYERS.get(i.data.avatarID).vars[r.sortVar],i.sort>s.sort&&(s=i),i.sort<f.sort&&(f=i);var c=r.isPercent?100:s.sort-f.sort,v=l/c;for(a in ARRAY.sort(n,r.sortVar),n){i=n[a];var h=r.isPercent?i.sort:i.sort-f.sort,p=MATH.hardLimit(h*v-d,-d,d);i.Crown&&(i.Crown.enabled=!1);var u=i.getLocalPosition();o?u.x=e?p:u.x+(p-u.x)/20:u.y=e?p:u.y+(p-u.y)/20,i.setLocalPosition(u)}s.Crown&&(s.Crown.enabled=!0)}}i.enabled=!1,FRIENDSBAR=r,on("FRIENDSBAR:Fill",(function(t){r.fill(t)})),r.fill=function(t){t=t||[PLAYERS.ME.avatarID,RIVALS.RIVAL.avatarID],r.fillPlayers(PLAYERS.get(t))},r.fillPlayers=function(a){for(var o in reset(),a){var l=s.shift()||i.clone(),d=a[o];d.vars[r.sortVar]||(d.vars[r.sortVar]=0),l.sort=d.vars[r.sortVar],CONTENT.fill(l,d.vars);var f=d.avatarID==PLAYERS.ME.avatarID,c=f?1:.75;l.setLocalScale(c,c,c),f&&(t=l),addChild(l,e),n.push(l),l.Crown=l.findByName("Crown")}setPositions(!0)},r.reset=reset,r.onUpdate=function(){setPositions()}},FriendsBar.prototype.update=function(t){this.onUpdate()};var COUNTDOWN=new function(){function start(t){UNDERLAYS.show("CountDown",{callback:t})}on("COUNTDOWN:Start",start),this.start=start},OverlayCountDown=pc.createScript("overlayCountDown");OverlayCountDown.prototype.initialize=function(){var t=this;SCREEN.call(t);var n=t.entity,o=n.findByName("Container"),e=n.findByName("titleField");TIMER.spawn({id:"COUNTDOWNTIMER",autoStart:!1,onSecond:!0,persistent:!1,replicated:!1,duration:3}),on("COUNTDOWNTIMER:onTimeUp",(function onTimeUp(){delay((function(){UNDERLAYS.hide("CountDown"),UI.unlock(),data.callback&&data.callback(),SFX.play("CountDownFinish"),fire("COUNTDOWN:onFinish"),TITLE.show({template:"GetReady",title:"GO!",time:1})}),1)})),on("COUNTDOWNTIMER:onSecond",(function onSecond(t){resetLocals(o),CONTENT.fill(n,{title:t+1+""}),ANIMATION.bounceScaleTo(o,.5,3,1.2),SFX.play("CountDown")})),getLocals(o),t.onShow=function(t){data=t||{},e.element.text=" ",fire("COUNTDOWNTIMER:Start",2),UI.lock()},t.onHide=function(){DELAY.cancel("CountDown")}};var TOUCH,Touch=pc.createScript("touch");function TouchInstance(o){var n=this,e=n.id=o.id||0;TOUCH.lastTouch=n,TOUCH.touches.push(n),TOUCH.index[e]=n,n.isDown=!1,n.anchor=n.anchor=new pc.Vec3,n.x=n._x=0,n.y=n._y=0;var c=n.pos=new pc.Vec3,t=n.lastPos=new pc.Vec3,s=n.start=new pc.Vec3;let u=new pc.Vec2,a=new pc.Vec2,i=new pc.Vec2;var h=n.distance=new pc.Vec3,T=n.totalDistance=new pc.Vec3;let r=n.rawTotalDistance=new pc.Vec2;function update(o){n._x=u.x=o.x,n._y=u.y=o.y;var e=UISIZE.touchToScreen(o);n.x=c.x=e.x,n.y=c.y=e.y,n.z=0}function getDistance(){return h.x=c.x-t.x,h.y=c.y-t.y,T.x=c.x-s.x,T.y=c.y-s.y,r.x=u.x-a.x,r.y=u.y-a.y,{startPos:s,pos:c,distance:h,total:T,rawTotal:r}}n.onDown=function(o){update(o),n.isDown=!0,n.anchor=c.clone(),s.x=t.x=n.x,s.y=t.y=n.y,a.x=i.x=n._x,a.y=i.y=n._y},n.onMove=function(o){update(o),n.isDown&&(MATH.hipotenusa(t,c)<1||(fire("TOUCH:onMove",n,getDistance()),t.copy(c)))},n.onUp=function(o){n.isDown&&(n.isDown=!1,n.pos.x=n.x,n.pos.y=n.y,fire("TOUCH:onUp",n,getDistance()))},n.onRelease=function(){n.isDown=!1,fire("TOUCH:onRelease",n)}}Touch.prototype.initialize=function(){var o=this;TOUCH=o,o.isDown=!1;o.touches=[];var n,e=o.index={};const c=document.getElementById("application-canvas");function copyTouch(n){o.x=n.x,o.y=n.y,o.z=n.z,o.pos=n.pos,o.anchor=n.anchor,o.isDown=n.isDown,o.totalDistance=n.totalDistance,o._x=n._x,o._y=n._y}function checkMouse(e){return n||(n=o.mouse=new TouchInstance(e)),copyTouch(n),n}function touchEnd(c){var t,s;for(t in c.id=c.id||0,c.changedTouches){(s=e[c.changedTouches[t].id])&&(s.onUp(),s.onRelease());break}c.touches[0]||(n=o.mouse=null,o.isDown=!1)}o.x=0,o.y=0,o.z=0,o.pos=new pc.Vec3,o.anchor=new pc.Vec3,o.lastTouch=null,APP.mouse.disableContextMenu(),APP.mouse.on(pc.EVENT_MOUSEDOWN,(function(o){checkMouse(o).onDown(o),fire("TOUCH:onPress",n),UI.isBlocked||UI.Layers.POPUP.current||n.y<800&&fire("TOUCH:onDown",n)})),APP.mouse.on(pc.EVENT_MOUSEMOVE,(function(o){checkMouse(o).onMove(o)})),APP.mouse.on(pc.EVENT_MOUSEUP,(function(o){checkMouse(o).onUp(o),n.onRelease()})),window.addEventListener("mouseout",(function(o){checkMouse(o).onRelease()}),!1),APP.mouse.on(pc.EVENT_MOUSEWHEEL,(function(n){o.wheel=n.wheel,fire("TOUCH:onWheel",o.wheel)})),APP.touch&&(APP.touch.on(pc.EVENT_TOUCHSTART,(function(e){for(var c in e.changedTouches){var t=e.changedTouches[c];o.lastTouch=new TouchInstance(t),o.lastTouch.onDown(t)}n||copyTouch(n=o.mouse=o.lastTouch),fire("TOUCH:onPress",n),o.lastTouch.y<800&&fire("TOUCH:onDown",o.lastTouch),e.event.preventDefault()})),APP.touch.on(pc.EVENT_TOUCHMOVE,(function(o){var t;for(t in o.changedTouches){var s=e[o.changedTouches[t].id];s&&s.onMove(o.changedTouches[t]);break}copyTouch(n);const u=document.elementFromPoint(o.touches[0].x,o.touches[0].y);(!u||u&&u!==c)&&touchEnd(o)})),APP.touch.on(pc.EVENT_TOUCHEND,touchEnd),APP.touch.on(pc.EVENT_TOUCHCANCEL,touchEnd)),o.block=function(){isBlocked=!0},o.unblock=function(){isBlocked=!1}};var showTimestamp,timePassed,show2ndBarTime,hide2ndBarTime,LOADSCENE=new function(){var e,n,o,i=this;i.show=function(o,i){o&&(n=!0),e||(e=!0,OVERLAYS.show("LoadScene",{isFTUE:i}),cancel("LoadScene"),showTimestamp=DATE.getNow(),show2ndBarTime=Date.now())},i.hide=function(){if(o=!0,e&&!n){if(e=!1,o=!1,timePassed=DATE.millisecondsFrom(showTimestamp),hide2ndBarTime=Date.now(),timePassed<1e3)return OVERLAYS.hide("LoadScene");fire("LOADSCENE:Finish")}},i.lock=function(e){i.show(!0,e)},i.unlock=function(e){n=!1,(o||e)&&i.hide()}},PopupLoadScene=pc.createScript("popupLoadScene");PopupLoadScene.prototype.postInitialize=function(){var e=this,n=e.entity,o=n.findByName("Container"),i=n.findByName("Logo"),a=n.findByName("LogoSymbol"),t=n.findByName("textField"),c=new Cue(!0);c.copy(["FUN","ADVENTURES","RIVALS","FRIENDS","CHALLENGES","REWARDS","CRAZINESS","PROGRESS"]);var d=0;function update(){if(--d<=0){let e=c.get();t.element.text=e,ANIMATION.bounceScaleTo(t),display("LoadSceneText",e),d=30}}function onResize(){let e=(UISIZE.isLandscape?UISIZE.WIDTH:UISIZE.HEIGHT)/1080;if(UISIZE.isLandscape||UISIZE.WIDTH>1080&&(e*=UISIZE.WIDTH/1080),UISIZE.isLandscape){let n=1920/1080,o=UISIZE.WIDTH/UISIZE.HEIGHT;o<n&&(e*=n-o+1)}o.setLocalScale(e,e,1)}SCREEN.call(e),e.onShow=function(e){d=0,fire("LOADSCENE:onShow"),t.enabled=!1,delayUnique("loadscene",(function(){t.enabled=!0,update(),start(update)}),1),ANIMATION.fadeIn(a,.5),ANIMATION.bounceScaleTo(i,.9,1,1),onResize()},e.onHide=function(){stop(update),cancel("loadscene")},on("LOADSCENE:Finish",(function finish(){cancel("loadscene"),OVERLAYS.hide("LoadScene")})),on("UI:onResize",onResize)};var POSITIONDISPLAYER=new function(){var e=this;e.show=function(){OVERLAYS.hide("PositionDisplayer"),OVERLAYS.show("PositionDisplayer")},e.hide=function(){OVERLAYS.hide("PositionDisplayer")},e.set=function(e){fire("POSITIONDISPLAYER:Set",e)},e.remove=function(e){fire("POSITIONDISPLAYER:Remove",e)},e.reset=function(){fire("POSITIONDISPLAYER:Reset")},e.hideAll=function(){fire("POSITIONDISPLAYER:HideAll")}},PositionDisplayer=pc.createScript("positionDisplayer");PositionDisplayer.prototype.postInitialize=function(){var e,n,i,t,o=this,a=o.entity,r=a,s=a.findByName("Template"),c=[],l=[];s.enabled=!1,SCREEN.call(o);function onResize(){e=UISIZE.TOP-90,n=UISIZE.BOTTOM+90,i=UISIZE.LEFT+90,t=UISIZE.RIGHT-90}function update(){for(var e in l)l[e].update()}function displayerInstance(){var o,a,c=this,l=c.entity=s.clone(),I=c.vars=null,f=new pc.Vec3,u=(l.findByName("textField"),l.findByName("Base")),p=210,S=3,d=new pc.Vec3,O=(new pc.Vec3,!0);l.enabled=!0,c.fill=function(e){I=c.vars=e,addChild(l,r),p=e.posMargin||p,S=e.posFriction||S,a=true,CONTENT.fill(l,I),I.scale&&l.setLocalScale(I.scale,I.scale,I.scale),I.forcePosition=!0,c.update()},c.update=function(){d.x=I.x,d.z=I.z,d.y=I.y+1.6,d=UISIZE.positionToScreen(d);var r=!1;if(a&&(r=UISIZE.isOnScreen(d)),I.isHidden||r)return O=!0,void(l.enabled=!1);O&&ANIMATION.bounceScaleTo(l,.5,1),O=!1,f.x=MATH.clamp(d.x,t,i),f.y=MATH.clamp(d.y,e,n),f.z=0,l.enabled=!0,l.setLocalPosition(f),I.color&&o!=I.color&&function setColor(){if(!I.color)return;o=I.color,u.element.color=COLOR.get(o)}()}}on("POSITIONDISPLAYER:Set",(function(e){o.set(e)})),on("POSITIONDISPLAYER:HideAll",(function(){for(var e in l)l[e].vars.isHidden=!0;o.stop()})),on("POSITIONDISPLAYER:Reset",(function(){o.reset(),o.stop()})),on("POSITIONDISPLAYER:Remove",(function(e){})),on("UI:onResize",onResize),o.onShow=function(){onResize()},o.set=function(e){var n=function getItem(e){for(var n in l)if(l[n].vars.avatarID==e.avatarID)return l[n];return!1}(e);if(!n&&n.avatarID!=ME.avatarID){var i=c.shift()||new displayerInstance;return i.fill(e),l.push(i),o.play(),i}},o.play=function(){startFixed(update)},o.stop=function(){update(),stop(update)},o.reset=function(){for(;l.length;)l.shift().entity.destroy()}};var Fxemitter=pc.createScript("fxemitter");Fxemitter.attributes.add("Template",{type:"string",enum:[{Dust:"Dust"},{SmallDust:"SmallDust"},{FireTrail:"FireTrail"},{Fire:"Fire"},{Sand:"Sand"},{Water:"Water"},{Smoke:"Smoke"}],default:"Dust"}),Fxemitter.attributes.add("radius",{type:"number",default:.1}),Fxemitter.attributes.add("scale",{type:"number",default:.3}),Fxemitter.attributes.add("autoStart",{type:"boolean",default:!1}),Fxemitter.prototype.initialize=function(){var t,e,a,i,r,l,n,u=this,s=u.entity,p=["Dust","SmallDust","OrangeTrail","FireTrail"];function spawnParticle(){return t={position:e,radius:u.radius,scaling:u.scale},"Dust"==u.Template?FX3D.DUST.play(t):"SmallDust"==u.Template?FX3D.DUST.small(t):"OrangeTrail"==u.Template?FX3D.DUST.orange(t):"FireTrail"==u.Template?FX3D.DUST.fire(t):void 0}u.includes=function(t){return p.includes(t)},u.Template=u.Template||"Dust",u.start=function(t){l!=t&&u.includes(t)&&(n=!0,a=!0,t&&(u.Template=t),i=-1!=t.indexOf("Small"),r=-1!=t.indexOf("Trail"))},u.play=u.start,u.stop=function(){n&&(n=!1,a=!1,l=null)},u.autoStart&&u.start(u.Template),u.onUpdate=function(){a&&UIFX.isEnabled&&(e=s.getPosition(),spawnParticle(),i||spawnParticle(),r&&spawnParticle())}},Fxemitter.prototype.update=function(){this.onUpdate()};var FxwindLines=pc.createScript("fxwindLines");FxwindLines.prototype.initialize=function(){var e=this.entity,n=[],i=getChildren(e);for(var a in i)n.push(new WindLine(i[a]));function WindLine(e){var n=RANDOM.value(6,3),i=e.getLocalScale().clone(),a=new pc.Vec3,t=.3;function randomPos(){e.enabled&&(a.x=RANDOM.spectrumDecimal(2),a.y=RANDOM.spectrumDecimal(2),a.z=-RANDOM.decimal(3,1),t=RANDOM.decimal(.8,.2),e.setLocalScale(i.x,i.y*RANDOM.decimal(.8,.2),i.z))}e.enabled=RANDOM.chance(),randomPos(),this.update=function(){--n<0&&(n=RANDOM.value(6,3),e.enabled=!e.enabled,randomPos()),e.enabled&&(a.z+=t,e.setLocalPosition(a))}}this.onUpdate=function(){for(var e in n)n[e].update()}},FxwindLines.prototype.update=function(e){this.onUpdate()};var KillFeed=pc.createScript("killFeed");KillFeed.prototype.initialize=function(){var e=this.entity.findByName("Content"),i=e.getLocalPosition().clone(),l=pc.Vec3.ZERO;function open(o){e.enabled=!0,e.setLocalPosition(l),ANIMATION.moveTo(e,i,1,EASING.ElasticOut),fill(e,{fullName:o.fullName}),SFX.play("Kill"),unique("killFeed",close,2)}function close(){ANIMATION.moveTo(e,l),unique("killFeed",hide,1)}function hide(){e.enabled=!1,e.setLocalPosition(l)}e.enabled=!1,on("KILLFEED",open),on("KILLFEED:Show",open),hide()};var RivalBar=pc.createScript("rivalBar");RivalBar.attributes.add("autoFillScore",{type:"number",default:0}),RivalBar.prototype.initialize=function(){var e,a,i=this,r=i.entity,t=r.findByName("ME"),o=r.findByName("RIVAL"),l=new CueProgression("endlessPrefill"),n="RivalDiff",c=t.findByName("textField"),s=o.findByName("textField"),f=c.script.motion,d=s.script.motion,u=o.findByName("Skull");getLocals(c),getLocals(s),getLocals(u),on("GAME:onReady",(function refill(){if(!RIVAL)return log("NO RIVAL");u&&(u.enabled=!1);CONTENT.fill(t,ME.vars,!0);var e=RIVAL.vars;i.autoFillScore&&(e.score=e.score||SCORE.setRival(function getScore(){var e=l.getPosition(get(n)||1),a=v[e];return l.get(),set(n,l.position),Math.round(decimal(a,.5*a)*i.autoFillScore)}()));CONTENT.fill(o,e,!0),refreshScores()})),f&&d&&on("SCORE:onUpdate",refreshScores);var v={easy:.05,medium:.15,hard:.5,crazy:1};function refreshScores(){var r=SCORE.isWinning();if(a!=r){if(a=r,resetLocals(c),resetLocals(s),c.element.opacity=s.element.opacity=1,f){f.enabled=d.enabled=!1;var t=a?f:d;t.enabled=!0,t.alpha=.8}a&&i.autoFillScore&&!e&&(e=!0,u&&(u.enabled=!0,ANIMATION.bounceScaleTo(u,.1,u.sca.x)),fire("KILLFEED:Show",RIVAL.vars),ANIMATION.bounceScale(o))}}};var EffectDistanceColorFade=pc.createScript("effectDistanceColorFade");EffectDistanceColorFade.attributes.add("materialChannel",{type:"string",default:"diffuse",enum:[{Diffuse:"diffuse"},{Emissive:"emissive"}]}),EffectDistanceColorFade.attributes.add("minDistance",{type:"number",default:2}),EffectDistanceColorFade.attributes.add("maxDistance",{type:"number",default:5}),EffectDistanceColorFade.attributes.add("materialAsset",{type:"asset",assetType:"material"}),EffectDistanceColorFade.attributes.add("endColor",{type:"rgb"}),EffectDistanceColorFade.prototype.initialize=function(){if(this.material=this.materialAsset.resource,this.posArr=[0,0,0],this.colorArr=[0,0,0],this.material){var e=this.material.chunks;switch(this.materialChannel){case"diffuse":e.diffusePS=EffectDistanceColorFade.diffusePS,e.APIVersion=pc.CHUNKAPI_1_55;break;case"emissive":e.emissivePS=EffectDistanceColorFade.emissivePS,e.APIVersion=pc.CHUNKAPI_1_55}this.material.update(),this.updateAttributes(),this.on("attr",this.updateAttributes);var t=this;on("FIRE:Refresh",(function(e){t.target=e}))}},EffectDistanceColorFade.prototype.updateAttributes=function(){this.material.setParameter("uMinDistance",this.minDistance),this.material.setParameter("uMaxDistance",this.maxDistance),this.colorArr[0]=this.endColor.r,this.colorArr[1]=this.endColor.g,this.colorArr[2]=this.endColor.b,this.material.setParameter("uEndColor",this.colorArr)},EffectDistanceColorFade.prototype.update=function(e){if(this.target){var t=this.target.getPosition();this.posArr[0]=t.x,this.posArr[1]=t.y,this.posArr[2]=t.z,this.material.setParameter("uTargetPosition",this.posArr)}},EffectDistanceColorFade.prototype.swap=function(){this.initialize()},EffectDistanceColorFade.diffusePS="\nuniform vec3 uTargetPosition;\nuniform float uMinDistance;\nuniform float uMaxDistance;\nuniform vec3 uEndColor;\n\n#ifdef MAPCOLOR\nuniform vec3 material_diffuse;\n#endif\n\n#ifdef MAPTEXTURE\nuniform sampler2D texture_diffuseMap;\n#endif\n\nvoid getAlbedo() {\n    dAlbedo = vec3(1.0);\n\n    #ifdef MAPCOLOR\n    float targetDistance = distance(vPositionW, uTargetPosition) - uMinDistance;\n    float factor = 1.0 - clamp(targetDistance / uMaxDistance, 0.0, 1.0);\n    dAlbedo *= mix(material_diffuse.rgb, uEndColor, factor);\n    #endif\n\n    #ifdef MAPTEXTURE\n    dAlbedo *= gammaCorrectInput(addAlbedoDetail(texture2D(texture_diffuseMap, $UV).$CH));\n    #endif\n\n    #ifdef MAPVERTEX\n    dAlbedo *= gammaCorrectInput(saturate(vVertexColor.$VC));\n    #endif\n}\n",EffectDistanceColorFade.emissivePS="\nuniform vec3 uTargetPosition;\nuniform float uMinDistance;\nuniform float uMaxDistance;\nuniform vec3 uEndColor;\n\n#ifdef MAPCOLOR\nuniform vec3 material_emissive;\n#endif\n\n#ifdef MAPFLOAT\nuniform float material_emissiveIntensity;\n#endif\n\n#ifdef MAPTEXTURE\nuniform sampler2D texture_emissiveMap;\n#endif\n\nvec3 getEmission() {\n    vec3 emission = vec3(1.0);\n\n    #ifdef MAPFLOAT\n    emission *= material_emissiveIntensity;\n    #endif\n\n    #ifdef MAPCOLOR\n    float targetDistance = distance(vPositionW, uTargetPosition) - uMinDistance;\n    float factor = 1.0 - clamp(targetDistance / uMaxDistance, 0.0, 1.0);\n    emission *= mix(material_emissive.rgb, uEndColor, factor);\n    #endif\n\n    #ifdef MAPTEXTURE\n    emission *= $texture2DSAMPLE(texture_emissiveMap, $UV).$CH;\n    #endif\n\n    #ifdef MAPVERTEX\n    emission *= gammaCorrectInput(saturate(vVertexColor.$VC));\n    #endif\n\n    return emission;\n}\n";var EffectCurvedWorld=pc.createScript("effectCurvedWorld");EffectCurvedWorld.attributes.add("onEventBoot",{type:"string",title:"On Event Boot",description:"If an event name is provided then the effect will be initialized after that event is fired."}),EffectCurvedWorld.attributes.add("onEventDestroy",{type:"string",title:"On Event Destroy",description:"If an event name is provided then the effect will be destroyed after that event is fired."}),EffectCurvedWorld.attributes.add("activeCamera",{type:"entity",title:"Active Camera",description:"An optional active camera can be passed to calculate the effect in relation to the camera world position. If no camera is passed the effect will be calculated from the PC engine uniform view_position."}),EffectCurvedWorld.attributes.add("curveDirection",{type:"vec3",default:[0,1,0],title:"Curve Direction",description:"This is a normalized factor that sets the curve direction from 0 to 1 on each axis."}),EffectCurvedWorld.attributes.add("lookDirection",{type:"vec3",default:[0,0,1],title:"Look Direction"}),EffectCurvedWorld.attributes.add("curvePower",{type:"number",default:10,min:-50,max:50,title:"Curve Power",description:"Determines the amount of curviness to be applied."}),EffectCurvedWorld.prototype.initialize=function(){this.onEventBoot?this.app.on(this.onEventBoot,this.boot,this):this.boot(),this.onEventDestroy&&this.app.on(this.onEventDestroy,this.disableEffect,this)},EffectCurvedWorld.prototype.boot=function(){if(this.isEnabled=!0,this.vec3Arr=[],this.vec3Arr2=[],this.vec3Arr3=[],this.vec3=new pc.Vec3,this.vec=new pc.Vec3,this.materials=[],this.curvedWorldEntities=this.app.root.findByTag("effect-curved-world-transform"),this.curvedWorldEntities.forEach((function(e){if("Bitmoji Parent"===e.name){var t=e.parent.parent.parent;e.transformTarget=t.findByName("Container")}})),this.app.assets.filter((function(e){return"material"===e.type&&!1===e.tags.has("effect-curved-world-disabled")})).forEach(function(e){e.ready(function(){this.enableEffect(e.resource)}.bind(this)),this.app.assets.load(e)}.bind(this)),UranusInstancerLite.api.cloneMaterials){const e=UranusInstancerLite.api.payload;for(let t in e){const r=e[t].meshInstance?.material;r&&this.enableEffect(r)}}this.on("attr",this.updateMaterials),this.app.on("EffectCurvedWorld:enableEffect",this.enableEffect,this),this.app.on("UranusInstancer:materialCloned",this.enableEffect,this)},EffectCurvedWorld.prototype.disableEffect=function(){this.isEnabled=!1,this.materials&&(this.materials.forEach((function(e){e.chunks.transformVS=pc.shaderChunks.transformVS,e.chunks.APIVersion=pc.CHUNKAPI_1_55,e.update()})),this.materials=void 0)},EffectCurvedWorld.prototype.enableEffect=function(e){this.isEnabled&&(this.materials.push(e),e.chunks.transformVS=`uniform vec3 view_position;\nuniform vec3 curveDirection;\nuniform float curvePower;\nuniform vec3 curveCenterPos;\nuniform vec3 curveCameraDirection;\n#ifdef PIXELSNAP\nuniform vec4 uScreenSize;\n#endif\n#ifdef MORPHING\nuniform vec4 morph_weights_a;\nuniform vec4 morph_weights_b;\n#endif\n#ifdef MORPHING_TEXTURE_BASED\nuniform vec4 morph_tex_params;\nvec2 getTextureMorphCoords() {\n    float vertexId = morph_vertex_id;\n    vec2 textureSize = morph_tex_params.xy;\n    vec2 invTextureSize = morph_tex_params.zw;\n    // turn vertexId into int grid coordinates\n    float morphGridV = floor(vertexId * invTextureSize.x);\n    float morphGridU = vertexId - (morphGridV * textureSize.x);\n    // convert grid coordinates to uv coordinates with half pixel offset\n    return (vec2(morphGridU, morphGridV) * invTextureSize) + (0.5 * invTextureSize);\n}\n#endif\n#ifdef MORPHING_TEXTURE_BASED_POSITION\nuniform highp sampler2D morphPositionTex;\n#endif\nmat4 getModelMatrix() {\n    #ifdef DYNAMICBATCH\n    return getBoneMatrix(vertex_boneIndices);\n    #elif defined(SKIN)\n    return matrix_model * getSkinMatrix(vertex_boneIndices, vertex_boneWeights);\n    #elif defined(INSTANCING)\n    return mat4(instance_line1, instance_line2, instance_line3, instance_line4);\n    #else\n    return matrix_model;\n    #endif\n}\nvec4 getPosition() {\n    dModelMatrix = getModelMatrix();\n    vec3 localPos = vertex_position;\n    #ifdef NINESLICED\n    // outer and inner vertices are at the same position, scale both\n    localPos.xz *= outerScale;\n    // offset inner vertices inside\n    // (original vertices must be in [-1;1] range)\n    vec2 positiveUnitOffset = clamp(vertex_position.xz, vec2(0.0), vec2(1.0));\n    vec2 negativeUnitOffset = clamp(-vertex_position.xz, vec2(0.0), vec2(1.0));\n    localPos.xz += (-positiveUnitOffset * innerOffset.xy + negativeUnitOffset * innerOffset.zw) * vertex_texCoord0.xy;\n    vTiledUv = (localPos.xz - outerScale + innerOffset.xy) * -0.5 + 1.0; // uv = local pos - inner corner\n    localPos.xz *= -0.5; // move from -1;1 to -0.5;0.5\n    localPos = localPos.xzy;\n    #endif\n    #ifdef MORPHING\n    #ifdef MORPHING_POS03\n    localPos.xyz += morph_weights_a[0] * morph_pos0;\n    localPos.xyz += morph_weights_a[1] * morph_pos1;\n    localPos.xyz += morph_weights_a[2] * morph_pos2;\n    localPos.xyz += morph_weights_a[3] * morph_pos3;\n    #endif // MORPHING_POS03\n    #ifdef MORPHING_POS47\n    localPos.xyz += morph_weights_b[0] * morph_pos4;\n    localPos.xyz += morph_weights_b[1] * morph_pos5;\n    localPos.xyz += morph_weights_b[2] * morph_pos6;\n    localPos.xyz += morph_weights_b[3] * morph_pos7;\n    #endif // MORPHING_POS47\n    #endif // MORPHING\n    #ifdef MORPHING_TEXTURE_BASED_POSITION\n    // apply morph offset from texture\n    vec2 morphUV = getTextureMorphCoords();\n    vec3 morphPos = texture2D(morphPositionTex, morphUV).xyz;\n    localPos += morphPos;\n    #endif\n    vec4 posW = dModelMatrix * vec4(localPos, 1.0);\n    vec3 curveCenter = ${this.activeCamera?"curveCenterPos":"view_position"};    float amountX = curveCameraDirection.x * pow(posW.x - curveCenter.x, 2.0);\n    float amountY = curveCameraDirection.y * pow(posW.y - curveCenter.y, 2.0);\n    float amountZ = curveCameraDirection.z * pow(posW.z - curveCenter.z, 2.0);\n    float amountSum = (amountX * curveCameraDirection.x + amountY * curveCameraDirection.y + amountZ * curveCameraDirection.z) * curvePower;\n    posW = posW + vec4(-amountSum * curveDirection.x, -amountSum * curveDirection.y, -amountSum * curveDirection.z, 0.0);\n    #ifdef SCREENSPACE\n    posW.zw = vec2(0.0, 1.0);\n    #endif\n    dPositionW = posW.xyz;\n    vec4 screenPos;\n    #ifdef UV1LAYOUT\n    screenPos = vec4(vertex_texCoord1.xy * 2.0 - 1.0, 0.5, 1);\n    #else\n    #ifdef SCREENSPACE\n    screenPos = posW;\n    #else\n    screenPos = matrix_viewProjection * posW;\n    #endif\n    #ifdef PIXELSNAP\n    // snap vertex to a pixel boundary\n    screenPos.xy = (screenPos.xy * 0.5) + 0.5;\n    screenPos.xy *= uScreenSize.xy;\n    screenPos.xy = floor(screenPos.xy);\n    screenPos.xy *= uScreenSize.zw;\n    screenPos.xy = (screenPos.xy * 2.0) - 1.0;\n    #endif\n    #endif\n    return screenPos;\n}\nvec3 getWorldPosition() {\n    return dPositionW;\n}\n`,e.update(),this.updateAttributes(e),SIGNAL.fire("CurvedWorld"))},EffectCurvedWorld.prototype.updateMaterials=function(){this.materials&&this.materials.forEach(function(e){this.updateAttributes(e)}.bind(this))},EffectCurvedWorld.prototype.updateAttributes=function(e){if(e.setParameter("curvePower",.001*this.curvePower),e.setParameter("offset",this.offset),e.setParameter("curveDirection",this.curveDirection.data),e.setParameter("curveCameraDirection",this.lookDirection.data),this.activeCamera){const t=this.activeCamera.getPosition();this.vec3Arr2[0]=t.x,this.vec3Arr2[1]=t.y,this.vec3Arr2[2]=t.z,e.setParameter("curveCenterPos",this.vec3Arr2)}},EffectCurvedWorld.prototype.update=function(e){this.isEnabled&&this.transformEntities()},EffectCurvedWorld.prototype.transformEntities=function(){const e=this.curvedWorldEntities;if(!e)return;let t;if(this.activeCamera)t=this.activeCamera.getPosition();else{const e=this.app.graphicsDevice.scope.resolve("view_position").getValue();e&&(t=this.vec.set(e[0],e[1],e[2]))}if(!t)return;const r=this.lookDirection,n=this.curvePower,i=this.curveDirection,o=this.vec3;e.forEach((function(e){const s=e.getPosition(),a=r.x*Math.pow(s.x-t.x,2),c=r.y*Math.pow(s.y-t.y,2),f=r.z*Math.pow(s.z-t.z,2),d=(a*r.x+c*r.y+f*r.z)*n*.001;o.set(-d*i.x,-d*i.y,-d*i.z),e.setLocalPosition(o),e.transformTarget&&e.setEulerAngles(e.transformTarget.getEulerAngles())}))};var Ribbon=pc.createScript("ribbon");Ribbon.attributes.add("lifetime",{type:"number",default:.5}),Ribbon.attributes.add("xoffset",{type:"number",default:-.8}),Ribbon.attributes.add("yoffset",{type:"number",default:1}),Ribbon.attributes.add("height",{type:"number",default:.4}),Ribbon.attributes.add("opacity",{type:"number",default:1,min:0,max:1}),Ribbon.attributes.add("tail",{type:"number",default:.5,min:0,max:1}),Ribbon.attributes.add("color",{type:"rgb",default:[1,1,1]}),Ribbon.attributes.add("layer",{type:"string"}),Ribbon.attributes.add("orient",{type:"boolean",title:"Face Camera",description:"Vertices are positioned so that they always face the camera."});var MAX_VERTICES=6e3,VERTEX_SIZE=4;Ribbon.prototype.initialize=function(){var t={attributes:{aPositionAge:pc.SEMANTIC_POSITION},vshader:["attribute vec4 aPositionAge;","","uniform mat4 matrix_viewProjection;","uniform float trail_time;","","varying float vAge;","","void main(void)","{","    vAge = trail_time - aPositionAge.w;","    gl_Position = matrix_viewProjection * vec4(aPositionAge.xyz, 1.0);","}"].join("\n"),fshader:["precision mediump float;","","varying float vAge;","","uniform float trail_lifetime;","uniform vec3 trail_color;","uniform float trail_opacity;","","void main(void)","{","    gl_FragColor = vec4(trail_color.rgb, (1.0 - (vAge / trail_lifetime)) * trail_opacity);","}"].join("\n")},e=new pc.Shader(this.app.graphicsDevice,t),i=new pc.BlendState(!0,pc.BLENDEQUATION_ADD,pc.BLENDMODE_SRC_ALPHA,pc.BLENDMODE_ONE_MINUS_SRC_ALPHA);this.material=new pc.Material,this.material.shader=e,this.material.blendState=i,this.material.cull=pc.CULLFACE_NONE,this.material.depthWrite=!1,this.updateAttributes(),this.on("attr",this.updateAttributes),this.timer=0,this.vertices=[],this.vertexData=new Float32Array(MAX_VERTICES*VERTEX_SIZE),this.vertexIndexArray=[];for(var a=0;a<this.vertexData.length;++a)this.vertexIndexArray.push(a);this.mesh=new pc.Mesh(this.app.graphicsDevice),this.mesh.clear(!0,!1),this.mesh.setPositions(this.vertexData,VERTEX_SIZE,MAX_VERTICES),this.mesh.setIndices(this.vertexIndexArray,MAX_VERTICES),this.mesh.update(pc.PRIMITIVE_TRISTRIP);var s=new pc.MeshInstance(this.mesh,this.material);const r=[this.app.scene.layers.getLayerByName("World").id];if(this.layer){const t=this.app.scene.layers.getLayerByName(this.layer).id;t&&r.push(t)}this.entity.addComponent("render",{castShadows:!1,receiveShadows:!1,meshInstances:[s],layers:r}),this.entity.render.enabled=!1,this.cursor=new pc.Entity},Ribbon.prototype.reset=function(){this.timer=0,this.vertices.length=0,this.vertexData=new Float32Array(MAX_VERTICES*VERTEX_SIZE),this.mesh.clear(!0,!1),this.mesh.setPositions(this.vertexData,VERTEX_SIZE,MAX_VERTICES),this.mesh.setIndices(this.vertexIndexArray,MAX_VERTICES),this.mesh.update(pc.PRIMITIVE_TRISTRIP)},Ribbon.v1=new pc.Vec3,Ribbon.prototype.spawnNewVertices=function(){var t=this.entity,e=t.getPosition();const i=this.orient?CAMERA.entity.up:t.up;var a=Ribbon.v1.copy(i).scale(this.height),s=this.xoffset,r=this.yoffset,o=[e.x+a.x*s,e.y+a.y*s,e.z+a.z*s,e.x+a.x*r,e.y+a.y*r,e.z+a.z*r],h=this.timer;this.vertices.unshift({spawnTime:h,vertexPair:o,pos:e.clone(),yaxis:a.clone()})},Ribbon.prototype.clearOldVertices=function(t){for(var e=this.vertices.length-1;e>=0;e--){var i=this.vertices[e];if(!(!0===t||this.timer-i.spawnTime>=this.lifetime))break;this.vertices.pop()}},Ribbon.prototype.prepareVertexData=function(){for(var t=this.xoffset,e=this.yoffset,i=0;i<this.vertices.length;i++){var a=this.vertices[i];let s=a.vertexPair[0],r=a.vertexPair[1],o=a.vertexPair[2],h=a.vertexPair[3],n=a.vertexPair[4],l=a.vertexPair[5],p=this.lifetime*this.tail;const c=this.timer-this.lifetime;c<0&&(p+=c);const m=this.timer-a.spawnTime;if(m>=p){let i=1-(m-p)/(this.lifetime*(1-this.tail));s=a.pos.x+a.yaxis.x*t*i,r=a.pos.y+a.yaxis.y*t*i,o=a.pos.z+a.yaxis.z*t*i,h=a.pos.x+a.yaxis.x*e*i,n=a.pos.y+a.yaxis.y*e*i,l=a.pos.z+a.yaxis.z*e*i}if(this.vertexData[8*i+0]=s,this.vertexData[8*i+1]=r,this.vertexData[8*i+2]=o,this.vertexData[8*i+3]=a.spawnTime,this.vertexData[8*i+4]=h,this.vertexData[8*i+5]=n,this.vertexData[8*i+6]=l,this.vertexData[8*i+7]=a.spawnTime,this.vertexData.length===i)break}},Ribbon.prototype.updateAttributes=function(){this.material.setParameter("trail_time",this.timer),this.material.setParameter("trail_lifetime",this.lifetime),this.material.setParameter("trail_opacity",this.opacity),this.material.setParameter("trail_color",[this.color.r,this.color.g,this.color.b])},Ribbon.prototype.update=function(t){if(this.timer+=t,this.material.setParameter("trail_time",this.timer),this.clearOldVertices(),this.spawnNewVertices(),this.vertices.length>1){this.prepareVertexData();var e=2*this.vertices.length,i=MAX_VERTICES;e<i&&(i=e),this.mesh.setPositions(this.vertexData,VERTEX_SIZE,i),this.mesh.setIndices(this.vertexIndexArray,i),this.mesh.update(pc.PRIMITIVE_TRISTRIP),this.entity.render.enabled=!0}};var FrameDisplayer=pc.createScript("frameDisplayer");FrameDisplayer.attributes.add("varName",{type:"string"}),FrameDisplayer.attributes.add("animate",{type:"boolean",default:!0}),FrameDisplayer.prototype.initialize=function(){var e=this,a=e.entity,r=getChildrenNames(a),t=!1;for(var i in getLocals(a),r)getLocals(r[i]),r[i].enabled=!1;function refresh(a){if(a!=t){t=a;var i=!1;for(var n in r)r[n].enabled=n==a,n==a&&(i=r[n]);e.animate&&i&&ANIMATION.bounceScaleTo(i,.1,i.sca.x)}}e.varName&&(on(e.varName,(function(e){t=null,refresh(e)})),refresh(get(e.varName))),e.hide=function(){for(var e in t=!1,r)r[e].enabled=!1},e.refresh=refresh};var ScreenFrameOverlay=pc.createScript("screenFrameOverlay");ScreenFrameOverlay.prototype.initialize=function(){var e=this,r=e.entity;SCREEN.call(e);var a=getChild(r,"FrameDisplayer","frameDisplayer");e.onShow=function(e){e=e||{},a.refresh(e.value)}};var Bezier=function(t){function n(a){if(r[a])return r[a].exports;var u=r[a]={exports:{},id:a,loaded:!1};return t[a].call(u.exports,u,u.exports,n),u.loaded=!0,u.exports}var r={};return n.m=t,n.c=r,n.p="",n(0)}([function(t,r,a){"use strict";t.exports=a(1)},function(t,r,a){"use strict";var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(){function n(t,r,a,u,c){void 0===c&&(c=.5);var h=z.projectionratio(c,t),x=1-h,p={x:h*r.x+x*u.x,y:h*r.y+x*u.y},y=z.abcratio(c,t);return{A:{x:a.x+(a.x-p.x)/y,y:a.y+(a.y-p.y)/y},B:a,C:p}}var r=Math.abs,c=Math.min,h=Math.max,x=Math.cos,p=Math.sin,y=Math.acos,d=Math.sqrt,m=Math.PI,g={x:0,y:0,z:0},z=a(2),b=a(3),l=function(t){var a=t&&t.forEach?t:[].slice.call(arguments),c=!1;if("object"===u(a[0])){c=a.length;var h=[];a.forEach((function(t){["x","y","z"].forEach((function(r){void 0!==t[r]&&h.push(t[r])}))})),a=h}var x=!1,p=a.length;if(c){if(c>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");x=!0}}else if(6!==p&&8!==p&&9!==p&&12!==p&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");var y=!x&&(9===p||12===p)||t&&t[0]&&void 0!==t[0].z;this._3d=y;for(var d=[],m=0,g=y?3:2;p>m;m+=g){var b={x:a[m],y:a[m+1]};y&&(b.z=a[m+2]),d.push(b)}this.order=d.length-1,this.points=d;var _=["x","y"];y&&_.push("z"),this.dims=_,this.dimlen=_.length,function(t){for(var a=t.order,u=t.points,c=z.align(u,{p1:u[0],p2:u[a]}),h=0;h<c.length;h++)if(r(c[h].y)>1e-4)return void(t._linear=!1);t._linear=!0}(this),this._t1=0,this._t2=1,this.update()};l.fromSVG=function(t){var r=t.match(/[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/g).map(parseFloat);return/[cq]/.test(t)?(r=r.map((function(t,a){return 2>a?t:t+r[a%2]})),new l(r)):new l(r)},l.quadraticFromPoints=function(t,r,a,u){if(void 0===u&&(u=.5),0===u)return new l(r,r,a);if(1===u)return new l(t,r,r);var c=n(2,t,r,a,u);return new l(t,c.A,a)},l.cubicFromPoints=function(t,r,a,u,c){void 0===u&&(u=.5);var h=n(3,t,r,a,u);void 0===c&&(c=z.dist(r,h.C));var x=c*(1-u)/u,p=z.dist(t,a),y=(a.x-t.x)/p,d=(a.y-t.y)/p,m=c*y,g=c*d,b=x*y,_=x*d,w=r.x-m,E=r.y-g,S=r.x+b,M=r.y+_,k=h.A,O=k.x+(w-k.x)/(1-u),T=k.y+(E-k.y)/(1-u),N=k.x+(S-k.x)/u,j=k.y+(M-k.y)/u,I={x:t.x+(O-t.x)/u,y:t.y+(T-t.y)/u},A={x:a.x+(N-a.x)/(1-u),y:a.y+(j-a.y)/(1-u)};return new l(t,I,A,a)};var v=function(){return z};l.getUtils=v,l.prototype={getUtils:v,valueOf:function(){return this.toString()},toString:function(){return z.pointsToString(this.points)},toSVG:function(t){if(this._3d)return!1;for(var r=this.points,a=["M",r[0].x,r[0].y,2===this.order?"Q":"C"],u=1,c=r.length;c>u;u++)a.push(r[u].x),a.push(r[u].y);return a.join(" ")},update:function(){this.dpoints=[];for(var t=this.points,r=t.length,a=r-1;r>1;r--,a--){for(var u,c=[],h=0;a>h;h++)u={x:a*(t[h+1].x-t[h].x),y:a*(t[h+1].y-t[h].y)},this._3d&&(u.z=a*(t[h+1].z-t[h].z)),c.push(u);this.dpoints.push(c),t=c}this.computedirection()},computedirection:function(){var t=this.points,r=z.angle(t[0],t[this.order],t[1]);this.clockwise=r>0},length:function(){return z.length(this.derivative.bind(this))},_lut:[],getLUT:function(t){if(t=t||100,this._lut.length===t)return this._lut;this._lut=[];for(var r=0;t>=r;r++)this._lut.push(this.compute(r/t));return this._lut},on:function(t,r){r=r||5;for(var a,u=this.getLUT(),c=[],h=0,x=0;x<u.length;x++)a=u[x],z.dist(a,t)<r&&(c.push(a),h+=x/u.length);return!!c.length&&(h/=c.length)},project:function(t){var r=this.getLUT(),a=r.length-1,u=z.closest(r,t),c=u.mdist,h=u.mpos;if(0===h||h===a){var x=h/a,p=this.compute(x);return p.t=x,p.d=c,p}var y,d,m,g=(h+1)/a,b=.1/a;for(c+=1,y=x=(h-1)/a;g+b>x;x+=b)d=this.compute(x),c>(m=z.dist(t,d))&&(c=m,y=x);return(d=this.compute(y)).t=y,d.d=c,d},get:function(t){return this.compute(t)},point:function(t){return this.points[t]},compute:function(t){if(0===t)return this.points[0];if(1===t)return this.points[this.order];var r=this.points,a=1-t;if(1===this.order)return d={x:a*r[0].x+t*r[1].x,y:a*r[0].y+t*r[1].y},this._3d&&(d.z=a*r[0].z+t*r[1].z),d;if(this.order<4){var u,c,h,x=a*a,p=t*t,y=0;2===this.order?(r=[r[0],r[1],r[2],g],u=x,c=a*t*2,h=p):3===this.order&&(u=x*a,c=x*t*3,h=a*p*3,y=t*p);var d={x:u*r[0].x+c*r[1].x+h*r[2].x+y*r[3].x,y:u*r[0].y+c*r[1].y+h*r[2].y+y*r[3].y};return this._3d&&(d.z=u*r[0].z+c*r[1].z+h*r[2].z+y*r[3].z),d}for(var m=JSON.parse(JSON.stringify(this.points));m.length>1;){for(var z=0;z<m.length-1;z++)m[z]={x:m[z].x+(m[z+1].x-m[z].x)*t,y:m[z].y+(m[z+1].y-m[z].y)*t},void 0!==m[z].z&&(m[z]=m[z].z+(m[z+1].z-m[z].z)*t);m.splice(m.length-1,1)}return m[0]},raise:function(){for(var t,r,a=this.points,u=[a[0]],c=a.length,h=1;c>h;h++)t=a[h],r=a[h-1],u[h]={x:(c-h)/c*t.x+h/c*r.x,y:(c-h)/c*t.y+h/c*r.y};return u[c]=a[c-1],new l(u)},derivative:function(t){var r,a,u=1-t,c=0,h=this.dpoints[0];2===this.order&&(h=[h[0],h[1],g],r=u,a=t),3===this.order&&(r=u*u,a=u*t*2,c=t*t);var x={x:r*h[0].x+a*h[1].x+c*h[2].x,y:r*h[0].y+a*h[1].y+c*h[2].y};return this._3d&&(x.z=r*h[0].z+a*h[1].z+c*h[2].z),x},inflections:function(){return z.inflections(this.points)},normal:function(t){return this._3d?this.__normal3(t):this.__normal2(t)},__normal2:function(t){var r=this.derivative(t),a=d(r.x*r.x+r.y*r.y);return{x:-r.y/a,y:r.x/a}},__normal3:function(t){var r=this.derivative(t),a=this.derivative(t+.01),u=d(r.x*r.x+r.y*r.y+r.z*r.z),c=d(a.x*a.x+a.y*a.y+a.z*a.z);r.x/=u,r.y/=u,r.z/=u,a.x/=c,a.y/=c,a.z/=c;var h={x:a.y*r.z-a.z*r.y,y:a.z*r.x-a.x*r.z,z:a.x*r.y-a.y*r.x},x=d(h.x*h.x+h.y*h.y+h.z*h.z);h.x/=x,h.y/=x,h.z/=x;var p=[h.x*h.x,h.x*h.y-h.z,h.x*h.z+h.y,h.x*h.y+h.z,h.y*h.y,h.y*h.z-h.x,h.x*h.z-h.y,h.y*h.z+h.x,h.z*h.z];return{x:p[0]*r.x+p[1]*r.y+p[2]*r.z,y:p[3]*r.x+p[4]*r.y+p[5]*r.z,z:p[6]*r.x+p[7]*r.y+p[8]*r.z}},hull:function(t){var r,a=this.points,u=[],c=[],h=0,x=0,p=0;for(c[h++]=a[0],c[h++]=a[1],c[h++]=a[2],3===this.order&&(c[h++]=a[3]);a.length>1;){for(u=[],x=0,p=a.length-1;p>x;x++)r=z.lerp(t,a[x],a[x+1]),c[h++]=r,u.push(r);a=u}return c},split:function(t,r){if(0===t&&r)return this.split(r).left;if(1===r)return this.split(t).right;var a=this.hull(t),u={left:new l(2===this.order?[a[0],a[3],a[5]]:[a[0],a[4],a[7],a[9]]),right:new l(2===this.order?[a[5],a[4],a[2]]:[a[9],a[8],a[6],a[3]]),span:a};return u.left._t1=z.map(0,0,1,this._t1,this._t2),u.left._t2=z.map(t,0,1,this._t1,this._t2),u.right._t1=z.map(t,0,1,this._t1,this._t2),u.right._t2=z.map(1,0,1,this._t1,this._t2),r?(r=z.map(r,t,1,0,1),u.right.split(r).left):u},extrema:function(){var t,r,a=this.dims,u={},c=[];return a.forEach(function(a){r=function(t){return t[a]},t=this.dpoints[0].map(r),u[a]=z.droots(t),3===this.order&&(t=this.dpoints[1].map(r),u[a]=u[a].concat(z.droots(t))),u[a]=u[a].filter((function(t){return t>=0&&1>=t})),c=c.concat(u[a].sort())}.bind(this)),c=c.sort().filter((function(t,r){return c.indexOf(t)===r})),u.values=c,u},bbox:function(){var t=this.extrema(),r={};return this.dims.forEach(function(a){r[a]=z.getminmax(this,a,t[a])}.bind(this)),r},overlaps:function(t){var r=this.bbox(),a=t.bbox();return z.bboxoverlap(r,a)},offset:function(t,r){if(void 0!==r){var a=this.get(t),u=this.normal(t),c={c:a,n:u,x:a.x+u.x*r,y:a.y+u.y*r};return this._3d&&(c.z=a.z+u.z*r),c}if(this._linear){var h=this.normal(0),x=this.points.map((function(r){var a={x:r.x+t*h.x,y:r.y+t*h.y};return r.z&&u.z&&(a.z=r.z+t*h.z),a}));return[new l(x)]}return this.reduce().map((function(r){return r.scale(t)}))},simple:function(){if(3===this.order){var t=z.angle(this.points[0],this.points[3],this.points[1]),a=z.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&0>a||0>t&&a>0)return!1}var u=this.normal(0),c=this.normal(1),h=u.x*c.x+u.y*c.y;this._3d&&(h+=u.z*c.z);var x=r(y(h));return m/3>x},reduce:function(){var t,a,u=0,c=0,h=.01,x=[],p=[],y=this.extrema().values;for(-1===y.indexOf(0)&&(y=[0].concat(y)),-1===y.indexOf(1)&&y.push(1),u=y[0],t=1;t<y.length;t++)c=y[t],(a=this.split(u,c))._t1=u,a._t2=c,x.push(a),u=c;return x.forEach((function(t){for(u=0,c=0;1>=c;)for(c=u+h;1+h>=c;c+=h)if(!(a=t.split(u,c)).simple()){if(r(u-(c-=h))<h)return[];(a=t.split(u,c))._t1=z.map(u,0,1,t._t1,t._t2),a._t2=z.map(c,0,1,t._t1,t._t2),p.push(a),u=c;break}1>u&&((a=t.split(u,1))._t1=z.map(u,0,1,t._t1,t._t2),a._t2=t._t2,p.push(a))})),p},scale:function(t){var r=this.order,a=!1;if("function"==typeof t&&(a=t),a&&2===r)return this.raise().scale(a);var u=this.clockwise,c=a?a(0):t,h=a?a(1):t,x=[this.offset(0,10),this.offset(1,10)],p=z.lli4(x[0],x[0].c,x[1],x[1].c);if(!p)throw new Error("cannot scale this curve. Try reducing it first.");var y=this.points,m=[];return[0,1].forEach(function(t){var a=m[t*r]=z.copy(y[t*r]);a.x+=(t?h:c)*x[t].n.x,a.y+=(t?h:c)*x[t].n.y}.bind(this)),a?([0,1].forEach(function(c){if(2!==this.order||!c){var h=y[c+1],x={x:h.x-p.x,y:h.y-p.y},g=a?a((c+1)/r):t;a&&!u&&(g=-g);var z=d(x.x*x.x+x.y*x.y);x.x/=z,x.y/=z,m[c+1]={x:h.x+g*x.x,y:h.y+g*x.y}}}.bind(this)),new l(m)):([0,1].forEach(function(t){if(2!==this.order||!t){var a=m[t*r],u=this.derivative(t),c={x:a.x+u.x,y:a.y+u.y};m[t+1]=z.lli4(a,c,p,y[t+1])}}.bind(this)),new l(m))},outline:function(t,r,a,u){function e(t,r,a,u,c){return function(h){var x=u/a,p=(u+c)/a,y=r-t;return z.map(h,0,1,t+x*y,t+p*y)}}r=void 0===r?t:r;var c,h=this.reduce(),x=h.length,p=[],y=[],d=0,m=this.length(),g=void 0!==a&&void 0!==u;h.forEach((function(c){T=c.length(),g?(p.push(c.scale(e(t,a,m,d,T))),y.push(c.scale(e(-r,-u,m,d,T)))):(p.push(c.scale(t)),y.push(c.scale(-r))),d+=T})),y=y.map((function(t){return(c=t.points)[3]?t.points=[c[3],c[2],c[1],c[0]]:t.points=[c[2],c[1],c[0]],t})).reverse();var _=p[0].points[0],w=p[x-1].points[p[x-1].points.length-1],E=y[x-1].points[y[x-1].points.length-1],S=y[0].points[0],M=z.makeline(E,_),k=z.makeline(w,S),O=[M].concat(p).concat([k]).concat(y),T=O.length;return new b(O)},outlineshapes:function(t,r,a){r=r||t;for(var u=this.outline(t,r).curves,c=[],h=1,x=u.length;x/2>h;h++){var p=z.makeshape(u[h],u[x-h],a);p.startcap.virtual=h>1,p.endcap.virtual=x/2-1>h,c.push(p)}return c},intersects:function(t,r){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof l&&(t=t.reduce()),this.curveintersects(this.reduce(),t,r)):this.selfintersects(r)},lineIntersects:function(t){var r=c(t.p1.x,t.p2.x),a=c(t.p1.y,t.p2.y),u=h(t.p1.x,t.p2.x),x=h(t.p1.y,t.p2.y),p=this;return z.roots(this.points,t).filter((function(t){var c=p.get(t);return z.between(c.x,r,u)&&z.between(c.y,a,x)}))},selfintersects:function(t){var r,a,u,c,h=this.reduce(),x=h.length-2,p=[];for(r=0;x>r;r++)u=h.slice(r,r+1),c=h.slice(r+2),a=this.curveintersects(u,c,t),p=p.concat(a);return p},curveintersects:function(t,r,a){var u=[];t.forEach((function(t){r.forEach((function(r){t.overlaps(r)&&u.push({left:t,right:r})}))}));var c=[];return u.forEach((function(t){var r=z.pairiteration(t.left,t.right,a);r.length>0&&(c=c.concat(r))})),c},arcs:function(t){t=t||.5;return this._iterate(t,[])},_error:function(t,a,u,c){var h=(c-u)/4,x=this.get(u+h),p=this.get(c-h),y=z.dist(t,a),d=z.dist(t,x),m=z.dist(t,p);return r(d-y)+r(m-y)},_iterate:function(t,r){var a,u=0,c=1;do{a=0,c=1;var h,y,d,m,g,b=this.get(u),_=!1,w=!1,E=c,S=1;do{if(w=_,m=d,E=(u+c)/2,h=this.get(E),y=this.get(c),(d=z.getccenter(b,h,y)).interval={start:u,end:c},_=t>=this._error(d,b,u,c),(g=w&&!_)||(S=c),_){if(c>=1){if(d.interval.end=S=1,m=d,c>1){var M={x:d.x+d.r*x(d.e),y:d.y+d.r*p(d.e)};d.e+=z.angle({x:d.x,y:d.y},M,this.get(1))}break}c+=(c-u)/2}else c=E}while(!g&&a++<100);if(a>=100)break;m=m||d,r.push(m),u=S}while(1>c);return r}},t.exports=l}()},function(t,r,a){"use strict";!function(){var r=Math.abs,u=Math.cos,c=Math.sin,h=Math.acos,x=Math.atan2,p=Math.sqrt,y=Math.pow,f=function(t){return 0>t?-y(-t,1/3):y(t,1/3)},d=Math.PI,m=2*d,g=d/2,z=Number.MAX_SAFE_INTEGER,b=Number.MIN_SAFE_INTEGER,_={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,r){var a=r(t),u=a.x*a.x+a.y*a.y;return void 0!==a.z&&(u+=a.z*a.z),p(u)},between:function(t,r,a){return t>=r&&a>=t||_.approximately(t,r)||_.approximately(t,a)},approximately:function(t,a,u){return r(t-a)<=(u||1e-6)},length:function(t){var r,a,u=0,c=_.Tvalues.length;for(r=0;c>r;r++)a=.5*_.Tvalues[r]+.5,u+=_.Cvalues[r]*_.arcfn(a,t);return.5*u},map:function(t,r,a,u,c){return u+(c-u)*((t-r)/(a-r))},lerp:function(t,r,a){var u={x:r.x+t*(a.x-r.x),y:r.y+t*(a.y-r.y)};return r.z&&a.z&&(u.z=r.z+t*(a.z-r.z)),u},pointToString:function(t){var r=t.x+"/"+t.y;return void 0!==t.z&&(r+="/"+t.z),r},pointsToString:function(t){return"["+t.map(_.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,r,a){var u=r.x-t.x,c=r.y-t.y,h=a.x-t.x,p=a.y-t.y;return x(u*p-c*h,u*h+c*p)},round:function(t,r){var a=""+t,u=a.indexOf(".");return parseFloat(a.substring(0,u+1+r))},dist:function(t,r){var a=t.x-r.x,u=t.y-r.y;return p(a*a+u*u)},closest:function(t,r){var a,u,c=y(2,63);return t.forEach((function(t,h){u=_.dist(r,t),c>u&&(c=u,a=h)})),{mdist:c,mpos:a}},abcratio:function(t,a){if(2!==a&&3!==a)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;var u=y(t,a)+y(1-t,a);return r((u-1)/u)},projectionratio:function(t,r){if(2!==r&&3!==r)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;var a=y(1-t,r);return a/(y(t,r)+a)},lli8:function(t,r,a,u,c,h,x,p){var y=(t-a)*(h-p)-(r-u)*(c-x);return 0!=y&&{x:((t*u-r*a)*(c-x)-(t-a)*(c*p-h*x))/y,y:((t*u-r*a)*(h-p)-(r-u)*(c*p-h*x))/y}},lli4:function(t,r,a,u){var c=t.x,h=t.y,x=r.x,p=r.y,y=a.x,d=a.y,m=u.x,g=u.y;return _.lli8(c,h,x,p,y,d,m,g)},lli:function(t,r){return _.lli4(t,t.c,r,r.c)},makeline:function(t,r){var u=a(1),c=t.x,h=t.y,x=r.x,p=r.y,y=(x-c)/3,d=(p-h)/3;return new u(c,h,c+y,h+d,c+2*y,h+2*d,x,p)},findbbox:function(t){var r=z,a=z,u=b,c=b;return t.forEach((function(t){var h=t.bbox();r>h.x.min&&(r=h.x.min),a>h.y.min&&(a=h.y.min),u<h.x.max&&(u=h.x.max),c<h.y.max&&(c=h.y.max)})),{x:{min:r,mid:(r+u)/2,max:u,size:u-r},y:{min:a,mid:(a+c)/2,max:c,size:c-a}}},shapeintersections:function(t,r,a,u,c){if(!_.bboxoverlap(r,u))return[];var h=[],x=[t.startcap,t.forward,t.back,t.endcap],p=[a.startcap,a.forward,a.back,a.endcap];return x.forEach((function(r){r.virtual||p.forEach((function(u){if(!u.virtual){var x=r.intersects(u,c);x.length>0&&(x.c1=r,x.c2=u,x.s1=t,x.s2=a,h.push(x))}}))})),h},makeshape:function(t,r,a){var u=r.points.length,c=t.points.length,h=_.makeline(r.points[u-1],t.points[0]),x=_.makeline(t.points[c-1],r.points[0]),p={startcap:h,forward:t,back:r,endcap:x,bbox:_.findbbox([h,t,r,x])},y=_;return p.intersections=function(t){return y.shapeintersections(p,p.bbox,t,t.bbox,a)},p},getminmax:function(t,r,a){if(!a)return{min:0,max:0};var u,c,h=z,x=b;-1===a.indexOf(0)&&(a=[0].concat(a)),-1===a.indexOf(1)&&a.push(1);for(var p=0,y=a.length;y>p;p++)u=a[p],(c=t.get(u))[r]<h&&(h=c[r]),c[r]>x&&(x=c[r]);return{min:h,mid:(h+x)/2,max:x,size:x-h}},align:function(t,r){var a=r.p1.x,h=r.p1.y,p=-x(r.p2.y-h,r.p2.x-a);return t.map((function(t){return{x:(t.x-a)*u(p)-(t.y-h)*c(p),y:(t.x-a)*c(p)+(t.y-h)*u(p)}}))},roots:function(t,r){r=r||{p1:{x:0,y:0},p2:{x:1,y:0}};var a=t.length-1,c=_.align(t,r),s=function(t){return t>=0&&1>=t};if(2===a){if(0!==(g=(z=c[0].y)-2*(b=c[1].y)+(w=c[2].y))){var x=-p(b*b-z*w),y=-z+b;return[-(x+y)/g,-(-x+y)/g].filter(s)}return b!==w&&0===g?[(2*b-w)/2*(b-w)].filter(s):[]}var d,g,z,b,w,E=c[0].y,S=c[1].y,M=c[2].y,k=(c=(3*(b=(-3*E+3*S)/(g=3*S-E-3*M+c[3].y))-(z=(3*E-6*S+3*M)/g)*z)/3)/3,O=(2*z*z*z-9*z*b+27*(w=E/g))/27,T=O/2,N=T*T+k*k*k;if(0>N){var j=-c/3,I=p(j*j*j),A=-O/(2*I),C=h(-1>A?-1:A>1?1:A),F=2*f(I);return[F*u(C/3)-z/3,F*u((C+m)/3)-z/3,F*u((C+2*m)/3)-z/3].filter(s)}if(0===N)return[2*(d=0>T?f(-T):-f(T))-z/3,-d-z/3].filter(s);var q=p(N);return[(d=f(-T+q))-f(T+q)-z/3].filter(s)},droots:function(t){if(3===t.length){var r=t[0],a=t[1],u=t[2],c=r-2*a+u;if(0!==c){var h=-p(a*a-r*u),x=-r+a;return[-(h+x)/c,-(-h+x)/c]}return a!==u&&0===c?[(2*a-u)/(2*(a-u))]:[]}if(2===t.length)return(r=t[0])!==(a=t[1])?[r/(r-a)]:[]},inflections:function(t){if(t.length<4)return[];var r=_.align(t,{p1:t[0],p2:t.slice(-1)[0]}),a=r[2].x*r[1].y,u=r[3].x*r[1].y,c=r[1].x*r[2].y,h=18*(-3*a+2*u+3*c-(g=r[3].x*r[2].y)),x=18*(3*a-u-3*c),p=18*(c-a);if(_.approximately(h,0)){if(!_.approximately(x,0)){var y=-p/x;if(y>=0&&1>=y)return[y]}return[]}var d=x*x-4*h*p,m=Math.sqrt(d),g=2*h;return _.approximately(g,0)?[]:[(m-x)/g,-(x+m)/g].filter((function(t){return t>=0&&1>=t}))},bboxoverlap:function(t,a){var u,c,h,x,p,y=["x","y"],d=y.length;for(u=0;d>u;u++)if(h=t[c=y[u]].mid,x=a[c].mid,p=(t[c].size+a[c].size)/2,r(h-x)>=p)return!1;return!0},expandbox:function(t,r){r.x.min<t.x.min&&(t.x.min=r.x.min),r.y.min<t.y.min&&(t.y.min=r.y.min),r.z&&r.z.min<t.z.min&&(t.z.min=r.z.min),r.x.max>t.x.max&&(t.x.max=r.x.max),r.y.max>t.y.max&&(t.y.max=r.y.max),r.z&&r.z.max>t.z.max&&(t.z.max=r.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,r,a){var u=t.bbox(),c=r.bbox(),h=1e5,x=a||.5;if(u.x.size+u.y.size<x&&c.x.size+c.y.size<x)return[(h*(t._t1+t._t2)/2|0)/h+"/"+(h*(r._t1+r._t2)/2|0)/h];var p=t.split(.5),y=r.split(.5),d=[{left:p.left,right:y.left},{left:p.left,right:y.right},{left:p.right,right:y.right},{left:p.right,right:y.left}];d=d.filter((function(t){return _.bboxoverlap(t.left.bbox(),t.right.bbox())}));var m=[];return 0===d.length?m:(d.forEach((function(t){m=m.concat(_.pairiteration(t.left,t.right,x))})),m=m.filter((function(t,r){return m.indexOf(t)===r})))},getccenter:function(t,r,a){var h,p=r.x-t.x,y=r.y-t.y,d=a.x-r.x,z=a.y-r.y,b=p*u(g)-y*c(g),w=p*c(g)+y*u(g),E=d*u(g)-z*c(g),S=d*c(g)+z*u(g),M=(t.x+r.x)/2,k=(t.y+r.y)/2,O=(r.x+a.x)/2,T=(r.y+a.y)/2,N=M+b,j=k+w,I=O+E,A=T+S,C=_.lli8(M,k,N,j,O,T,I,A),F=_.dist(C,t),q=x(t.y-C.y,t.x-C.x),U=x(r.y-C.y,r.x-C.x),B=x(a.y-C.y,a.x-C.x);return B>q?((q>U||U>B)&&(q+=m),q>B&&(h=B,B=q,q=h)):U>B&&q>U?(h=B,B=q,q=h):B+=m,C.s=q,C.e=B,C.r=F,C}};t.exports=_}()},function(t,r,a){"use strict";!function(){var r=a(2),i=function(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)};i.prototype={valueOf:function(){return this.toString()},toString:function(){return"["+this.curves.map((function(t){return r.pointsToString(t.points)})).join(", ")+"]"},addCurve:function(t){this.curves.push(t),this._3d=this._3d||t._3d},length:function(){return this.curves.map((function(t){return t.length()})).reduce((function(t,r){return t+r}))},curve:function(t){return this.curves[t]},bbox:function e(){for(var t=this.curves,e=t[0].bbox(),a=1;a<t.length;a++)r.expandbox(e,t[a].bbox());return e},offset:function o(t){var o=[];return this.curves.forEach((function(r){o=o.concat(r.offset(t))})),new i(o)}},t.exports=i}()}]);var WindLeaf=pc.createScript("windLeaf");WindLeaf.attributes.add("canRotate",{type:"boolean",default:!1}),WindLeaf.prototype.initialize=function(){var e=this,a=e.entity,t=new pc.Vec3,i=new pc.Vec2,c=0,n=0,o=0,l=0,p=0,s=0,d=0;function spawn(){t.x=878,t.y=RANDOM.spectrum(2971),i.x=-RANDOM.value(20,10)/5,i.y=-RANDOM.value(10,2)/2;var e=RANDOM.decimal(.5,.25);a.setLocalScale(e,e,e),s=RANDOM.spectrumDecimal(20),c=RANDOM.decimal(),o=RANDOM.decimal(.3,.01)/10,n=RANDOM.decimal(),l=RANDOM.decimal(.3,.01)/5,p=5*RANDOM.decimal(30,10)}e.onUpdate=function(){t.x+=i.x,t.y+=i.y,c+=o,n+=l*RANDOM.decimal(1,.5);var M=Math.sin(c),R=Math.sin(n);d+=(100*R-d)/10,a.setLocalPosition(t.x+d,t.y+M*p,0),e.canRotate&&a.setLocalEulerAngles(M*p/2,0,s+M*p),t.x<-900&&spawn()},spawn(),a.setLocalPosition(RANDOM.spectrum(800),RANDOM.spectrum(2800),0)},WindLeaf.prototype.update=function(e){this.onUpdate()};class GestureRecognizer{constructor(){this.createDefaults()}get atlas(){return this._atlas}get thresholds(){return this._thresholds}get outputOptions(){return this._output}process(e){const t=this.detectShape(e);let r;switch(t.name){case"circle":{const e=t.geometry.getCenter();r={center:[e.x,e.y],radius:t.geometry.r};break}case"vector":{const{vertex1:e,vertex2:s}=t.geometry;r=[[e.x,e.y],[s.x,s.y]];break}default:r=t.geometry.vertices.map((e=>[e.x,e.y]))}return r.name=t.name,r}add(e,t,r){this.transformAtlas({bolt:{closed:!1,vertices:[[15,268],[-191,71],[94,71],[-144,-189]]}}),log(this._atlas)}createDefaults(){const e=this;e._output={vectorRotationProduct:Math.PI/16,rectRotationProduct:Math.PI/8},e._thresholds={circleClosureDistance:100,circleReductionAngle:.6,minPolygonArea:300,minShapeScore:.5,minSquareScore:.85,normalDistance:90,radiusesStdRatio:.18,vectorsReductionAngle:.3},e._atlas=[{name:"square",geometry:new GestureRecognizer.Rectangle([{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],{rotationProduct:e._output.rectRotationProduct})}];const t={"equilateral triangle":function generateEquilateral(e){const t=2*Math.PI/e,r=new GestureRecognizer.Circle({x:0,y:0},1);return _.times(e,(e=>[r.getX(t*e),r.getY(t*e)]))}(3),"golden-ratio triangle":[[0,0],[1,0],[0,Math.sqrt(3)]],"silver-ratio triangle":[[0,0],[1,0],[0,1]],spark:[[250,0],[50,50],[0,250],[-50,50],[-250,0],[-50,-50],[0,-250],[50,-50]],star:[[0,-300],[-100,-110],[-300,-70],[-160,90],[-190,300],[0,210],[190,300],[160,90],[300,-70],[100,-110]]};this.transformAtlas(t)}transformAtlas(e){const t=this;return _.transform(e,((e,r,s)=>{let i,n;r instanceof Array?(i=r,n=!0):(i=r.vertices,n=r.closed),t._atlas.push({name:s,geometry:new GestureRecognizer.Polygon(i,{closed:n})})}),[])}detectShape(e){const t=[];for(let r=2;r<e.length-1;r++){const s=e[r],i=e[r+1];let n=new GestureRecognizer.Vector(s,i);r==e.length-2&&(n=n.normalizeLength(this._thresholds.normalDistance,s));for(let s=0;s<r-1;s++){const i=e[s],o=e[s+1];let h=new GestureRecognizer.Vector(i,o);0==s&&(h=h.normalizeLength(this._thresholds.normalDistance,o));const c=n.getAngle(h);if(GestureRecognizer.Utils.isBetweenThreshold(c,0,this._thresholds.vectorsReductionAngle)||GestureRecognizer.Utils.isBetweenThreshold(c,Math.PI,this._thresholds.vectorsReductionAngle))continue;const a=h.getIntersection(n);if(a===GestureRecognizer.Vertex.NaN)continue;const g=e.slice(s+1,r).concat(a),u=new GestureRecognizer.Polygon(g);u.getArea()>this._thresholds.minPolygonArea&&t.push(u),e=e.slice(0,s).concat(a).concat(e.slice(r+1)),r=s;break}}let r;r=0==t.length?new GestureRecognizer.Polygon(e):_.maxBy(t,(e=>e.getArea()));const s=this.tryCircle(r);if(s)return s;const i=r.reduceLOD(this._thresholds.vectorsReductionAngle);if(i.vertices.length<3||0==t.length){const e=this.tryCircle(r);if(e)return e;const t=i.getVectors().slice(0,-1).filter(Boolean);0==t.length&&t.push(new GestureRecognizer.Vector(r.vertices[0],r.vertices[r.vertices.length-1]));const s=_.chain(t).map((e=>e.getVertices())).flatten().value();return 2==s.length?{name:"vector",geometry:new GestureRecognizer.Vector(...s,{rotationProduct:this._output.vectorRotationProduct}).roundAngle()}:{name:"open polygon",geometry:new GestureRecognizer.Polygon(s,{closed:!1})}}const n=i.getVectors(),o=i.getCosines(n),h=i.getRatios(n),c=this._atlas.map((e=>{const t=e.geometry.getCosines(),r=e.geometry.getRatios(),s=GestureRecognizer.Utils.matchScore(t,o),i=GestureRecognizer.Utils.matchScore(r,h),n=new Number(s*i);return Object.assign(n,_.max([GestureRecognizer.Utils.matchScore(t,o,i.offset+1,i.offset),GestureRecognizer.Utils.matchScore(r,h,s.offset+1,s.offset)])),n})),a=_.maxBy(Object.keys(c),(e=>c[e])),g=c[a];for(let e=0;e<g.offset;e++)i.vertices.push(i.vertices.shift());const u=_.clone(this._atlas[a]);if(g>("square"==u.name?this._thresholds.minSquareScore:this.getScoreThreshold(i.vertices.length)))return u.geometry=u.geometry.fitWith(i),u;const l={name:"polygon",geometry:i};switch(i.vertices.length){case 3:l.name="triangle";break;case 4:this.handleQuadShape(l);break;case 5:l.name="pentagon";break;case 6:l.name="hexagon";break;case 8:l.name="octagon"}return l}tryCircle(e){if(e.vertices.length<3)return;if(e.reduceLOD(this._thresholds.circleReductionAngle).vertices.length>3)return;if(new GestureRecognizer.Vector(e.vertices[0],e.vertices[e.vertices.length-1]).getLength()>this._thresholds.circleClosureDistance)return;const t=e.getCenter(),r=e.vertices.map((e=>new GestureRecognizer.Vector(t,e).getLength())),s=GestureRecognizer.Utils.getStandardDeviation(r),i=_.mean(r);return s/i>this._thresholds.radiusesStdRatio?void 0:{name:"circle",geometry:new GestureRecognizer.Circle(t,i)}}handleQuadShape(e){e.name="quadrilateral";const t=e.geometry,r=t.getCosines();if(GestureRecognizer.Utils.matchScore(r,_.times(4,(()=>Math.PI/2)))<this._thresholds.minSquareScore)return;e.name="rectangle";const s=t.getLengths(),i=_.mean([s[0],s[2]]),n=_.mean([s[1],s[3]]);e.geometry=new GestureRecognizer.Rectangle([{x:0,y:i},{x:0,y:0},{x:n,y:0},{x:n,y:i}]).fitWith(e.geometry)}getScoreThreshold(e){return Math.sin(Math.PI/2*this._thresholds.minShapeScore**e)}}GestureRecognizer.Circle=class{constructor({x:e,y:t},r,s=0,i=2*Math.PI){this.x=e,this.y=t,this.r=r,this.rad1=s,this.rad2=i}getCenter(){return new GestureRecognizer.Vertex(this.x,this.y)}getX(e){return this.hasRad(e)?this.r*Math.cos(e)+this.x:NaN}getY(e){return this.hasRad(e)?this.r*Math.sin(e)+this.y:NaN}getVertex(e){return this.hasRad(e)?new GestureRecognizer.Vertex({x:this.r*Math.cos(e)+this.x,y:this.r*Math.sin(e)+this.y}):GestureRecognizer.Vertex.NaN}hasRad(e){if(null!=e&&GestureRecognizer.Utils.isBetween(e,this.rad1,this.rad2))return!0;let t;return t=Math.abs(this.rad1)>Math.abs(this.rad2)?this.rad1:this.rad2,!(!GestureRecognizer.Utils.isBetween(e+2*Math.PI*Math.floor(t/(2*Math.PI)),this.rad1,this.rad2)&&!GestureRecognizer.Utils.isBetween(e+2*Math.PI*Math.ceil(t/(2*Math.PI)),this.rad1,this.rad2))}getRad(e,t){let r=Math.atan2(t-this.y,e-this.x);return this.hasRad(r)?r:NaN}hasVertex(e,t){return!Number.isNaN(this.getRad(e,t))}getIntersection(e){return e instanceof GestureRecognizer.Circle?this.getCircleIntersection(e):e instanceof GestureRecognizer.Vector?this.getVectorIntersection(e):void 0}getCircleIntersection(e){const t=e.x-this.x,r=e.y-this.y,s=Math.sqrt(Math.pow(t,2)+Math.pow(r,2));if(s>this.r+e.r||s<Math.abs(this.r-e.r))return[];const i=(Math.pow(this.r,2)-Math.pow(e.r,2)+Math.pow(s,2))/(2*s),n=this.x+t*i/s,o=this.y+r*i/s,h=Math.sqrt(Math.pow(this.r,2)-Math.pow(i,2)),c=-r*h/s,a=t*h/s;let g=[{x:n+c,y:o+a},{x:n-c,y:o-a}];g=_.uniq(g,(({x:e,y:t})=>`(${e}, ${t})`)),[this,e].forEach((function(e){g=g.filter((({x:t,y:r})=>e.hasVertex(t,r)))})),GestureRecognizer.Vertex.map(g)}getVectorIntersection(e){const t=e.x1-this.x,r=e.x2-this.x,s=e.y1-this.y,i=e.y2-this.y,n=r-t,o=i-s,h=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),c=t*i-r*s,a=Math.pow(this.r,2)*Math.pow(h,2)-Math.pow(c,2);if(a<0)return GestureRecognizer.Vertex.NaN;let g=[{x:(c*o+(o/Math.abs(o)||1)*n*Math.sqrt(a))/Math.pow(h,2)+this.x,y:(-c*n+Math.abs(o)*Math.sqrt(a))/Math.pow(h,2)+this.y},{x:(c*o-(o/Math.abs(o)||1)*n*Math.sqrt(a))/Math.pow(h,2)+this.x,y:(-c*n-Math.abs(o)*Math.sqrt(a))/Math.pow(h,2)+this.y}].filter((({x:t,y:r})=>this.hasVertex(t,r)&&e.boundsHaveVertex(t,r)));g=_.uniq(g,(({x:e,y:t})=>`(${e}, ${t})`)),GestureRecognizer.Vertex.map(g)}moveTo(e){return new GestureRecognizer.Circle(e,this.r,this.rad1,this.rad2)}},GestureRecognizer.Polygon=class{get opened(){return!this.closed}set opened(e){this.closed=!e}get vertices(){return this._vertices}set vertices(e){this._vertices=GestureRecognizer.Vertex.map(e).filter(((t,r)=>{const s=GestureRecognizer.Utils.fixedMod(r-1,e.length),i=e[s];return!i||(!GestureRecognizer.Utils.isSimilar(t.x,i.x)||!GestureRecognizer.Utils.isSimilar(t.y,i.y))}))}get options(){return{closed:this.closed}}constructor(e,t={}){t=Object.assign({closed:!0},t),this.vertices=e,this.closed=t.closed}getVectors(){const e=this.vertices,t=e.map(((t,r)=>{const s=GestureRecognizer.Utils.fixedMod(r+1,e.length),i=e[s];return new GestureRecognizer.Vector(t,i)}));return this.opened&&t.pop(),t}getLengths(e=this.getVectors()){return e.map((e=>e.getLength()))}getAngles(e=this.getVectors()){return e.map((e=>e.getAngle()))}getCosines(e=this.getVectors()){const t=e.map(((t,r)=>{const s=GestureRecognizer.Utils.fixedMod(r+1,e.length),i=e[s];return t.cosines(i)}));return t.length>0&&t.unshift(t.pop()),t}getRatios(e=this.getVectors()){const t=e.reduce(((e,t)=>t.getLength()<e.getLength()?t:e));return e.map((e=>e.getLength()/t.getLength()))}getCenter(){const e=this.vertices;let t=0,r=0,s=0;if(e.forEach(((i,n)=>{const o=(n+1)%e.length,h=e[o],c=i.x*h.y-h.x*i.y;t+=c,r+=(i.x+h.x)*c,s+=(i.y+h.y)*c})),!t)return e.reduce(((e,t)=>({x:e.x+t.x/this.vertices.length,y:e.y+t.y/this.vertices.length})),{x:0,y:0});const i=3*t;return new GestureRecognizer.Vertex({x:r/i,y:s/i})}getMinX(){return _.minBy(this.vertices,(e=>e.x)).x}getMaxX(){return _.maxBy(this.vertices,(e=>e.x)).x}getMinY(){return _.minBy(this.vertices,(e=>e.y)).y}getMaxY(){return _.maxBy(this.vertices,(e=>e.y)).y}boundsHaveVertex({x:e,y:t}){return!(e<this.getMinX())&&(!(e>this.getMaxX())&&(t<this.getMinY()||this.getMinY(),!0))}getBoundingBox(){const e=this.getMinX(),t=this.getMaxX(),r=this.getMinY(),s=this.getMaxY();return new GestureRecognizer.Rectangle([{x:e,y:r},{x:t,y:r},{x:t,y:s},{x:e,y:s}])}getBoundingCircle(){const e=this.getCenter(),t=_.chain(this.vertices).map((t=>new GestureRecognizer.Vector(t,e).getLength())).max().value();return new GestureRecognizer.Circle(e,t)}getArea(){const e=this.vertices;let t=0;for(let r=0,s=e.length;r<s;r++){t+=e[r].x*e[r==e.length-1?0:r+1].y*.5,t-=e[r==e.length-1?0:r+1].x*e[r].y*.5}return Math.abs(t)}scale(e,t=this.getCenter()){const r=this.vertices.map((e=>({x:e.x-t.x,y:e.y-t.y}))).map((t=>({x:t.x*e,y:t.y*e}))).map((e=>({x:e.x+t.x,y:e.y+t.y})));return new this.constructor(r,this.options)}rotate(e,t=this.getCenter()){const r=Math.cos(e),s=Math.sin(e),i=this.vertices.map((e=>({x:e.x-t.x,y:e.y-t.y}))).map((e=>({x:r*e.x-s*e.y,y:s*e.x+r*e.y}))).map((e=>({x:e.x+t.x,y:e.y+t.y})));return new this.constructor(i,this.options)}moveTo(e){const t=this.getCenter(),r=e.x-t.x,s=e.y-t.y,i=this.vertices.map((e=>({x:e.x+r,y:e.y+s})));return new this.constructor(i,this.options)}fitWith(e,t=!0){const r=e.getVectors(),s=e.getLengths(r),i=this.getVectors(),n=this.getLengths(i),o=e.getCenter(),h=[],c=[];for(let t=0;t<e.vertices.length;t++){const e=r[t],o=s[t],a=i[t],g=n[t];let u=GestureRecognizer.Utils.fixedMod(Math.PI/2-e.getAngle(a),Math.PI/2);u=Math.min(u,Math.PI/2-u),h.push(u),c.push(o/g)}const a=this.options,g=_.mean(h),u=_.mean(c),l=[new this.constructor(this.vertices.slice(),a).moveTo(o).scale(u).rotate(g),new this.constructor(this.vertices.slice(),a).moveTo(o).scale(u).rotate(-g),new this.constructor(this.vertices.slice(),a).moveTo(o).scale(u).rotate(Math.PI+g),new this.constructor(this.vertices.slice(),a).moveTo(o).scale(u).rotate(Math.PI-g),new this.constructor(this.vertices.slice().reverse(),a).moveTo(o).scale(u).rotate(g+Math.PI/2),new this.constructor(this.vertices.slice().reverse(),a).moveTo(o).scale(u).rotate(-g-Math.PI/2),new this.constructor(this.vertices.slice().reverse(),a).moveTo(o).scale(u).rotate(Math.PI-g-Math.PI/2),new this.constructor(this.vertices.slice().reverse(),a).moveTo(o).scale(u).rotate(Math.PI+g+Math.PI/2)];if(t){const t=this.mirror();this.vertices.some(((e,r)=>!_.isEqual(e,t.vertices[r])))&&l.push(t.fitWith(e,!1))}return _.minBy(l,(t=>_.sum(t.vertices.map((t=>_.min(e.vertices.map((e=>Math.abs(t.x-e.x)+Math.abs(t.y-e.y)))))))))}mirror(e=0){const t=this.rotate(e).vertices.map((({x:e,y:t})=>({x:e,y:-t})));return new this.constructor(t,this.options).rotate(-e)}reduceLOD(e){const t=this.getCosines(),r=t.map((t=>isNaN(t)||GestureRecognizer.Utils.isBetweenThreshold(t,Math.PI,e))).map(((e,t)=>!e&&this.vertices[t])).filter(Boolean);if(r.length<3)return new GestureRecognizer.Polygon([this.vertices[0],this.vertices[this.vertices.length-1]],this.options);const s=this.getBoundingBox();let i=Math.min(s.getWidth(),s.getHeight())/5;i=_.clamp(i,10,50),r.forEach((e=>{r.forEach(((t,s)=>{if(e===t)return;new GestureRecognizer.Vector(e,t).getLength()<i&&r.splice(s,1)}))}));const n=new GestureRecognizer.Polygon(r,this.options);return t.length==r.length?n:n.reduceLOD(e)}},GestureRecognizer.Rectangle=class extends GestureRecognizer.Polygon{static fromScalars(e,t,r,s){return new GestureRecognizer.Rectangle([{x:e,y:t},{x:e+r,y:t},{x:e+r,y:t+s},{x:e,y:t+s}])}constructor(e,{rotationProduct:t}={}){if(super(e,{closed:!0}),4!=e.length)throw TypeError("A rectangle must have 4 corners");this.rotationProduct=t;this.getCosines().forEach((e=>{if(e.toFixed(5)!=(Math.PI/2).toFixed(5))throw TypeError("All angles must be 1/2 radians")}))}getWidth(e=this.getVectors()){return _.minBy(e,(e=>Math.abs(e.getAngle()))).getLength()}getHeight(e=this.getVectors()){return _.maxBy(e,(e=>Math.abs(e.getAngle()))).getLength()}getRotation(){return _.minBy(this.getAngles(),Math.abs)}getIndexCorner(){const e=this.getCenter(),t=this.getRotation(),r=this.rotate(-t),s=new GestureRecognizer.Vector(e,this.vertices[0]).getLength(),i=new GestureRecognizer.Circle(e,s),n=r.getMinX(),o=r.getMinY(),h=i.getRad(n,o);return i.getVertex(h+t)}fitWith(e,t){let r=super.fitWith(e,t);if(this.rotationProduct){const e=r.getRotation(),t=GestureRecognizer.Utils.fixedMod(e,this.rotationProduct),s=Math.abs(t)/t||1;r=t>this.rotationProduct/2?r.rotate(-s*(t-this.rotationProduct)):r.rotate(-s*t)}return r}containsVertex(e){return this.boundsHaveVertex(e)}},GestureRecognizer.Vertex=class{static get NaN(){return GestureRecognizer.NaN}static map(e){return e.map((e=>new GestureRecognizer.Vertex(e)))}constructor(e,t){if(1==arguments.length){const r=arguments[0];r instanceof Array?(e=r[0],t=r[1]):r instanceof Object&&(e=r.x,t=r.y)}this.x=e,this.y=t}},GestureRecognizer.NaN=new GestureRecognizer.Vertex(NaN,NaN),GestureRecognizer.Vector=class{get vertex1(){return this._vertex1}set vertex1(e){this._vertex1=new GestureRecognizer.Vertex(e)}get vertex2(){return this._vertex2}set vertex2(e){this._vertex2=new GestureRecognizer.Vertex(e)}get x1(){return this.vertex1.x}get y1(){return this.vertex1.y}get x2(){return this.vertex2.x}get y2(){return this.vertex2.y}constructor(e,t,r){this.vertex1=e,this.vertex2=t,this.rotationProduct=r&&r.rotationProduct||{}}getLength(){return Math.sqrt((this.x1-this.x2)**2+(this.y1-this.y2)**2)}getSlope(e){return e?Math.tan(this.getAngle(e)):(this.y2-this.y1)/(this.x2-this.x1)}getAngle(e){if(!e){return Math.atan(this.getSlope())}const t=this.getAngle(),r=e.getAngle();return Math.atan2(Math.sin(r-t),Math.cos(r-t))}getVertices(){return[this._vertex1,this._vertex2]}getCenter(){return new GestureRecognizer.Vertex(this.x1+this.x2/2,this.y1+this.y2/2)}hasVertex({x:e,y:t}){return!!this.boundsHaveVertex(e,t)&&(t-this.y1)/(e-this.x1)==this.getSlope()}boundsHaveVertex({x:e,y:t}){return GestureRecognizer.Utils.isBetween(e,this.x1,this.x2)&&GestureRecognizer.Utils.isBetween(t,this.y1,this.y2)}getIntersection(e){return e instanceof GestureRecognizer.Vector?this.getVectorIntersection(e):e instanceof GestureRecognizer.Circle?this.getCircleIntersection(e):void 0}getVectorIntersection(e){if((this.x1-this.x2)*(e.y1-e.y2)-(this.y1-this.y2)*(e.x1-e.x2)==0)return GestureRecognizer.Vertex.NaN;const t=((this.x1*this.y2-this.y1*this.x2)*(e.x1-e.x2)-(this.x1-this.x2)*(e.x1*e.y2-e.y1*e.x2))/((this.x1-this.x2)*(e.y1-e.y2)-(this.y1-this.y2)*(e.x1-e.x2)),r=((this.x1*this.y2-this.y1*this.x2)*(e.y1-e.y2)-(this.y1-this.y2)*(e.x1*e.y2-e.y1*e.x2))/((this.x1-this.x2)*(e.y1-e.y2)-(this.y1-this.y2)*(e.x1-e.x2));return GestureRecognizer.Utils.isBetween(t,this.x1,this.x2)&&GestureRecognizer.Utils.isBetween(t,e.x1,e.x2)&&GestureRecognizer.Utils.isBetween(r,this.y1,this.y2)&&GestureRecognizer.Utils.isBetween(r,e.y1,e.y2)?new GestureRecognizer.Vertex({x:t,y:r}):GestureRecognizer.Vertex.NaN}getCircleIntersection(e){return e.getVectorIntersection(this)}normalizeLength(e,t=this.vertex1){if(!e)return this;const r=e-this.getLength();if(r<0)return this;const s=[this.vertex1,this.vertex2],i=s.findIndex((e=>!_.isEqual(e,t)));if(-1==i)return this;const n=(i+1)%2,o=s[i],h=(o.x-t.x)/Math.abs(o.x-t.x)||0,c=(o.y-t.y)/Math.abs(o.y-t.y)||0,a=this.getAngle(),g={x:t.x+h*r*Math.abs(Math.cos(a)),y:t.y+c*r*Math.abs(Math.sin(a))},u=[];return u[n]=t,u[i]=g,new GestureRecognizer.Vector(...u)}cosines(e){const t=_.chain([this,e]).map((e=>_.pick(e,"vertex1","vertex2"))).map(_.values).thru((e=>_.xorWith(...e,_.isEqual))).value();if(2!=t.length)return NaN;const r=new GestureRecognizer.Vector(...t),s=this.getLength(),i=e.getLength(),n=r.getLength();return Math.acos((n**2-s**2-i**2)/(-2*s*i))}rotate(e,t=this.vertex2){const r=Math.cos(e),s=Math.sin(e),i=[this.vertex1,this.vertex2].map((e=>({x:e.x-t.x,y:e.y-t.y}))).map((e=>({x:r*e.x-s*e.y,y:s*e.x+r*e.y}))).map((e=>({x:e.x+t.x,y:e.y+t.y})));return new this.constructor(...i)}roundAngle(){if(!this.rotationProduct)return this;const e=this.getAngle(),t=GestureRecognizer.Utils.fixedMod(e,this.rotationProduct),r=Math.abs(t)/t||1;return t>this.rotationProduct/2?this.rotate(-r*(t-this.rotationProduct)):this.rotate(-r*t)}},GestureRecognizer.Utils=class{static fixedMod(e,t){return(e%t+t)%t}static isBetween(e,t,r){let s,i;return t<r?(s=t,i=r):(s=r,i=t),e>=s&&e<=i}static isBetweenThreshold(e,t,r){return GestureRecognizer.Utils.isBetween(e,t-r,t+r)}static getStandardDeviation(e){const t=_.mean(e),r=e.map((e=>(e-t)**2)),s=_.mean(r);return Math.sqrt(s)}static matchScore(e,t,r=t.length,s=0){if(s==r)return 0;if(e.length!=t.length)return 0;e=e.slice(),t=t.slice(s).concat(t.slice(0,s));const i=e.map(((e,r)=>{const s=t[r],[i,n]=[e,s].sort();return i/n})),n=_.mean(i),o=GestureRecognizer.Utils.matchScore(arguments[0],arguments[1],r,s+1);let h=_.max([n,o]);return h instanceof Number||(h=new Number(h),h.offset=s),h}static isSimilar(e,t){return e>=t-Number.EPSILON&&e<=t+Number.EPSILON}};var CharacterVehicle=pc.createScript("characterVehicle");CharacterVehicle.attributes.add("isME",{type:"boolean"}),CharacterVehicle.prototype.initialize=function(){var e,n,i=this,t=i.entity,c=t.findByName("Body"),a=t.findByName("Chassis"),l=(new pc.Vec3,new pc.Vec3),r=new pc.Vec3,o=new pc.Vec3,p=new pc.Vec3,s=t.findByName("Smoke").particlesystem,u=t.findByName("FXWindLines"),y=[];function Wheel(e){var i=e.name.includes("Front"),t=new pc.Vec3;y.push(this),this.update=function(){i&&(t.y+=(40*-n.input.x-t.y)/2),t.x+=7*n.input.y,e.setLocalEulerAngles(t)}}getLocals(c),function initWheels(){var e=t.findByName("Wheels").children;for(var n in e)new Wheel(e[n])}(),i.fill=function(t){i.player=e=t,i.isME=e==PLAYERS.ME,n=e.vars},i.onUpdate=function(){if(n){l.z=20*n.input.x,l.x=11*n.input.y,o.y=30*-n.input.x;var e=a.getLocalEulerAngles().clone(),i=c.getLocalEulerAngles().clone();for(var t in n.isMoving?(e.copy(ANIMATION.A2BFrictionVector(e,l,2)),i.copy(ANIMATION.A2BFrictionVector(i,o,2))):(e.copy(ANIMATION.A2BSprings(e,l,r,null,.92)),i.copy(ANIMATION.A2BSprings(i,o,p,null,.92))),c.setLocalEulerAngles(i),a.setLocalEulerAngles(e),y)y[t].update();Math.abs(n.input.x)>.2?s.play():s.stop(),n.input.y>.98?u.enabled=!0:u.enabled=!1}},i.isME&&i.fill(PLAYERS.ME)},CharacterVehicle.prototype.update=function(e){this.onUpdate()};var UISIZE=new function(){var e,n,i,t,o=this,r=new pc.Vec3,a=o.isLandscape=null;function adjustResolution(){!function adjustOrientation(){let i=a;n.referenceResolution=window.innerWidth<window.innerHeight?new pc.Vec2(1080,1920):new pc.Vec2(1920,1080),o._WIDTH=n.referenceResolution.x,o._HEIGHT=n.referenceResolution.y,e=o._HEIGHT/o._WIDTH,o.isLandscape=a=e<1,o.isLandscape!==i&&(o.orientation=a?"Landscape":"Portrait",fire("UI:onOrientationChange",a))}(),t.canvas.style.marginTop="0px",t.maxPixelRatio=QUALITY.devicePixelRatio,APP.setCanvasResolution(pc.RESOLUTION_FIXED,window.innerWidth,window.innerHeight),APP.setCanvasFillMode(pc.FILLMODE_KEEP_ASPECT,window.innerWidth,window.innerHeight),fire("UI:Resize",t.width,t.height)}function resize(t,r){var s=o.ratio=r/t;o.SCALE=e/s,o.SCALED=e<s?o.SCALE:1,o.SCALEU=e>s?o.SCALE:1,a&&(o.SCALED=.56,o.SCALEU=1),i=o.UISCALE=1/n.scale/o.SCALED,o.WIDTH=t*i,o.HEIGHT=r*i,o.TOP=o.HEIGHT/2,o.BOTTOM=-o.TOP,o.RIGHT=o.WIDTH/2,o.LEFT=-o.RIGHT,o.pixelRatio=APP.graphicsDevice.maxPixelRatio*i,fire("UI:onResize")}o.init=function(e){t=APP.graphicsDevice,n=e,on("UI:Resize",resize),adjustResolution(),window.addEventListener("resize",adjustResolution),window.addEventListener("orientationchange",adjustResolution),window.matchMedia("(orientation: portrait)").addEventListener("change",adjustResolution)},o.adjustResolution=adjustResolution,o.touchToScreen=function(e){return isNaN(e.x)&&(e.x=0),isNaN(e.y)&&(e.y=0),isNaN(e.z)&&(e.z=0),r.x=e.x*o.pixelRatio-o.RIGHT,r.y=-e.y*o.pixelRatio+o.TOP,r.z=0,r},o.touchToWorld=function(e){const n=QUALITY.devicePixelRatio,i=UI.entity.screen.scale;return r.x=(TOUCH.x*i+.5*t.width)/n,r.y=-(TOUCH.y*i-.5*t.height)/n,r},o.screenToTouch=function(e){var n=new pc.Vec3;return n.x=(e.x+o.RIGHT)/o.pixelRatio,n.y=-(e.y-o.TOP)/o.pixelRatio,n},o.worldToScreen=function(e){return o.positionToScreen(e.getPosition())},o.positionToScreen=function(e){return o.touchToScreen(CAMERA.entity.camera.worldToScreen(e))},o.isOnScreen=function(e){return MATH.isBetween(e.x,o.LEFT,o.RIGHT)&&MATH.isBetween(e.y,o.BOTTOM,o.TOP)},o.frustum=function(e){return o.isOnScreen(o.positionToScreen(e))}};var SENTRY=new function(){var n=this;n.init=function(){}};var log=console.log,LOG=new function(){this.init=function(o){if("Disabled"!=o){if("VConsole"==o){var n=[];return log=function(o,i,l,e){n.push(arguments)},void ASSETS.loadScript("vconsole.min",(function(){for(var o in new VConsole({maxLogNumber:5e3}),log=console.log,n)log("Log:",n[o])}))}log="Native"!=o?console.log:function(){invokeCSharpAction(JSON.stringify({key:"Utils",value:{command:"Log",log:JSON.stringify(arguments)}}))}}else log=function(){}},this.filter=function(o){log=function(n,i){-1!=n.toString().indexOf(o)&&console.log(n,i)}}};var ShopInventoryConfig=pc.createScript("shopInventoryConfig");ShopInventoryConfig.attributes.add("key",{title:"key",type:"string"}),ShopInventoryConfig.attributes.add("title",{title:"Tab Title",type:"string"}),ShopInventoryConfig.attributes.add("description",{title:"Description",type:"string"}),ShopInventoryConfig.attributes.add("platform",{title:"Platform Exclusive",type:"string",enum:[{SuperSnappy:"SuperSnappy"},{Azerion:"Azerion"},{Poki:"Poki"},{CrazyGames:"CrazyGames"},{VK:"VK"},{"All Platforms":"All Platforms"}],default:"All Platforms"}),ShopInventoryConfig.attributes.add("currency",{title:"Default Currency",type:"string",default:"Coin"}),ShopInventoryConfig.attributes.add("price",{title:"Default Price",type:"number",default:5e3}),ShopInventoryConfig.attributes.add("symbol",{title:"Symbol",type:"string"}),ShopInventoryConfig.attributes.add("color",{title:"Color",type:"string",default:"#FFFFFF"}),ShopInventoryConfig.attributes.add("sorting",{title:"Sorting",type:"number"}),ShopInventoryConfig.attributes.add("canLevelUp",{title:"Can Level Up",type:"boolean"}),ShopInventoryConfig.attributes.add("levelUpCurrency",{title:"Lvl Up Currency",type:"string"}),ShopInventoryConfig.attributes.add("priceLevelUp",{title:"Lvl Up Price",type:"number"}),ShopInventoryConfig.attributes.add("isProtected",{title:"Is Protected",type:"boolean",default:!1}),ShopInventoryConfig.attributes.add("items",{type:"json",schema:[{title:"Key",name:"key",type:"string"},{title:"Title",name:"title",type:"string"},{title:"Description",name:"description",type:"string"},{title:"Value",name:"value",type:"string"},{title:"Symbol",name:"symbol",type:"string"},{title:"Auto Equip",name:"autoEquip",type:"boolean"},{title:"Metadata",name:"metadata",type:"string"},{title:"Rarity",name:"rare",type:"string",enum:[{Auto:"Auto"},{Common:"Common"},{Rare:"Rare"},{Epic:"Epic"},{Legendary:"Legendary"},{Mythic:"Mythic"}],default:"Auto"}],array:!0}),ShopInventoryConfig.prototype.initialize=function(){var t=this;t.key||(t.key=t.entity.name),"All Platforms"==t.platform&&(t.platform=!1);for(let e in t.items){let r=t.items[e];r.type="Inventory",r.currency=r.currency||t.currency}t.items[0]&&(t.items[0].autoEquip=!0);let e={},r={Common:1,Rare:2,Epic:3,Legendary:4,Mythic:5},i=["Common","Rare","Epic","Legendary","Mythic"],n=Math.round(t.items.length/5)+2,o=0,a=1;for(let l in t.items){let y=e[t.items[l].key]=t.items[l],p=i[0];++o>=n&&(i.push(i.shift()),n--,o=0),y.sorting=a++,y.rarity="Auto"==y.rare?p:y.rare,delete y.rare,y.price=t.price*r[y.rarity],t.canLevelUp&&(y.canLevelUp=t.canLevelUp,y.levelUpCurrency=t.levelUpCurrency||y.currency)}CONFIG.add("SHOP.TABS."+t.key,{key:t.key,name:t.title,title:t.title,items:e,symbol:t.symbol,color:t.color,platform:t.platform,type:"Inventory",sorting:t.sorting,description:t.description},!0)};var ProfileConfig=pc.createScript("profileConfig");ProfileConfig.attributes.add("public",{title:"Public Variables",name:"varName",type:"string",array:!0}),ProfileConfig.attributes.add("items",{type:"json",schema:[{name:"varName",type:"string"},{name:"varBase",type:"string"},{name:"title",type:"string"},{name:"symbol",type:"string"}],array:!0}),ProfileConfig.prototype.initialize=function(){var a=this;let e=[];for(var l in e.push({varName:"userXP",varBase:null,title:"Experience",symbol:"Symbol_XP"}),e.push({varName:"totalGamesPlayed",varBase:null,title:"Games Played",symbol:"Symbol_Rocket"}),e.push({varName:"totalWin",varBase:null,title:"Matches Won",symbol:"Symbol_Dance"}),e.push({varName:"WinStreak",varBase:"maxWinStreak",title:"Win Streak / Max",symbol:"Symbol_Crown"}),e.push({varName:"totalPlayersEliminated",varBase:null,title:"Players Eliminated",symbol:"Symbol_Skull"}),e.push({varName:"maxScore",varBase:null,title:"Max Score",symbol:"Symbol_Trophy"}),a.items)e.push(a.items[l]);CONFIG.add(null,{PROFILE:e}),CONFIG.add(null,{PUBLIC:a.public})};var PFX=new function(){this.spawn=function(n){return new PFXInstance(n)}};var EmotesConfig=pc.createScript("emotesConfig");EmotesConfig.attributes.add("items",{type:"json",schema:[{name:"text",type:"string"},{name:"value",type:"string"},{name:"color",type:"string",default:"#FFFFFF"}],array:!0}),EmotesConfig.prototype.initialize=function(){var t=this;for(var e in t.items)t.items[e].id=e;CONFIG.add(null,{EMOTES:t.items})};var NavigationConfig=pc.createScript("navigationConfig");NavigationConfig.attributes.add("items",{type:"json",schema:[{title:"Screen",name:"id",type:"string"},{title:"Title",name:"title",type:"string"},{title:"Symbol",name:"symbol",type:"string"},{title:"Notification ID",name:"notification",type:"string"}],array:!0}),NavigationConfig.prototype.initialize=function(){CONFIG.add(null,{NAV:this.items})};function PFXInstance(t){t=t||{};var o,e,n,a=this,i=null,r={};function update(){o&&i&&o.setPosition(i.getPosition())}a.reset=function(){for(e in r)r[e].reset()},a.stop=function(){for(e in r)r[e].stop();stop(update)},a.stop(),a.play=function(t){if(o){if(a.stop(),!Array.isArray(t))return doPlay(t);for(var e in t)doPlay(t[e])}else n=t;function doPlay(t){var o=r[t];o&&(o.play(),start(update))}},a.follow=function(t){i=t,update()},a.fire=function(){a.play("Fire")},a.smoke=function(){a.play("Smoke")},a.combustion=function(){a.play(["Smoke","Fire"])},ASSETS.loadTemplate(t.template||"PFXPresets",t.parent||root,(function(e){o=e;var i=getChildrenNames(o);for(var l in i)i[l].enabled=!0,i[l].particlesystem&&(r[l]=i[l].particlesystem);ENTITY.wrap(o,a),a.stop(),n&&a.play(n),a.follow(t.follow)}))}var MissionsConfig=pc.createScript("missionsConfig");MissionsConfig.attributes.add("overwrite",{title:"Save to DB",type:"boolean",default:!1}),MissionsConfig.attributes.add("prefills",{type:"string",title:"Prefills",default:["PlayWithFriend","WinGames","PlayGames","CoinEarn","Purchase"],array:!0}),MissionsConfig.attributes.add("Defaults",{type:"json",schema:[{name:"currencyName",title:"Currency Name",type:"string",default:"Coin"}]}),MissionsConfig.attributes.add("FTUE",{type:"json",schema:[{type:"string",name:"category",title:"Category",enum:[{PlayWithFriend:"PlayWithFriend"},{Score:"Score"},{ScoreTime:"ScoreTime"},{GameAction:"GameAction"},{GameActionTime:"GameActionTime"},{CollectCoins:"CollectCoins"},{CollectCoinsTime:"CollectCoinsTime"},{Survive:"Survive"},{BeatRival:"BeatRival"},{WinGames:"WinGames"},{PlayGames:"PlayGames"}],default:"GameAction"},{title:"Text",name:"text",type:"string"},{title:"Amount",name:"amount",type:"string"},{title:"Time",name:"time",type:"string"},{title:"Name",name:"name",type:"string"},{title:"Variable Name",name:"varName",type:"string"},{title:"Persistent",name:"persistent",type:"boolean",default:!1}],array:!0}),MissionsConfig.attributes.add("Procedural",{type:"json",schema:[{type:"string",name:"category",title:"Category",enum:[{GameAction:"GameAction"},{GameActionTime:"GameActionTime"},{Score:"Score"},{ScoreTime:"ScoreTime"},{CollectCoins:"CollectCoins"},{CollectCoinsTime:"CollectCoinsTime"},{Survive:"Survive"}],default:"GameAction"},{title:"Text",name:"text",type:"string"},{title:"Amount",name:"amount",type:"string"},{title:"Time",name:"time",type:"string"},{title:"Name",name:"name",type:"string"},{title:"Variable Name",name:"varName",type:"string"},{title:"Persistent",name:"persistent",type:"boolean",default:!1}],array:!0}),MissionsConfig.prototype.initialize=function(){var e,t=this,a={PlayWithFriend:{text:"Challenge {amount} friends",persistent:!0,amount:"2, 4, 6, 8",varName:"PlayWithFriend",isCollection:!0},WinGames:{text:"Win {amount} games",persistent:!0,amount:"2, 5, 10, 15",varName:"WinGames"},BeatRival:{text:"Beat the score",value:1,varName:"PlayerScoreIncrease"},PlayGames:{text:"Play {amount} games",persistent:!0,amount:"2, 5, 10, 15",varName:"PlayGames"},Survive:{text:"Play for {time} seconds",time:60,varName:"Survive",persistent:!1},Score:{text:"Score {amount} points",varName:"PlayerScoreIncrease"},ScoreTime:({text:"Score {amount} points in less than {time} seconds",varName:"PlayerScoreIncrease"},{text:"Score {amount} points in less than {time} seconds",varName:"PlayerScoreIncrease"}),CollectCoins:{text:"Collect {amount} {currency}",varName:"GameCoinsIncrease"},CollectCoinsTime:{text:"Collect {amount} {currency} in less than {time} seconds",varName:"GameCoinsIncrease"},CoinEarn:{text:"Earn {amount} {currency}",amount:"1000,2000,3000,5000,10000",varName:"CoinEarned",persistent:!0},CoinSpend:{text:"Spend {amount} {currency}",amount:5e3,varName:"CoinSpent",persistent:!0},Purchase:{text:"Purchase something on the shop",amount:1,varName:"onPurchase",persistent:!0}},i={},n=t.Defaults;for(e in t.prefills)parseMission({category:t.prefills[e]});var r=t.Procedural;for(e in r)parseMission(r[e]);var o=t.FTUE;for(e in o)parseMission(o[e],"FTUE");function parseMission(e,t){!function prefillItem(e){e.category||(e.category="Custom");var t=a[e.category];if(t)for(var i in t)e[i]||(e[i]=t[i])}(e),e.category=t||e.category;var i=STRING.getArray(e.varName),r=STRING.getArray(e.name),o=STRING.getArray(e.amount),s=STRING.getArray(e.time);for(var m in i)for(var l=i[m],c=ARRAY.getClamp(r,m),u=MATH.higherValue(o.length,MATH.higherValue(s.length,r.length)),y=0;y<u;y++){var p=extract(e);p.varName=l,p.name=c,p.time=ARRAY.getClamp(s,y),p.amount=ARRAY.getClamp(o,y),p.index=y,p.currency=n.currencyName,p.time||delete p.time,p.name||delete p.name,p.amount||delete p.amount,pushMission(p)}}function pushMission(e){e.currency=n.currency,i[e.category]||(i[e.category]=[]),i[e.category].push(e)}for(var s in i)"FTUE"!=s&&(i[s]=sort(i[s],-1!=s.indexOf("Time")?"time":"amount"));CONFIG.add("MISSIONS",{overwrite:t.overwrite}),CONFIG.add("MISSIONS.DATA",i)};function CueProgression(e,s){var n,t,r=this,a=r.patterns=new Cue(!0,"patterns"),d=r.segments=new Cue(!0,"segments"),u=r.progressions=new Cue(!0,"progressions"),i=r.endless=new Cue(!0,"endless");function nextProgression(){if(t)return nextEndless();if(u.selected){var e=u.selected.consume();return e?setSegment(e):(t=!0,nextEndless())}u.get(),u.selected.get(),setSegment(u.selected.consume())}function nextEndless(){var e;if(i.selected&&(e=i.selected.consume()))return setSegment(e);i.get(),i.selected.get(),setSegment(i.selected.consume())}function setSegment(e){d.get(e),d.selected.get(),setPattern(d.selected.consume())}function setPattern(e){a.get(e),(n=a.selected).get()}function prefillSegments(){r.addSegments("easySegments").push(["easy","easy","medium"]),r.addSegments("mediumSegments",!0).push(["easy","easy","medium","medium"]),r.addSegments("hardSegments",!0).push(["easy","easy","medium","medium","hard","hard","hard"]),r.addSegments("crazySegments",!0).push(["easy","easy","medium","hard","hard","crazy","crazy","crazy"]),r.addSegments("endlessSegments",!0).push(["easy","medium","medium","hard","hard","hard","crazy","crazy","crazy"]),r.addProgressions("progression1").push(["easySegments","mediumSegments","easySegments","hardSegments","mediumSegments","crazySegments"]),r.addEndless("endgame1",!0).push(["endlessSegments"])}r.position=0,r.addPattern=function(e,s){return a.add(e,new Cue(s,e))},r.addSegments=function(e,s){return d.add(e,new Cue(s,e))},r.addProgressions=function(e,s){return u.add(e,new Cue(s,e))},r.addEndless=function(e){return i.add(e,new Cue(!0,e))},r.getLength=function(){if(r.length)return r.length;r.length=0;var e=u._pool[0]._pool[0];for(var s in e){var n=d[e[s]]._pool[0];for(var t in n){var i=a[n[t]]._pool;for(var m in i)r.length+=Array.isArray(i[m])?i[m].length:1}}return r.length},r.reset=function(){r.position=0,a.reset(),d.reset(),u.reset(),i.reset(),t=!1,nextProgression()},r.clear=function(){a.clear(),d.clear(),u.clear(),i.clear()},r.get=function(){n||r.reset();var e=n.consume();return null!=e?(r.position++,e):(function nextSegment(){var e=d.selected.consume();if(null!=e)return setPattern(e);nextProgression()}(),r.get())},r.getPosition=function(e){if(e&&!(e<0)){if(r.reset(),r.getLength(),e>r.length)return t=!0,r.position=e,nextEndless(),r.get();for(var s;e>r.position;)s=r.get();return s}},r.PRESETS={},r.PRESETS.endlessDifficulty=function(){return r.clear(),r.addPattern("easy",!0),r.addPattern("medium",!0),r.addPattern("hard",!0),r.addPattern("crazy",!0),prefillSegments(),r},r.PRESETS.endlessStatic=function(){return r.clear(),r.addPattern("easy"),r.addPattern("medium"),r.addPattern("hard"),r.addPattern("crazy"),prefillSegments(),r},r.PRESETS.endlessPrefill=function(){r.PRESETS.endlessDifficulty(),a.easy.push(["easy","easy","easy"]),a.easy.push(["easy","easy","easy"]),a.easy.push(["easy","easy"]),a.medium.push(["medium","medium","medium"]),a.medium.push(["medium","medium"]),a.medium.push(["medium","easy","medium"]),a.medium.push(["medium","hard","medium"]),a.hard.push(["hard","hard","hard"]),a.hard.push(["hard","hard"]),a.hard.push(["hard","medium","hard"]),a.hard.push(["hard","easy","hard"]),a.hard.push(["hard","crazy","hard"]),a.crazy.push(["crazy","crazy","crazy"]),a.crazy.push(["crazy","medium","crazy"]),a.crazy.push(["crazy","hard","crazy"]),a.crazy.push(["crazy","easy","crazy"])},r.PRESETS.linear=function(e){if(r.clear(),e){for(var s,n=[],t=0;t<e;t++)s="linear"+t,r.addPattern(s),r.addSegments(s).push([s]),n.push(s);r.addProgressions("progression1").push(n),s="endless",r.addPattern(s),r.addSegments(s).push([s]),r.addEndless(s,!0).push([s])}},r.PRESETS[e]&&r.PRESETS[e](s)}var HamburgerButton=pc.createScript("hamburgerButton");HamburgerButton.attributes.add("symbolY",{type:"number",default:35}),HamburgerButton.attributes.add("symbolScale",{type:"number",default:1.2}),HamburgerButton.prototype.initialize=function(){var e=this,t=e.entity,a=t.findByName("Arrow");a&&(a.enabled=!1),BUTTON.call(e),e.skipAnimation=!0;var l=t.findByName("titleField"),i=t.findByName("Symbol"),o=t.findByName("Notification"),n=i.getLocalPosition().y;getLocals(l),l.setLocalPosition(0,-130,0),e.fill=function(e){var t=this;CONTENT.fill(t,e),t.Enabled.enabled=!0,t.Disabled.enabled=!1,t.scale=(new pc.Vec3).copy(i.getLocalScale()),o&&e.notification&&o.script.textDisplayer.setVarName(e.notification),e.isLocked&&t.disable()},e.select=function(){var e=this;if(!e.isSelected){var t=e.symbolScale,o=EASING.SineOut;e.isSelected=!0,ANIMATION.scaleTo(i,{x:e.scale.x*t,y:e.scale.y*t,z:1},.2,o),ANIMATION.moveTo(i,{x:0,y:n+e.symbolY,z:0},.2,o),ANIMATION.moveTo(l,{x:0,y:l.pos.y,z:0},.2,o),e.Selected&&(e.Selected.enabled=!0),e.Deselected&&(e.Deselected.enabled=!1),a&&(a.enabled=!1)}},e.deselect=function(){var e=this;if(e.Selected&&(e.Selected.enabled=!1),e.Deselected&&(e.Deselected.enabled=!0),e.isSelected){e.isSelected=!1;var t=EASING.SineOut;ANIMATION.scaleTo(i,e.scale,.2,t),ANIMATION.moveTo(i,{x:0,y:n,z:0},.2,t),ANIMATION.moveTo(l,{x:0,y:-130,z:0},.2,t)}},on("highlightNav",(function(t){t==e.data.id&&(a.enabled=!0)})),e.deselect()};var MISSIONS=new function(){on("MISSION:Show",(function show(){off("MISSION:Show",show)}))},MissionDisplayer=pc.createScript("missionDisplayer");MissionDisplayer.prototype.initialize=function(){var e,n,i=this.entity,o=getChildScript(i,"Bar","bar"),t=i.findByName("Title"),a=i.findByName("MissionTime"),s=new DelayUnique("missionDisplayer"),l=i.findByName("Container");function fillMission(o){n="Survive"!=(e=o).category,e.start(),fill(i,e),l.enabled=!0,onUpdate()}function show(){hide(),GAME.Missions.get().then((function(e){if(!e)return i.destroy();fillMission(e),l.enabled=!1,s.start((function(){toFront(i),l.enabled=!0,a.enabled=!1,l.setLocalPosition(pc.Vec3.ZERO),ANIMATION.bounceScaleTo(l,.1,1,2),showTitle("NEW MISSION!"),o.entity.enabled=n,onUpdate(),s.start((function(){!function hideTitle(){t.enabled=!1}(),a.enabled=!1,s.start((function(){a.enabled=e.time}),.6)}),2)}),.5)}))}function showTitle(e){t.enabled=!0,fill(t,{text:e})}function hide(){l.enabled=!1}function onUpdate(){n&&o.setAmount(e.value,0,e.amount,!0)}function panOut(){ANIMATION.moveTo(l,new pc.Vec3(-1200,0,0)),delay(hide,.5)}getLocals(i),getLocals(o.entity),on("UI:onGame",hide),on("MISSION:Show",show),on("MISSION:Hide",hide),on("MISSION:onUpdate",onUpdate),on("MissionTime:onTimeUp",(function onTimeUp(){if(!ME.isAlive||"MissionTime:onSecond"==e.varName)return;a.enabled=!1,showTitle("Failed!"),ANIMATION.bounceScaleTo(l,.4,1,.6,EASING.SineInOut),s.start(panOut,2)})),on("MISSION:onComplete",(function onComplete(){a.enabled=!1,showTitle("COMPLETED!"),SFX.play("Achievement"),ANIMATION.bounceScaleTo(l,1.1,1),conquer.Haptic.heartBeat(),s.start(panOut,1),delay(show,2)})),hide()};var GameOverQuestBox=pc.createScript("gameOverQuestBox");GameOverQuestBox.prototype.initialize=function(){var e=this.entity,t=(getChildScript(e,"BarStars","barStarsProgress"),e.findByName("description")),r=e.findByName("Reward"),n=getScript(r,"motion");function onMissionUpdate(){e.enabled&&(QUEST.current?fill(t,{text:QUEST.current.text,value:QUEST.current.value+"/"+QUEST.current.amount}):log("NO QUEST CURRENT"))}getLocals(r),fill(e.findByName("Picture"),ME.vars),on("QUEST:RefreshBox",(function refresh(){if(onMissionUpdate(),!QUEST.currentReward)return void log("NO QUEST CURRENT REWARD!");fill(r,{symbol:QUEST.currentReward.symbol}),resetLocals(r),n.enabled=QUEST.tierSlot>=3})),on("MISSION:onUpdate",onMissionUpdate),this.onMouseDown=function(){QUEST.show()}};var BarStarsProgress=pc.createScript("barStarsProgress");BarStarsProgress.attributes.add("varName",{type:"string"}),BarStarsProgress.attributes.add("max",{type:"number",default:3}),BarStarsProgress.attributes.add("amount",{type:"number",default:0}),BarStarsProgress.attributes.add("skipAnimations",{type:"boolean"}),BarStarsProgress.prototype.initialize=function(){var t=this,e=t.entity;e.barScript=t;var a,r=[],n=e.findByName("Fill"),s=0,i=[],o=t.entity.findByName("Template");o.enabled=!1;var l=0,d=t.max;getLocals(n);var u=n.element.width,m=-u/2;if(t.setAmount=function(e,c,f){null!=c&&(s=c),f&&(d=f),l=clamp(e,d,s),a=u/d,n.element.width=l?l*a:0,function fillStars(){var e,n,s=d-1;for(;i.length>s;){var u=i.shift();r.push(u),u.enabled=!1}for(e=0;e<s;e++){(n=i[e])||((n=r.shift()||o.clone()).enabled=!0,i.push(n),addChild(n,t.entity)),n.setLocalPosition(m+a+a*e,0,0);var c=n.findByName("Active"),f=n.findByName("Inactive");f&&(f.enabled=!0),c&&(c.enabled=!0),e<=l-1&&(c&&(c.enabled=!0),f&&(f.enabled=!1),toFront(n))}if(!l)return;if(!(n=i[l-1])||t.skipAnimations)return;n.setLocalScale(2,2,2),ANIMATION.scaleTo(n)}()},t.increase=function(e){t.setAmount(l+(e||1))},t.decrease=function(e){t.setAmount(l-(e||1))},t.reset=function(e){t.setAmount(e||0)},!t.varName)return t.setAmount(0);onDataUpdate(t.varName,t.setAmount,t)};var ShopIapconfig=pc.createScript("shopIapconfig");ShopIapconfig.attributes.add("key",{title:"key",type:"string"}),ShopIapconfig.attributes.add("title",{title:"Tab Title",type:"string"}),ShopIapconfig.attributes.add("description",{title:"Description",type:"string"}),ShopIapconfig.attributes.add("platform",{title:"Platform Exclusive",type:"string",enum:[{SuperSnappy:"SuperSnappy"},{Azerion:"Azerion"},{Poki:"Poki"},{CrazyGames:"CrazyGames"},{VK:"VK"},{"All Platforms":"All Platforms"}],default:"All Platforms"}),ShopIapconfig.attributes.add("currency",{title:"Default Currency",type:"string",default:"USD"}),ShopIapconfig.attributes.add("price",{title:"Default Price",type:"number"}),ShopIapconfig.attributes.add("items",{type:"json",schema:[{title:"Key",name:"key",type:"string"},{title:"Title",name:"title",type:"string"},{title:"Description",name:"description",type:"string"},{title:"Value",name:"value",type:"string"},{title:"Variable",name:"variable",type:"string"},{title:"Amount",name:"amount",type:"number",default:0},{title:"Price",name:"price",type:"number",default:1.99},{title:"Currency",name:"currency",type:"string"},{title:"Symbol",name:"symbol",type:"string"},{title:"AD Timer",name:"timer",type:"number"},{title:"IAP ID",name:"iap",type:"string"}],array:!0}),ShopIapconfig.prototype.initialize=function(){var t=this;t.key||(t.key=t.entity.name),"All Platforms"==t.platform&&(t.platform=!1);let e={};for(let i in t.items){let r=t.items[i];r.type="IAP",r.price=r.price||t.price,r.currency=r.currency||t.currency,e[r.key]=r}CONFIG.add("SHOP.TABS."+t.key,{key:t.key,name:t.title,title:t.title,items:e,symbol:t.symbol,color:t.color,platform:t.platform,type:"IAP",description:t.description})};var PopupQuest=pc.createScript("popupQuest");PopupQuest.prototype.initialize=function(){var e=this,t=e.entity,r=getChildScript(t,"ProgressGallery","progresGallery"),i=t.findByName("Picture");fill(i,{userPhoto:ME.userPhoto}),SCREEN.call(e),e.onShow=function(){r.fill(QUEST.rewards,QUEST.percent)},e.onHide=function(){}};var ProgresGallery=pc.createScript("progresGallery");ProgresGallery.prototype.initialize=function(){var e=this.entity,r=getChildScript(e,"Gallery","gallery"),l=getChildScript(e,"GalleryNumbering","gallery"),t=e.findByName("Footer"),i=getChildScript(e,"Bar","bar");getLocals(t),this.fill=function(e,o){var a,s=e.length,c=copy(e),n=o*s;for(a=s-1;a>=0;a--)c[a].isUnlocked;c.reverse(),r.fill(c),t.setLocalPosition(t.pos.x,r.posY+r.entity.getLocalPosition().y,0);var y=[];for(a=s;a>0;a--)y.push({title:a,isUnlocked:a<=n});l.fill(y),i.setPercent(100*o,!0)}};var QuestHome=pc.createScript("questHome");QuestHome.prototype.initialize=function(){var e=this,r=e.entity,t=(getChildScript(r,"BarStars","barStarsProgress"),r.findByName("Reward")),o=getScript(t,"motion");function refresh(){QUEST.currentReward&&(fill(e,{symbol:QUEST.currentReward.symbol}),resetLocals(t),o.enabled=QUEST.tierSlot>=3)}getLocals(t),on("QUEST:RefreshBox",refresh),refresh()};function GridPathFinder(){var e=this,t=e.pool={},n=e.points={},r=0,o=0,i=0,l=0;e.cellSize=1,e.scan=function(t){e.clear();let n=getChildren(t);for(let t in n){let r=n[t],o=r.getLocalPosition();e.set(Math.round(o.x),Math.round(o.z),r)}e.createPath()},e.set=function(a,c,d){var u=e.key(a,c);if(!d)return e.delete(a,c);a>o&&(o=a),a<r&&(r=a),c>i&&(i=c),c<l&&(l=c),t[u]=d,n[u]||(n[u]=new pc.Vec2(a,c))},e.delete=function(r,o){delete t[e.key(r,o)],delete n[e.key(r,o)]},e.get=function(n,r){return t[e.key(n,r)]},e.getCellOfPosition=function(t){return{x:Math.round(t.x/e.cellSize),y:Math.round(t.z/e.cellSize)}},e.getPosition=function(t,n){return new pc.Vec3(t*e.cellSize,0,n*e.cellSize)},e.getSmoothPositon=function(t,n){let r=e.getPosition(t,n),o=e.cellSize/2,i=RANDOM.spectrumDecimal(o,-1*o),l=RANDOM.spectrumDecimal(o,-1*o);return r.x+=i,r.y+=l,r},e.getArray=function(t){var n,r=[];for(var o in t)(n=t[o])&&(n=e.get(n.x,n.y))&&r.push(n);return r},e.clear=function(){t=e.pool={},n=e.points={},r=o=i=l=0},e.key=function(e,t){return e+","+t};var a,c,d,u=e;e.getRandomAt=function(t,n,r,o,i){r=r||3,i||(i=0);var l=RANDOM.spectrum(r,o)+t,a=RANDOM.spectrum(r,o)+n,c=e.get(l,a);return++i>100?c:c?l==t&&a==n?e.getRandomAt(t,n,r,o,i):e.getPath({x:t,y:n},{x:l,y:a}):e.getRandomAt(t,n,r,o,i)},e.getRandomPosition=function(){return d.getRandomPosition()},e.getRandomRange=function(t,n){var r=RANDOM.spectrum(Math.round(t)),o=RANDOM.spectrum(Math.round(n)),i=e.get(r,o);return!i||r==t&&o==n?e.getRandomRange(t,n):i},e.clone=function(){var e=new Grid;ARRAY.extract(n,e.points),ARRAY.extract(t,e.pool)};var h=[],g=new Rect;function PathNode(e,t){var n,r,o=this,i=o.childs=[];o.key=u.key(e,t),o.x=e,o.y=t,o.level=0,o.reset=function(){o.level=999999999,n=g.hitTestPoint(o),r=!1},o.addChild=function(e){e&&i.push(e)},o.ripple=function(){o.setLevel(1),o.rippleChildren(!0)},o.setLevel=function(e){!n||o.level<=e||(o.level=e,r=!1)},o.rippleChildren=function(){if(n&&!r){var e;r=!0;var t=o.level+1;for(e in i)i[e].setLevel(t);for(e in i)i[e].rippleChildren()}},o.getCloser=function(){for(var e in i)if(i[e].level<o.level)return i[e];return o}}e.createPath=function(t={}){var r,o,i,l,a;for(r in d=e.pathNodes=new Grid,n)a=n[r],d.set(a.x,a.y,new PathNode(a.x,a.y));for(r in n)o=(a=n[r]).x,i=a.y,(l=d.get(o,i)).addChild(d.get(o-1,i)),l.addChild(d.get(o,i-1)),l.addChild(d.get(o,i+1)),l.addChild(d.get(o+1,i)),t.ignoreDiagonals||(l.addChild(d.get(o-1,i-1)),l.addChild(d.get(o+1,i-1)),l.addChild(d.get(o-1,i+1)),l.addChild(d.get(o+1,i+1)))},e.getForced=function(t){return e.get(MATH.clamp(t.x,o,r),MATH.clamp(t.y,i,l))},e.getPathnodeForced=function(e){var t=MATH.clamp(e.x,o,r),n=MATH.clamp(e.y,i,l);return d.get(t,n)},e.getPath=function(t,n){if(a=e.getPathnodeForced(t),c=e.getPathnodeForced(n),h=[],!a||!c||a==c)return!1;var r;for(r in g.left=Math.min(a.x,c.x)-10,g.right=Math.max(a.x,c.x)+10,g.bottom=Math.min(a.y,c.y)-10,g.top=Math.max(a.y,c.y)+10,d.pool)d.pool[r].reset();c.ripple();var o=a,i=100;for(h.push(a);o!=c&&--i>0&&(o=o.getCloser(),h[h.length-1].key!=o.key);)h.push(o);return h}}var KEYBOARD,Keyboard=pc.createScript("keyboard");Keyboard.prototype.initialize=function(){var o=this,e=o.entity;KEYBOARD=o;var r=getChildrenNames(e);for(var n in r)r[n]=r[n].script.keyboardButton;o.onMouseDown=function(o){var e=o.label;fire("KEYBOARD:onKey",e,o)},o.changeColor=function(o,e){o=o.toUpperCase(),r[o]&&r[o].changeColor(e)},o.resetColors=function(){for(let o in r)r[o].changeColor()}};var KeyboardButton=pc.createScript("keyboardButton");KeyboardButton.prototype.initialize=function(){var e=this,t=e.entity,o=t.findByName("Mesh"),n=t.findByName("textField");function changeColor(e){let t="GRAY_DARK_1",a="WHITE";"ORANGE"==e&&(t="RED_DARK",a="WHITE"),"GREEN"==e&&(t="GOLD",a="BLACK"),"GRAY"==e&&(t="GRAY",a="#C2E7F3"),o&&fillMaterial(o,t),n&&(n.element.color=COLOR.get(a))}BUTTON.call(e),fill(t,{text:t.name}),e.skipAnimation=!1,changeColor(),e.changeColor=changeColor};var GRIDBOARD,GridBoard=pc.createScript("gridBoard");GridBoard.prototype.initialize=function(){var e=this,t=e.entity,i=new EntityPool(t.findByName("Template"),"gridPiece");GRIDBOARD=e,GRIDPIECES.init();var n=e.CONFIG=CONFIG.GRIDBOARD.BOARD;getLocals(t);var o=e.grid=e.GRID=new Grid(n.size.x,n.size.y);o.setMargins(n.margins.x,n.margins.y*(n.invertY?-1:1)),e.spawn=function(e,t,n){return i.get({key:o.key(e,t),pieceID:n})},e.set=function(e){addChild(e.entity,t),e.entity.setLocalPosition(o.getPosition(e.x,e.y))};var r=e.FILL={};r.load=function(t){t=copy(t||[]),layout=e.layout=GRIDBOARDLAYOUTS.get();let i=n.size;for(var r=0;r<i.y;r++)for(let n=0;n<i.x;n++)e.spawn(n,r,t.shift());"Collapse"==n.type&&a.islands(),"Match3"==n.type&&a.avoidLines(),o.enable()},r.refill=function(){let t=o.getGravityPaths(CONFIG.diagonalGravity).newSpawns;for(var i in t)e.spawn(t[i].x,t[i].y)};var l=e.GRAVITY={};l.do=function(e){if(f.set(),l.stop(),o.disable(),!e)return doGravity();function doGravity(){r.refill(),o.gravity(),delay((function(){c.kickY(),SFX.play("AfterGravity",{volume:.2});for(let e in o.pool)o.pool[e].ANIMATE.bounce();"Collapse"==n.type?a.islands():o.refresh(),delay((function(){s.onGravity()}),.3)}),.2)}unique("GBGravity",doGravity,e)},l.stop=function(){cancel("GBGravity")};var a=e.MATCH={};a.islands=function(){let e=o.getIslands();for(let t in e){let i=e[t],n=GRIDPIECES.getSpawn(i);for(let e in i)i[e].refresh({nextSpawn:n})}},a.lines=function(){return o.getLineMatches()},a.avoidLines=function(){let e=a.lines();for(let t in e)for(let i in e[t]);};var s=e.EXPLODE={};s.selection=function(e,t){for(let t in e)e[t].EXPLODE.do();let i=GRIDBOARD.GRID.getShore(e,!0);for(let e in i)i[e].EXPLODE.do();GRIDBOARD.GRAVITY.do(t)},s.onGravity=function(){if("Match3"==n.type)return s.lines();let e=o.getProperty("explodeOnGravity",!0).shift();if(!e)return o.enable();o.disable(),delay((function(){e.EXPLODE.do()}),.3)},s.lines=function(e){let t=a.lines();if(!t.length)return o.enable();o.disable();let i={},n=[],r={};for(let e in t){let o=t[e],l=GRIDPIECES.getSpawn(o);if(l){let e=o.indexOf(GRIDSELECTION.lastPiece),t=o[e]||getRandomItem(o);for(let e in o)r[o[e].key]=!0;n.push({line:o,nextSpawn:l,piece:t})}else for(let e in o)i[o[e].key]=o[e]}for(let e in r)delete i[e];s.selection(ARRAY.fromObject(i),.3);for(let e in n){let t=n[e];t.piece.morph(t.line,t.nextSpawn)}return!0};var c=e.ANIMATE={};c.kickY=function(e){c.kickXY(0,e||-5)},c.kickX=function(e,t){c.kickXY(e||-5,t)},c.kickXY=function(e,i){ANIMATION.kickXY(t,null,e,i)};var f=e.SCORING={};f.score=0,f.set=function(){SCORE.increase(f.score),f.score=0},f.increase=function(e){f.score+=e||1},n.preFill&&r.load()};var ShopLayoutConfig=pc.createScript("shopLayoutConfig");ShopLayoutConfig.attributes.add("overwrite",{title:"Save to DB",type:"boolean",default:!1}),ShopLayoutConfig.attributes.add("tabs",{type:"json",schema:[{title:"Tab Key",name:"tabKey",type:"string"},{title:"ShopItem Keys",name:"shopItemKeys",type:"string"},{title:"Title",name:"title",type:"string"},{title:"Layout",name:"layout",type:"string",default:"Tall",enum:[{Tall:"Tall"},{Triad:"Triad"},{Square:"Square"},{Single:"Single"}]}],array:!0}),ShopLayoutConfig.prototype.initialize=function(){var t=this;for(let e in t.tabs)t.tabs[e].shopItemKeys=STRING.getArray(t.tabs[e].shopItemKeys);CONFIG.add("SHOP",{overwrite:t.overwrite}),CONFIG.add("SHOPLAYOUT",t.tabs)};var LadderButton=pc.createScript("ladderButton");LadderButton.prototype.initialize=function(){var a=this,t=a.entity;BUTTON.call(a);var e,i,n=t.findByName("Rival"),l=t.findByName("Me");l.setLocalPosition(0,0,0),n.setLocalPosition(0,0,0),a.fill=function(t){a.data=t,n.enabled=l.enabled=!1,i=t.avatarID==ME.avatarID,(e=i?l:n).enabled=!0,fill(e,a.data),i&&delay((function(){ANIMATION.moveTo(e,new pc.Vec3(0,28,0),2,EASING.ElasticOut)}),1)}};var TutorialConfig=pc.createScript("tutorialConfig");TutorialConfig.prototype.postInitialize=function(){var t=this.entity,i=[],r=getChildren(t);for(var o in r){var a=getScript(r[o],"tutorialStepConfig");a&&i.push(a.get())}CONFIG.add("TUTORIAL",i)};var LootConfig=pc.createScript("lootConfig");LootConfig.attributes.add("rank",{title:"Rank",type:"string",default:"Common",enum:[{Common:"Common"},{Rare:"Rare"},{Epic:"Epic"},{Legendary:"Legendary"},{Progression:"Progression"}]}),LootConfig.attributes.add("cards",{title:"Cards Amount",type:"number",default:9}),LootConfig.attributes.add("shopItems",{title:"ShopItem Values",type:"string"}),LootConfig.attributes.add("currencies",{title:"Currencies",type:"json",schema:[{title:"Currency",name:"currency",type:"string",default:"Coin"},{title:"Amount",name:"amount",type:"number"}],array:!0}),LootConfig.attributes.add("odds",{title:"Draw Odds",type:"json",schema:[{title:"Common",name:"common",type:"number",enum:[{"0%":0},{"5%":5},{"10%":10},{"15%":15},{"20%":20},{"25%":25},{"30%":30},{"35%":35},{"45%":45},{"50%":50},{"75%":75}]},{title:"Rare",name:"rare",type:"number",enum:[{"0%":0},{"5%":5},{"10%":10},{"15%":15},{"20%":20},{"25%":25},{"30%":30},{"35%":35},{"45%":45},{"50%":50},{"75%":75}]},{title:"Epic",name:"epic",type:"number",enum:[{"0%":0},{"5%":5},{"10%":10},{"15%":15},{"20%":20},{"25%":25},{"30%":30},{"35%":35},{"45%":45},{"50%":50},{"75%":75}]},{title:"Legendary",name:"legendary",type:"number",enum:[{"0%":0},{"5%":5},{"10%":10},{"15%":15},{"20%":20},{"25%":25},{"30%":30},{"35%":35},{"45%":45},{"50%":50},{"75%":75}]}]}),LootConfig.attributes.add("guaranteed",{title:"Guaranteed",type:"json",schema:[{title:"Common",name:"common",type:"number"},{title:"Rare",name:"rare",type:"number"},{title:"Epic",name:"epic",type:"number"},{title:"Legendary",name:"legendary",type:"number",default:0}]}),LootConfig.prototype.postInitialize=function(){var e=this;let t=e.entity.name;var n=e.odds,r=e.guaranteed,o={};for(var a in e.currencies)o[e.currencies[a].currency]=e.currencies[a].amount;var i={key:t,cards:e.cards,shopItems:STRING.getArray(e.shopItems),type:"Loot",currencies:o,odds:[n.common,n.rare,n.epic,n.legendary],guaranteed:[r.common,r.rare,r.epic,r.legendary]};if(CONFIG.SHOP.TABS.Loot)for(let e in CONFIG.SHOP.TABS.Loot.items)if(e==t){CONFIG.SHOP.TABS.Loot.items[e].value=i;break}};var SKYBOX=new function(){var e=this;let n,o;function preloading(){o.resources.length<7||(stop(preloading),APP.scene.setSkybox(o.resources))}e.show=function(e){if(!e){if(!n)return;return n=!1,APP.scene.setSkybox(!1)}if(n!=e){if(stop(preloading),n=e,!e)return APP.scene.setSkybox(!1);ASSETS.load(e+"_Skybox",null,(function(r){e==n&&r.resources&&(o=r,start(preloading))}))}},e.set=e.show};var ScoringConfig=pc.createScript("scoringConfig");ScoringConfig.attributes.add("maxScore",{title:"Max Possible Score",type:"number",default:0}),ScoringConfig.attributes.add("scorePerMinute",{title:"Score per Minute",type:"number",default:10}),ScoringConfig.attributes.add("scoreToCoins",{title:"Score to Coins",type:"number",default:0}),ScoringConfig.attributes.add("canWinGame",{title:"Can Win Game",type:"boolean"}),ScoringConfig.prototype.postInitialize=function(){CONFIG.add("GAME.SCORING",this)};var EffectPrettyGestureInput=pc.createScript("effectPrettyGestureInput");EffectPrettyGestureInput.prototype.initialize=function(){this.drawing=void 0,this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this)},EffectPrettyGestureInput.prototype.onMouseDown=function(t){t.button===pc.MOUSEBUTTON_LEFT&&(this.drawing=!0,this.addGesturePoint(t.x,t.y))},EffectPrettyGestureInput.prototype.onMouseMove=function(t){this.drawing&&this.addGesturePoint(t.x,t.y)},EffectPrettyGestureInput.prototype.onMouseUp=function(t){this.drawing=!1,EffectPrettyGestures.api.clearPoints()},EffectPrettyGestureInput.prototype.addGesturePoint=function(t,e){EffectPrettyGestures.api.addPoint(t,e)};var AbtestsConfig=pc.createScript("abtestsConfig");AbtestsConfig.attributes.add("items",{type:"json",schema:[{name:"id",type:"string"},{name:"newPlayersOnly",type:"boolean",default:!1},{name:"active",type:"boolean",default:!0}],array:!0}),AbtestsConfig.prototype.initialize=function(){var e={"0000_placebo_2":{active:!0,buckets:[{id:"a"},{id:"b"}],default:"a",newPlayersOnly:!1},"0000_placebo_3":{active:!0,buckets:[{id:"a"},{id:"b"},{id:"c"}],default:"a",newPlayersOnly:!1},"0000_placebo_4":{active:!0,buckets:[{id:"a"},{id:"b"},{id:"c"},{id:"d"}],default:"a",newPlayersOnly:!1},"0000_placebo_5":{active:!0,buckets:[{id:"a"},{id:"b"},{id:"c"},{id:"d"},{id:"e"}],default:"a",newPlayersOnly:!1}};for(var a in this.items){var t=this.items[a];t.active&&(e[t.id]={active:!0,default:"Control",newPlayersOnly:t.newPlayersOnly,buckets:[{id:t.id.split("_")[1]},{id:"Control"}]})}CONFIG.add("ABTESTS",e)};var EffectPrettyGestures=pc.createScript("effectPrettyGestures");EffectPrettyGestures.attributes.add("brushColor",{type:"rgba",default:[1,1,1,1]}),EffectPrettyGestures.attributes.add("brushSize",{type:"number",default:30}),EffectPrettyGestures.attributes.add("brushCap",{type:"string",default:"round",enum:[{butt:"butt"},{round:"round"},{square:"square"}]}),EffectPrettyGestures.prototype.initialize=function(){EffectPrettyGestures.api=this,this.vec=new pc.Vec2,this.canvas=void 0,this.ctx=void 0,this.texture=void 0,this.points=void 0,this.fadeFactor=void 0,this.fadeSpeed=1,this.prepare(),this.app.graphicsDevice.on("resizecanvas",this.prepareCanvas,this)},EffectPrettyGestures.prototype.prepare=function(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");const t=this.canvas.style;t.zIndex=100,t.position="relative",t.pointerEvents="none",document.body.appendChild(this.canvas),this.prepareCanvas(),this.clearPoints()},EffectPrettyGestures.prototype.prepareCanvas=function(){const t=this.app.graphicsDevice;this.canvas.width=t.canvas.width,this.canvas.height=t.canvas.height},EffectPrettyGestures.prototype.addPoint=function(t,e){this.fadeFactor&&(this.fadeFactor=void 0,this.points=[]),this.points.push(new pc.Vec2(t,e)),this.updateCanvas()},EffectPrettyGestures.prototype.clearPoints=function(){this.fadeFactor=void 0,this.points=[],this.updateCanvas()},EffectPrettyGestures.prototype.updateCanvas=function(t){const e=this.canvas,s=this.ctx;s.clearRect(0,0,e.width,e.height);const i=this.points;if(i.length<2)return;let r=i[0],a=i[1];s.beginPath(),s.moveTo(r.x,r.y),s.lineWidth=this.brushSize,s.lineJoin=this.ctx.lineCap=this.brushCap;const o=pc.math.clamp(void 0!==t?t:1,0,this.brushColor.a);s.strokeStyle=this.getBrushColor(o);for(let t=1,e=i.length;t<e;t++){const e=this.getMidPoint(r,a);s.quadraticCurveTo(r.x,r.y,e.x,e.y),r=i[t],a=i[t+1]}s.lineTo(r.x,r.y),s.stroke()},EffectPrettyGestures.prototype.getMidPoint=function(t,e){return this.vec.copy(t).lerp(t,e,.5)},EffectPrettyGestures.prototype.getBrushColor=function(t){const e=this.brushColor;return`rgba(${255*e.r}, ${255*e.g}, ${255*e.b}, ${t})`},EffectPrettyGestures.prototype.fadeOutPoints=function(t){this.fadeFactor=1,t&&(this.fadeSpeed=t)},EffectPrettyGestures.prototype.update=function(t){this.fadeFactor&&(this.fadeFactor-=t*this.fadeSpeed,this.updateCanvas(this.fadeFactor),this.fadeFactor<=0&&this.clearPoints())};var AlphaOcclusion=pc.createScript("alphaOcclusion");AlphaOcclusion.attributes.add("resetEvent",{type:"string",default:"AlphaOcclusion"}),AlphaOcclusion.prototype.initialize=function(){var e=this,n=e.entity,t=n.findByName("Solid"),i=n.findByName("Transparent");function reset(){t.enabled=!0,i.enabled=!1}new Collider(e,(function onEnter(e,n){if("AlphaOcclusion"!=e)return;t.enabled=!1,i.enabled=!t.enabled}),(function onExit(e,n){if("AlphaOcclusion"!=e)return;reset()})),on(e.resetEvent,reset),reset()};var IapButton=pc.createScript("iapButton");IapButton.prototype.initialize=function(){var e,n=this,o=n.entity;BUTTON.call(n);o.findByName("Timer");var t=o.findByName("Notification"),i=o.findByName("priceField"),l=o.findByName("daysField"),c=o.findByName("Sold"),r=o.findByName("currSymbolTexture");function refreshSold(){if(!c)return;let n=GAME.Inventory.getItem(e.key);n&&(c.enabled=!n.isLocked)}function onSecond(n){e.canCollect||(l.enabled=!0,l.element.text=DATE.days(n))}c&&(c.enabled=!1),getLocals(i),n.click=function(){if(ANIMATION.click(n.entity),!c||!c.enabled){if(e.canCollect)return ADPLAYER.playRewarded((function(e){e&&doBuy()}));doBuy()}function doBuy(){if(!e.canCollect){var n=WALLET[e.currency];if(!n)return;if(n.value<e.price)return UPSALE.noCoins()}e.buy().then((function(n){log("RESULT OF BUYING",n),n&&(WALLET[e.variable]&&WALLET[e.variable].collect(e.amount),"Lootbox"==e.variable&&SCREENS.show("OpenLoot",{loot:n}),refreshSold())}))}},n.fill=function(o){n.remove(),l.enabled=!1,fill(n,o),"TimeWarp"==(e=o).value&&(e.description=IDLE.getHourlyProduction(e.amount)),e.onRefresh=function(){n.fill(e),l.enabled=!e.canCollect},resetLocals(i),t&&(t.enabled=e.canCollect),e.timer&&on(e.key+"Timer:onSecond",onSecond);let c=CONFIG.WALLET[e.currency]?CONFIG.WALLET[e.currency].color:"RED";e.canCollect&&(c="RED"),r.element.color=COLOR.get(c),refreshSold()},n.remove=function(){e&&e.timer&&off(e.key+"Timer:onSecond",onSecond)}};var GAMEPLAYERS,GamePlayers=pc.createScript("gamePlayers");GamePlayers.attributes.add("className",{title:"Class",type:"string",default:"playerDisplayer"}),GamePlayers.prototype.initialize=function(){var t=this;GAMEPLAYERS=t;var e,a=t.entity,s=new EntityPool(getChild(a,"Template"),t.className,a);function spawn(t){var a=PLAYERS.get(t);return position=e.getPosition(),a.vars.spawn.x=position.x,a.vars.spawn.y=position.y,a.vars.spawn.z=position.z,s.get(a)}function reset(){s.reset(),e&&e.reset()}function updateSpawnPositions(t){t||(t=a),e=getChildScript(t,"SpawnPositions","spawnPositions")}t.fill=function(){for(var t in reset(),SOCKET.data.players)spawn(SOCKET.data.players[t])},t.remove=function(t){s.remove(t)},t.reset=reset,t.updateSpawnPositions=updateSpawnPositions,updateSpawnPositions(a)};var ScreenSpectating=pc.createScript("screenSpectating");ScreenSpectating.prototype.initialize=function(){var t=this;t.entity;function refresh(){SOCKET.data.status==SOCKET.STATUS.LOBBY&&GAME.home()}SCREEN.call(t),t.onShow=function(){on("SOCKET:onStatus",refresh)},t.onHide=function(){off("SOCKET:onStatus",refresh)}};var SmartButton=pc.createScript("smartButton");SmartButton.attributes.add("event",{type:"string"}),SmartButton.attributes.add("eventValue",{type:"string"}),SmartButton.attributes.add("skipAnimation",{type:"boolean",default:!1}),SmartButton.attributes.add("isMute",{type:"boolean",default:!1}),SmartButton.attributes.add("clickVertical",{type:"boolean",default:!1}),SmartButton.attributes.add("sound",{type:"string",default:"Button"}),SmartButton.attributes.add("dontCommarize",{type:"boolean",default:!1}),SmartButton.prototype.initialize=function(){var t=this,e=t.entity,a=e.findByName("Symbol"),n=e.findByName("Text"),i=e.findByName("SymbolText");a.enabled=n.enabled=i.enabled=!1,BUTTON.call(t),t.fill=function(e){var o=function getCompo(e){if(t.data=e,a.enabled=n.enabled=i.enabled=!1,e.text&&e.symbol)return i;if(e.text)return n;if(e.symbol)return a}(e);o&&(o.enabled=!0,o==i&&alignText(o),fill(o,e))}};function GalleryButtonScript(t,n){var e=this;e.entity=null;var o=e.data=n,i=1,c=e.rot=new pc.Vec3,u=e.position=new pc.Vec3,l=1,s=1,a=!1,f=e.button=null;function onMouseDown(){t.onMouseDown(e)}function updateEntity(){e.entity&&(e.entity.setLocalPosition(u),e.entity.setLocalEulerAngles(c),e.entity.setLocalScale(l,l,l))}e.show=function(){a||(a=!0,e.entity=t._unused.shift()||t.Template.clone(),addChild(e.entity,t.entity),(f=e.button=e.entity.buttonScript).fill(n),f.onMouseDown=onMouseDown,i=f.scale.x,l=i*s,updateEntity())},e.refresh=function(){f&&f.refresh&&f.refresh()},e.hide=function(){a&&(a=!1,removeChild(e.entity),t._unused.push(e.entity),cancel("button"+o.id))},e.remove=function(){e.entity&&e.entity.destroy()},e.select=function(){e.show(),f.select()},e.deselect=function(){e.show(),f.deselect()},e.click=function(){e.show(),f.click()},e.fill=function(t){e.data=t,e.show(),f.fill(t)},e.setLocalPosition=function(t,n,e){u.x=t,u.y=n,u.z=e,updateEntity()},e.setLocalScale=function(t){s=t,l=t*i,updateEntity()},e.setLocalEulerAngles=function(t,n,e){c.x=t,c.y=n,c.z=e,updateEntity()},e.animateIn=function(t){e.hide(),DELAY.unique("button"+o.id,(function(){e.show(),ANIMATION.bounceScaleTo(e.entity,.3*l,l,.6)}),t)},t.autoShow&&e.show()}var EASING=new function(){var c=this;c.Linear=pc.Linear,c.QuadraticIn=pc.QuadraticIn,c.QuadraticOut=pc.QuadraticOut,c.QuadraticInOut=pc.QuadraticInOut,c.CubicIn=pc.CubicIn,c.CubicOut=pc.CubicOut,c.CubicInOut=pc.CubicInOut,c.QuarticIn=pc.QuarticIn,c.QuarticOut=pc.QuarticOut,c.QuarticInOut=pc.QuarticInOut,c.QuinticIn=pc.QuinticIn,c.QuinticOut=pc.QuinticOut,c.QuinticInOut=pc.QuinticInOut,c.SineIn=pc.SineIn,c.SineOut=pc.SineOut,c.SineInOut=pc.SineInOut,c.ExponentialIn=pc.ExponentialIn,c.ExponentialOut=pc.ExponentialOut,c.ExponentialInOut=pc.ExponentialInOut,c.CircularIn=pc.CircularIn,c.CircularOut=pc.CircularOut,c.CircularInOut=pc.CircularInOut,c.ElasticIn=pc.ElasticIn,c.ElasticOut=pc.ElasticOut,c.ElasticInOut=pc.ElasticInOut,c.BackIn=pc.BackIn,c.BackOut=pc.BackOut,c.BackInOut=pc.BackInOut,c.BounceIn=pc.BounceIn,c.BounceOut=pc.BounceOut,c.BounceInOut=pc.BounceInOut};var ANIMATION=new function(){var e,t,n=this;n.play=function(e,t,n){if(e&&e.animation){var o,i=t+".json",a=e.animation,c=a.animations,l=n||1;tryPlay()||fixed((function loop(){tryPlay()&&stop(loop)}))}function tryPlay(){if(o=function search(){if(c[i])return i;var e=[];for(var n in c)n.includes(t)&&e.push(n);if(e.length)return ARRAY.getRandomItem(e)}())return a.play(o),a.speed=l,!0}},n.playSpine=function(e,t){if(e&&e.spine){var n=t||"Animation";return e.spine.spine.priority=2,e.spine.state.setAnimation(0,n,!0),e.spine.spine.skeleton.setSkinByName("default"),e.spine.spine.skeleton.setSlotsToSetupPose(),e.spine.spine}},n.stopSpine=function(e){e&&e.spine&&e.spine.state.stop(0)},n.varsTo=function(e,t,n,o,i,a,c){if(e){n=n||.5,o=o||EASING.SineInOut;var l=APP.tween(e).to(t,n,o);return i&&l.on("update",(function(){i(e)})),a&&l.on("complete",(function(t){a(e)})),c&&l.loop(),l.start(),l}},n.entityTo=function(e,t,n,o,i,a){if(e){var c=n||{x:1,y:1,z:1},l=o||.5,s=i||EASING.CircularInOut,r=e.tween(t).to(c,l,s);return a&&delay(a,l),r.start()}},n.moveTo=function(e,t,o,i,a){if(e)return n.entityTo(e,e.getLocalPosition(),t,o,i,a)},n.moveToRB=function(e,t,o,i,a){if(e){var c=e.getPosition(),l={x:c.x,y:c.y,z:c.z},s={x:t.x,y:t.y,z:t.z},r=e.rigidbody||e.rb,u=r.type;r.type="kinematic",n.varsTo(l,s,o,i,(function onUpdate(){r.teleport(l.x,l.y,l.z)}),(function onComplete(){r.type=u,a&&a()}))}},n.moveToGlobal=function(e,t,o,i,a){if(!e)return;var c=getPosition(e);return n.varsTo(c,t,o,i,(function onUpdate(){e.setPosition(c.x,c.y,c.z)}),(function onComplete(){e.setPosition(t.x,t.y,t.z),a&&a(e)}))},n.rotateToGlobal=function(e,t,o,i){if(!e)return;var a=getEulerAngles(e);return n.varsTo(a,t,o,i,(function onUpdate(){e.setEulerAngles(a.x,a.y,a.z)}),(function onComplete(){e.setEulerAngles(t.x,t.y,t.z)}))},n.rotateTo=function(e,t,n,o,i){if(e){t=t||pc.Vec3.ZERO,n=n||.5,o=o||pc.SineInOut;var a=e.tween(e.getLocalEulerAngles()).rotate(t,n,o).on("complete",i);return a.start(),a}},n.rotateToRB=function(e,t,o,i,a){if(e){var c=e.getEulerAngles(),l={x:c.x,y:c.y,z:c.z},s={x:t.x,y:t.y,z:t.z},r=e.rigidbody,u=r.type;r.angularVelocity=pc.Vec3.ZERO,r.linearVelocity=pc.Vec3.ZERO,r.type="kinematic",n.varsTo(l,s,o,i,(function onUpdate(){var t=e.getPosition();r.teleport(t.x,t.y,t.z,l.x,l.y,l.z)}),(function onComplete(){r.linearVelocity=pc.Vec3.ZERO,r.type=u}))}},n.bounceAngle=function(e,t,n,o,i,a){if(e){i=i||1,o=o||ARRAY.getRandomItem(["x","y","z"]);var c=60*i,l=c;n=n||15;var s=(t=t||(e.rot||e.getLocalEulerAngles()).clone())[o],r=a||decimal();fixed(update),delay((function onComplete(){e.setLocalEulerAngles(t),stop(update)}),i)}function update(){r+=.2;var t=MATH.getPercent(--c,l)/100,i=e.getLocalEulerAngles().clone();i[o]=s+Math.cos(r)*n*t,e.setLocalEulerAngles(i)}},n.bounceAngleZ=function(e,t,n,o){if(e){t=t||15;var i=60*(n=n||1),a=i,c=(e.rot||e.getLocalEulerAngles()).clone(),l=c.z,s=o||decimal();fixed(update),delay((function onComplete(){e.setLocalEulerAngles(c),stop(update)}),n)}function update(){s+=.2;var n=MATH.getPercent(--i,a)/100,o=e.getLocalEulerAngles().clone();o.z=l+Math.cos(s)*t*n,e.setLocalEulerAngles(o)}},n.moveAndRotateToEntity=function(e,t,o,i){e&&t&&n.moveAndRotateGlobal(e,t.getPosition(),t.getEulerAngles(),o,i)},n.moveAndRotateGlobal=function(e,t,o,i,a){e&&(n.moveToGlobal(e,t,i,a),n.rotateToGlobal(e,o,i,a))},n.moveAndRotateTo=function(e,t,o,i,a){e&&(n.moveTo(e,t,i,a),n.rotateTo(e,o,i,a))},n.scaleTo=function(e,t,o,i,a){if(e)return n.entityTo(e,e.getLocalScale(),t,o,i,a)},n.shrink=function(e,t,o,i){e&&(t=t||.6,n.scaleTo(e,pc.Vec3.ZERO,t,o),delay((function(){e.enabled=!1,i&&i()}),t))},n.grow=function(e,t,o){e&&(t=t||.6,e.setLocalScale(0,0,0),n.scaleTo(e,e.sca||new pc.Vec3(1,1,1),t,o))},n.click=function(e,t){e&&(t=t||{x:1,y:1,z:1},e.setLocalScale(.85*t.x,.85*t.y,.85*t.z),ANIMATION.scaleTo(e,t,.7,EASING.ElasticOut))},n.pulse=function(e,t){if(e){e.sca||getLocals(e);var n=e.sca.clone(),o=t||1.1;n.x*=o,n.y*=o,n.z*=o,e.setLocalScale(n),ANIMATION.scaleTo(e,e.sca,.7,EASING.ElasticOut)}},n.clickVertical=function(e,t){if(e){var n=t||{x:1,y:1,z:1};e.setLocalScale(.95*n.x,.85*n.y,n.z),ANIMATION.scaleTo(e,n,.8,EASING.ElasticOut)}},n.bounceScale=function(e,t,n,o,i,a,c){if(e){var l=60*(a=a||1),s=l,r=(n=null!=n?n:.1,o=null!=o?o:.1,i=null!=i?i:.1,e.sca||e.getLocalScale()),u=(t=t||e.sca||{x:r.x,y:r.y,z:r.z},c||0);fixed(update),delay((function onComplete(){e&&e.setLocalScale(t.x,t.y,t.z);stop(update)}),a+.1)}function update(){if(e){u+=.2;var a=MATH.getPercent(--l,s)/100,c=Math.cos(u)*n*a,r=Math.cos(u)*o*a,f=Math.cos(u)*i*a;e.setLocalScale(t.x+c*t.x,t.y+r*t.y,t.z+f*t.z)}}},n.bounceScaleTo=function(e,t,o,i,a,c){if(e){e.enabled=!0;var l=t||.5,s=o||1;return e.setLocalScale(l,l,l),n.scaleTo(e,new pc.Vec3(s,s,s),i||.8,a||EASING.ElasticOut,c)}},n.fadeTo=function(e,t,o,i){if(e){var a={opacity:n.getOpacity(e)};return n.varsTo(a,{opacity:t},o||.6,i||EASING.SineOut,(function(t){n.setOpacity(e,a.opacity)}))}},n.setOpacity=function(e,t){if(e){if(e.model&&e.model.meshInstances)for(var n in e.model.meshInstances)e.model.meshInstances[n].setParameter("material_opacity",t);e.element&&(e.element.opacity=t),e.sprite&&(e.sprite.opacity=t)}},n.getOpacity=function(e,t){if(e)return e.sprite?e.sprite.opacity:e.element?e.element.opacity:e.model&&e.model.meshInstances?e.model.meshInstances[0].material.opacity:1},n.fadeIn=function(e,t,o,i){if(e)return n.setOpacity(e,0),n.fadeTo(e,i||1,t,o)},n.fadeOut=function(e,t,o){if(e)return n.fadeTo(e,0,t,o)},n.fadeFromTo=function(e,t,o,i,a){if(e)return n.setOpacity(e,t),n.fadeTo(e,o,i,a)},n.fadeInOut=function(e,t,o,i){e&&(n.fadeIn(e,t,o,i),delay((function(){n.fadeOut(e,t,o)}),t))},n.fadeOutIn=function(e,t,o){e&&(n.fadeOut(e,t,o),delay((function(){n.fadeIn(e,t,o)}),t))},n.emissiveFromTo=function(e,t,o,i,a,c){if(e){var l={to:t};return n.setEmissive(e,t),n.varsTo(l,{to:o},i||.6,a||EASING.SineOut,(function(t){n.setEmissive(e,l.to,c)}))}},n.setEmissive=function(e,t,n){if(!e)return;if((!e.model||e.model.meshInstances)&&(!e.render||!e.render.meshInstances))return;let o=[];for(var i in e.model&&e.model.meshInstances&&(o=e.model.meshInstances),(e.render||e.render.meshInstances)&&(o=e.render.meshInstances),o){var a=o[i],c=a.material;c._hasEmissive||(c._hasEmissive=c.emissive=n||pc.Color.WHITE),c.emissive.set(1,0,0),c.update(),a.setParameter("material_emissiveIntensity",t)}},n.emissiveIn=function(e,t,o,i,a){if(e)return n.emissiveFromTo(e,0,i||.6,t,o,a)},n.emissiveOut=function(e,t,o,i,a){if(e)return n.emissiveFromTo(e,i||.6,0,t,o,a)},n.emissiveInOut=function(e,t,o,i,a){if(e){var c=.3*t;n.emissiveIn(e,c,o,i,a),delay((function(){n.emissiveOut(e,.7*t,o,i,a)}),c)}},n.blink=function(e,t,n,o,i){if(e){var a=0,c=t||10;!function loop(){if(a<c)return e.enabled=!e.enabled,e.enabled&&a++,void delay(loop,n||.05);e.enabled=!o}()}},n.blinkLight=function(e,t,n,o){if(e){var i=0,a=t||10,c=e.light,l=n||c.intensity,s=!1;!function loop(){if(i<a)return(s=!s)&&i++,c.intensity=s?25:1,void delay(loop,o||.2);c.intensity=l}()}},n.shake=function(e,t,n,o,i){if(e){var a=1;t=t||e.pos||getLocalPosition(e).clone(),n=null!=n?n:40,o=null!=o?o:40,i=i||.5,fixed(shakingScreen),delay((function shakeEnd(){stop(shakingScreen),e.setLocalPosition(t)}),i);var c=t.x+spectrumDecimal(n),l=t.y+spectrumDecimal(o),s=!0,r=new pc.Vec3(c,l,t.z)}function shakingScreen(){a+=.04,(s=!s)&&(r.x=t.x+spectrumDecimal(n/a),r.y=t.y+spectrumDecimal(o/a)),c+=(r.x-c)/1.5,l+=(r.y-l)/1.5,e.setLocalPosition(c,l,t.z)}},n.shake3D=function(e,t,o,i,a,c){if(e){var l=1;t=t||e.pos||getLocalPosition(e),o=null!=o?o:.1,i=null!=i?i:.1,a=null!=a?a:.1,c=c||.5;fixed(shakingScreen),delay((function shakeEnd(){stop(shakingScreen),n.moveTo(e,t,.2)}),c)}function shakingScreen(){l+=.04;var n=t.x+spectrumDecimal(o/l),c=t.y+spectrumDecimal(i/l),s=t.z+spectrumDecimal(a/l);e.setLocalPosition(n,c,s)}},n.alert=function(e){n.bounceScaleTo(e,.6,1,2),n.shakeIncrease(e)},n.shakeIncrease=function(e,t,n,o,i){if(e){var a=1;t=t||e.pos||getLocalPosition(e),n=null!=n?n:5,o=null!=o?o:5,i=i||1,fixed(shakingScreen),delay((function shakeEnd(){stop(shakingScreen),e.setLocalPosition(t)}),i)}function shakingScreen(){a+=.04;var i=t.x+spectrumDecimal(n*a),c=t.y+spectrumDecimal(o*a);e.setLocalPosition(i,c,t.z)}},n.kickY=function(e,t,o){n.kickXY(e,t,0,o||-1)},n.kickZ=function(e,t,o){n.kickXY(e,t,0,0,o||-1)},n.kickXY=function(e,t,o,i,a){e&&(t=t||e.pos||e.getLocalPosition().clone(),e.setLocalPosition(t.x+(o||0),t.y+(i||0),t.z+(a||0)),n.moveTo(e,t,.2))},n.kick=function(e,t,o,i){e&&(e.setLocalPosition(o.x+t.x,o.y+t.y,o.z+t.z),n.moveTo(e,o,i||.6,EASING.ElasticOut))},n.spring=function(e,t,n,o){if(e){var i=i||new pc.Vec3,a=n||.2,c=o||.8,l=e._diff=e._diff||{};for(var s in i)l[s]||(l[s]=0),l[s]+=(i[s]-e[s])*a,l[s]*=c,e[s]+=l[s]}},n.commarize=function(e,t,o){n.fillField(e,{value:t,lastValue:o,commarize:!0})},n.fillField=function(e,t){if(t=t||{},e){e.vars||(e.vars=t),extract(t,e.vars);var o=(t=e.vars).prefix||"",i=t.suffix||"",a={value:t.lastValue||0},c={value:t.value||0},l="number"==typeof c.value;if(t.autoReach||!l||0===c.value||Math.abs(c.value-a.value)<=1)return onComplete();n.varsTo(a,c,t.time||.25,EASING.LINEAR,(function onUpdate(){updateText(a.value)}),onComplete)}function onComplete(){t.lastValue=c.value,updateText(c.value)}function updateText(e){if(!l)return fillText(e);if(t.commarize){var n=STRING.commarize(e,!0);return fillText(n.number+n.unit)}fillText(MATH.commas(Math.ceil(e)))}function fillText(t){e&&e.element&&e.element.text&&(e.element.text=o+t+i,function textAlign(e){var t=e.parent;t&&t.tags&&-1!=t.tags._list.indexOf("alignText")&&CONTENT.alignText(t)}(e))}},n.animateChars=function(e,t,n){if(e){vars=e.vars;var o="",i=t.split(""),a=0;start(onUpdate)}function onUpdate(){if(!((a+=DT)<1)){a=0;var t=i.shift();if(!t)return function onComplete(){stop(onUpdate),n&&n()}();o+=t,e.element.text=o}}},n.explode=function(e,t){if(e){var o,i=(t=t||{}).force,a=e.getPosition().clone(),c=t.time||2,l=t.min||.2,s=t.max||.3,r=null!=t.gravity?t.gravity:.01;return t.endScale&&n.scaleTo(e,new pc.Vec3(t.endScale,t.endScale,t.endScale),c,EASING.LINEAR),i||(i=new pc.Vec3(spectrumDecimal(s,l)/10,decimal(s,l),spectrumDecimal(s,l)/10)),t.rot&&(o=new pc.Vec3(spectrumDecimal(s,l)*t.rot,10*decimal(s,l),spectrumDecimal(s,l)*t.rot),e.setEulerAngles(random(360),random(360),random(360))),delay((function(){stop(updateExplosion),t.callback&&t.callback()}),c),fixed(updateExplosion),updateExplosion}function updateExplosion(){i.y-=r,i.x*=.995,i.z*=.995,a.x+=i.x*dtFixed,a.y+=i.y*dtFixed,a.z+=i.z*dtFixed,e.setPosition(a),o&&(e.rotate(o),o.mulScalar(.99)),null!=t.left&&a.x<t.left&&(a.x=t.left,i.x=Math.abs(i.x)),null!=t.right&&a.x>t.right&&(a.x=t.right,i.x=-Math.abs(i.x)),null!=t.bottom&&a.z<t.bottom&&(a.z=t.bottom,i.z=Math.abs(i.z)),null!=t.top&&a.z>t.top&&(a.z=t.top,i.z=-Math.abs(i.z)),null!=t.floor&&a.y<t.floor&&(a.y=t.floor,i.y=.5*Math.abs(i.y))}},n.explodeXZ=function(e,t){if(e){var n=(t=t||{}).force,o=e.getPosition().clone();n||(n=new pc.Vec3(spectrumDecimal(.3,.2),.4,spectrumDecimal(.3,.2))),delay((function(){stop(updateXZ),t.callback&&t.callback()}),3),fixed(updateXZ)}function updateXZ(){n.x*=.995,n.z*=.995,o.x+=n.x*dtFixed,o.z+=n.z*dtFixed,e.setPosition(o),null!=t.left&&o.x<t.left&&(o.x=t.left,n.x=Math.abs(n.x)),null!=t.right&&o.x>t.right&&(o.x=t.right,n.x=-Math.abs(n.x)),null!=t.bottom&&o.z<t.bottom&&(o.z=t.bottom,n.z=Math.abs(n.z)),null!=t.top&&o.z>t.top&&(o.z=t.top,n.z=-Math.abs(n.z))}},n.init=function(){e=new pc.Vec3,t=new pc.Quat},n.A2BFrictionVector=function(t,n,o){return e.copy(t),o=o||10,e.x+=(n.x-e.x)/o,e.z+=(n.z-e.z)/o,e.y+=(n.y-e.y)/o,e},n.A2BFrictionLerp=function(t,n,o){return e.lerp(t,n,1-Math.pow(o||10,dt))},n.A2BFrictionQuaternion=function(e,n,o){return t.slerp(e,n,1-Math.pow(o||.5,dt)),t},n.A2BFrictionPosition=function(t,o,i){return n.A2BFrictionVector(t.getPosition(),o,i),t.setPosition(e),e},n.A2BFrictionLocalPosition=function(t,o,i){return n.A2BFrictionVector(t.getLocalPosition(),o,i),t.setLocalPosition(e),e},n.A2BFrictionRotation=function(e,n,o){return t.slerp(e.getRotation(),n,1-Math.pow(.01,dt*(o||2))),e.setRotation(t),t},n.lerpPosition=function(t,n,o){e.copy(t.getPosition());var i=(o||.1)/dtFixed;return e.lerp(e,n,i),t.setPosition(e),e},n.A2BSprings=function(t,n,o,i,a){e.copy(t);var c=i||25,l=a||.87;return o.x+=(n.x-e.x)/c,o.y+=(n.y-e.y)/c,o.z+=(n.z-e.z)/c,o.x*=l,o.y*=l,o.z*=l,e.x+=o.x,e.y+=o.y,e.z+=o.z,e},n.lookAt=function(e,t,n,o){let i,a=t,c=!t.getPosition;n=n||.2,o||(o={}),o.useLocalSpace?(i=e.getLocalPosition().clone(),c||(a=t.getLocalPosition().clone())):(i=e.getPosition().clone(),c||(a=t.getPosition().clone())),o.removeY&&(i.y=a.y=0);let l=new pc.Quat;o.invert?l.copy(MATH.lookAt(a,i)):l.copy(MATH.lookAt(i,a));let s=e.getLocalRotation().clone(),r=(new pc.Quat).slerp(s,l,n*DT);return e.setLocalRotation(r),r},n.rotateToLookAt=function(e,t,o,i){let a=0;start((function update(){if(n.lookAt(e,t,o,i),a+=DT,a>60)return stop(update)}))}};var AnimateOnload=pc.createScript("animateOnload");AnimateOnload.attributes.add("autoLoad",{type:"boolean",default:!0}),AnimateOnload.prototype.initialize=function(){var a=this;a.isLoaded=!1;var t=a.entity;if(getLocals(t),t.setLocalScale(0,0,0),a.autoLoad)return onLoad();function onLoad(){a.autoLoad||log("THIS LOADED",t.name),a.isLoaded=!0,a.animate()}ASSETS.preloadEntityModels(t,onLoad)},AnimateOnload.prototype.animate=function(){var a=this,t=a.entity;a.isLoaded&&a.isPlaying&&t.enabled&&(t.enabled=!1,DELAY.start((function(){t.enabled=!0,ANIMATION.bounceScaleTo(t,.1*t.sca.x,t.sca.x,RANDOM.decimal(3,1.5))}),RANDOM.decimal(1)))},AnimateOnload.prototype.play=function(){var a=this,t=a.entity;a.isPlaying=!0,a.isLoaded&&t.enabled&&a.animate()};var Billboard=pc.createScript("billboard");Billboard.prototype.initialize=function(){},Billboard.prototype.update=function(t){this.entity.setRotation(CAMERA.getRotation())};var Orbit=pc.createScript("orbit");Orbit.prototype.initialize=function(){var t=this;t.sinCount=0,t.inc=.05,getLocals(t.entity)},Orbit.prototype.update=function(t){var i=this,n=i.entity;i.sinCount+=i.inc;var o=2*Math.sin(i.sinCount),r=2*Math.cos(i.sinCount),s=n.pos;n.setLocalPosition(r,s.y,o)};var PickupItem=pc.createScript("pickupItem");PickupItem.attributes.add("isBounceY",{type:"number",default:0}),PickupItem.attributes.add("isFloatY",{type:"number",default:0}),PickupItem.attributes.add("isFloatX",{type:"number",default:0}),PickupItem.attributes.add("isFloatZ",{type:"number",default:0}),PickupItem.attributes.add("isRotateX",{type:"number",default:0}),PickupItem.attributes.add("isRotateY",{type:"number",default:0}),PickupItem.attributes.add("isRotateZ",{type:"number",default:0}),PickupItem.attributes.add("isWindy",{type:"number",default:0}),PickupItem.attributes.add("isWindyY",{type:"number",default:0}),PickupItem.attributes.add("isBreathing",{type:"number",default:0}),PickupItem.attributes.add("isZooming",{type:"number",default:0}),PickupItem.attributes.add("isBursting",{type:"number",default:0}),PickupItem.attributes.add("isBurstingB",{type:"number",default:0}),PickupItem.attributes.add("isHalo",{type:"number",default:0}),PickupItem.attributes.add("opacity",{type:"number",default:0}),PickupItem.attributes.add("isBillboard",{type:"number",default:0}),PickupItem.attributes.add("friction",{type:"number",default:1}),PickupItem.attributes.add("floatOffset",{type:"number",default:0}),PickupItem.attributes.add("isFlame",{type:"number",default:0}),PickupItem.attributes.add("isParticle",{type:"number",default:0}),PickupItem.attributes.add("hasTick",{type:"boolean",default:!1}),PickupItem.attributes.add("text",{type:"string"}),PickupItem.prototype.initialize=function(){var t,e=this,i=e.entity,a=i.model,s=new pc.Vec3,u=new pc.Vec3,c=new pc.Vec3,o=i.element,r=e.friction,l=0,p=0,d=o?o.opacity:.5,n=RANDOM.spectrum(300);getLocals(i),i.pickupScript=e,e.hasTick&&(e.Tick=i.findByName("Tick")),e.reset=function(){resetLocals(i),s.copy(i.rot),u.copy(i.pos),c.copy(i.sca),e.element=i.element||i.sprite,l=RANDOM.decimal(),p=RANDOM.decimal(),t=MOTION.TickAngle,e.Tick&&e.Tick.setLocalEulerAngles(0,0,MOTION.TickAngle)},e.onUpdate=function(y){var m,O,I=!1,b=!1,f=!1;if(e.text&&e.Dots!=MOTION.Dots){e.Dots=MOTION.Dots;var T=e.text;for(m=1;m<=e.Dots;m++)T+=".";o.text=T}if(e.Tick&&t!=MOTION.TickAngle&&(t=MOTION.TickAngle,e.Tick.setLocalEulerAngles(0,0,t+90),ANIMATION.rotateTo(e.Tick,{x:0,y:0,z:t},.5,EASING.ElasticOut)),e.isBounceY&&(u.y=i.pos.y+MOTION.BOUNCE_Y*e.isBounceY,I=!0),e.isFloatY&&(u.y=i.pos.y+MOTION.getFloatY(e.floatOffset)*e.isFloatY,I=!0),e.isFloatX&&(u.x=i.pos.x+MOTION.getFloatY(e.floatOffset)*e.isFloatX,I=!0),e.isFloatZ&&(u.z=i.pos.z+MOTION.getFloatY(e.floatOffset)*r,I=!0),(e.isBursting||e.isBurstingB)&&(O=e.isBurstingB?MOTION.INC_B:MOTION.INC_A,o&&(o.opacity=.8*(1-O)),O*=i.sca.x,O+=.3*i.sca.x,c.x=c.y=c.z=O,b=!0),e.isRotateY&&(s.y=MOTION.ROT_Y*e.isRotateY,f=!0),e.isRotateX&&(s.x=MOTION.ROT_Y*e.isRotateX,f=!0),e.isRotateZ&&(s.z=MOTION.ROT_Y*e.isRotateZ,f=!0),e.isWindy&&(s.z=i.rot.z+50*MOTION.getFloatY(l)*e.isWindy,f=!0),e.isWindyY&&(s.y=i.rot.y+50*MOTION.getFloatY(p)*e.isWindyY,f=!0),e.isBreathing&&(c.x=i.sca.x+.03*MOTION.SIN_B*e.isBreathing*i.sca.x,c.y=i.sca.y-.03*MOTION.SIN_B*e.isBreathing*i.sca.y,b=!0),e.isZooming&&(O=(1+.5*MOTION.SIN_C)*e.isZooming,c.x=i.sca.x+i.sca.x*O,c.y=i.sca.y+i.sca.y*O,c.z=i.sca.z+i.sca.z*O,b=!0),e.opacity||e.isHalo){var k=d+MOTION.SIN_C*e.opacity*.5;o&&(o.opacity=k),a&&a.meshInstances&&a.meshInstances[0].material.setParameter("material_opacity",k)}if(e.isHalo&&(O=i.sca.x+.07*MOTION.SIN_C*i.sca.x,c.x=c.y=c.z=O,s.z=-MOTION.ROT_Z*e.isHalo,b=!0,f=!0),e.isFlame){n+=RANDOM.decimal(.3,.05);var N=Math.sin(n);c.y=i.sca.y+N*e.isFlame*i.sca.y,b=!0}e.isParticle&&((n+=6)>300&&(n=-RANDOM.value(300)),c.x=c.y=c.z=n>0?i.sca.z*(300-n)/300:0,u.y=i.pos.y+.01*n*e.isParticle,I=!0,b=!0),b&&i.setLocalScale(c.x,c.y,c.z),I&&i.setLocalPosition(u.x,u.y,u.z),e.isBillboard?i.setRotation(CAMERA.entity.getRotation()):f&&i.setLocalEulerAngles(s)},e.reset()},PickupItem.prototype.update=function(t){this.onUpdate()};var AutoLook=pc.createScript("autoLook");AutoLook.prototype.initialize=function(){},AutoLook.prototype.update=function(t){this.entity.lookAt(this.entity.parent.getPosition())};var SCENES,AnimateMe=pc.createScript("animateMe");AnimateMe.attributes.add("id",{type:"string"}),AnimateMe.attributes.add("event",{title:"In Event",type:"string"}),AnimateMe.attributes.add("hideEvent",{title:"Out Event",type:"string"}),AnimateMe.attributes.add("fromX",{type:"number",default:0}),AnimateMe.attributes.add("fromY",{type:"number",default:0}),AnimateMe.attributes.add("fromZ",{type:"number",default:0}),AnimateMe.attributes.add("fromScale",{type:"number",default:0}),AnimateMe.attributes.add("time",{type:"number",default:.8}),AnimateMe.attributes.add("delay",{type:"number",default:0}),AnimateMe.attributes.add("sound",{title:"Sound IN",type:"string"}),AnimateMe.attributes.add("soundOut",{title:"Sound Out",type:"string"}),AnimateMe.attributes.add("Platform",{type:"string"}),AnimateMe.attributes.add("autoStart",{type:"boolean"}),AnimateMe.attributes.add("enableButton",{type:"boolean"}),AnimateMe.attributes.add("sineOut",{title:"SineOut",type:"boolean",boolean:!1}),AnimateMe.prototype.postInitialize=function(){var t,e,o=this,a=o.entity;getLocals(a),o.fromX=o.fromX,o.fromY=o.fromY,o.fromZ=o.fromZ;var n=o.id;function animateIn(){if(t&&t.stop(),e&&e.stop(),a.enabled&&(!o.Platform||PLATFORM.Platform==o.Platform)){if((o.fromX||o.fromY||o.fromZ)&&a.setLocalPosition(9999,9999,0),o.delay)return DELAY.start(doAnimateIn,o.delay);doAnimateIn()}}function doAnimateIn(){a.enabled=!0,o.sound&&SFX.playPitchSmall(o.sound),hide(),!0,a.setLocalPosition(a.pos.x+o.fromX,a.pos.y+o.fromY,a.pos.z+o.fromZ),(o.fromX||o.fromY||o.fromZ)&&(t=ANIMATION.moveTo(a,a.pos,o.time,o.sineOut?EASING.SineOut:EASING.ElasticOut)),o.fromScale&&(e=ANIMATION.bounceScaleTo(a,o.fromScale,a.sca.x,o.time))}function show(){!0,a.enabled=!0,resetLocals(a)}function hide(){!1,a.setLocalPosition(a.pos.x+o.fromX,a.pos.y+o.fromY,a.pos.z+o.fromZ),o.fromScale&&a.setLocalScale(o.fromScale,o.fromScale,o.fromScale)}n&&(on(n+":In",doAnimateIn),on(n+":Out",(function doAnimateOut(){a.enabled=!0,show(),!1,o.soundOut&&SFX.playPitchSmall(o.soundOut);t=ANIMATION.moveTo(a,new pc.Vec3(a.pos.x+o.fromX,a.pos.y+o.fromY,a.pos.z+o.fromZ),o.time,EASING.ElasticOut),o.fromScale&&(e=ANIMATION.bounceScaleTo(a,o.fromScale,a.sca.x,o.time))})),on(n+":Show",show),on(n+":Hide",hide),on(n+":MoveTo",(function moveTo(e,n,i){t&&t.stop();t=ANIMATION.moveTo(a,e,n||o.time,i||EASING.SineOut)})),on(n+":Restore",(function restore(e,o){t&&t.stop();if(!e)return a.setLocalPosition(a.pos);t=ANIMATION.moveTo(a,a.pos,e,o||EASING.SineInOut)}))),o.autoStart&&(o.event||(o.event=SCENES&&SCENES.getStartEvent(a)),o.event||animateIn()),o.event&&on(o.event,animateIn)};var Motion=pc.createScript("motion");Motion.attributes.add("isBounceY",{type:"number",default:0}),Motion.attributes.add("isBounceSlowY",{type:"number",default:0}),Motion.attributes.add("isFloatY",{type:"number",default:0}),Motion.attributes.add("isFloatX",{type:"number",default:0}),Motion.attributes.add("isFloatZ",{type:"number",default:0}),Motion.attributes.add("isRotateX",{type:"number",default:0}),Motion.attributes.add("isRotateY",{type:"number",default:0}),Motion.attributes.add("isRotateZ",{type:"number",default:0}),Motion.attributes.add("isRandomY",{type:"number",default:0}),Motion.attributes.add("isWindy",{type:"number",default:0}),Motion.attributes.add("isWindyY",{type:"number",default:0}),Motion.attributes.add("isWindyX",{type:"number",default:0}),Motion.attributes.add("isWindFastY",{type:"number",default:0}),Motion.attributes.add("isWingZ",{type:"number",default:0}),Motion.attributes.add("isBreathing",{type:"number",default:0}),Motion.attributes.add("isZooming",{type:"number",default:0}),Motion.attributes.add("isBursting",{type:"number",default:0}),Motion.attributes.add("isBurstingB",{type:"number",default:0}),Motion.attributes.add("isHalo",{type:"number",default:0}),Motion.attributes.add("opacity",{type:"number",default:0}),Motion.attributes.add("lightIntensity",{type:"number",default:0}),Motion.attributes.add("isBillboard",{type:"number",default:0}),Motion.attributes.add("floatOffset",{type:"number",default:0}),Motion.attributes.add("isFlame",{type:"number",default:0}),Motion.attributes.add("isParticle",{type:"number",default:0}),Motion.attributes.add("hasTick",{type:"boolean",default:!1}),Motion.attributes.add("text",{type:"string"}),Motion.attributes.add("speed",{type:"vec3"}),Motion.attributes.add("boundaries",{type:"vec3",default:[5,5,5]}),Motion.prototype.initialize=function(){var t=this,e=t.entity,i=e.model;e.motion=t,getLocals(e);var a=(new pc.Vec3).copy(e.rot),s=(new pc.Vec3).copy(e.pos),o=(new pc.Vec3).copy(e.sca),n=t.element=e.element||e.sprite,d=e.light;d&&(t.intensity=d.intensity);var r=new pc.Vec3,u=t.isRandomY?pc.math.random(-180,180):0;t.speed||(t.speed=new pc.Vec3),t.speed.x&&(r.x=spectrumDecimal(t.boundaries.x)),t.speed.y&&(r.y=spectrumDecimal(t.boundaries.y)),t.speed.z&&(r.z=spectrumDecimal(t.boundaries.z)),-1==t.floatOffset&&(t.floatOffset=decimal());var l=MOTION.TickAngle;t.alpha=n?n.opacity:.5;var y=RANDOM.spectrum(300);e.pickupScript=t,t.hasTick&&(t.Tick=e.findByName("Tick"),t.Tick&&t.Tick.setLocalEulerAngles(0,0,MOTION.TickAngle));var c=RANDOM.decimal(),p=RANDOM.decimal(),O=RANDOM.decimal();t.reset=function(){a.copy(e.rot),s.copy(e.pos),o.copy(e.sca),t.isBounceY=t.isBounceSlowY=t.isFloatY=t.isFloatX=t.isFloatZ=t.isRotateX=t.isRotateY=t.isRotateZ=t.isRandomY=t.isWindy=t.isWindyY=t.isWindyX=t.isWindFastY=t.isWingZ=t.isBreathing=t.isZooming=t.isBursting=t.isBurstingB=t.isHalo=t.isBillboard=t.floatOffset=t.lightIntensity=0},t.updatePos=function(){getLocals(e,null,!0),a.copy(e.rot),s.copy(e.pos),o.copy(e.sca)},t.fill=function(e){t.reset(),extract(e,t),e.color&&n&&(n.color=COLOR.get(e.color))},t.onUpdate=function(b){var M,f,m=!1,N=!1,T=!1;if(t.text&&t.Dots!=MOTION.Dots){t.Dots=MOTION.Dots;var g=t.text;for(M=1;M<=t.Dots;M++)g+=".";n.text=g}if(t.Tick&&l!=MOTION.TickAngle&&(l=MOTION.TickAngle,t.Tick.setLocalEulerAngles(0,0,l+90),ANIMATION.rotateTo(t.Tick,{x:0,y:0,z:l},.5,EASING.ElasticOut)),t.isBounceY&&(s.y=e.pos.y+MOTION.BOUNCE_Y*t.isBounceY,m=!0),t.isBounceSlowY&&(s.y=e.pos.y+MOTION.BOUNCESLOW_Y*t.isBounceSlowY,m=!0),t.isFloatY&&(s.y=e.pos.y+MOTION.getFloatY(t.floatOffset)*t.isFloatY,m=!0),t.isFloatX&&(s.x=e.pos.x+MOTION.getFloatY(t.floatOffset)*t.isFloatX,m=!0),t.isFloatZ&&(s.z=e.pos.z+MOTION.getFloatY(t.floatOffset)*t.isFloatZ,m=!0),(t.isBursting||t.isBurstingB)&&(f=t.isBurstingB?MOTION.INC_B:MOTION.INC_A,n&&(n.opacity=.8*(1-f)),f*=e.sca.x,f+=.3*e.sca.x*(t.isBursting||t.isBurstingB),o.x=o.y=o.z=f,N=!0),t.speed.x&&(r.x+=t.speed.x,t.speed.x>0&&r.x>t.boundaries.x&&(r.x-=2*t.boundaries.x),t.speed.x<0&&r.x<t.boundaries.x&&(r.x+=2*t.boundaries.x),m=!0),t.speed.y&&(r.y+=t.speed.y,t.speed.y>0&&r.y>t.boundaries.y&&(r.y-=2*t.boundaries.y),t.speed.y<0&&r.y<t.boundaries.y&&(r.y+=2*t.boundaries.y),m=!0),t.speed.z&&(r.z+=t.speed.z,t.speed.z>0&&r.z>t.boundaries.z&&(r.z-=2*t.boundaries.z),t.speed.z<0&&r.z<t.boundaries.z&&(r.z+=2*t.boundaries.z),m=!0),t.isRotateY&&(a.y=u+MOTION.ROT_Y*t.isRotateY,T=!0),t.isRotateX&&(a.x=MOTION.ROT_Y*t.isRotateX,T=!0),t.isRotateZ&&(a.z=MOTION.ROT_Y*t.isRotateZ,T=!0),t.isWindy&&(a.z=e.rot.z+50*MOTION.getFloatY(c)*t.isWindy,T=!0),t.isWindyY&&(a.y=e.rot.y+50*MOTION.getFloatY(p)*t.isWindyY,T=!0),t.isWindyX&&(a.x=e.rot.x+50*MOTION.getFloatY(p)*t.isWindyX,T=!0),t.isWindFastY&&(a.y=e.rot.y+50*MOTION.getFloatFastY(O)*t.isWindFastY,T=!0),t.isWingZ&&(a.z=e.rot.z+50*MOTION.BOUNCE_Y*t.isWingZ,T=!0),t.isBreathing&&(o.x=e.sca.x+.03*MOTION.SIN_B*t.isBreathing*e.sca.x,o.y=e.sca.y-.03*MOTION.SIN_B*t.isBreathing*e.sca.y,N=!0),t.isZooming&&(f=(1+.5*MOTION.SIN_C)*t.isZooming,o.x=e.sca.x+e.sca.x*f,o.y=e.sca.y+e.sca.y*f,o.z=e.sca.z+e.sca.z*f,N=!0),t.opacity||t.isHalo){var x=t.alpha+MOTION.SIN_C*t.opacity*.5;n&&(n.opacity=x),i&&i.meshInstances&&i.meshInstances[0].material.setParameter("material_opacity",x)}if(d&&(d.intensity=t.intensity+MOTION.SIN_C*t.lightIntensity*.5),t.isHalo&&(f=e.sca.x+.07*MOTION.SIN_C*e.sca.x,o.x=o.y=o.z=f,a.z=-MOTION.ROT_Z*t.isHalo,N=!0,T=!0),t.isFlame){y+=RANDOM.decimal(.3,.05);var I=Math.sin(y);o.y=e.sca.y+I*t.isFlame*e.sca.y,N=!0}t.isParticle&&((y+=6)>300&&(y=-RANDOM.value(300)),o.x=o.y=o.z=y>0?e.sca.z*(300-y)/300:0,s.y=e.pos.y+.01*y*t.isParticle,m=!0,N=!0),N&&e.setLocalScale(o.x,o.y,o.z),m&&e.setLocalPosition(s.x+r.x,s.y+r.y,s.z+r.x),t.isBillboard?e.setRotation(CAMERA.entity.getRotation()):T&&e.setLocalEulerAngles(a)}},Motion.prototype.update=function(t){this.onUpdate(t)};var AnimateOnelementLoad=pc.createScript("animateOnelementLoad");AnimateOnelementLoad.prototype.initialize=function(){var e=this;getLocals(e.entity),ASSETS.preloadElements(e.entity,(function onLoad(){ANIMATION.bounceScaleTo(e.entity,.9*e.entity.sca.x,e.entity.sca.x,3)})),e.entity.setLocalScale(0,0,0)};var FollowTarget=pc.createScript("followTarget");FollowTarget.attributes.add("id",{title:"Component ID",type:"string"}),FollowTarget.attributes.add("target",{title:"Target",type:"entity"}),FollowTarget.attributes.add("axis",{title:"Follow Axis",type:"vec3",default:[1,1,1]}),FollowTarget.attributes.add("offset",{title:"Offset",type:"vec3",default:[0,0,0]}),FollowTarget.attributes.add("keepOffset",{title:"Keep original offset",type:"boolean",default:!1}),FollowTarget.attributes.add("autoStart",{title:"Auto Start",type:"boolean",default:!0}),FollowTarget.attributes.add("friction",{type:"number",default:0}),FollowTarget.attributes.add("max",{title:"Max Tracking",type:"vec3",default:[0,0,0]}),FollowTarget.attributes.add("enableMinTracking",{type:"boolean",default:!1}),FollowTarget.attributes.add("min",{title:"Min Tracking",type:"vec3",default:[0,0,0]}),FollowTarget.prototype.initialize=function(){var t,e=this,a=e.entity,o=e.id,i=!1,l=null,n=new pc.Vec3,r=e.offset,s=e.axis,f=0;function follow(e,o){if(new pc.Vec3,t=new pc.Vec3,e){if(l=e,(o=o||{}).keepOffset){var i=l.getPosition(),n=a.getPosition();r.x+=n.x-i.x,r.y+=n.y-i.y,r.z+=n.z-i.z}o.axis&&(s.x=o.axis.x,s.y=o.axis.y,s.z=o.axis.z),f=o.friction,enable()}}function enable(){i||(i=!0,e.target&&e.follow(e.target))}function disable(){i=!1}getLocals(a),o&&(on(o+":Enable",enable),on(o+":Disable",disable),on(o+":Reset",(function reset(){i=l=!1,resetLocals(a)})),on(o+":Follow",follow)),e.follow=follow,e.enable=enable,e.disable=disable,this.onUpdate=function(){if(i&&l){var o=l.getPosition();if(r.x&&(n.x=r.x),r.y&&(n.y=r.y),r.z&&(n.z=r.z),s.x&&(n.x=o.x+r.x),s.y&&(n.y=o.y+r.y),s.z&&(n.z=o.z+r.z),e.enableMinTracking&&e.min.x&&(n.x<t.x&&(t.x=n.x),n.x>t.x+e.min.x&&(n.x=t.x+e.min.x)),f)return ANIMATION.A2BFrictionPosition(a,n,f*DT);a.setPosition(n)}},e.autoStart&&e.enable()},FollowTarget.prototype.update=function(){this.onUpdate()};function get(e,A){if(DATA)return DATA.get(e,A)}function set(e,A){if(DATA)return DATA.set(e,A)}function display(e,A,n){if(DATA)return DATA.display(e,A,n)}function increase(e,A){if(DATA)return DATA.increase(e,A)}function decrease(e,A){if(DATA)return DATA.decrease(e,A)}function displayIncrease(e,A){if(DATA)return DATA.displayIncrease(e,A)}function displayDecrease(e,A){if(DATA)return DATA.displayDecrease(e,A)}var rpw,ABTESTS=new function(){var i=this;i.init=function(){var n=CONFIG.ABTESTS;if(n)for(var r in rpw.InitABTests(n),n)if(-1==r.indexOf("placebo")){var o=r.split("_")[1];i[o]="Control"!=rpw.CheckABTest(r),"Enabled"==CONFIG.DEBUG.GodMode&&(i[o]=!0),log("ABTEST",o,i[o])}}};var IAP=new function(){this.isEnabled=!1,this.init=function(){"Wortal"==PLATFORM.platform&&new IAP_Wortal,"Yandex"==PLATFORM.platform&&new IAP_Yandex,"Kongregate"==PLATFORM.platform&&new IAP_Kongregate}};function IAP_Wortal(){var n=this;IAP=n,n.isEnabled=!1;try{Wortal.iap.getCatalogAsync().then((function(e){n.isEnabled=!0}))}catch(n){console.error(n)}n.purchase=function(e,a){n.isEnabled&&Wortal.iap.makePurchaseAsync({productID:e}).then((function(n){a()}))}}function IAP_Yandex(){var n=this;IAP=n,n.isEnabled=!1;var e=null;ysdk.getPayments({signed:!0}).then((a=>{function consumePurchase(n){"gold500"===n.productID&&e.consumePurchase(n.purchaseToken)}e=a,n.isEnabled=!0,e.getCatalog().then((n=>{n})),e.getPurchases().then((n=>n.forEach(consumePurchase)))})).catch((n=>{})),n.purchase=function(a,t){n.isEnabled&&e.purchase({id:"gold500"}).then((n=>{t()})).catch((n=>{}))}}function IAP_Kongregate(){var n=this;IAP=n,n.isEnabled=!0,n.purchase=function(e,a){n.isEnabled&&kongregate.mtx.purchaseItems([e],(function(n){log("Purchase success:"+n.success),n.success&&a()}))}}var MATCHMAKING=new function(){var t=!1;function clearEvents(){t=!1,cancel("matchmaking"),function cancelMatchWithBot(){cancel("matchmaking")}(),off("MATCHMAKING:Exit",exit)}function delayMatchWithBot(){unique("matchmaking",matchWithBot,3)}function matchWithBot(){SOCKET.reset(),RIVALS.setVS(),ME.reset(),ME.sendStatus("Ready")}function exit(){clearEvents(),NAKAMA.leaveMatchmaking()}this.join=function(){t=!0,clearEvents(),delayMatchWithBot(),on("MATCHMAKING:Exit",exit),CONFIG.MULTIPLAYER.realMultiplayer&&(SOCKET.disconnect(),NAKAMA.matchmaking("Match"+get("buildVersion"),(function(n){t&&(delayMatchWithBot(),SOCKET.connect(n.token,onConnect))})))}};var SOCKET=new function(){var n=this;n.ACTIONS=n.STATUS={},n.data={},n.isHost=function(){return!0},n.send=function(){},n.init=function(){log("==SOCKET:onInit")}};var UIFXID=0;function UIFXParticle(e){var t,l,a,n,o,c,i,r,s,p,d,y,f,x,u,T,D,S,z,A,m=this,h=new pc.Vec3,I={x:0,y:0,z:0,offsetX:0,offsetY:0,offsetZ:0,forceX:0,forceY:0,forceZ:0,speedX:0,speedY:0,speedZ:0,sinVelX:0,sinVelZ:0,sinVelS:null,endScale:null,rotation:h,rotationVel:h,scale:1,friction:0,alpha:1,endAlpha:1,time:1},v=!0,V=new pc.Vec3,X=new pc.Vec3,Y=new pc.Vec3,g="UIFX"+UIFXID++;function remove(){UIFX.remove(m)}t=ARRAY.mergeUnique(I,e),m.parent=t.parent,l=1,a=1,(n=t.space3D)||m.parent||(t.model?(m.parent=FX3D,n=!0):(m.parent=FX,n=!1)),n?(l=.01,t.model||(a=l)):((t.model||t.particle)&&(a=100),l=1),o=1,V.x=V.y=V.z=0,t.reparent&&(o=m.parent.getLocalScale().x,V=m.parent.getLocalPosition().clone(),m.parent=m.parent.parent,l*=o,a*=o,t.x*=o,t.y*=o,t.z*=o,t.x+=V.x,t.y+=V.y,t.z+=V.z),m.scale=t.scale*a,m.scaleY=(t.scaleY||t.scale)*a,c=t.time,i=60*c,S=t.startTicks||i,tint=t.tint,z=t.scaleIn,m.x=t.x+t.offsetX*l,m.y=t.y+t.offsetY*l,m.z=t.z+t.offsetZ*l,m.alpha=t.alpha,m.rotation=t.rotation,r=t.rotationVel,s=t.gravity*l,X.x=(t.speedX+t.forceX)*l,X.y=(t.speedY+t.forceY)*l,X.z=(t.speedZ+t.forceZ)*l,p=t.friction,endColor=t.endColor,d=t.endAlpha,y=t.midAlpha,t.midScale,f=null!=t.endScale?t.endScale*a:null,x=t.floorY,u=t.follow,T=t.isStandalone,D=t.billboard,m.layers=t.layers||[n?"World":"UI"],Y.x=t.sinVelX,Y.z=t.sinVelZ,Y.y=t.sinVelS,trail=t.trail,m.model=t.model,m.texture=t.texture,m.particle=t.particle,m.text=t.text,m.color=t.color,m.anchorY=t.anchorY,m.sprite=t.sprite,m.blend=t.blendMode||t.blend,ASSETS.getAsync(m,(function onEntity(e){(A=m.entity=e).enabled=!0,A._guid||A.getGuid();A.model&&(A.model.castShadows=A.model.receiveShadows=!1);t.data&&CONTENT.fill(A,t.data);DELAY.unique(g,remove,1.1*c),z&&ANIMATION.bounceScaleTo(A,.01*m.scale,m.scale,z,EASING.SineOut)})),m.disable=function(){cancel(g),v&&(v=!1,ASSETS.remove(A),A=m.entity=null)},m.setSpeedY=function(e){X.y=e},m.setEndAlpha=function(e){d=e},m.setEndScale=function(e){f=e};var E=new pc.Vec3,M=new pc.Vec3,L=new pc.Vec3;m.update=function(){if(!T&&A){E.copy(A.getLocalPosition()),M.copy(A.getLocalEulerAngles()),L.copy(A.getLocalScale());var e=i/(60*c);if(s&&(X.y+=-s*DT),p&&(X.x*=p*DT,X.y*=p*DT,X.z*=p*DT,r.x*=p*DT,r.y*=p*DT,r.z*=p*DT),null!=d){var t=m.alpha,l=d,a=e;if(y&&(e>=.5?(a=2*Math.abs(.5-e),t=m.alpha,l=y):(a=2*(e-.5),t=y,l=d)),A.element){var o=MATH.lerp(l,t,a);A.element.opacity+=(o-A.element.opacity)/5*DT}}if(null!=f&&(L.x=L.y=L.z=(m.scale-f)*e+f),Y.y){Y.y+=.05*DT;var z=.1*Math.sin(Y.y);L.x+=z*L.x*DT,L.x-=z*L.y*DT}if(x&&E.y<x&&(X.y*=-.5,X.x*=.8,X.z*=.8,M.z=m.rotation.z,E.y=x),Y.x&&(Y.x+=RANDOM.decimal(.1,.05)/2,E.x+=Math.sin(Y.x)*(n?.005:1)*DT*(X.x||1)),Y.z&&(Y.z+=RANDOM.decimal(.1,.05)/2,E.z+=Math.sin(Y.z)*(n?.005:1)*DT*(X.z||1)),u&&i<.7*S){var h=.6+RANDOM.decimal(.6);let e=E.clone();X.x=X.y=X.z=0,ANIMATION.varsTo(e,{x:u.x,y:u.y},h,EASING.SineIn,(function(){E.copy(e),A.setLocalPosition(E)})),delay((function(){A&&(A.enabled=!1)}),h),u=null}E.x+=X.x*DT,E.y+=X.y*DT,E.z+=X.z*DT,A.setLocalPosition(E),A.setLocalEulerAngles(M),A.rotateLocal(r.x*DT,r.y*DT,r.z*DT),D&&A.setRotation(CAMERA.getRotation()),A.setLocalScale(L),i>0&&(i-=DT)}}}var FX3D,FX3DParallax,UIFX=new function(){var e=this;UIFX=e;var n=[],t=!1;e.isEnabled=!0;var a,i=0;function update(){for(var e in n)n[e].update();var t=FX3D.children.length;a&&(SFX.play(a),a=null),i!=t&&(i=t)}e.initialize=function(){FX3D=addChild(new pc.Entity("FX3D"),root),new FX2DPresets,new FX3DPresets,FX3D.addComponent("script"),FX2D.init(),FX3D.init(),fire("UIFX:onInit"),log("UIFX:onInit")},e.disable=function(){e.isEnabled=!1},e.enable=function(){e.isEnabled=!0},e.stop=function(){if(t){for(t=!1;n.length;)e.remove(n[0]);FX.enabled=FX3D.enabled=!1,stop(update)}},e.spawn=function(t){if(e.isEnabled){var i=new UIFXParticle(t);return t.sfx&&(a=t.sfx),n.push(i),e.play(),i}},e.remove=function(t){ARRAY.removeItem(n,t),t.disable(),n.length||e.stop()},e.play=function(){t||(t=!0,FX.enabled=FX3D.enabled=!0,start(update))},e.cache=function(e){function delayNext(){if(e.length)for(;e.length;)cacheParticle()}function cacheParticle(){var n=e.shift();n.x=n.y=n.z=0,n.time=1,FX3D.play(n),delayNext()}e&&delayNext()}};var AnimatedSprite=pc.createScript("animatedSprite");AnimatedSprite.attributes.add("frames",{type:"number",default:1}),AnimatedSprite.attributes.add("fps",{type:"number",default:20}),AnimatedSprite.attributes.add("autoPlay",{type:"boolean",default:!0}),AnimatedSprite.attributes.add("isLoop",{type:"boolean",default:!0}),AnimatedSprite.prototype.initialize=function(){var t=this;t.entity,t.entity.sprite;t.fps=60/t.fps,t.counter=0,t.frame=0,t.isPlaying=t.autoPlay},AnimatedSprite.prototype.play=function(t,e){var i=this;i.entity.enabled=!0,null!=t&&(i.frame=t),i.onFinish=e,i.isPlaying=!0,i.entity.element.spriteFrame=i.frame},AnimatedSprite.prototype.stop=function(t){var e=this;null!=t&&(e.frame=t),e.isPlaying=!1,e.entity.element.spriteFrame=e.frame},AnimatedSprite.prototype.hide=function(t){this.stop(),this.entity.enabled=!1},AnimatedSprite.prototype.update=function(t){var e=this;e.isPlaying&&(++e.counter<e.fps||(e.counter=0,++e.frame>=e.frames&&(e.frame=0,e.onFinish&&e.onFinish(),e.isLoop||e.stop()),e.entity.element.spriteFrame=e.frame))};var CAMERA,Camera=pc.createScript("camera");Camera.prototype.initialize=function(){var o=this,t=o.entity;o.Camera=t.findByName("Camera"),o.Front=t.findByName("Front"),o.Left=t.findByName("Left"),o.Right=t.findByName("Right"),getLocals(o.Front);let n=t.findByName("Materials");if(CAMERA)return o.Camera.enabled=!1,void t.destroy();on("SCENES:onInit",(function(){log("Prerender materials"),delay((function(){n&&(n.enabled=!0),delay((function(){log("Destroy materials"),n&&n.destroy()}),.1)}),1)})),ENTITY.wrap(t,o),CAMERA=o,getLocals(o.Camera),o.camera=t.camera=o.Camera.camera,o.FX=o.Camera.script.camerafx,o.pawn=new pc.Entity,o.sinCount=0,o.cameras={},o.screenToWorld=function(t,n,e,i){return o.camera.screenToWorld(t,n,e||1,i)},o.touchToWorld=function(t,n){const e=UISIZE.touchToWorld(TOUCH);return o.camera.screenToWorld(e.x,e.y,1,n)},o.touchInstanceToWorld=function(o){return o=o||TOUCH,CAMERA.screenToWorld(o._x,o._y,CAMERA.entity.getPosition().z)},o.onUpdate=function(t){o.orbitTarget&&o.orbiting(),o.followTarget&&o.following()},o.containsPoint=function(o){return this.Camera.camera.frustum.containsPoint(o)},o.pause=function(){o.isPaused=!0},o.unpause=function(){o.isPaused=!1},o.setColor=function(t){t!=o.camera.clearColor&&(o.camera.clearColor=APP.scene.fogColor=t)},o.startFollow=function(t,n,e,i){o.followTarget=t,o.followLookAt=i;var a=getPosition(t),r=getPosition(o.entity);o.followOffset=new pc.Vec3(r.x-a.x,r.y-a.y,r.z-a.z),o._followMargin=null!=n?n:1,o.setFollowMargin(n,e)},o.setFollowMargin=function(t,n){o.followMargin=t||1,o.followFriction=n||2.5},o.following=function(t){if(!o.isPaused){var n=getPosition(o.followTarget),e=getPosition(o.entity),i=o.followOffset;o._followMargin+=(o.followMargin-o._followMargin)/o.followFriction;var a=o._followMargin;e.x+=(n.x+i.x*a-e.x)/o.followFriction,e.y+=(n.y+i.y*a-e.y)/o.followFriction,e.z+=(n.z+i.z*a-e.z)/o.followFriction,o.entity.setLocalPosition(e),o.followLookAt&&o.entity.lookAt(o.followLookAt.getPosition())}},o.orbit=function(t,n){o.orbitTarget=t,o.sinCount=0,o.inc=.04,addChild(o.pawn,APP.root),o.pawn.setPosition(o.entity.getPosition())},o.orbiting=function(t){o.sinCount+=o.inc;var n=o.orbitTarget.getPosition().clone();n.x+=10*Math.cos(o.sinCount),n.y+=3,n.z+=10*Math.sin(o.sinCount),ANIMATION.A2BFrictionPosition(o.pawn,n,50),ANIMATION.A2BFrictionPosition(o.entity,o.pawn.getPosition(),10),CAMERA.entity.lookAt(o.orbitTarget.getPosition())},o.stop=function(){o.orbitTarget=o.followTarget=null},o.moveTo=function(t,n,e){var i=o.cameras[t];i&&(o.stop(),o.moveToEntity(i,n,e),SFX.playPitch("MoveCamera"))},o.set=function(t){var n=o.cameras[t];o.setToEntity(n)},o.moveToPosition=function(t,n,e){ANIMATION.moveToGlobal(o.entity,t,n||1,e,!0)},o.rotateTo=function(t,n,e){ANIMATION.rotateToGlobal(o.entity,t,n||1,e,!0)},o.moveToEntity=function(t,n,e){if(t){n=n||1.5*UI.time,e=e||EASING.SineOut;o.moveToPosition(t.getPosition(),n,e),o.rotateTo(t.getEulerAngles(),n,e)}},o.setToEntity=function(t){t&&(o.entity.setPosition(t.getPosition()),o.entity.setEulerAngles(t.getEulerAngles()))},o.moveToName=function(t,n,e){var i=findByName(t);if(!i)return log("NO ENTITY BY NAME",i);o.moveToEntity(i,n,e)},o.shake=function(t,n,e){conquer.Haptic.fadeOut(),ANIMATION.shake(o.Camera,pc.Vec3.ZERO,t||.1,n||.1)},o.shake3D=function(t,n,e,i,a){a||conquer.Haptic.fadeOut(),ANIMATION.shake3D(o.Camera,pc.Vec3.ZERO,t||.05,n||.05,e||.05,i||1)},o.kick=function(t,n,e,i){conquer.Haptic.mini(),ANIMATION.kick(o.Camera,new pc.Vec3(t,n,e),pc.Vec3.ZERO,i)}},Camera.prototype.update=function(){this.onUpdate()};var TriggerCamera=pc.createScript("triggerCamera");TriggerCamera.attributes.add("label",{type:"string",default:"triggerCamera"}),TriggerCamera.attributes.add("autoTrigger",{type:"boolean"}),TriggerCamera.attributes.add("orbitSpeed",{type:"number",default:0}),TriggerCamera.attributes.add("activateEvent",{type:"string"}),TriggerCamera.attributes.add("enableEvent",{type:"string"}),TriggerCamera.attributes.add("disableEvent",{type:"string"}),TriggerCamera.prototype.postInitialize=function(){var e=this,t=e.entity,a=getChild(t,"CinemaCamera","cinemaCamera"),r=!0;t.tags._list.unshift(e.label);var i=new Collider(e,(function onColliderStart(t,a){if(!e.autoTrigger||!r)return;e.activate(a.entity)}),(function onColliderEnd(t,i){if(!e.autoTrigger||!r)return;a.disable()}));e.enable=function(){r=!0,i.enable()},e.disable=function(){r=!1,i.disable()},e.activate=function(t){var r=t.getPosition();a.entity.setEulerAngles(0,r.x>=0?0:-180,0),a.entity.setPosition(r),a.overlay(t),e.orbitSpeed&&a.orbit(e.orbitSpeed)},e.activateEvent&&on(e.activateEvent,e.activate,e),e.enableEvent&&on(e.enableEvent,e.enable,e),e.disableEvent&&on(e.disableEvent,e.disable,e)};var CINEMACAMERAS=new function(){var a=this,e=0,n=a.pool={},i=!1;a.overlayCamera=null,a.push=function(l){!function init(){function enable(a){var e=n[a];e&&e.enable()}function disable(){for(var e in a.camera=null,n)n[e].disable()}i||(i=!0,on("CINEMACAMERA:Overlay",enable),on("CINEMACAMERA:Enable",enable),a.enable=a.overlay=enable,on("CINEMACAMERA:StopOverlay",disable),on("CINEMACAMERA:Disable",disable),a.disable=disable,on("CINEMACAMERA:ForcePosition",(function(e){var i=n[e]||a.camera;i&&(disable(),i.enable(),i.forcePosition())})))}();var o=l.id||"cinema_"+e++;return n[o]=l,a[o]=l,o},a.get=function(a){return n[a]},a.set=function(e){a.camera!=e&&(a.camera&&a.camera.disable(),a.camera=e)},a.unset=function(e){a.camera==e&&(a.cinemaCamera=null)}};var SCENES,CinemaCamera=pc.createScript("cinemaCamera");CinemaCamera.attributes.add("id",{type:"string"}),CinemaCamera.attributes.add("autoStart",{type:"boolean",default:!1}),CinemaCamera.attributes.add("pan",{title:"Pan",type:"boolean",default:!1,description:"Before the cinema camera activates, you can either immediately teleport game camera to it, or have a gradual transition (pan) to it."}),CinemaCamera.attributes.add("panDuration",{title:"Pan Duration",type:"number",default:0,description:"If pan is enabled, this number will specify how long the panning will take in seconds."}),CinemaCamera.attributes.add("startEvent",{type:"string"}),CinemaCamera.attributes.add("lerp",{title:"Lerp",type:"number",default:0,precision:6,description:"If non-zero, the game camera will smoothly chase the cinema camera, technically never reaching it, always getting closer. The smaller the number, the faster it will close the distance between them."}),CinemaCamera.attributes.add("localUp",{title:"Use Local UP",type:"boolean",default:!1,description:"If checked, uses cinema camera local UP vector, instead of world UP. Enable this, if you need to look directly up or down."}),CinemaCamera.attributes.add("projDuration",{title:"Projection Blend Duration",type:"number",default:0,description:"When a cinema camera is activated with a different projection type (e.g. perspective vs orthographic), this will specify how long the blending will be in seconds."}),CinemaCamera.attributes.add("overrideLayers",{title:"Override Layers",type:"boolean",default:!1,description:"If enabled, will use the layers that are listed in this cinema camera."}),CinemaCamera.prototype.initialize=function(){var e=this,t=e.entity,a=e.Camera=t.findByName("Camera")||t.parent.findByName("LookAt"),o=t.findByName("LookAt"),i=!1;let n=!1;var r,c=t.findByName("LIGHTS"),l=e.camera=a.camera;let s=e.lerp,A=0,p=0,C=0,m=e.pan;const u=e.localUp,d=e.panDuration,f=e.projDuration,E=new pc.Vec3,M=new pc.Quat,h=new pc.Mat4,R=new pc.Mat4,b=new pc.Mat4,g=new pc.Quat,v=new pc.Vec3;l.enabled=!1,getLocals(t),getGlobals(t),getLocals(a),getLocals(o);e.id=CINEMACAMERAS.push(e);e.orbitSpeed=0;e.onUpdate=function(c){if(0===c)return;if(!i)return;if(CINEMACAMERAS.overlayCamera&&CINEMACAMERAS.overlayCamera!==e)return;l.projection===pc.PROJECTION_PERSPECTIVE&&l.fov!==CAMERA.camera.fov&&(m?CAMERA.camera.fov+=(l.fov-CAMERA.camera.fov)/10:CAMERA.camera.fov=l.fov),n&&function blendProjection(e){p+=e/f,p>1&&(p=1);const t=(new pc.Mat4).lerp(b,R,function SineInOut(e){return 0===e?0:1===e?1:.5*(1-Math.cos(Math.PI*e))}(p));CAMERA.camera.projectionMatrix.copy(t),1===p&&(n=!1,CAMERA.camera.projection=l.projection)}(c),r&&o.setPosition(r.getPosition()),e.orbitSpeed&&t.rotate(0,e.orbitSpeed,0);const C=a.getPosition(),y=o.getPosition(),P=u?a.up:pc.Vec3.UP;if(h.setLookAt(C,y,P),g.setFromMat4(h),m){0===d?A=1:A+=c/d,A>1&&(A=1);const e=0===(I=A)?0:I>=1?1:.5*(1-Math.cos(Math.PI*I)),t=v.lerp(E,C,e),a=g.slerp(M,g,e);return CAMERA.setPosition(t),CAMERA.setRotation(a),void(1===A&&(m=!1))}var I;if(s){const e=CAMERA.getPosition(),t=CAMERA.getRotation(),a=ANIMATION.A2BFrictionLerp(e,C,1-s**c),o=ANIMATION.A2BFrictionQuaternion(t,g,1-s**c);CAMERA.setPosition(a),CAMERA.setRotation(o)}else CAMERA.setPosition(a.getPosition()),CAMERA.lookAt(y,P)},e.enablePan=function(){m=!0,A=0,E.copy(CAMERA.getPosition()),M.copy(CAMERA.getRotation())},e.forcePosition=function(){i&&(CAMERA.stop(),a.lookAt(o),CAMERA.setToEntity(a))},e.enable=function(){if(!i){if(i=!0,e.autoStart){const e=a.getPosition(),t=a.getRotation();CAMERA.setPosition(e),CAMERA.setRotation(t)}if(function enableLights(){c&&(c.enabled=!0)}(),CAMERA.setColor(e.camera.clearColor),CAMERA.camera.projection!==l.projection)if(f>0){const e=CAMERA.camera.nearClip,t=CAMERA.camera.farClip,a=APP.graphicsDevice.width/APP.graphicsDevice.height;if(p=0,n=!0,b.copy(CAMERA.camera.projectionMatrix),l.projection===pc.PROJECTION_PERSPECTIVE)C=l.fov,R.setPerspective(C,a,e,t);else{const o=l.orthoHeight;R.setOrtho(-o*a,o*a,-o,o,e,t)}}else CAMERA.camera.projection=l.projection,n=!1;e.pan&&e.enablePan(),CAMERA.LookAt=o,CAMERA.camera.nearClip=l.nearClip,CAMERA.camera.farClip=l.farClip,CAMERA.camera.frustumCulling=l.frustumCulling,CAMERA.camera.orthoHeight=l.orthoHeight,CAMERA.camera.clearColorBuffer=l.clearColorBuffer,CAMERA.camera.clearDepthBuffer=l.clearDepthBuffer,e.overrideLayers&&(CAMERA.camera.layers=[...l.layers]),CINEMACAMERAS.set(e)}},e.disable=function(){i&&(!function disableLights(){c&&(c.enabled=!1)}(),i=!1,e.orbitSpeed=0,CINEMACAMERAS.unset(e))},e.follow=function(e){r=e},e.overlay=function(t){t&&e.follow(t),e.enable()},e.orbit=function(t){e.orbitSpeed=t||5,e.enable()},e.moveAndRotateTo=function(e,i,n,r,c){r=r||1.5,c=c||EASING.SineOut,e&&ANIMATION.moveToGlobal(t,e.getPosition(),r,c),i&&ANIMATION.moveToGlobal(a,i.getPosition(),r,c),n&&ANIMATION.moveToGlobal(o,n,r,c)},e.restore=function(e,i){e=e||1,i=i||EASING.SineOut,ANIMATION.moveToGlobal(t,t.gPos,e,i),ANIMATION.moveTo(a,a.pos,e,i),ANIMATION.moveTo(o,o.pos,e,i)},e.setColor=function(t){t!=e.camera.clearColor&&(e.camera.clearColor=t,CAMERA.setColor(e.camera.clearColor))},e.autoStart&&(!e.startEvent&&SCENES&&(e.startEvent=SCENES.getStartEvent(t)),e.enable()),e.startEvent&&on(e.startEvent,(function(){e.enable()}))},CinemaCamera.prototype.postUpdate=function(e){this.onUpdate(e)};var Card=pc.createScript("card");Card.prototype.initialize=function(){var n,e=this,o=e.entity,t=o.findByName("Paper"),i=o.findByName("Front"),a=o.findByName("Back"),l=o.findByName("Bar"),r=i.findByName("symbolSprite"),c=!0;function setFront(n){e.isFront=n,t.setLocalEulerAngles(0,e.isFront?0:180,0),a.enabled=!e.isFront,i.enabled=e.isFront}getLocals(l),setFront(!1),e.setFront=setFront,e.fill=function(n){if(fill(e,n),r&&n.symbol){let e="WHITE";n.symbol.includes("Symbol_")&&(e="BLUE"),"Symbol_Skull"==n.symbol&&(e="RED"),r.element.color=COLOR.get(e)}if(l)return resetLocals(l),l.enabled=!0,l.script.barStars.setAmount(e.data.rarity,1,e.data.rarity),e},e.collectStars=function(){l&&(ANIMATION.blink(l,3),ANIMATION.moveTo(l,{x:l.pos.x,y:5,z:l.pos.z},.6))},e.onMouseDown=function(){if(c)return e.onCardDown?e.onCardDown(e):void s.flip()},e.enable=function(){c=!0},e.disable=function(){c=!1};var s=e.ANIMATE={};s.deal=function(t){var i=t.from||new pc.Vec3,a=t.to||new pc.Vec3,l=t.time||.5,r=t.easing||EASING.SineOut;SFX.playPitch("Throw"),N.hide(),t.data&&e.fill(t.data),toFront(o),o.setLocalPosition(i.x,i.y,i.z),ANIMATION.moveTo(o,a,l,r);var c=t.scale||.45;o.localScale.set(c,c,c),ANIMATION.scaleTo(o,null,l,r),setFront(!1),n&&n.stop(),ANIMATION.bounceAngle(o),delay((function(){s.airReveal()}),.3)},s.airReveal=function(o){setFront(!1),o=o||3,n=ANIMATION.rotateTo(t,{x:0,y:360,z:0},o||3,EASING.ElasticOut),SFX.playPitch("Throw"),delay((function(){e.isFront=!0,i.enabled=!0,a.enabled=!1}),.03*o)},s.flip=function(){var n=.35;e.isFront=!e.isFront,SFX.playPitch("Throw"),ANIMATION.rotateTo(t,{x:0,y:e.isFront?360:180,z:0},n),delay((function(){resetLocals(l),a.enabled=!e.isFront,i.enabled=e.isFront}),.105),ANIMATION.moveTo(t,{x:0,y:0,z:150},.175,EASING.SineOut,(function(){ANIMATION.moveTo(t,{x:0,y:0,z:0},.175,EASING.SineIn,(function(){ANIMATION.moveTo(t,{x:0,y:0,z:20},.0875,EASING.SineOut,(function(){ANIMATION.moveTo(t,{x:0,y:0,z:0},.0875,EASING.SineIn)}))}))})),delay((function(){setFront(e.isFront)}),.7)};var N=e.GLOW={},d=o.findByName("Glow");d&&(d.enabled=!1),N.good=function(n){N.show(n||"#EA00FF")},N.bad=function(n){N.show(n||"#FF0000")},N.show=function(n){d&&(d.enabled=!0,n&&(n=COLOR.get(n),d.element&&(d.element.color=n),d.sprite&&(d.sprite.color=n)),ANIMATION.fadeIn(d),ANIMATION.bounceScale(d))},N.hide=function(){d&&(d.enabled=!1)}};var Finger=pc.createScript("finger"),FINGER=new function(){var o=this;function getTemplate(o){ASSETS.loadTemplate("FINGER",root,o)}o.show=function(o){getTemplate((()=>FINGER.show(o)))},o.tap=function(o){getTemplate((()=>FINGER.doAction("tap",o)))},o.swipeTo=function(o){getTemplate((()=>FINGER.doAction("swipeTo",o)))},o.swipeLeftRight=function(o){getTemplate((()=>FINGER.doAction("swipeLeftRight",o)))},o.touch=function(o){getTemplate((()=>FINGER.doAction("touch",o)))},o.circle=function(o){getTemplate((()=>FINGER.doAction("circle",o)))},o.swipeUp=function(o){getTemplate((()=>FINGER.doAction("swipeUp",o)))},o.tapRandom=function(o){getTemplate((()=>FINGER.doAction("tapRandom",o)))},o.hide=function(){getTemplate((()=>FINGER.hide()))}};Finger.prototype.initialize=function(){var o=this;FINGER=o;var t,i,e,n,a,c,s,p,d,l=o.entity,r=l.findByName("Sprite"),u=l.findByName("Icon"),f=l.findByName("TrailContainer"),A=0;function doSwipeTo(){if(t){var i=o.data,n=i.time||1;e=i.curve,DELAY.unique("Finger",doSwipeTo,n+.1),u.element.opacity=1,r.setLocalPosition(a,c,0),u.setLocalPosition(pc.Vec3.ZERO),ANIMATION.moveTo(r,{x:i.swipeToX||0,y:i.swipeToY||0,z:0},n,EASING.Linear),e&&ANIMATION.moveTo(u,{x:e.x||0,y:e.y||0,z:0},.5*n,EASING.SineOut),DELAY.start((function(){ANIMATION.fadeOut(u,.5*n),e&&ANIMATION.moveTo(u,pc.Vec3.ZERO,.5*n,EASING.SineIn)}),.5*n)}}function update(){if(t){var o=Math.sin(n);return"touch"==i?(n+=.3,void u.setLocalPosition(0,50+20*o,0)):"circle"==i?(n+=.05,u.setLocalPosition(Math.sin(n)*p,Math.cos(n)*p,0),void doTrail()):"swipeUp"==i?(n+=.3,u.setLocalPosition(0,100*o,0),void doTrail()):"swipeLeftRight"==i?(u.element.opacity=1,r.setLocalPosition(a+250*o,c,0),e&&u.setLocalPosition(0,Math.abs(Math.cos(n))*e.y,0),n+=.05,void doTrail()):"tap"==i||"tapRandom"==i?(n+=.3,o<0?(s||"tapRandom"==i&&(a+=RANDOM.spectrum(150),c+=RANDOM.spectrum(150)),o=0,s=!0):s=!1,r.setLocalPosition(a,c,0),void u.setLocalPosition(0,30*o,0)):"press"==i?(n+=.3,void(++s>=0&&(s=-20,function doShockWave(){FX2D.SHOCKWAVE.expand({positon:r.getLocalPosition().clone().add(u.getLocalPosition()),parent:f})}()))):void 0}}function doTrail(){d&&(A||FX2D.FADE.vanish({position:r.getLocalPosition().clone().add(u.getLocalPosition()),scale:.05,sprite:"FX_Circle",time:1,parent:f}),--A<0&&(A=3))}r.enabled=!0,o.hide=function(){t=!1,DELAY.cancel("Finger"),removeChild(l),stop(update)},o.show=function(f){o.hide(),l.enabled=!0,A=0;var T=o.data=f||{};a=T.x||0,c=T.y||0,n=RANDOM.decimal(),i=T.action||"touch",s=0,t=!0,e=T.curve,p=T.radius||200,d=f.hasTrail;var h=f.scale||1;if(r.setLocalPosition(a,c,0),u.setLocalPosition(0,0,0),r.setLocalEulerAngles(0,0,T.rotation||0),u.setLocalEulerAngles(0,0,T.angle||0),u.setLocalScale(h,h,h),f.corner&&(f.parent=UICORNERS[f.corner]),addChild(l,f.parent||UI.entity),startFixed(update),"swipeTo"==i)return doSwipeTo()},o.doAction=function(t,i){(i=i||{}).action=t,o.show(i)},o.tap=function(t){o.doAction("tap",t)},o.swipeTo=function(t){o.doAction("swipeTo",t)},o.swipeLeftRight=function(t){o.doAction("swipeLeftRight",t)},o.touch=function(t){o.doAction("touch",t)},o.circle=function(t){o.doAction("circle",t)},o.swipeUp=function(t){o.doAction("swipeUp",t)},o.tapRandom=function(t){o.doAction("tapRandom",t)}};function IdleData(e){var r=this,n=r.id=e.id;r.title=e.title,r.symbol=e.symbol,r.color=e.color;var t=r.Amount=new IdleDataAmount(r,e.amountConfig),f=r.Modifiers=new IdleDataModifiers(r,e.modifiersConfig),s=r.Level=new IdleDataLevel(r,e.levelConfig),i=r.Managers=new IdleDataManagers(r,e.managerConfig),o=r.Timer=new IdleDataTimer(r,e.timerConfig),a=r.Investment=new IdleDataInvestment(r);function refresh(e){f.refresh(),t.refresh(),s.refresh(),i.refresh(),a.refresh(),o.refresh(),r.level=s.level,e||r.fire("onRefresh")}r.managers=[],r.refresh=refresh,s.getLevel(),r.reset=function reset(){f.reset(),t.reset(),s.reset(),i.reset(),a.reset(),o.reset(),refresh(),r.fire("onReset")},r.fire=function(e,r){fire(n+":"+e,r||n)},r.on=function(e,r){on(n+":"+e,r)},r.off=function(e,r){off(n+":"+e,r)}}function IdleDataLevel(e,l){var t=this,r="LV"+e.id,n=STRING.getArray(l.price)||[0],v=n.length?n[n.length-1]:0,i=l.coefficient;t.currency=l.currency||"Coin";l.levelNames=STRING.getArray(l.levelNames)||[0];var u=t.levelUpTable=STRING.getArray(l.levelUpTable)||[0];u[0]&&u.unshift(0);var c=t.levelUp10=l.levelUp10;t.maxLevel=l.maxLevel,t.unlocksAt=l.unlocksAt||0,t.isComplete=!1;var s=u.length>1,a=v,o=l.maxLevel;t.max=0,t.nextLevelUpAt=0,t.multiplier=1;var L,f=t.level=get(r)||1;function getLevel(){if(s){var l,L=0,p=e.amount,g=u[0],m=u[1];if(p<10&&c)return L=1,g=0,m=10,setLevel();for(l=1;l<u.length;l++)if(L++,g=u[l-1],m=u[l],p<u[l]||isLevelLocked())return setLevel();m=u[u.length-1],g=u[u.length-2]||0;for(var h=m-g,A=1,x=h;p>=m&&!(o&&L>=o);)if(L++,A++,g+=x,x=MATH.round(h*i**A),m+=x,isLevelLocked())return setLevel();return setLevel()}function setLevel(){t.max=m,t.min=g,t.value=p-g,t.nextLevelUpAt=m,t.level=f=set(r,L),function getPriceLevel(){if(!a)return setPrice(0);if(t.level>=o)return t.isComplete=!0,setPrice(0);var e=t.level-1;return n[e]?setPrice(n[e]):setPrice(Math.ceil(v*i**e));function setPrice(e){return t.price=e,t.price}}()}function isLevelLocked(){return a&&L>=f}}t.refresh=function(){t.canPurchase=t.unlocksAt<=get("userLevel");var l=f;(!L||e.amount>=t.nextLevelUpAt)&&getLevel(),L=!0,function refreshBonus(){if(t.multiplier=1,1==t.level)return;t.multiplier=c?3:2;for(var e=3;e<=t.level;e++)t.multiplier*=2}(),e.level=t.level,e.nextLevelUpAt=t.nextLevelUpAt,l<f&&e.fire("onLevelUp")},t.reset=function reset(){f=t.level=set(r,1)},t.getLevel=getLevel,t.purchase=function(){t.level>=o||(f=increase(r),t.refresh())}}function IdleDataTimer(e,t){var a=this,n="TM"+e.id,r="DP"+e.id,i="DR"+e.id,o=a._capacity=t.capacity,c=t.percentEarnings,d=a._speed=t.speed,l=t.speedMultiplier;a.currency=t.currency||"Coin",a.managerBonus=1,a.enabled=t.enabled,a.productionPerSecond=0;var s=t.collectWallet,u=!0;a.deployed=get(r),a.isAutomated=t.isAutomated;var p=a.timer=TIMER.spawn({id:n,killOnReach:!0,duration:get(i)||1e16,autoStart:!1,persistent:!0,isAuto:0!=e.Managers.managerID});function increaseDeployed(e){a.deployed=increase(r,e)}on(n+":onTimeUp",(function onTimeUp(){increaseDeployed(a.capacity),e.fire("onTimeUp"),(a.isAutomated||e.Managers.managerID)&&a.start()})),a.start=function(){a.enabled&&!p.isPlaying&&(p.start({duration:1e3*a.loadTime}),e.fire("onTimeStart"))},a.refresh=function(){a.enabled&&e.Amount.amount&&(!function calculateValues(){var t=e.Investment.multiplier,n=e.Managers.multiplier*t*(get("ADBOOST")||1);if(c)return a.capacity=c*(1+e.Amount.percent/100)*n,a.speed=d/n,a.loadTime=Math.round(a.speed),a.productionPerSecond=a.capacity/a.loadTime,void p.setDuration(set(i,1e3*a.loadTime));for(var r=e.Amount.amount-1,s=1,u=1,m=1,y=1;y<e.Level.level;y++)u*=s*=2,m*=s*l;a.capacity=Math.round(o+u*r*o)*n,a.speed=Math.round(d+m*r*d)*n,a.loadTime=Math.round(a.capacity/a.speed);var f=1e3*a.loadTime;a.productionPerSecond=a.capacity/a.loadTime,p.setDuration(set(i,f))}(),(a.isAutomated||e.Managers.managerID)&&a.start(),u&&e.Amount.amount&&p.cycles&&increaseDeployed(a.capacity*p.cycles),u=!1)},a.reset=function reset(){a.enabled&&(u=!0,a.deployed=set(r,0),p.cycles=0,p.stop())},a.collect=function(e){if(!a.enabled||!a.deployed)return 0;var t=a.deployed;if(a.deployed=set(r,0),s){var n=WALLET.get(a.currency);e?n.increase(t):n.collect(t)}return a.start(),t},a.resetDeployed=function(){a.enabled&&(a.deployed=set(r,0),a.start())}}function IdleDataManagers(e,a){var r=this,n="MN"+e.id,l=r.idleID=a.idleID,i=a.enabled;l&&on(l+":onRefresh",(()=>e.refresh())),r.multiplier=1;var t=r.pool=[];r.multiplier=1,r.managerID=get(n),r.managerIdleData=null;var g=!0;r.managerID&&t.push(r.managerID),r.refresh=function refresh(){if(i){r.managerID=t[0];var e=r.managerIdleData=IDLE[l];if(g&&e&&e.refresh(!0),r.multiplier=1,r.managerID&&(r.multiplier=e?e.level+1:2*t.length),g){g=!1;var a=get(n);a&&r.add(a,!0)}}},r.reset=function reset(){t=r.pool=[],r.managerID=set(n,0),r.managerIdleData=null,r.multiplier=1},r.add=function(a){set(n,a),pushUnique(t,a),e.refresh(),e.fire("onManager")}}function IdleDataAmount(e,t){var n=this,r=e.id,a=STRING.getArray(t.price),o=a.length?a[a.length-1]:0,u=!1;n.idle=e,n.title=e.title,n.symbol=e.symbol;var i=t.toPercent||10,m=n.coefficient=t.coefficient,c=n.currency=t.currency||"Coin";function getPrice(e){return e=MATH.clamp(e||1,n.maxAmount)-1,null!=a[e]?a[e]:(e-=a.length-1,Math.ceil(o*m**e))}function getTotalPrice(e){var t=0;e=e||1;for(var r=1;r<=e&&!(n.maxAmount&&n.amount+r>n.maxAmount);r++)t+=getPrice(n.amount+r);return t}n.amount=get(r)||t.startAmount||0,n.percent=0,n.text=t.text,n.maxAmount=t.maxAmount,n.isComplete=!1,n.purchase=function(t,r){if(t=t||1,n.maxAmount&&(t=MATH.clamp(t,n.maxAmount-n.amount)),log("IdledataPurchase",t,n.maxAmount),t){var a=getTotalPrice(t);!r&&WALLET[c].value<a||(n.increase(t),WALLET[c].purchase(a),log("PURCHASED, deployed?",e.Timer.deployed),e.Timer.deployed||e.Timer.start(),e.refresh())}},n.canPurchase=function(e){return!!u||WALLET[c].value>=getTotalPrice(e)},n.increase=function(e){return u=!1,n.set(n.amount+(e||1))},n.set=e.set=function(t){return n.amount=set(r,MATH.clamp(t,n.maxAmount)),n.isComplete=n.amount==n.maxAmount,e.refresh(),n.amount},n.setMax=e.setMax=function(e){n.amount<e&&n.set(e)},n.getAmountToBuy=function(){var t=WALLET[c].value;if(n.affordablePrice=n.price,n.price>t)return 0;if(!n.amount)return 1;if(!get("BuyMax"))return 1;for(var r=e.Level.nextLevelUpAt,a=1;n.amount+a<r;){var o=getTotalPrice(a+1);if(o>t)break;a++,n.affordablePrice=o}return a},n.refresh=function refresh(){n.price=e.price=getPrice(n.amount+1),n.percent=e.percent=e.Modifiers.percent+n.amount*(i||0),e.amount=n.amount},n.reset=function reset(){set(r,0),n.amount=t.startAmount||0}}var IDLE=new function(){var r=this,e={};function refresh(){for(var r in e)e[r].refresh()}on("TOY:onFinalize",(function init(){if(!CONFIG.IDLE)return;for(var e in CONFIG.IDLE)r.spawn(e);refresh()})),on("IDLE:Refresh",refresh),r.spawn=function(n){return r[n]=e[n]=new IdleData(CONFIG.IDLE[n]),r[n]},r.get=function(e){if(!Array.isArray(e))return r[e];var n=[];for(var o in e){var i=e[o];r[i]&&n.push(r[i])}return n.length?n:void 0},r.getHourlyProduction=function(r){var n=3600*(r||1),o=0;for(var i in e)o+=e[i].Timer.productionPerSecond;var t=o*n;return Math.ceil(t)},r.getManagers=function(){var r=[];for(var n in e)push(e[n].Managers.pool,r);return r},r.collect=function(r){var n=0;for(var o in e)n+=e[o].Timer.collect(r);return n},r.resetDeployed=function(){for(var r in e)e[r].Timer.resetDeployed()},r.getDeployed=function(){var r=0;for(var n in e)r+=e[n].Timer.deployed;return r},r.reset=function(){for(var r in e)e[r].reset()}};function IdleDataInvestment(e,t){var n=this,s="NV"+e.id;n.multiplier=1,n.managers=[],n.investmentID=get(s);n.pool=[];n.data={},n.set=function(e){n.data=e,n.investmentID=set(s,e.id)},n.refresh=function refresh(){},n.reset=function reset(){n.investmentID=set(s,0)}}function IdleDataModifiers(e,r){var n=this,t=(e.id,r);for(var i in n.percent=0,n.refresh=function refresh(){for(var e in n.percent=0,t)t[e].refresh()},n.reset=function reset(){n.percent=0},t)t[i]=new modifierItem(t[i]);function modifierItem(r){var t=r.varName||"Modifier",i=r.toPercent||1,f=get(t);on(t,(function onData(r){if(f==r)return;f=r,e.refresh()})),this.refresh=function(){n.percent+=f*i}}}var IdleAmountDisplayer=pc.createScript("idleAmountDisplayer");IdleAmountDisplayer.prototype.postInitialize=function(){var e,t=this,r=t.entity,n=r.findByName("Purchase");n&&(n=n.buttonScript);function refresh(){var t={};t.title=e.title,t.titleAmount=e.title+" ("+e.amount+")",t.text=e.text,t.textPercent=replace(e.text,{percent:e.percent,amount:e.amount}),fill(r,t),t={text:e.price,isUnlocked:e.canPurchase()},n&&(n.fill(t),n.entity.enabled=!e.isComplete)}t.fill=function(t){!function reset(){if(!e)return;e.currency&&off(e.currency,refresh)}(),(e=t).currency&&(on(e.currency,refresh),n&&fill(n.entity,{currency:e.currency,text:e.price,color:e.idle.color})),refresh()},t.onMouseDown=function(t){if("Purchase"==t.label)return e.purchase()}};var IdleDisplayer=pc.createScript("idleDisplayer");IdleDisplayer.prototype.postInitialize=function(){var i=this.entity,t=getChildScript(i,"Amount","idleAmountDisplayer");this.fill=function(i){i,t&&t.fill(i.Amount)}};var UpgradeBox=pc.createScript("upgradeBox");UpgradeBox.attributes.add("id",{type:"string",default:"UpgradeBox"}),UpgradeBox.attributes.add("autoFill",{title:"Idle IDs",type:"string"}),UpgradeBox.prototype.postInitialize=function(){var t,e=this,i=e.entity,l=getChildScript(i,"Tabs","tabs"),a=getChildScript(i,"IdleItem","idleDisplayer");function fill(t){var e=STRING.getArray(t);l.fill(IDLE.get(e),onTabDown),l.click(e[0])}function reset(){l.click(array[0])}function onTabDown(t){delay((()=>a.fill(t.data)),.01)}e.setID=function(e){e&&(t=e,on(t+":Fill",fill),on(t+":Reset",reset))},e.autoFill.length&&fill(e.autoFill)};var TextConfig=pc.createScript("textConfig");TextConfig.attributes.add("id",{title:"ID",type:"string"}),TextConfig.attributes.add("items",{title:"Items",type:"string",array:!0}),TextConfig.prototype.initialize=function(){var t=this,i=t.entity,e=t.id=t.id||i.name;CONFIG.add("TEXT."+e,t.items)};var IdleComponent=pc.createScript("idleComponent");IdleComponent.attributes.add("canCollect",{type:"boolean",default:!0}),IdleComponent.prototype.initialize=function(){var e=this,t=e.entity;e.Enabled=t.findByName("Enabled"),e.Disabled=t.findByName("Disabled"),e.upgradeField=t.findByName("upgradeField"),e.deployField=t.findByName("deployField"),e.capacityField=t.findByName("capacityField"),e.speedField=t.findByName("speedField"),e.Investment=t.findByName("Investment"),e.PurchaseBar=getChildScript(t,"PurchaseBar","bar"),e.UpgradeBar=getChildScript(t,"UpgradeBar","bar"),e.TimeBar=getChildScript(t,"TimeBar","bar"),e.CollectButton=getChildScript(t,"CollectButton","buttonProximity");var n,i,r=1;function refresh(){if(n){i=!0,n.Amount.price>WALLET.Cash.value&&(i=!1),function enable(t){i=t,e.Enabled.enabled=e.Disabled.enabled=!1;let r=i?e.Enabled:e.Disabled;r.enabled=!0,CONTENT.fill(r,{currSymbol:"Symbol_Cash",price:n.Amount.affordablePrice||n.Amount.price})}(i),r=n.Amount.getAmountToBuy();var t=n.Amount.amount;e.upgradeField.element.text=i&&r?t+" + "+r:t,e.speedField&&(e.speedField.element.text=DATE.days(1e3*n.Timer.loadTime)),n.Amount.amount&&(e.PurchaseBar.entity.enabled=e.UpgradeBar.entity.enabled=e.upgradeField.enabled=!0);var l=n.Level.min,a=n.Level.max;e.PurchaseBar.setAmount(t+r,l,a,!0),e.UpgradeBar.setAmount(t,l,a,!0),e.capacityField&&ANIMATION.fillField(e.capacityField,{value:n.Timer.capacity||n.Timer._capacity,commarize:!0,prefix:"PRODUCTION: "})}}function refreshDeploy(){e.deployField&&(n.Timer.deployed?ANIMATION.fillField(e.deployField,{value:n.Timer.deployed,commarize:!0,prefix:"DEPLOYED: ",lastValue:0}):e.deployField.element.text=" ")}getLocals(t),e.canCollect&&(on("PROXIMITY:onEnter",tryCollect),on("PROXIMITY:onClick",tryCollect),startFixed((function producing(){if(!n||!e.TimeBar)return;e.TimeBar.setPercent(n.Timer.timer.percent,!0)}))),SIGNAL.on("Cash",refresh),e.init=function(t,i){n&&n.off("onTimeUp",refreshDeploy),n=IDLE[t],extract(i,e),e.CollectButton&&(e.CollectButton.label=n.id),SIGNAL.on("BuyMax",refresh),n.on("onTimeUp",refreshDeploy),e.Investment&&fill(e.Investment,n.Investment.data),refresh(),refreshDeploy()};var l=!1,a=0;function pressing(){if(!TOUCH.isDown||!i)return stop(pressing);(a+=dtFixed)<30||(a=20,l=!0,doPurchase())}function doPurchase(){log("IdleComponent DO PURCHASE"),n.Amount.purchase(r)}function tryCollect(e){n&&e==n.id&&n.Timer.deployed&&(n.Timer.collect(),refreshDeploy(),n.fire("onCollect"))}e.onMousePress=function(e){if("PurchaseButton"==e.label)return function startPurchasing(){if(!i)return;a=0,startFixed(pressing)}()},e.onMouseDown=function(e){var t=e.label;return"PurchaseButton"==t?function stopPurchasing(){if(stop(pressing),l)return void(l=!1);if(!i)return;doPurchase()}():"CollectButton"==t?collect():void 0}};var IdlePurchase=pc.createScript("idlePurchase");IdlePurchase.prototype.initialize=function(){var e,n,i,r,a=this,t=a.entity,o=0,s=t.findByName("PurchaseButton"),c=!1;function refresh(){n=!0;var i=e.Amount.price;i>WALLET.Coin.value&&(n=!1),0===i?(a.Price.enabled=!1,a.FREE.enabled=!0):(a.FREE.enabled=!1,a.Price.enabled=!0),function enable(e){n=a.isEnabled=e,a.Enabled.enabled=n,a.Disabled.enabled=!n}(n),r=e.Amount.getAmountToBuy(),CONTENT.fill(a.Price,{text:e.Amount.affordablePrice});var t=2*-a.PriceTag.getLocalPosition().x,o=1;t>150&&(o=150/t),a.Price.setLocalScale(o,o,o)}function pressing(){if(!TOUCH.isDown||!n)return stop(pressing);(o+=dtFixed)<30||(o=20,i=!0,doPurchase())}function doPurchase(){e.Amount.purchase(r)}a.Price=t.findByName("Price"),a.PriceTag=t.findByName("PriceTag"),a.Enabled=t.findByName("Enabled"),a.Disabled=t.findByName("Disabled"),a.FREE=t.findByName("FREE"),getLocals(s),a.init=function(n,i){e=IDLE[n],SIGNAL.on("BuyMax",refresh),SIGNAL.on("Coin",refresh),c=i,refresh()},a.shake=function(){s.setLocalPosition(s.pos.x+spectrum(10,5),s.pos.y,s.pos.z),ANIMATION.moveTo(s,s.pos,random(1.3,.8),EASING.ElasticOut),SFX.play("Error")},a.onMousePress=function(e){"PurchaseButton"==e.label&&function startPurchasing(){if(c)return;if(!n)return;o=0,startFixed(pressing)}()},a.onMouseDown=function(r){if("PurchaseButton"==r.label){if(c)return fire("PROXIMITY:onClick",e.id);n||a.shake(),function stopPurchasing(){if(stop(pressing),i)return void(i=!1);if(!n)return;if(c)return;doPurchase()}()}}};var LeaderboardLadder=pc.createScript("leaderboardLadder");LeaderboardLadder.prototype.initialize=function(){var a=this.entity,r=getChildScript(a,"HorizontalGallery","horizontalGallery");function onGalleryDown(a){log("on Leaderboard down");var r=a.data.avatarID;if(r==ME.avatarID)return log("SHARE SCORE"),PLATFORM.shareScore(playAgain);BOTS.isBot(r)&&(r=null),log("PLAY WITH FRIEND"),PLATFORM.playWithFriend(r,playAgain,"Challenge")}function playAgain(){fire("BUTTON:onClick","PlayAgainButton")}on("LEADERBOARDS:Show",(function show(){SCOREBOARD.getLadder((function onLadder(a){var o=copy(a);o.reverse();var e=[];for(var l in o){var n=o[l];e.push({avatarID:n.avatarID,fullName:n.fullName,userPhoto:n.userPhoto,score:n.score,rank:n.rank})}r.fill(e,onGalleryDown),r.Gallery.scrollToPos(ME.vars.rank-2,!0),r.Gallery.scrollToAttribute("avatarID",ME.avatarID,!1,2,EASING.ElasticOut),SCOREBOARD.onShow()}))})),on("LEADERBOARDS:Hide",(function hide(){}))};var RIVALSLADDER=new function(){this.show=function(){}},RivalsLadder=pc.createScript("rivalsLadder");RivalsLadder.attributes.add("showFriendPassed",{type:"boolean",default:!0}),RivalsLadder.prototype.initialize=function(){var e=this,o=e.entity,t=o.findByName("Content");ASSETS.loadTemplate("FRIENDELIMINATED_Particle",null,(function(e){e.destroy()}),!0),getLocals(t);var a=t.findByName("Template"),i=o.findByName("MeTemplate");a.enabled=!1;var r=[],s=[],c=800/(2*(CONFIG.GAME.SCORING.scorePerMinute||100)),l=new pc.Vec3,d=t.pos.clone(),u=!1;function reset(){var e;for(e in stop(onUpdate),s)s[e].disable();s=[]}function resort(){for(let e=s.length-1;e>=0;e--)toFront(s[e].entity)}function show(){SCOREBOARD.getLadder().then(fill)}function fill(e){for(reset(),r=e,CONTENT.fill(i,{userPhoto:r[0].userPhoto}),n=1;n<r.length;n++){var o=r[n];o!=ME&&s.push(new LadderItem(o))}on("PlayerScore",updateScore),updateScore(),u=!1,resort(),startFixed(onUpdate)}function updateScore(){for(var e in l.x=SCORE.get()*c,d.x=t.pos.x-l.x,s)s[e].refresh();checkEliminated()}function onUpdate(){for(var e in ANIMATION.A2BFrictionLocalPosition(t,d),s)s[e].onUpdate()}function checkEliminated(o){var t=s[0];!t||t.distance>0||(s.shift(),t.disable(),o||(e.showFriendPassed&&FX2D.FRIEND.eliminated(t),fire("RIVALSLADDER:onPassFriend",t.vars.userPhoto)),GAME.Data.increaseTotal("PlayersEliminated"),checkEliminated(!0))}function LadderItem(e){var o=this;o.vars=e.vars;var n,i,r=!1;o.fullName=e.fullName,o.userPhoto=e.userPhoto,o.score=e.vars.score,o.color=e.vars.color,o.distance=0,o.position=new pc.Vec3(o.vars.score*c,0,0);var s=.5;o.show=function(){r||(r=!0,n=o.entity=a.clone(),CONTENT.fill(n,{userPhoto:e.userPhoto,score:e.vars.score,color:e.vars.color}),addChild(n,t),(i=n.findByName("Score")).enabled=!1,n.setLocalPosition(o.position),ANIMATION.bounceScaleTo(n,0,s,.5,EASING.SineOut),u||resort())},o.refresh=function(){if(o.distance=o.position.x-l.x,o.distance>440)return;if(r||o.show(),!n||o.distance>500)return;if(o.distance<150)return n.setLocalScale(.8,.8,.8);i.enabled||(i.enabled=!0,ANIMATION.bounceScaleTo(i,0,2));let e=o.distance-150,t=s;if(o.distance<=500&&(s=1-e/350*.5),s*=.8,u)return n.setLocalScale(s,s,s);ANIMATION.bounceScaleTo(n,t,s,.5,EASING.SineOut)},o.onUpdate=function(){r&&ANIMATION.A2BFrictionLocalPosition(n,o.position)},o.disable=function(){r=!1,n&&n.destroy(),n=null}}on("GAME:onReady",show),on("UI:offGame",reset),show()};var Sticker=pc.createScript("sticker"),STICKER=new function(){this.get=function(e,t,n){!function getInstance(e){ASSETS.loadTemplate("STICKER",root,e)}((function(){STICKER.get(e,t,n)}))}};Sticker.prototype.initialize=function(){var e=this;STICKER=e;var t,n,i,a,r=e.entity,o=r.findByName("Camera"),d=r.findByName("Res"),l={width:512,height:512},T=getChildrenNames(r.findByName("Scenes"));o.enabled=!1,e.get=function(e,r,h){if(function init(){a||(a=!0,i=getChildrenNames(d),n=l)}(),"Default"==(e=e||"Default")&&t)return h(t);var u,s=ARRAY.extract(r),E=n.width,f=n.height;for(u in s.userPhoto=ME.userPhoto,s.firstName=ME.firstName,s.score=SCORE.get(),s.image="512x512.png",i)i[u].enabled=!1;var c=e,m=i[c],g=T[c];if(log("STICKER!",e,s),"Quiz"==e){f=670;var S=TEXTURE.renderLayersToTexture();(C=m.findByName("screenshot")).enabled=!0,C.element.width=S.width,C.element.height=S.height,C.element.texture=S,scale=512/C.element.width,s.quote=TEXT.get("Quotes")}if("Share"==e){f=670;var C;S=TEXTURE.renderLayersToTexture();(C=m.findByName("screenshot")).enabled=!0,C.element.width=S.width,C.element.height=S.height,C.element.texture=S,scale=512/C.element.width,s.quote=TEXT.get("Quotes")}function doCapture(){if(m){o.enabled=!0,d.syncHierarchy();var n=TEXTURE.textureToBase64Cropped(TEXTURE.renderLayersToTexture(["STICKER"]),E,f);o.enabled=!1,"Enabled"==CONFIG.DEBUG.GodMode&&TEXTURE.base64Download(n),"Default"==e&&(t=n),h&&h(n)}}ASSETS.loadTexture(s.image,(function doFill(){m&&(m.enabled=!0,CONTENT.fill(m,s));g&&(g.enabled=!0,CONTENT.fill(g,s));DELAY.start(doCapture,1)}))}};function TimerData(t){var e=this,n=e.id=t.id||TIMER.getID(),i=(e.id,e.duration=t.duration||6e4),o=t.autoStart||!1;e.isPlaying=!1;var r,a=t.sound,s=t.onSecond,u=0,c=0,p=null!=t.persistent&&t.persistent,d=e.startTime=get(n),f=setAuto(t.isAuto),T=t.replicated,l=t.onTimeUp;function update(){var t=u;if(c=e.elapsed=DATE.getNow()-d,e.percent=100*c/i,t!=(u=e.remaining=Math.ceil((i-c)/1e3)))return T?sendTimer():void updateSecond()}function sendTimer(){}function updateSecond(){s&&(fire(n+":onSecond",u),a&&u<=10&&u>0&&(conquer.Haptic.mini(),SFX.play(a)),e.onSecond&&e.onSecond(u)),u<=0&&e.onReach()}function setAuto(t){return f=t}e.percent=0,e.cycles=0,TIMER.push(e),on(n+":Start",(function start(t){e.start({duration:1e3*t,startTime:DATE.getNow()})})),on(n+":Stop",(function stop(){e.stop()})),on(n+":Pause",(function pause(){e.pause()})),on(n+":Resume",(function resume(){e.resume()})),on(n+":Increase",(function increase(t){i+=1e3*t})),on(n+":Reset",(function reset(){e.reset()})),T&&on("SOCKET:onTimer",(function onReplicated(t){if(t.timerID!=n)return;if(i=e.duration=t.duration,c=t.elapsed,d=e.startTime=DATE.getNow()-c,u=e.remaining=Math.ceil((i-c)/1e3),updateSecond(),u>=0)return;e.isPlaying||e.restart()})),e.varMultiplier&&on(e.varMultiplier,(function onData(t){e.multiplier=t||1})),e.start=function(n){(t=n||{}).duration&&(i=e.duration=t.duration),t.onTimeUp&&(l=t.onTimeUp),e.restart(t.startTime||e.startTime||DATE.getNow()),TIMER.refresh(),sendTimer()},e.restart=function(t){if(r=!1,e.isPlaying=!1,MOTOR.stop(update),d=e.startTime=t||DATE.getNow(),display(n,d,p),(c=e.elapsed=DATE.getNow()-d)>=i){if(!f)return e.cycles=1,e.onReach(),void e.stop();for(;c>=i;)c-=i,e.cycles++}e.isPlaying=!0,MOTOR.steady(update)},e.pause=function(){e.isPlaying&&!r&&(r=!0,MOTOR.stop(update))},e.resume=function(){r=!1,e.isPlaying&&e.start({duration:i-c,startTime:DATE.getNow()})},e.play=function(){},e.checkComplete=function(){},e.stop=function(){e.isPlaying=!1,n&&(d=e.startTime=display(n,0,p)),MOTOR.stop(update),TIMER.refresh()},e.reset=function(){e.stop(),fire(n+":onSecond",Math.ceil(i/1e3))},e.setAuto=setAuto,e.setDuration=function(t){i=e.duration=t},e.onReach=function(){e.stop(),l&&l(e),fire(n+":onTimeUp",e)},(o||get(n))&&e.start()}var TUTORIAL=new function(){var n=this;n.vars={};var e=0;n.isEnabled=!1;var i,o=[],r={};n.block=function(){n.isBlocked=!0},n.init=function(){if(!n.isBlocked&&!n.isEnabled&&"Enabled"!=CONFIG.DEBUG.GodMode){e=get("FTXP");var i=CONFIG.TUTORIAL;if(e||ANALYTICS.onTutorialStart(),e>=i)return n.disable();for(var o in i)new TUTORIAL_DATA(i[o]);n.set(e),n.enable()}},n.set=function(r){if(!(i=o[e=r]))return n.disable();ANALYTICS.onTutorialStage(e),i.enable(),set("FTXP",e)},n.next=function(){i&&i.finished();var r=++e;if(r>=o.length)return n.finish();n.set(r)},n.push=function(n){o.push(n),r[n.id]=n},n.disable=function(){log("DISABLE TUTORIAL"),n.vars={},n.isEnabled=!1},n.enable=function(){n.isEnabled=!0},n.onEvent=function(e,o){if(!n.isEnabled||!i)return o();i.onEvent(e,o)},n.finish=function(){ANALYTICS.onTutorialComplete(),n.disable(),i=null,set("FTXP",999),fire("TUTORIAL:onFinish")}};function TUTORIAL_DATA(n){var e=this;e.id=n.id;var i=n.Trigger,o=n.screens,r=parseInt(n.value),t=o.length?o[0].delayTime:0;function fireEvents(n){if(TUTORIAL.vars={},n)for(var e in n)log("=FIRE",e,n[e]),fire(e,n[e]),TUTORIAL.vars[e]=n[e]}function onTrigger(){if(log("TUTORIAL ON TRIGGER",i),TUTORIAL.isEnabled&&!(r&&r>get(i)))return o?t?void delay(showOverlay,t):showOverlay():void TUTORIAL.next()}function showOverlay(){OVERLAYS.show("Tutorial",o)}TUTORIAL.push(e),e.enable=function(){log("================ ENABLE FTUE",e.id,i),fireEvents(n.onEnable),on(i,onTrigger),!i.includes("_")&&get(i)&&onTrigger()},e.disable=function(){e.isEnabled=!1,off(i,onTrigger)},e.onEvent=function(n,o){if(i!=n)return o();e.callback=o,onTrigger()},e.finished=function(){e.callback&&e.callback(),e.disable(),fireEvents(n.onClose)}}var OverlayTutorial=pc.createScript("overlayTutorial");OverlayTutorial.prototype.initialize=function(){var e,t,n,i=this,a=i.entity,r=(a.findByName("Box"),a.findByName("Characters")),o=getChildrenNames(r),c=a.findByName("textField");function nextScreen(){if(!(t=e.shift()))return function exit(){OVERLAYS.hide("Tutorial"),TUTORIAL.next()}();for(var i in o)o[i].enabled=o[i].name==t.Character;!function startAnimation(){ANIMATION.bounceScaleTo(r),n=t.text,nextText()}()}function nextText(){var e=n.shift();if(!e)return nextScreen();CONTENT.fill(a,{title:t.title,text:e}),ANIMATION.bounceScaleTo(c,.8,1,1.3)}SCREEN.call(i),i.onShow=function(t){e=ARRAY.copy(t),nextScreen()},i.onMouseDown=function(){nextText()}};var DATA,SCORE,COINS,SCOREBOARD,ANALYTICS,PLAYERS,LIVES,XP;function GameInit(A){log("GAME INITIALIZE"),conquer.Games.getOne(TOY.id).then((function(E){GAME=E,log("GAME READY",GAME.gameID),GAME.loadConfig(CONFIG.GAME),SCORE=GAME.Score,COINS=GAME.Coins,SCOREBOARD=GAME.Scoreboard,ANALYTICS=GAME.Analytics,LIVES=GAME.Lives,PLAYERS=GAME.Players,DATA=GAME.Data,XP=GAME.UserXP,QUALITY.init(),SOUNDS.init(),GAME.Signal.broadcast=function(A,E){fire(A,E)},CONFIG.SHOP.overwrite&&(log("CONFIG.SHOP",CONFIG.SHOP),GAME.Shop.setShop(CONFIG.SHOP.TABS)),CONFIG.MISSIONS.overwrite&&GAME.Missions.set(CONFIG.MISSIONS.DATA),CONFIG.DEBUG.resetData&&(DATA.reset(),GAME.Missions.reset(),GAME.Inventory.reset()),A()}))}var GAMEPLAY=new function(){this.set=function(n){return n.onReady=function(){log("GAMEPLAY PREPARE"),n.start()},n.start=function(){log("GAMEPLAY CALL START"),GAME.start()},n.onReveal=function(){log("GAMEPLAY ON REVEAL")},n.onStart=function(){log("GAMEPLAY ONSTART")},n.onSpectating=function(){},n.onEnd=function(){},n.die=function(){log("==GAMEPLAY CALL DIE"),GAME.die()},n.onDie=function(){},n.onAskContinue=function(){},n.onContinue=function(){},n.onExit=function(){},n.pause=function(){},n.resume=function(){},GAMEPLAY=n,n},this.set(this)};var Scenes=pc.createScript("scenes"),SCENES=new function(){var n,e=this,o=null;e.scene=null;var t={};let i=0,r=0;function onInventoryLoading(){i++}function onInventoryLoaded(){++r<i||!e.scene||doHide()}function doHide(n){if(!(i>r)){if(off("INVENTORY:onLoading",onInventoryLoading),off("INVENTORY:onLoaded",onInventoryLoaded),fireLoaded(n),n)return doIt();delay(doIt,1)}function doIt(){fire("SCENES:onShow"+o),LOADSCENE.hide()}}function fireLoaded(n){fire("SCENES:onLoaded",o,e.scene,n),fire("SCENES:on"+o,e.scene,n)}e.scan=function(o,i){if(o){var r=getChildrenNames(o);for(var d in r){var a=r[d];a.enabled=!1,d=d.split("SCENE_")[1]||d,a.name=d,e[d]=t[d]=a,ENTITY.reparent(a,n)}if(!i)return o.enabled=!1;n=o;for(let e in t)ENTITY.reparent(t[e],n)}},e.show=function(d){if(!d||!e.find(d))return log("SCENE DOESNT EXIST",d);if(d==o)return fireLoaded(!0);e.hide(),o=d,e.scene=!1,n.enabled=!1,LOADSCENE.show();var a=t[d];if(a)return a._isLoaded?onScene(a,!0):void ASSETS.preloadEntityModels(a,onScene);var f="SCENE_"+d;function onScene(a,f){a&&(on("INVENTORY:onLoading",onInventoryLoading),on("INVENTORY:onLoaded",onInventoryLoaded),i=r=0,n.enabled=!0,e.scene=a,a.name=d,addChild(a,n),fire("SCENES:onLoad"+o),e[d]=t[d]=a,doHide(f))}ASSETS.loadTemplateAndModels(f,null,onScene)},e.find=function(n){return t[n]||ASSETS.find(function getFullName(n){return"SCENE_"+n}(n),"template")},e.hide=function(){for(var n in o&&fire("SCENES:off"+o),t)t[n].enabled=!1;o=e.scene=null},e.hide(),e.getStartEvent=function(n){return UI.getStartEvent(n)||function scan(n){if(!n)return;return n.parent==e.entity?"SCENES:on"+n.name:scan(n.parent)}(n)}};Scenes.prototype.initialize=function(){var n=this.entity;SCENES.scan(n,!0)};var WALLET=new function(){var n=this,o=n.pool=[];function reload(){for(var n in o)o[n].reload()}function push(r){r&&!n[r]&&(n[r]=new CurrencyData(r),o.push(n[r]),n[r].sorting=CONFIG.WALLET[r]?CONFIG.WALLET[r].sorting:0,o=n.pool=ARRAY.sort(o,"sorting"))}on("TOY:onFinalize",(function(){on("GAME:onInit",reload),function init(){var n=CONFIG.WALLET;for(var o in n)push(o);fire("WALLET:onRefresh")}()})),n.get=function(o){return push(o),n[o]},n.cheat=function(){for(var n in o)set(o[n].id,999999999999999)}};function CurrencyData(e){var a,n=this;n.id=e,n.value=0,n.max=0,n.displayer=null,on(e,(function onData(e){n.set(e)})),n.reload=function(){a=null,GAME.Wallet.get(e).then((function(e){a=e,n.max=a.max,n.refresh()}))},n.reload(),n.private=!!CONFIG.WALLET[e]&&CONFIG.WALLET[e].private,n.setDisplayer=function(e){n.displayer=e},n.setPrivate=function(e){n.private=e,fire("WALLET:onRefresh")},n.increase=function(i){i=i||1,a.increase(i).then((function(a){n.set(a),DATA.increaseTotal(e,i),fire(e+"Earned",i),n.displayer&&n.displayer.bounce()}))},n.decrease=function(i){return a.decrease(i).then((function(a){n.set(a),fire(e+"Spent",i)})),!0},n.purchase=function(e){var a=parseInt(e);return a<=n.value?n.decrease(a):(UPSALE.noCoins(),n.displayer&&n.displayer.shake(),!1)},n.set=function(e){n.value=MATH.hardLimit(Math.round(e),0),n.displayer&&n.displayer.onValue(n.value)},n.collect=function(e,a,i){if(e){var r=localToLocal(UICORNERS.TopRight,FX);n.displayer&&(n.displayer.show(),r=localToLocal(n.displayer.entity,FX));var t={sprite:"Symbol_"+n.id,follow:r,time:2,amount:MATH.hardLimit(e,0,10)};a&&(t.x=a.x,t.y=a.y,t.z=0),FX2D.COLLECT.play(t),i&&delay((function(){n.increase(e)}),1)}},n.refresh=function(){a&&(n.set(a.value),n.displayer&&n.displayer.onValue(n.value))}}var WalletDisplayer=pc.createScript("walletDisplayer");WalletDisplayer.prototype.initialize=function(){var e=this.entity,i=e.findByName("Template");i&&(i.enabled=!1);var l={};let r=0;function refresh(){for(let e in l)l[e].disable();for(var a in r=0,WALLET.pool){var o=WALLET.pool[a];if(!o.private){var n=e.findByName(o.id);if(!n)n=i.clone(),addChild(n,e),delayFill(l[o.id]=n.script.currencyDisplayer,o.id);n.enabled=!0,n.setLocalPosition(-92-165*r,0,0),r++}}for(var a in WALLET.pool)WALLET.pool[a].refresh()}function delayFill(e,i){delay((function(){e.fill(WALLET[i])}),.1)}on("WALLET:onRefresh",refresh),refresh()};var CurrencyDisplayer=pc.createScript("currencyDisplayer");CurrencyDisplayer.prototype.postInitialize=function(){var e,n=this,o=n.entity,i=n.data=null,l=o.findByName("symbolSprite"),a=o.findByName("textField"),t={commarize:!0},c=0,r=o.findByName("timeField");function onSecond(e){i.value>=c?r.enabled=!1:(r.enabled=!0,r.element.text=DATE.days(e))}r.enabled=!1,getLocals(l),n.disable=function(){o.enabled=!1},n.fill=function(a){return n.data=i=a,e=i.id,fill(o,{symbol:"Symbol_"+i.id}),l.element.color=COLOR.get(CONFIG.WALLET[e].color||"WHITE"),(c=i.max)&&(t.suffix="/"+c,on(e+"Timer:onSecond",onSecond)),i.setDisplayer(n),n.onValue(i.value),n},n.bounce=function(){l&&ANIMATION.bounceScaleTo(l,.5*l.sca.x,l.sca.x)},n.onValue=function onValue(e){t.value=e,ANIMATION.fillField(a,t)},n.shake=function(){l&&ANIMATION.shake(l,l.pos,10,10)},n.show=function(){},n.onMouseDown=function(){if("Energy"==e)return UPSALE.noEnergy();PLATFORM.isLogged((function(){SCREENS.show("Shop")}))}};var APP,TOY,root,Startup=pc.createScript("startup"),cuedLogs=[];Startup.attributes.add("id",{type:"string",title:"Game ID"}),Startup.attributes.add("gameName",{type:"string",title:"Game Name"}),Startup.attributes.add("LaunchDefault",{title:"Launch Screen",type:"string",enum:[{Auto:"Auto"},{Home:"Home"},{Game:"Game"},{Shop:"Shop"},{Over:"Over"},{Chat:"Chat"},{Inventory:"Inventory"},{SnappyMaker:"SnappyMaker"},{Quest:"Quest"},{FortuneWheel:"FortuneWheel"},{Hunt:"Hunt"},{VS:"VS"},{Scoreboard:"Scoreboard"},{OpenLoot:"OpenLoot"},{Lobby:"Lobby"},{Planet:"Planet"},{Disable:"Disable"}],default:"Game"}),Startup.attributes.add("LaunchCustom",{title:"Launch Custom",type:"string"}),Startup.prototype.initialize=function(){var t=this,e=t.entity;APP=t.app,TOY=t,root=APP.root,UISIZE.init(e.screen),APP.root.findByName("GAMEPLAY").enabled=!1,t.buildVersion=window.buildVersion||"0.01";var n=getChildren(e,null,!1),i=0;for(var o in function enableNext(){var t=n[i];if(!t)return;i++,t.enabled=!0,delay(enableNext,.01)}(),t.NAV){var a=t.NAV[o];a.title||(a.title=a.id),a.symbol||(a.symbol=a.id),a.Notification||(a.Notification=a.id)}e.script.create("motor"),APP.root.findByName("CAMERA")||ASSETS.loadTemplate("CAMERA",APP.root),e.script.create("ui");var r=new Callback(-1,(function onToyInit(){for(var t in n)n[t].destroy();SOCKET.init(),log("======TOY:onFinalize"),MOTION.init(),CANVASFONT.init(),ANIMATION.init(),fire("TOY:onFinalize"),log("======TOY:onInit"),fire("TOY:onInit")}));once("SCENES:onInit",r.listen()),once("PLATFORM:onInit",r.listen()),once("PRELOAD:onInit",r.listen()),once("PHYSICS:onInit",r.listen()),CONFIG.init(),LOADSCENE.show()};var DebugConfig=pc.createScript("debugConfig");DebugConfig.attributes.add("log",{type:"string",title:"Debug Console",enum:[{Console:"Console"},{VConsole:"VConsole"},{Disabled:"Disabled"}],default:"Console"}),DebugConfig.attributes.add("GodMode",{title:"God Mode",type:"string",enum:[{Enabled:"Enabled"},{Disabled:"Disabled"}],default:"Disabled"}),DebugConfig.attributes.add("invulnerable",{title:"Invulnerable",type:"boolean",default:!1}),DebugConfig.attributes.add("unlockShop",{title:"Unlock Shop",type:"boolean",default:!1}),DebugConfig.attributes.add("muteSounds",{title:"Mute Sounds",type:"boolean",default:!1}),DebugConfig.attributes.add("disableBOTAI",{title:"Disable BOTAI",type:"boolean",default:!0}),DebugConfig.attributes.add("showFPS",{title:"Show FPS",type:"boolean",default:!1}),DebugConfig.attributes.add("cheatCurrency",{title:"Cheat Currency",type:"boolean",default:!1}),DebugConfig.attributes.add("resetData",{title:"Reset Data",type:"boolean",default:!1}),DebugConfig.attributes.add("disableSave",{title:"Disable Data Save",type:"boolean",default:!1}),DebugConfig.attributes.add("logMissions",{title:"Log Missions",type:"boolean",default:!1}),DebugConfig.attributes.add("hideAllRewards",{title:"Disable Rewards",type:"boolean",default:!1}),DebugConfig.attributes.add("logging",{title:"Debug Logs",type:"json",schema:[{title:"Render Frame",name:"renderFrame",type:"boolean",default:!1},{title:"Render Frame Time",name:"renderFrameTime",type:"boolean",default:!1},{title:"Render Pass",name:"renderPass",type:"boolean",default:!1},{title:"Render Pass Detail",name:"renderPassDetail",type:"boolean",default:!1},{title:"Render Action",name:"renderAction",type:"boolean",default:!1},{title:"Render Target Alloc",name:"renderTargetAlloc",type:"boolean",default:!1},{title:"Texture Alloc",name:"textureAlloc",type:"boolean",default:!1},{title:"Shader Alloc",name:"shaderAlloc",type:"boolean",default:!1},{title:"Shader Compile",name:"shaderCompile",type:"boolean",default:!1},{title:"VRAM Texture",name:"vramTexture",type:"boolean",default:!1},{title:"VRAM Vertex Buffer",name:"vramVB",type:"boolean",default:!1},{title:"VRAM Index Buffer",name:"vramIB",type:"boolean",default:!1},{title:"Render Pipeline Alloc",name:"renderPipelineAlloc",type:"boolean",default:!1},{title:"Pipeline Layout Alloc",name:"pipelineLayout",type:"boolean",default:!1}]}),DebugConfig.prototype.initialize=function(){var e=this;e.entity;const t=e.logging;e.showFPS&&TOY.entity.script.create("fps"),void 0!==window.useVConsole&&(e.log=window.useVConsole?"VConsole":"Disabled"),LOG.init(e.log);String(window.location.href);pc.Tracing.set(pc.TRACEID_RENDER_FRAME,t.renderFrame),pc.Tracing.set(pc.TRACEID_RENDER_FRAME_TIME,t.renderFrameTime),pc.Tracing.set(pc.TRACEID_RENDER_PASS,t.renderPass),pc.Tracing.set(pc.TRACEID_RENDER_PASS_DETAIL,t.renderPassDetail),pc.Tracing.set(pc.TRACEID_RENDER_ACTION,t.renderAction),pc.Tracing.set(pc.TRACEID_RENDER_TARGET_ALLOC,t.renderTargetAlloc),pc.Tracing.set(pc.TRACEID_TEXTURE_ALLOC,t.textureAlloc),pc.Tracing.set(pc.TRACEID_SHADER_ALLOC,t.shaderAlloc),pc.Tracing.set(pc.TRACEID_SHADER_COMPILE,t.shaderCompile),pc.Tracing.set(pc.TRACEID_VRAM_TEXTURE,t.vramTexture),pc.Tracing.set(pc.TRACEID_VRAM_VB,t.vramVB),pc.Tracing.set(pc.TRACEID_VRAM_IB,t.vramIB),pc.Tracing.set(pc.TRACEID_RENDERPIPELINE_ALLOC,t.renderPipelineAlloc),pc.Tracing.set(pc.TRACEID_PIPELINELAYOUT_ALLOC,t.pipelineLayout),CONFIG.add("DEBUG",e),CONFIG.add("GAME.DEBUG",e),on("TOY:onFinalize",(function(){e.cheatCurrency&&WALLET.cheat()}))};var NAV=new function(){var n=this;function enable(){return addChild(UI.screens.NAV,UI.Layers.TOP),!0}on("UI:onHome",(function(){NAV.show()})),on("NAV:Show",(function(n){NAV.show(n)})),on("NAV:Hide",(function(){NAV.hide()})),on("NAV:Hidden",(function(n){if("false"!=n&&"0"!=n||(n=!1),display("NAVHIDDEN",n),!n)return NAV.show();NAV.hide()})),n.show=function(n){enable(),NAV.show(n)},n.showSmart=function(n){enable(),NAV.showSmart(n)},n.hide=function(){}},Nav=pc.createScript("nav");Nav.prototype.postInitialize=function(){var n=this,e=n.entity,o=getChildScript(e,"Hamburger","hamburgerGallery"),i=getChildScript(e,"SmartNav","smartNav");function goScreen(n){SCREENS.show(n),fire("NAV:on"+n)}NAV=n,on("UI:onScreen",(function onScreen(n){o.select(n)})),o.fill(CONFIG.NAV,(function onGalleryDown(n){let e=n.data.id;if("Home"==e)return goScreen(e);PLATFORM.isLogged((function(){goScreen(e)}))})),n.show=function(n){e.enabled=!0,o.entity.enabled=!0,i.entity.enabled=!1,addChild(UI.screens.NAV,UI.Layers.TOP)},n.showSmart=function(n){e.enabled=!0,o.entity.enabled=!1,i.entity.enabled=!0,fire("SmartNav:Hide"),i.show(n),addChild(UI.screens.NAV,UI.Layers.TOP)},n.refresh=function(n){i.refresh(n)},n.hide=function(){e.enabled=!1},n.goto=function(n){o.Gallery.click(n)},n.block=function(){!0;var n=o.Gallery.pool;for(var e in n)n[e].disable()},n.unblock=function(n){var e;!1;var i=o.Gallery.pool;if(n)for(e in i)i[e].data.id==n&&i[e].enable();else for(e in i)i[e].enable()}};var WalletConfig=pc.createScript("walletConfig");WalletConfig.attributes.add("currencies",{title:"Currencies",type:"json",schema:[{title:"Name",name:"name",type:"string"},{title:"Is Private",name:"private",type:"boolean"},{title:"Sorting",name:"sorting",type:"number"},{title:"Color",name:"color",type:"string"},{title:"Max",name:"max",type:"number"}],array:!0}),WalletConfig.prototype.postInitialize=function(){var e=this,t={Coin:{name:"Coin",sorting:1,color:"YELLOW"},Gem:{name:"Gem",sorting:2,color:"PURPLE"},Energy:{name:"Energy",sorting:3,color:"BLUE"}};for(var n in e.currencies)t[e.currencies[n].name]=e.currencies[n];CONFIG.add("WALLET",t)};var IdleConfig=pc.createScript("idleConfig");IdleConfig.attributes.add("id",{title:"ID",type:"string"}),IdleConfig.attributes.add("title",{title:"Title",type:"string"}),IdleConfig.attributes.add("color",{title:"Color",type:"string"}),IdleConfig.attributes.add("symbol",{title:"Symbol",type:"string"}),IdleConfig.attributes.add("amountConfig",{title:"Amount Increments Config",type:"json",schema:[{title:"Price",name:"price",type:"string",default:"100"},{title:"Coefficient",name:"coefficient",type:"number",default:1.15},{title:"Start Amount",name:"startAmount",type:"number",default:0},{title:"Amount to %",name:"toPercent",type:"number",default:10},{title:"Max Amount",name:"maxAmount",type:"number",default:0},{title:"Currency",name:"currency",type:"string",default:"Coin"},{title:"Text",name:"text",type:"string"}]}),IdleConfig.attributes.add("levelConfig",{title:"Level Up Config",type:"json",schema:[{title:"Price",name:"price",type:"string",default:"100"},{title:"Coefficient",name:"coefficient",type:"number",default:1.2},{title:"Currency",name:"currency",type:"string",default:"Coin"},{title:"Level Up Table",name:"levelUpTable",type:"string"},{title:"Level Names",name:"levelNames",type:"string"},{title:"Level Up 10",name:"levelUp10",type:"number"},{title:"Max Level",name:"maxLevel",type:"number"}]}),IdleConfig.attributes.add("timerConfig",{title:"Idle Timer Config",type:"json",schema:[{title:"Enabled",name:"enabled",type:"boolean"},{title:"Collect Wallet",name:"collectWallet",type:"boolean"},{title:"Is Automated",name:"isAutomated",type:"boolean"},{title:"Capacity",name:"capacity",type:"number"},{title:"Percent Earnings",name:"percentEarnings",type:"number"},{title:"Seconds (speed)",name:"speed",type:"number"},{title:"Speed Multiplier",name:"speedMultiplier",type:"number",default:1},{title:"Currency",name:"currency",type:"string",default:"Coin"}]}),IdleConfig.attributes.add("managerConfig",{title:"Manager Config",type:"json",schema:[{title:"Enabled",name:"enabled",type:"boolean"},{title:"Idle ID",name:"idleID",type:"string"}]}),IdleConfig.attributes.add("modifiersConfig",{title:"Modifiers Config",type:"json",schema:[{title:"Var Name",name:"varName",type:"string"},{title:"Coefficient",name:"coefficient",type:"number",default:0},{title:"Amount to %",name:"toPercent",type:"number",default:5}],array:!0}),IdleConfig.prototype.initialize=function(){var e=this,t=e.entity,i=e.id=e.id||t.name;e.title=e.title||i,CONFIG.add("IDLE."+i,e)};var ProgressionItemConfig=pc.createScript("progressionItemConfig");ProgressionItemConfig.attributes.add("id",{title:"ID",type:"string"}),ProgressionItemConfig.attributes.add("title",{title:"Title",type:"string"}),ProgressionItemConfig.attributes.add("color",{title:"Color",type:"string"}),ProgressionItemConfig.attributes.add("symbol",{title:"Symbol",type:"string"}),ProgressionItemConfig.attributes.add("amountConfig",{title:"Amount Increase",type:"json",schema:[{title:"Price",name:"price",type:"string",default:"100"},{title:"Coefficient",name:"coefficient",type:"number",default:1.15},{title:"Currency",name:"currency",type:"string",default:"Coin"}]}),ProgressionItemConfig.attributes.add("levelConfig",{title:"Level Up",type:"json",schema:[{title:"Price",name:"price",type:"string",default:"100"},{title:"Coefficient",name:"coefficient",type:"number",default:1.2},{title:"Currency",name:"currency",type:"string",default:"Coin"},{title:"Level Up Table",name:"levelUpTable",type:"string"},{title:"Level Names",name:"levelNames",type:"string"},{title:"Level Up 10",name:"levelUp10",type:"number"},{title:"Max Level",name:"maxLevel",type:"number"}]}),ProgressionItemConfig.attributes.add("timerConfig",{title:"Timer",type:"json",schema:[{title:"Capacity",name:"capacity",type:"number"},{title:"Speed",name:"speed",type:"number"},{title:"Speed Multiplier",name:"speedMultiplier",type:"number",default:1}]}),ProgressionItemConfig.attributes.add("modifiers",{title:"Modifiers",type:"json",schema:[{title:"Var Name",name:"varName",type:"string"},{title:"Coefficient",name:"coefficient",type:"number",default:5}],array:!0}),ProgressionItemConfig.prototype.initialize=function(){var e=this,t=e.entity,i=e.id=e.id||t.name;CONFIG.add("PROGRESSION."+i,e),log("PROG",CONFIG)};var ButtonBoolean=pc.createScript("buttonBoolean");ButtonBoolean.attributes.add("label",{type:"string",default:"button"}),ButtonBoolean.attributes.add("groupVar",{type:"string"}),ButtonBoolean.attributes.add("allowDeselect",{type:"boolean",default:!0}),ButtonBoolean.attributes.add("skipAnimation",{type:"boolean",default:!1}),ButtonBoolean.prototype.initialize=function(){var e=this,t=e.entity;BUTTON.call(e);var a=t.findByName("Text");function enable(t){e.On.enabled=t,e.Off.enabled=!t}e.setBoolean(get(e.label)),e.click=function(t){if(!e.value||e.allowDeselect){if(e.skipAnimation||ANIMATION.click(e.entity,e.scale),e.groupVar)return fire(e.groupVar,e.label);e.setBoolean(!e.value),e.doClick(),SFX.play("Button")}},e.setBoolean=function(t){e.value=Boolean(t),enable(t),set(e.label,e.value),a&&(a.element.color=COLOR.get("BLACK"))},e.groupVar&&on(e.groupVar,(function(t){enable(t==e.label)})),e.validate=function(){return!e.value&&a&&(a.element.color=COLOR.get("RED")),e.value}};var IdleInvestmentConfig=pc.createScript("idleInvestmentConfig");IdleInvestmentConfig.attributes.add("type",{title:"TYPE",type:"string"}),IdleInvestmentConfig.attributes.add("items",{title:"Items",type:"json",schema:[{title:"Value",name:"value",type:"string"},{title:"Title",name:"title",type:"string"},{title:"Thumbnail",name:"thumbnail",type:"string"},{title:"Text",name:"text",type:"string"},{title:"ID",name:"id",type:"string"}],array:!0}),IdleInvestmentConfig.prototype.initialize=function(){var t=this,e=t.entity,i=t.id=t.id||e.name;for(var n in t.title=t.title||i,t.items){var a=t.items[n];a.type=i,a.thumbnail||(a.thumbnail=a.value),a.title||(a.title=a.value)}CONFIG.add("INVESTMENTS."+i,t.items)};var BUTTONS=new function(){var n=this;function setEnabled(a,e){var i=n.get(a);i&&(i.entity.enabled=e)}n.hide=function(a){if(Array.isArray(a))for(var e in a)n.hide(a[e]);else setEnabled(a,!1)},n.show=function(a){if(Array.isArray(a))for(var e in a)n.show(a[e]);else setEnabled(a,!0)},n.add=function(a){n[a.label]=a},n.fill=function(a,e){var i=n.get(a);i&&(i.show(),i.fill(e))},n.animateIn=function(a,e){if(Array.isArray(a))for(var i in a)n.animateIn(a[i]);else{var r=n.get(a);if(r){if(!e)return r.animateIn();DELAY.start(r.animateIn,e)}}},n.get=function(a){var e=n[a];return e||((e=findByName(a))?(e.enabled=!0,e.buttonScript):void 0)}};var TutorialStepConfig=pc.createScript("tutorialStepConfig");TutorialStepConfig.attributes.add("Trigger",{title:"Trigger",type:"string"}),TutorialStepConfig.attributes.add("value",{title:"Value",type:"string"}),TutorialStepConfig.attributes.add("onEnable",{type:"json",schema:[{name:"varName",title:"Variable",type:"string"},{name:"value",title:"Value",type:"string",default:"true"}],array:!0}),TutorialStepConfig.attributes.add("screens",{title:"Screens",type:"json",schema:[{name:"delayTime",type:"number",default:0},{name:"Character",type:"string"},{name:"Title",type:"string"},{name:"text",title:"Text",type:"string",array:!0}],array:!0}),TutorialStepConfig.prototype.initialize=function(){var e,t=this,a=t.entity,r={id:a.name,Trigger:t.Trigger||a.name,value:t.value,onEnable:{},screens:t.screens};for(e in r.id=a.name,t.onEnable){var i=t.onEnable[e];r.onEnable[i.varName]=STRING.getArray(i.value)}t.get=function(){return r}};var ButtonProximity=pc.createScript("buttonProximity");ButtonProximity.attributes.add("label",{type:"string",default:"Proximity"}),ButtonProximity.attributes.add("radius",{type:"number",default:80}),ButtonProximity.prototype.initialize=function(){var t=this,i=t.entity;t.isMute=!0,t.skipAnimation=!0,BUTTON.call(t),t.isOver=!1,t.onUpdate=function(){if(TOUCH.isDown){var o=MATH.hipotenusa(UISIZE.worldToScreen(i),TOUCH)<t.radius;o&&!t.isOver&&t.onMouseEnter(),t.isOver=o}},t.onMouseEnter=function(){fire("PROXIMITY:onEnter",t.label,t)},t.click=function(){fire("PROXIMITY:onClick",t.label,t)}},ButtonProximity.prototype.update=function(t){this.onUpdate()};var SimpleButton=pc.createScript("simpleButton");SimpleButton.attributes.add("label",{type:"string"}),SimpleButton.attributes.add("event",{type:"string"}),SimpleButton.attributes.add("eventValue",{type:"string"}),SimpleButton.attributes.add("eventPress",{type:"string"}),SimpleButton.attributes.add("eventPressValue",{type:"string"}),SimpleButton.attributes.add("skipAnimation",{type:"boolean",default:!1}),SimpleButton.attributes.add("isMute",{type:"boolean",default:!1}),SimpleButton.attributes.add("clickVertical",{type:"boolean",default:!1}),SimpleButton.attributes.add("sound",{type:"string",default:"Button"}),SimpleButton.prototype.initialize=function(){BUTTON.call(this)},SimpleButton.attributes.add("dontCommarize",{type:"boolean",default:!1});var InventorySwapper=pc.createScript("inventorySwapper");InventorySwapper.prototype.initialize=function(){var e=this.entity;on("INVENTORY:tabChanged",(function makeSwap(n){for(const t of e.children){let e=t.name==n;t.enabled=e,e&&fire("INVENTORYSWAPPER:on"+n)}}))};function BUTTON(e){var n=this;e=e||{};var l=n.entity;function onMouseRelease(e){var l=e.id||0;n.touchID==l&&(off("TOUCH:onRelease",onMouseRelease),fire("BUTTON:onRelease",n.label,n),n.isDown=!1,n.Down&&(n.Down.enabled=!1),callScript("onMouseRelease"))}function callScript(e,o){if(e=e||"onMouseDown",l.parent){if(l.parent[e])return l.parent[e](n);if(l.parent.script&&l.parent.script._scripts){var i=l.parent.script._scripts;for(var a in i)if(i[a][e])return i[a][e](n,o)}}}n.label=n.label||l.name,l.buttonScript=n,BUTTONS.add(n),n.autoSize=e.autoSize,n.data={},n.scale=l.getLocalScale().clone(),n.vars={x:1,y:1,z:1},n.isEnabled=!0,n.isDown=!1,n.isAuto=!1,n.pos=l.getLocalScale().clone(),n.Selected=l.findByName("Selected"),n.Deselected=l.findByName("Deselected")||l.findByName("Unselected"),n.On=l.findByName("On"),n.Off=l.findByName("Off"),n.Down=l.findByName("Down"),n.Locked=l.findByName("Locked"),n.Unlocked=l.findByName("Unlocked"),n.Enabled=l.findByName("Enabled"),n.Disabled=l.findByName("Disabled"),n.Down&&(n.Down.enabled=!1),n.click||(n.click=function(e){var n=this;n.doClick(),n.isMute||SFX.play(n.sound||"Button"),conquer.Haptic.mini(),n.skipAnimation||(n.clickVertical?ANIMATION.clickVertical(l,n.scale):ANIMATION.click(l,n.scale))}),n.doClick||(n.doClick=function(){if(n.onMouseDown)return n.onMouseDown(n);n.Down&&(n.Down.enabled=!1),fire("BUTTON:onClick",n.label,n),n.label&&"Button"!=n.label&&ANALYTICS.onButton(n.label),n.event&&fire(n.event,n.eventValue),callScript("onMouseDown")}),n.onMousePress||(n.onMousePress=function(e){n.isDown=!0,n.Down&&(n.Down.enabled=!0),fire("BUTTON:onPress",n.label,n),n.touchID=e.touch?e.touch.identifier:0,n.eventPress&&fire(n.eventPress,n.eventPressValue),on("TOUCH:onRelease",onMouseRelease),callScript("onMousePress",e.touch)}),n.onMouseUp||(n.onMouseUp=function(e){n.isDown=!1,n.Down&&(n.Down.enabled=!1),callScript("onMouseUp")}),n.callScript=callScript,n.fill||(n.fill=function(e){CONTENT.fill(n,e,n.dontCommarize),n.autoSize&&(l.element.width=l.findByName("titleField").element.width+100),n.Unlocked&&(n.Unlocked.enabled=!e.isLocked,CONTENT.fill(n.Unlocked,e)),n.Locked&&(n.Locked.enabled=e.isLocked,CONTENT.fill(n.Locked,e)),n.Selected&&CONTENT.fill(n.Selected,e),n.Deselected&&CONTENT.fill(n.Deselected,e),n.onRefresh||(e.onRefresh=function(){n.refill()}),n.refresh&&n.refresh()}),n.refill||(n.refill=function(){n.fill(n.data)}),n.select||(n.select=function(){n.isSelected=!0,n.setBoolean(!0),n.Selected&&(n.Selected.enabled=!0),n.Deselected&&(n.Deselected.enabled=!1)}),n.deselect||(n.deselect=function(){n.isSelected=!1,n.setBoolean(!1),n.Selected&&(n.Selected.enabled=!1),n.Deselected&&(n.Deselected.enabled=!0)}),n.enable||(n.enable=function(){n.isEnabled=!0,n.Enabled&&(n.Enabled.enabled=n.isEnabled),n.Disabled&&(n.Disabled.enabled=!n.isEnabled)}),n.disable||(n.disable=function(){n.isEnabled=!1,n.Enabled&&(n.Enabled.enabled=n.isEnabled),n.Disabled&&(n.Disabled.enabled=!n.isEnabled)}),n.setBoolean||(n.setBoolean=function(e){n.value=e,n.On&&(n.On.enabled=n.value),n.Off&&(n.Off.enabled=!n.value)}),n.show||(n.show=function(){l.enabled=!0}),n.hide||(n.hide=function(){l.enabled=!1}),n.animateIn||(n.animateIn=function(){l.enabled=!0,ANIMATION.bounceScaleTo(l,.1,n.scale.x)}),l.element.on("click",(function(e){UI.isBlocked&&!n.nonblockable||(n.isDown=!1,n.isEnabled&&n.click(e))})),l.element.on("mousedown",(function(e){n.isDown=!0,n.isEnabled&&n.onMousePress&&n.onMousePress(e)})),l.element.on("mouseup",(function(e){n.isDown=!1,n.isEnabled&&n.onMouseUp&&n.onMouseUp(e)})),n.app.touch&&(l.element.on("touchstart",(function(e){n.isDown=!0,n.isEnabled&&n.onMousePress&&n.onMousePress(e)})),l.element.on("touchend",(function(e){n.isDown=!1,n.isEnabled&&n.onMouseUp&&n.onMouseUp(e)})))}var EntityDisplayer=pc.createScript("entityDisplayer");EntityDisplayer.attributes.add("id",{type:"string"}),EntityDisplayer.attributes.add("isAnimated",{type:"boolean"}),EntityDisplayer.prototype.initialize=function(){var t,e=this,i=e.entity,n=getChildrenNames(i),a=(getChildren(i),new DelayUnique);function hide(){show(null)}function show(t){for(var a in n)n[a].enabled=a==t;e.isAnimated&&ANIMATION.bounceScaleTo(i,i.sca.x/2,i.sca.x)}getLocals(i),e.setEvents=function(e){e&&(t=e,on(t,show),on(t+":Hide",hide),on(t+":SetState",(function(t,e){o.set(t,e)})),show(get(t)))},e.hide=hide,e.show=show;var s,o=e.STATE={};o.set=function(t,e){t!=s&&o[t]&&(o.Reset(),s=t,o[t](e||{}))},o.Reset=function(){s=null,a.cancel(),hide()},o.On=function(t){t.duration&&a.start((()=>o.Reset()),t.duration);for(let t in n)n[t].enabled=!0},e.id&&e.setEvents(e.id)};var ValueDisplayer=pc.createScript("valueDisplayer");ValueDisplayer.attributes.add("refreshEvent",{type:"string"}),ValueDisplayer.attributes.add("animateIn",{type:"boolean",default:!1}),ValueDisplayer.prototype.initialize=function(){var e=this,a=e.entity,t=null;getLocals(a),e.refreshEvent&&on(e.refreshEvent,(function refresh(r){if(r==t)return;if(t=r,CONTENT.fill(a,{value:r}),!e.animateIn)return;ANIMATION.bounceScaleTo(a,.1,a.sca.x,2)}))};var SkyboxDisplayer=pc.createScript("skyboxDisplayer");SkyboxDisplayer.attributes.add("InventoryTab",{type:"string"}),SkyboxDisplayer.attributes.add("SkyboxAssetPreffix",{type:"string"}),SkyboxDisplayer.attributes.add("SkyboxAssetSuffix",{type:"string"}),SkyboxDisplayer.attributes.add("canPreview",{type:"boolean"}),SkyboxDisplayer.prototype.initialize=function(){let e=this;function onInventoryUpdated(){var t=INVENTORY[e.InventoryTab];if(t){e.SkyboxAssetPreffix=e.SkyboxAssetPreffix||"",e.SkyboxAssetSuffix=e.SkyboxAssetSuffix||"";var i=e.SkyboxAssetPreffix+function getValue(t){return e.canPreview&&t.previewing?t.previewing:t.value}(t)+e.SkyboxAssetSuffix;SKYBOX.show(i)}}on("INVENTORY:onUpdate",onInventoryUpdated),e.canPreview&&on("INVENTORY:onPreview",onInventoryUpdated),onInventoryUpdated()};var InventoryDisplayer=pc.createScript("inventoryDisplayer");InventoryDisplayer.attributes.add("inventoryTab",{type:"string"}),InventoryDisplayer.attributes.add("valuePrefix",{type:"string"}),InventoryDisplayer.attributes.add("valueSufix",{type:"string"}),InventoryDisplayer.attributes.add("refreshEvent",{type:"string",default:"INVENTORY:onUpdate"}),InventoryDisplayer.attributes.add("animateIn",{type:"boolean",default:!1}),InventoryDisplayer.attributes.add("debug",{type:"boolean",default:!1}),InventoryDisplayer.attributes.add("canPreview",{type:"boolean"}),InventoryDisplayer.attributes.add("isRandom",{type:"boolean"}),InventoryDisplayer.attributes.add("doSkybox",{type:"boolean",default:!0}),InventoryDisplayer.attributes.add("doFog",{type:"boolean",default:!0}),InventoryDisplayer.attributes.add("autoLoad",{type:"boolean",default:!1}),InventoryDisplayer.prototype.postInitialize=function(){var e=this,t=e.entity;e.valuePrefix=e.valuePrefix||"",e.valueSufix=e.valueSufix||"",e.inventoryTab=e.inventoryTab||t.name,getLocals(t);var a=null;function refresh(){if(!t.enabled)return;var n=e.isRandom?getRandomItem(GAME.Inventory.tabs[e.inventoryTab].items).key:GAME.Inventory.selected[e.inventoryTab];if(!n)return;let r=GAME.Inventory.getItem(n);if(!r)return;let o=JSON.parse(r.data.metadata||"{}");e.doSkybox&&SKYBOX.set(o.skybox),e.doFog&&FOG.set(o.fog);var i=e.valuePrefix+n+e.valueSufix;if(i==a)return animate();a=i,fire("INVENTORY:onLoading");let y="CONTENT:on"+i;on(y,(function onLoaded(){fire("INVENTORY:onLoaded"),off(y,onLoaded),animate()})),fill(t,{value:i})}function animate(){e.animateIn&&ANIMATION.bounceScaleTo(t,.6,t.sca.x,2)}on(e.refreshEvent,refresh),refresh()};var HamburgerGallery=pc.createScript("hamburgerGallery");HamburgerGallery.attributes.add("autoSelect",{type:"boolean",default:!0}),HamburgerGallery.attributes.add("margin",{type:"number",default:168}),HamburgerGallery.attributes.add("marginSelected",{type:"number",default:260}),HamburgerGallery.prototype.initialize=function(){var e,t=this,r=t.entity,a=t.Gallery=getChildScript(r,"Gallery","gallery");function onDown(r){t.autoSelect&&t.select(r.data.id),e&&e(r)}a.autoSelect=t.autoSelect,a.marginX=t.margin,t.marginSelected-=t.margin,t.Separator=r.findByName("Separator"),getLocals(t.Separator),getLocals(t.Gallery.entity),t.Highlight=r.findByName("Highlight"),t.Highlight&&(t.Highlight.element.width=t.marginSelected+t.margin,getLocals(t.Highlight)),t.separators=[],t.fill=function(r,i){if(r&&r.length){e=i,a.fill(r,onDown);var l=(-a.pool.length*a.marginX-t.marginSelected)/2;if(a.entity.setLocalPosition(l,t.Gallery.entity.pos.y,0),t.Separator){t.Separator.enabled=!1;for(var o=0;o<r.length-1;o++){var n=t.Separator.clone();n.enabled=!0,addChild(n,t.Separator.parent),t.separators.push(n)}}t.bPos=(new pc.Vec3).copy(a.pool[0].entity.getLocalPosition())}},t.select=function(e){var r=a.buttons[e];if(r){if(t.current){if(t.current==r)return;r.entity.getLocalPosition().x<t.current.entity.getLocalPosition().x?"left":"right"}t.current&&t.current.deselect(),t.current=r,r.select();var i=t.bPos.x,l=t.bPos.y,o=EASING.CircularOut;for(var n in a.pool){var g=a.pool[n].entity,c=t.margin/2;g==r.entity&&(i+=t.marginSelected/2,c+=t.marginSelected/2,t.Highlight&&ANIMATION.moveTo(t.Highlight,{x:i,y:t.Highlight.pos.y,z:t.Highlight.pos.z},.2,o)),t.separators[n]&&ANIMATION.moveTo(t.separators[n],{x:i+c,y:t.Separator.pos.y,z:t.Separator.pos.z},.2,o),ANIMATION.moveTo(g,{x:i,y:l,z:0},.2,o),g==r.entity&&(i+=t.marginSelected/2),i+=t.margin}}}};var DAILYREWARDS=new function(){var o,e=!1;function offAds(){off("UI:onGame",offAds),off("ADS:onRewardedLoaded",doShow)}function doShow(){e=!0,offAds(),POPUPS.show("DailyRewards",o)}on("UI:onHome",(function onHome(){if(off("UI:onHome",onHome),e)return;!function show(e){if(!(o=GAME.DailyRewards.get()).canCollect)return;if(e)return doShow();if(ADPLAYER.hasRewardedLoaded)return doShow();on("ADS:onRewardedLoaded",doShow)}(!0)})),on("UI:onGame",offAds)},PopupDailyReward=pc.createScript("popupDailyReward");PopupDailyReward.prototype.postInitialize=function(){var o,e=this,n=e.entity,a=getChild(n,"Gallery","gallery"),t=n.findByName("CollectDailyButton");SCREEN.call(e),getLocals(n),e.onShow=function(){o=GAME.DailyRewards.get(),a.fill(o.items),t.enabled=o.canCollect,fire("DAILYREWARD:Refresh")},e.onMouseDown=function(e){if("CollectDailyButton"!=e.label)return POPUPS.hide();ADPLAYER.playRewarded((function(l){l&&function doConsume(){t.enabled=!1,a.pool[o.current].select(),BUTTONS.hide("CollectDailyButton"),UI.block(),ANIMATION.bounceScaleTo(n,.9,1);let l=GAME.DailyRewards.set();l&&WALLET[l.varName]&&WALLET[l.varName].collect(l.value,localToLocal(e.entity,FX));DELAY.start((function(){var o=0;ANIMATION.scaleTo(n,new pc.Vec3(o,o,o))}),1),DELAY.start((function(){POPUPS.hide(),l&&"Lootbox"==l.varName&&SCREENS.show("OpenLoot",l.value)}),1.5)}()}))}};var SmartNav=pc.createScript("smartNav");SmartNav.prototype.postInitialize=function(){var t,e=this,n=e.entity,o=getChildScript(n,"ActionButton1","smartButton"),i=getChildScript(n,"ActionButton2","smartButton"),c=getChildScript(n,"BackButton","simpleButton"),r=0,l=null,onAction1=function(){},onAction2=function(){},onBack=function(){},a=[];function refreshButtons(){for(var t in a)a[t]();i.entity.enabled&&i.entity.setLocalPosition(o.entity.enabled?i.entity.pos.x:0,i.entity.pos.y,0)}function removeListeners(){l=null,off("ADS:onRewardedLoaded",e.refresh,e)}getLocals(o.entity),getLocals(i.entity),getLocals(n),getLocals(o.entity),getLocals(i.entity),e.show=function(e){let o=n.pos;n.setLocalPosition(o.x,o.y-100,0),ANIMATION.moveTo(n,o,.8,EASING.ElasticOut),e=e||{},s.clear(),e.template=e.template||"Back",e.onBack&&(onBack=e.onBack),e.onAction1&&(onAction1=e.onAction1),e.onAction2&&(onAction2=e.onAction2),removeListeners(),r=0,t=e.callback,l=e.template,fire("SmartNav:Show"),a=[],s[l]&&s[l](),refreshButtons()},e.hide=function(){removeListeners(),fire("SmartNav:Hide")},e.refresh=function(){refreshButtons()},e.onMouseDown=function(t){var e=t.label;return"ActionButton1"==e?onAction1():"ActionButton2"==e?onAction2():"BackButton"==e?function exit(){NAV.show(),onBack()}():void 0};var s={clear:function(){resetLocals(o.entity),resetLocals(i.entity),o.entity.enabled=!1,i.entity.enabled=!1,c.entity.enabled=!1,onAction1=onAction2=function(){}},Back:function(){c.entity.enabled=!0},Poke:function(){c.entity.enabled=!0,o.entity.enabled=!0,o.entity.setLocalPosition(pc.Vec3.ZERO),o.fill({text:"POKE"})},Share:function(){c.entity.enabled=!0,o.entity.enabled=!0,o.entity.setLocalPosition(pc.Vec3.ZERO),o.fill({text:"SHARE"})},JustBack:function(){o.entity.enabled=!0,o.entity.setLocalPosition(pc.Vec3.ZERO),o.fill({text:"BACK"})},Spin:(function(){c.entity.enabled=!0,o.entity.enabled=!0,o.entity.setLocalPosition(pc.Vec3.ZERO),o.fill({symbol:"Symbol_Ad",text:"Spin"})},function(){c.entity.enabled=!0,o.entity.enabled=!0,o.entity.setLocalPosition(pc.Vec3.ZERO),o.fill({symbol:"Symbol_Ad",text:"Spin"})}),Exit:function(){o.entity.enabled=!0,o.entity.setLocalPosition(pc.Vec3.ZERO),o.fill({text:"BACK"})},Next:function(){o.entity.enabled=!0,o.entity.setLocalPosition(pc.Vec3.ZERO),o.fill({text:"NEXT"})},Collect:function(){o.entity.enabled=!0,o.entity.setLocalPosition(pc.Vec3.ZERO),o.fill({text:"Collect"})},ShopInventory:function(){s.TokenOrAdForCurrency(),o.entity.enabled=!0,y.ShopInventory()},TokenOrAdForCurrency:function(){if(IAP.isEnabled)return s.TokenForCurrency();s.WatchAdForCurrency()},WatchAdForCurrency:function(){o.entity.enabled=!1,a.push(u.WatchAdForCurrency),y.WatchAdForCurrency()},TokenForCurrency:function(){o.entity.enabled=!1,a.push(u.TokenForCurrency),y.TokenForCurrency()}},u={WatchAdForCurrency:function(){i.entity.enabled=r<5&&ADPLAYER.hasRewardedLoaded},TokenForCurrency:function(){i.entity.enabled=IAP.isEnabled}},y={ShopInventory:function(){onAction1=function(){WALLET.Coin.value<5e3&&(ADPLAYER.hasRewardedLoaded&&r<5?UPSALE.noCoins():DIALOG.show("NoCoins")),t&&t("Buy")},o.fill({symbol:"Coin",text:"5000"})},WatchAdForCurrency:function(){onAction2=function(){ADPLAYER.playRewarded((function(t){t&&(r++,refreshButtons(),WALLET.Coin.collect(1e3))}))},on("ADS:onRewardedLoaded",e.refresh,e),i.fill({symbol:"Symbol_Ad",text:"+1000"})},TokenForCurrency:function(){log("ACTION TokenForCurrency"),onAction2=function(){IAP.get5KCoins((function(t){t&&WALLET.Coin.collect(5e3)}))},on("ADS:onRewardedLoaded",e.refresh,e),i.fill({symbol:"Coin",text:"GET 5K"})}}};var DailyItem=pc.createScript("dailyItem");DailyItem.prototype.initialize=function(){var e,t=this,l=t.entity,a=getChildrenNames(l.findByName("States")),i=l.findByName("dayField");BUTTON.call(t),getLocals(l),t.fill=function(t){e=t,i.element.text=e.day;let l={symbol:"Symbol_Coin",value:e.value};if("Lootbox"==e.varName){l.symbol=e.value,l.value=" ";let t=a[e.state].findByName("symbolTexture");t.setLocalPosition(0,0,0),t.element.width=t.element.height=150}for(var n in a)fill(a[n],l),a[n].enabled=n==e.state},t.select=function(){for(var e in ANIMATION.bounceScale(l.findByName("States")),a)a[e].enabled="Collected"==e}};var PopupGameWin=pc.createScript("popupGameWin");PopupGameWin.prototype.postInitialize=function(){var o=this,e=o.entity,n=e.findByName("RewardContainer"),a=e.findByName("Top");function showLeaderboard(){conquer.Haptic.fadeIn(),SCOREBOARD.show()}function onRewardCollected(){delay((function(){fire("CHALLENGEFRIEND:Show"),UPSALE.goShopping(),BUTTONS.animateIn("ShopButton2",2)}),1)}SCREEN.call(o),o.onShow=function(){SCOREBOARD.captureScores(),fire("CHALLENGEFRIEND:Hide"),BUTTONS.hide("ShopButton2"),ADPLAYER.playInterstitial(showLeaderboard)},on("LEADERBOARDS:onShow",(function(){if(!ADPLAYER.hasRewardedLoaded){var o=new pc.Vec3;return n&&(o.y=a.getLocalPosition().y+n.getLocalPosition().y),WALLET.Coin.collect(get("RewardCoins"),o),void delay(onRewardCollected,1)}delay((function(){UPSALE.rewardBonus(onRewardCollected)}),1)}))};var ScreenGameOver=pc.createScript("screenGameOver");ScreenGameOver.prototype.postInitialize=function(){var e=this,o=e.entity,n=o.findByName("RewardContainer");o.findByName("Top");function showLeaderboard(){UI.block(),conquer.Haptic.fadeIn(),SCOREBOARD.show()}function onRewardCollected(e){e||WALLET.Coin.collect(get("RewardCoins"),ENTITY.localToScreen(n)),delay((function lastShow(){fire("PlayGames"),fire("CHALLENGEFRIEND:Show"),UPSALE.goShopping()}),1)}SCREEN.call(e),e.onShow=function(){if(fire("QUEST:RefreshBox"),fire("CHALLENGEFRIEND:Hide"),log("ON SHOW GAMEOVER"),SCOREBOARD.captureScores(),PLATFORM.isFacebook)return showLeaderboard();ADPLAYER.playInterstitial(showLeaderboard)},e.onHide=function(){log("ON HIDE GAMEOVER",PLATFORM.isFacebook),PLATFORM.isFacebook&&ADPLAYER.playInterstitial((function(){}))},on("LEADERBOARDS:onShow",(function(){delay((function(){UI.unblock(),UPSALE.rewardBonus(onRewardCollected)}),1)}))};var ChallengeFriend=pc.createScript("challengeFriend");ChallengeFriend.prototype.initialize=function(){var n,e=this.entity,a=e.findByName("ShareButton"),t=e.findByName("ChallengeButton");function playAgain(){fire("BUTTON:onClick","PlayAgainButton")}getLocals(e),on("CHALLENGEFRIEND:Show",(function show(){ANIMATION.bounceScaleTo(e),n=RIVALS.getNext(),RIVALS.clear(),e.enabled=!0,a.enabled=!n,t.enabled=!a.enabled,BUTTONS.hide("SkipButton"),n&&BUTTONS.fill("ChallengeButton",n);BUTTONS.animateIn("SkipButton",3)})),on("CHALLENGEFRIEND:Hide",(function hide(){e.enabled=!1})),this.onMouseDown=function(e){UI.block(3),UIFX.stop();var a=e.label;return"ChallengeButton"==a?PLATFORM.playWithFriend(n.avatarID,playAgain,"Challenge"):"ShareButton"==a?PLATFORM.shareScore(playAgain):"SkipButton"==a?function skipRival(){RIVALS.consume(),playAgain()}():void 0}};var ScreenSplash=pc.createScript("screenSplash");ScreenSplash.prototype.initialize=function(){SCREEN.call(this)},ScreenSplash.prototype.update=function(e){};var ScreenHome=pc.createScript("screenHome");ScreenHome.prototype.postInitialize=function(){var e,o=this,i=o.entity;SCREEN.call(o);let n=getChildScript(i,"HomeSlider","homeSlider");function refresh(){e||(e=!0,fire("UI:onHome"))}o.onShow=function(){TOP.hide(),n.show(),MUSIC.play("Home"),PLATFORM.isLogged(refresh)},on("SCENES:onShowHome",(()=>FX3D.CONFETTI.sides({amount:2,z:-10,y:3,sound:!1}))),o.onHide=function(){n.hide()}};var PopupRoulettePicker=pc.createScript("popupRoulettePicker");PopupRoulettePicker.prototype.initialize=function(){var e=this,n=e.entity;SCREEN.call(e);var o,i=getChildScript(n,"SlotMachineSymbols","slotMachineSymbols"),t=n.findByName("SpinButton");function spin(){t.enabled=!1,i.spin(onSpinStop),i.onMouseDown=onSelection}function onSpinStop(e){delay((function(){ADPLAYER.hasRewardedLoaded&&(t.enabled=!0,ANIMATION.bounceScaleTo(t))}),.25)}function onSelection(e){UI.block(),POPUPS.hide(),o&&o(e.data)}e.onShow=function(e){t.enabled=!1,o=e.callback,i.fill(e.reels),delay(spin,.25)},e.onMouseDown=function(e){if("CloseBtn"==e.label)return POPUPS.hide();ADPLAYER.playRewarded((function(e){e&&spin()}))}};var RewardBonusBar=pc.createScript("rewardBonusBar");RewardBonusBar.attributes.add("speed",{title:"Speed",type:"number",default:5}),RewardBonusBar.prototype.initialize=function(){var e,n,t,o=this,a=o.entity,i=a.findByName("Arrow"),r=i.getLocalPosition().clone(),s=(RANDOM.direction(),!1),u=0,c=a.findByName("TextDisplayer");function disable(){s=!1,ANIMATION.bounceScaleTo(c,1.5,1,2),stop(update)}function update(){if(s){t+=o.speed*DT,r.x=325*Math.sin(t),i.setLocalPosition(r);var n=u;(u=function getBonus(){var e=Math.abs(r.x);return e<75?5:e<175?4:e<275?3:2}())!=n&&(n=u,display("RewardBonus",u*e))}}on("UPSALE:onRewardBonus",(function enable(o){log("ENABLE BONUS",o),e=o.profits||COINS.get(),n=o.currency||"Coin",t=RANDOM.decimal(),s=!0,start(update)})),on("UPSALE:onRewardBonusAccept",disable),on("UPSALE:onRewardBonusExit",(function consumeBonus(t){disable(),t&&WALLET[n].collect(e*u,pc.Vec3,!0)}))};var UI,FX,FX2D,FX3D,UICORNERS,Ui=pc.createScript("ui");Ui.prototype.initialize=function(){var e=this,n=e.entity;UI=this;var o=e.screens={},t=[];e.time=.7,e.scan=function(n){if(n){var t=getChildrenNames(n);for(var i in t){var r=t[i];i=i.split(CONFIG.id+"SCREEN_")[1]||i.split("SCREEN_")[1]||i,r.name=i,o[i]||(o[i]=e[i]=r),removeChild(r)}}};var i=e.Screens=ASSETS.createGroup({parent:n});i.name="Screens",i.addComponent("script"),i.script.create("onResize"),i.script.onResize.scaleMode="Down",i.script.onResize.refresh();var r,c=e.Layers={},a=["BACKGROUND","SCREEN","UNDERLAY","TOP","POPUP","OVERLAY"];for(var u in a)screenLayer(a[u]);function screenLayer(e){var n=ASSETS.createElement({parent:i});n.init=function(){var t=c[e]=n;function refresh(){t.current=t.pool[0],t.component=o[t.current]}t.current=null,t.pool=[],t.component=null,t.label=null,t.previous=null,t.unshift=function(e){t.pool.unshift(e),addChild(o[e],t),t.previous=t.label,t.label=e,refresh()},t.shift=function(e){return e?ARRAY.removeItem(t.pool,e):e=t.pool.shift(),refresh(),e},t.reset=function(){for(var e in t.pool){var n=o[t.pool[e]];n.screenScript&&n.screenScript.deactivate(),n.enabled=!1}t.pool=[],refresh()}},n.init()}function unblock3D(){e.isBlocked3D=!1}function showLoader(n){if(hideLoader(),e.block(),e.isShowingLoader=!0,!n)return doIt();function doIt(){r=ASSETS.getTemplate("LOADER",c.POPUP)}uniqueSteady("uiLoad",doIt,n)}function hideLoader(){e.isShowingLoader=!1,e.unblock(),cancel("uiLoad"),destroyLoader()}function destroyLoader(){r&&r.destroy(),r=null}function fireLoaded(e,n){e&&e.screenScript&&e.screenScript.activate(n);var o=e.name;fire("UI:on"+o,n),fire("UI:onScreen",o,n)}function animateOut(n,o){if(n){var t=e.time;if(function fireUnloaded(e){e&&e.screenScript&&e.screenScript.deactivate();var n=e.name;fire("UI:off"+n)}(n),!o)return hideScreen(n);var i={x:0,y:0,z:0};"left"==o&&(i.x=UISIZE.RIGHT_NEIGHBOR),"right"==o&&(i.x=UISIZE.LEFT_NEIGHBOR),"up"==o&&(i.y=UISIZE.BOTTOM_NEIGHBOR),"down"==o&&(i.y=UISIZE.TOP_NEIGHBOR),"zoomIn"==o&&(i.z=50),"zoomOut"==o&&(i.z=-50),"cut"==o&&(t=.1),ANIMATION.moveTo(n,i,e.time,EASING.SineOut),steady((function(){hideScreen(n)}),t)}}function hideScreen(e){e.enabled=!1}FX2D=FX=ASSETS.createGroup({parent:i}),ASSETS.getTemplate("ScreenCorners",i,(function(e){UICORNERS=e.script.screenCorners})),ASSETS.getTemplate("TOUCH",i),UIFX.initialize(),e.lock=function(n){e.isLocked=!0,e.block()},e.unlock=function(n){e.isLocked=!1,e.unblock()},e.superLock=function(n){e.isSuperLocked=!0,e.block()},e.superUnlock=function(n){e.isSuperLocked=!1},e.lockTemp=function(n){e.isLockedTemp=!0,e.block()},e.unlockTemp=function(n){e.isLockedTemp=!1,e.unblock()},e.block=function(n){if(e.isBlocked=!0,n)return e.unblock(n);cancel("uiUnblock")},e.unblock=function(n){e.isLocked||e.isLockedTemp||uniqueSteady("uiUnblock",(function(){e.isBlocked=!1}),n||.1)},e.block3D=function(){e.isBlocked3D=!0},e.showLoader=showLoader,e.hideLoader=hideLoader,e.reveal=function(n,t,i,r,a){if(c[n].current==t)return fireLoaded(c[n].component,i);if(ANALYTICS&&ANALYTICS.onUI(t),"SCREEN"==n&&(CAMERA.FX.stop(),SKYBOX.set(),FOG.set()),i=i||{},!SCENES||!SCENES.find(t))return showOrLoad();function showOrLoad(){if(o[t])return doLoadScreen();var e="SCREEN_",n=(ASSETS.find(e+t,"template")?e:"")+t;ASSETS.find(n,"template")&&doLoadScreen(n)}function doLoadScreen(e){if("POPUP"==n&&fire("UI:onPopup"),showLoader(.5),!e)return preloadElements();ASSETS.loadTemplate(e,null,(function(e){if(!e)return log("UI NO SCREEN FOUND",t,prefix+t);e.name=t,o[t]=e,preloadElements()}))}function preloadElements(){ASSETS.preloadElements(o[t],doShow)}function doShow(){hideLoader();var u=o[t];u.layerName=n;var s=c[n];if("SCREEN"==n&&(BACKGROUND.show(t),FINGER.hide(),e.hidePopups(),e.unReveal(s.current,r)),"POPUP"==n&&(r=r||"bounce",SFX.play("Popup"),SFX.play("Reveal"),e.showBlack()),s.unshift(t),e.block(e.time/2),function animateIn(n,o,t){if(!n)return;if(n.enabled=!0,toFront(n),n.setLocalPosition(999,0,0),n.screenScript)return doIN();function doIN(){MOTOR.stop(doIN),n.setLocalPosition(0,0,0),fireLoaded(n,o);var i={x:0,y:0,z:0};t&&("left"==t&&n.setLocalPosition(UISIZE.LEFT,0,0),"right"==t&&n.setLocalPosition(UISIZE.RIGHT,0,0),"up"==t&&n.setLocalPosition(0,UISIZE.TOP,0),"down"==t&&n.setLocalPosition(0,UISIZE.BOTTOM,0),"zoomIn"==t&&n.setLocalPosition(0,0,-50),"zoomOut"==t&&n.setLocalPosition(0,0,50),"bounce"==t&&(i.z=.001,ANIMATION.click(n,{x:1,y:1,z:1})),ANIMATION.moveTo(n,i,e.time,EASING.SineOut))}MOTOR.start(doIN)}(u,i,r),a){if(r)return CAMERA.moveTo(t,.7);CAMERA.set(t)}}on("SCENES:on"+t,(function onScene(e,n){if(off("SCENES:on"+t,onScene),n)return showOrLoad();steady((function(){showOrLoad()}),.1)})),SCENES.show(t,!0)},e.unReveal=function(n,t){var i=o[n];if(i&&i.enabled){ANALYTICS.onUIOut(n);var r=i.layerName;c[r].shift(n),"SCREEN"==r&&animateOut(o[c.SCREEN.current]),"POPUP"==r&&(e.block(e.time/4),e.hideBlack(),steady(unblock3D,.2),fire("UI:offPopup")),animateOut(i,t)}},e.hide=function(){var e;for(e in animateOut(o[c.SCREEN.current]),destroyLoader(),c)"BACKGROUND"!=e&&"TOP"!=e&&c[e].reset();for(e in o)"BACKGROUND"!=e&&"TOP"!=e&&"LoadScene"!=e&&(o[e].enabled=!1);TOP.hide()},e.hidePopups=function(){for(;c.POPUP.pool.length>0;)e.unReveal(c.POPUP.current);for(;t.length>0;)e.hideBlack()},e.showBlack=function(){var e=ASSETS.getTemplate("UI_BLACK");c.POPUP.addChild(e),ANIMATION.fadeFromTo(e,.4,.8,.3,EASING.SineOut),t.unshift(e)},e.hideBlack=function(){var e=t.shift();e&&e.destroy()},e.fadeOutBlack=function(e){var n=t.shift();n&&(ANIMATION.fadeFromTo(n,.8,0,e||.6,EASING.SineOut),steady((function(){n.destroy()}),e||.6))},e.shake=function(e,n){ANIMATION.shake(i,null,e||10,n||10)},e.getStartEvent=function(e){if(e)return function scan(e){if(!e)return;return o[e.name]==e?"UI:on"+e.name:scan(e.parent)}(e.parent)},e.hide()};function SCREEN(n){var o=this,i=(o.entity,{});function onClick(n,i){o.onClick(n,i)}o.activate=function(n){o.onShow(n),o.onEvent("BUTTON:onClick",onClick)},o.deactivate=function(){for(var n in i)o.offEvent(n,i[n]);i={},o.onHide()},o.onEvent=function(n,o){on(n,o),i[n]=o},o.offEvent=function(n,o){off(n,o),delete i[n]},o.onShow||(o.onShow=function(n){CONTENT.fill(o,n)}),o.onHide||(o.onHide=function(){o.data&&o.data.onHide&&o.data.onHide()}),o.onUnload||(o.onUnload=function(){}),o.onClick||(o.onClick=function(n,o){}),o.onMouseDown||(o.onMouseDown=function(n){}),o.entity.screenScript=o}function getChild(e,t,n){return getChildScript(e,t,n)}function getTextfield(e){return ENTITY.getTextfield(e)}function getScript(e,t){return ENTITY.getScript(e,t)}function getChildScript(e,t,n){return ENTITY.getChild(e,t,n)}function getChildrenNames(e,t,n){return ENTITY.getChildrenNames(e,t,n)}function getChildrenNameScripts(e,t,n){return ENTITY.getChildrenNameScripts(e,t,n)}function getChildren(e,t){return ENTITY.getChildren(e,t)}function addChild(e,t){return ENTITY.addChild(e,t)}function removeChild(e){return ENTITY.removeChild(e)}function toFront(e,t){return ENTITY.toFront(e,t)}function getLocals(e,t,n){return ENTITY.getLocals(e,t,n)}function getGlobals(e,t,n){return ENTITY.getGlobals(e,t,n)}function resetLocals(e){return ENTITY.resetLocals(e)}function applyVars(e,t){return ENTITY.applyVars(e,t)}function findByName(e){return ENTITY.findByName(e)}function localToLocal(e,t,n){return ENTITY.localToLocal(e,t,n)}function getPosition(e){return ENTITY.getPosition(e)}function getLocalPosition(e){return ENTITY.getLocalPosition(e)}function getEulerAngles(e){return ENTITY.getEulerAngles(e)}function setColor(e,t){ENTITY.setColor(e,t)}var ENTITY=new function(){var e=this;const t=new pc.Mat4,n=new pc.Mat4;e.removeChild=function(e,t){return e&&e.parent?(t||(e.enabled=!1),e.parent.removeChild(e),e):e},e.addChild=function(t,n){if(t&&n)return t.enabled=!0,e.reparent(t,n)},e.reparent=function(e,t){if(e&&t){var n=t||e.parent;if(e.parent!=t)return e.reparent(n),e}},e.toFront=function(t,n){t&&(n=n||t.parent)&&(e.removeChild(t),e.addChild(t,n))},e.getChildren=function(e,t,n){var r=[];if(!e||!e.children)return r;for(var o in e.children){var i=e.children[o];i&&i.name&&"Untitled"!=i.name&&(t&&-1==i.name.indexOf(t)||r.push(i))}if(null!=n)for(o in r)r[o].enabled=n;return r},e.getChild=function(t,n,r){var o=t.findByName(n);if(o)return r?e.getScript(o,r):o},e.getTextfield=function(e){if(e){var t=getChild(e,"textField");if(t)return t;var n=getChildren(e);for(var r in n)if(n[r].element&&n[r].name.includes("Field"))return n[r];return t}},e.getScript=function(e,t){if(e&&t&&e.script&&e.script[t])return e.script[t]},e.getChildrenScripts=function(t,n){var r=e.getChildren(t);for(var o in r)r[o]=r[o].script[n];return r},e.getChildrenNameScripts=function(t,n,r){var o=e.getChildrenNames(t,n);let i={};for(var l in o){let e=o[l];e.script&&e.script[r]&&(i[l]=e.script[r])}return i},e.getChildrenNames=function(e,t){var n={};if(!e)return n;for(var r in e.children){var o=e.children[r];o&&o.name&&"Untitled"!=o.name&&(t&&!o.name.includes(t)||(n[o.name]=o))}return n},e.getChildFilter=function(t,n,r){for(var o in t.children)if(-1!=t.children[o].name.indexOf(n))return r&&e.removeChild(t.children[o]),t.children[o]},e.findByName=function(e){return root.findByName(e)},e.localToLocal=function(e,r,o=new pc.Vec3){var i=e.getWorldTransform(),l=t.copy(r.getWorldTransform()).invert();return n.mul2(l,i),n.getTranslation(o),o},e.localToScreen=function(e){if(!e)return new pc.Vec3;var t=e.getLocalPosition().clone();return function addParentPos(e){var n=e.parent;if(!n||n==UI.Screens)return;var r=n.getLocalPosition();t.x+=r.x,t.y+=r.y,addParentPos(e.parent)}(e),t},e.rotationToLocal=function(e){return(new pc.Quat).setFromMat4(e.getWorldTransform().clone())},e.getScale=function(e){return(new pc.Vec3).copy(e.getScale())},e.getEulerAngles=function(e){return(new pc.Vec3).copy(e.getEulerAngles())},e.getPosition=function(e){return(new pc.Vec3).copy(e.getPosition())},e.getPositions=function(t){var n=[];for(var r in t)n.push(e.getPosition(t[r]));return n},e.getLocalScale=function(e){return(new pc.Vec3).copy(e.getLocalScale())},e.getLocalEulerAngles=function(e){return(new pc.Vec3).copy(e.getLocalEulerAngles())},e.getLocalPosition=function(e){return(new pc.Vec3).copy(e.getLocalPosition())},e.setLocalScale=function(e,t,n){var r=n||1,o=null!=t?t:1,i=MATH.isNumber(o)?{x:o,y:o,z:o}:o;e.setLocalScale(i.x*r,i.y*r,i.z*r)},e.getLocals=function(t,n,r){if(t){if(!Array.isArray(t))return t.pos&&!r||(t.pos=e.getLocalPosition(t)),t.sca&&!r||(t.sca=e.getLocalScale(t)),t.rot&&!r||(t.rot=e.getLocalEulerAngles(t)),null!=n&&(t.enabled=n),t;for(var o in t)e.getLocals(t[o],n)}},e.getGlobals=function(t,n,r){if(t)if(Array.isArray(t))for(var o in t)e.getLocals(t[o],n,r);else t.gPos&&!r||(t.gPos=e.getPosition(t)),t.gRot&&!r||(t.gRot=e.getEulerAngles(t)),null!=n&&(t.enabled=n)},e.resetLocals=function(t,n){if(t)if(Array.isArray(t))for(var r in t)e.resetLocals(t[r]);else{var o=t.rigidbody;if(o&&(o.type="kinematic"),t.setLocalPosition(t.pos),t.setLocalScale(t.sca),t.setLocalEulerAngles(t.rot),o){var i=t.getPosition(),l=t.getEulerAngles();o.linearVelocity=pc.Vec3.ZERO,o.angularVelocity=pc.Vec3.ZERO,o.teleport(i.x,i.y,i.z,l.x,l.y,l.z)}null!=n&&(t.enabled=n)}},e.localToRigidbody=function(e){e.enabled=!0;var t=e.getPosition(),n=e.getEulerAngles();e.rigidbody.teleport(t.x,t.y,t.z,n.x,n.y,n.z),e.rigidbody.type="dynamic"},e.wrap=function(e,t){e&&t&&(t.getPosition=function(){return e.getPosition()},t.getRotation=function(){return e.getRotation()},t.getEulerAngles=function(){return e.getEulerAngles()},t.getLocalPosition=function(){return e.getLocalPosition()},t.getLocalRotation=function(){return e.getLocalRotation()},t.getLocalEulerAngles=function(){return e.getLocalEulerAngles()},t.getLocalScale=function(){return e.getLocalScale()},t.setPosition=function(t,n,r){return e.setPosition(t,n,r)},t.setRotation=function(t,n,r,o){return e.setRotation(t,n,r,o)},t.setEulerAngles=function(t,n,r){return e.setEulerAngles(t,n,r)},t.setLocalPosition=function(t,n,r){return e.setLocalPosition(t,n,r)},t.setLocalRotation=function(t,n,r,o){return e.setLocalRotation(t,n,r,o)},t.setLocalEulerAngles=function(t,n,r){return e.setLocalEulerAngles(t,n,r)},t.setLocalScale=function(t,n,r){return e.setLocalScale(t,n,r)},t.lookAt=function(t,n=pc.Vec3.UP){e.setRotation(MATH.lookAt(e.getPosition(),t,n))})},e.applyVars=function(t,n){if(n=n||{},t.enabled=!0,n.parent&&addChild(t,n.parent),n.position&&(n.x=n.position.x,n.y=n.position.y,n.z=n.position.z),n.pos&&(n.x=n.pos.x,n.y=n.pos.y,n.z=n.pos.z),n.scale&&t.setLocalScale(n.scale,n.scaleY||n.scale,n.scale),n.rotation&&t.setLocalEulerAngles(n.rotation.x,n.rotation.y,n.rotation.z),null!=n.alpha&&t.element&&(t.element.opacity=n.alpha),e.setLayers(t,n.layers),n.color){var r=Array.isArray(n.color)?ARRAY.getRandomItem(n.color):n.color;t.element&&(t.element.color=COLOR.get(r))}return n.text&&t.element&&(t.element.text=MATH.commas(n.text)),n.tags&&(t.tags=asset.tags),n.blend&&ASSETS.applyBlendMode(t.element),(n.x||n.y||n.z)&&t.setLocalPosition(n.x||0,n.y||0,n.z||0),t},e.setLayers=function(e,t){if(e&&!t){var n=[];for(var r in t){var o=APP.scene.layers.getLayerByName(t[r]);o&&n.push(o.id)}e.layers=n,e.element&&(e.element.layers=n)}},e.setColor=function(e,t){if(!e||!t)return;if(Array.isArray(e)){for(var n in e)setColor(e[n],t);return}if(Array.isArray(t))return setColor(e,ARRAY.getRandomItem(t));let r=COLOR.get(t);e.element&&(e.element.color=r),e.sprite&&(e.sprite.color=r)},e.getDistanceXY=function(e,t){if(e&&t)return e=e.entity||e,t=t.entity||t,MATH.distanceXY(e.getLocalPosition(),t.getLocalPosition())},e.getVisibleComponents=function(e){let t=e.findComponents("model"),n=e.findComponents("render");return t.concat(n)},e.show=function(t){let n=e.getVisibleComponents(t);for(const e of n)e.show()},e.hide=function(t){let n=e.getVisibleComponents(t);for(const e of n)e.hide()},e.isVisible=function(e,t=!1){let n=[];if(e.model&&(n=e.model.meshInstances),e.render&&(n=n.concat(e.render.meshInstances)),!t)return n[0].visible;for(const e of n)if(!e.visible)return!1;return!0},e.anyVisibleChild=function(t,n=!1){let r=e.getVisibleComponents(t);for(const t of r)if(e.isVisible(t.entity,n))return!0;return!1}},DEPTH=ENTITY;var TEXTURE=new function(){var e=this,r={};e.getBase64=function(t,a){if(r[t])return a(r[t]);ASSETS.loadTexture(t,(function onAsset(n){var i=e.textureToBase64(n.resources[0]);r[t]=i,a&&a(i)}))},e.urlToTexture=function(e,r){var t=new Image;t.crossOrigin="Anonymous",t.src=e,t.onload=function(){var e=document.createElement("canvas"),a=e.getContext("2d");e.height=this.naturalHeight,e.width=this.naturalWidth,a.drawImage(this,0,0),function base64ToTexture(e){var a=new pc.Texture(APP.graphicsDevice,{mipmaps:!1});a.minFilter=pc.FILTER_LINEAR,a.magFilter=pc.FILTER_LINEAR,a.addressU=pc.ADDRESS_CLAMP_TO_EDGE,a.addressV=pc.ADDRESS_CLAMP_TO_EDGE,t.src=e,t.onload=e=>{a.setSource(t),r(a)}}(e.toDataURL("image/png"))}},e.base64ToTexture=function(e,r){var t=new pc.Texture(APP.graphicsDevice,{mipmaps:!1});t.minFilter=pc.FILTER_LINEAR,t.magFilter=pc.FILTER_LINEAR,t.addressU=pc.ADDRESS_CLAMP_TO_EDGE,t.addressV=pc.ADDRESS_CLAMP_TO_EDGE;var a=new Image;a.crossOrigin="Anonymous",log("OK CREATED IMAGE",e),a.onload=function(e){log("IMAGE LOADED!"),t.setSource(a),r(t)},a.src=e},e.urlToBase64=function(e,t){var a=new Image;a.crossOrigin="Anonymous",a.onload=function(){var a=document.createElement("CANVAS"),n=a.getContext("2d");a.height=this.naturalHeight,a.width=this.naturalWidth,n.drawImage(this,0,0);var i=a.toDataURL("image/png");r[e]=i,t(i)},a.src=e},e.textureToBase64=function(e){if(!e)return null;var r=e.device;if(!r)return log("Texture has no GraphicsDevice");var t=new pc.RenderTarget({colorBuffer:e,depth:!1}),a=e.width,n=e.height,i=r.renderTarget;r.setRenderTarget(t),r.updateBegin();var o=new Uint8Array(4*a*n);r.readPixels(0,0,a,n,o),r.updateEnd(),r.setRenderTarget(i);var c=document.createElement("canvas");c.width=a,c.height=n;for(var s=c.getContext("2d"),d=new Uint8ClampedArray(o.length),u=0;u<n;u++)for(var g=0;g<a;g++){var h=4*(g+u*a),p=4*(g+(n-1-u)*a);d[p+0]=o[h+0],d[p+1]=o[h+1],d[p+2]=o[h+2],d[p+3]=o[h+3]}var l=new ImageData(d,a,n);return s.putImageData(l,0,0),c.toDataURL("image/png")},e.textureToBase64Cropped=function(e,r,t){var a=e.device;if(!a)return log("Texture has no GraphicsDevice");var n=new pc.RenderTarget({colorBuffer:e,depth:!1}),i=r||512,o=t||256,c=a.renderTarget;a.setRenderTarget(n),a.updateBegin();var s=new Uint8Array(4*i*o);a.readPixels((APP.graphicsDevice.width-i)/2,(APP.graphicsDevice.height-o)/2,i,o,s),a.updateEnd(),a.setRenderTarget(c);var d=document.createElement("canvas");d.width=i,d.height=o;for(var u=d.getContext("2d"),g=new Uint8ClampedArray(s.length),h=0;h<o;h++)for(var p=0;p<i;p++){var l=4*(p+h*i),m=4*(p+(o-1-h)*i);g[m+0]=s[l+0],g[m+1]=s[l+1],g[m+2]=s[l+2],g[m+3]=s[l+3]}var v=new ImageData(g,i,o);return u.putImageData(v,0,0),d.toDataURL("image/png")},e.base64Download=function(e){var r=document.createElement("img");r.src=e,r.style.border="1px solid black",r.style.position="absolute",r.style.width="-webkit-fill-available",document.body.appendChild(r),setTimeout((function(){r.parentNode.removeChild(r)}),1e3);var t=document.createElement("a");t.href=e,t.download=DATE.getNow()+".png",t.click()},e.renderLayersToTexture=function(e,r,t,a,n){for(var i in e=e||["BACKGROUND","World"])e[i]=APP.scene.layers.getLayerByName(e[i]);var o=r||new pc.Texture(APP.graphicsDevice,{width:t||APP.graphicsDevice.width,height:a||APP.graphicsDevice.height,format:pc.PIXELFORMAT_R8_G8_B8_A8}),c=new pc.RenderTarget({colorBuffer:o,depth:!0,flipY:n}),s=new pc.LayerComposition,d=[];return e.forEach((function(e){d.push(e.renderTarget),e.renderTarget=c,s.push(e),e.cameras[0].calculateAspectRatio(c)})),APP.renderer.renderComposition(s),e.forEach((function(e,r){s.remove(e),e.renderTarget=d[r]})),o}};var QUALITY=new function(){var e,a=this,i=60,r=null,t=[];function setFPS(e){r&&clearInterval(r),r=null,i=e,APP.autoRender=!0,60!=i&&(APP.autoRender=!1,r=setInterval((function(){APP.renderNextFrame=!0}),1e3/i))}a.devicePixelRatio=2,a.quality=!0,a.init=function(){e=APP.graphicsDevice,a.setQuality(function getMaxPixelRatio(){if(!pc.platform.mobile)return 2;if(Math.min(e.width,e.height)*window.devicePixelRatio<750)return 1;var a=pc.Application.getApplication().graphicsDevice.unmaskedRenderer;if(!a)return 1;if(-1!==a.search(/Adreno\D*3/)||-1!==a.search(/Adreno\D*4/)||-1!==a.search(/Adreno\D*505/)||-1!==a.search(/Adreno\D*506/)||-1!==a.search(/Mali\D*2/)||-1!==a.search(/Mali\D*3/)||-1!==a.search(/Mali\D*4/)||-1!==a.search(/Mali\D*5/)||-1!==a.search(/Mali\D*6/)||-1!==a.search(/Mali\D*T6/)||-1!==a.search(/Mali\D*T7/)||-1!==a.search(/Mali\D*T82/)||-1!==a.search(/Mali\D*T83/)||-1!==a.search(/Mali\D*T86/)||-1!==a.search(/Adreno\D*508/)||-1!==a.search(/Adreno\D*512/)||-1!==a.search(/Adreno\D*510/)||-1!==a.search(/Adreno\D*509/)||-1!==a.search(/Adreno\D*540/)||-1!==a.search(/Adreno\D*530/)||-1!==a.search(/Adreno\D*530/)||-1!==a.search(/Mali\D*T88/)||-1!==a.search(/Mali\D*G71/)||-1!==a.search(/Mali\D*G52/)||-1!==a.search(/Mali\D*G72/))return 1;return 2}()>1)},a.low=function(){a.setQuality(!1)},a.high=function(){a.setQuality(!0)},a.setQuality=function(i){for(var r in a.quality=i,display("Quality",i),a.devicePixelRatio=e.maxPixelRatio=a.quality?pc.platform.desktop?window.devicePixelRatio:MATH.clamp(window.devicePixelRatio,2,1):1,t)t[r]();if(a.quality)return UIFX.enable(),void setFPS(60);UIFX.disable(),setFPS(24)}};var DATE=new function(){var o=this;o.now=Date.now(),o.dt=1,o.getNow=function(){return Date.now()},o.getISO=function(){return new Date((new Date).toISOString()).getTime()},o.now=o.getNow,o.daysFrom=function(n){return Math.floor(o.millisecondsFrom(n)/864e5)},o.hoursFrom=function(n){return Math.floor(o.fractionHoursFrom(n))},o.fractionHoursFrom=function(n){return o.millisecondsFrom(n)/36e5},o.secondsFrom=function(n){return Math.floor(o.millisecondsFrom(n)/1e3)},o.millisecondsFrom=function(n){return o.getNow()-n},o.format=function(o){var n=o;return n.getFullYear()+"."+n.getMonth()+"."+n.getDate()},o.days=function(o){if(o<1e3)return Math.round(o)+"msec ";for(var n=Math.round(o/1e3),r=0,e=0,t=0;n>=86400;)r++,n-=86400;for(;n>=3600;)e++,n-=3600;for(;n>=60;)n-=60,t++;var i=[];return r&&i.push(r+"D"),e&&i.push(e+"H"),r?i.join(" "):(t&&i.push(t+"Min"),e||n&&i.push(STRING.fillZero(n,1)+"sec"),i.join(" "))},o.seconds=function(o){for(var n=0,r=0,e=Math.round(o);e>=60;)e-=60,r++;for(;r>=60;)r-=60,n++;return n?STRING.fillZero(n,1)+":"+STRING.fillZero(r,1)+STRING.fillZero(e,1):r?STRING.fillZero(r,1)+":"+STRING.fillZero(e,1):"0:"+STRING.fillZero(e,1)},o.millisecondsToSeconds=function(o){return o/1e3},o.mts=function(n){return o.millisecondsToSeconds(n)},o.secondsToMinutes=function(o){return o/60},o.millisecondsToMinutes=function(o){return Math.ceil(o/6e4)}};"undefined"!=typeof document&&(
/*! FPSMeter 0.3.1 - 9th May 2013 | https://github.com/Darsain/fpsmeter */
function(t,e){function s(t,e){for(var n in e)try{t.style[n]=e[n]}catch(t){}return t}function H(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function R(t,e){if("array"!==H(e))return-1;if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function I(){var t,e=arguments;for(t in e[1])if(e[1].hasOwnProperty(t))switch(H(e[1][t])){case"object":e[0][t]=I({},e[0][t],e[1][t]);break;case"array":e[0][t]=e[1][t].slice(0);break;default:e[0][t]=e[1][t]}return 2<e.length?I.apply(null,[e[0]].concat(Array.prototype.slice.call(e,2))):e[0]}function N(t){return 1===(t=Math.round(255*t).toString(16)).length?"0"+t:t}function S(t,e,n,o){t.addEventListener?t[o?"removeEventListener":"addEventListener"](e,n,!1):t.attachEvent&&t[o?"detachEvent":"attachEvent"]("on"+e,n)}function D(t,e){function g(t,e,n,o){return h[0|t][Math.round(Math.min((e-n)/(o-n)*M,M))]}function r(){F.legend.fps!==q&&(F.legend.fps=q,F.legend[c]=q?"FPS":"ms"),b=q?v.fps:v.duration,F.count[c]=999<b?"999+":b.toFixed(99<b?0:O.decimals)}function m(){for(l=n(),P<l-O.threshold&&(v.fps-=v.fps/Math.max(1,60*O.smoothing/O.interval),v.duration=1e3/v.fps),w=O.history;w--;)T[w]=0===w?v.fps:T[w-1],j[w]=0===w?v.duration:j[w-1];if(r(),O.heat){if(z.length)for(w=z.length;w--;)z[w].el.style[o[z[w].name].heatOn]=q?g(o[z[w].name].heatmap,v.fps,0,O.maxFps):g(o[z[w].name].heatmap,v.duration,O.threshold,0);if(F.graph&&o.column.heatOn)for(w=C.length;w--;)C[w].style[o.column.heatOn]=q?g(o.column.heatmap,T[w],0,O.maxFps):g(o.column.heatmap,j[w],O.threshold,0)}if(F.graph)for(y=0;y<O.history;y++)C[y].style.height=(q?T[y]?Math.round(x/O.maxFps*Math.min(T[y],O.maxFps)):0:j[y]?Math.round(x/O.threshold*Math.min(j[y],O.threshold)):0)+"px"}function k(){20>O.interval?(p=i(k),m()):(p=setTimeout(k,O.interval),f=i(m))}function G(t){(t=t||window.event).preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0),v.toggle()}function U(){O.toggleOn&&S(F.container,O.toggleOn,G,1),t.removeChild(F.container)}function V(){if(F.container&&U(),o=D.theme[O.theme],!(h=o.compiledHeatmaps||[]).length&&o.heatmaps.length){for(y=0;y<o.heatmaps.length;y++)for(h[y]=[],w=0;w<=M;w++){var e,n=h[y],a=w;e=.33/M*w;var i=o.heatmaps[y].saturation,l=o.heatmaps[y].lightness,p=void 0,c=void 0,u=void 0,d=u=void 0,f=p=c=void 0;f=void 0;0===(u=.5>=l?l*(1+i):l+i-l*i)?e="#000":(c=(u-(d=2*l-u))/u,f=(e*=6)-(p=Math.floor(e)),f*=u*c,0===p||6===p?(p=u,c=d+f,u=d):1===p?(p=u-f,c=u,u=d):2===p?(p=d,c=u,u=d+f):3===p?(p=d,c=u-f):4===p?(p=d+f,c=d):(p=u,c=d,u-=f),e="#"+N(p)+N(c)+N(u)),n[a]=e}o.compiledHeatmaps=h}for(var b in F.container=s(document.createElement("div"),o.container),F.count=F.container.appendChild(s(document.createElement("div"),o.count)),F.legend=F.container.appendChild(s(document.createElement("div"),o.legend)),F.graph=O.graph?F.container.appendChild(s(document.createElement("div"),o.graph)):0,z.length=0,F)F[b]&&o[b].heatOn&&z.push({name:b,el:F[b]});if(C.length=0,F.graph)for(F.graph.style.width=O.history*o.column.width+(O.history-1)*o.column.spacing+"px",w=0;w<O.history;w++)C[w]=F.graph.appendChild(s(document.createElement("div"),o.column)),C[w].style.position="absolute",C[w].style.bottom=0,C[w].style.right=w*o.column.width+w*o.column.spacing+"px",C[w].style.width=o.column.width+"px",C[w].style.height="0px";s(F.container,O),r(),t.appendChild(F.container),F.graph&&(x=F.graph.clientHeight),O.toggleOn&&("click"===O.toggleOn&&(F.container.style.cursor="pointer"),S(F.container,O.toggleOn,G))}"object"===H(t)&&undefined===t.nodeType&&(e=t,t=document.body),t||(t=document.body);var o,h,l,p,f,x,b,w,y,v=this,O=I({},D.defaults,e||{}),F={},C=[],M=100,z=[],E=O.threshold,A=0,P=n()-E,T=[],j=[],q="fps"===O.show;v.options=O,v.fps=0,v.duration=0,v.isPaused=0,v.tickStart=function(){A=n()},v.tick=function(){l=n(),E+=(l-P-E)/O.smoothing,v.fps=1e3/E,v.duration=A<P?E:l-A,P=l},v.pause=function(){return p&&(v.isPaused=1,clearTimeout(p),a(p),a(f),p=f=0),v},v.resume=function(){return p||(v.isPaused=0,k()),v},v.set=function(t,e){return O[t]=e,q="fps"===O.show,-1!==R(t,u)&&V(),-1!==R(t,d)&&s(F.container,O),v},v.showDuration=function(){return v.set("show","ms"),v},v.showFps=function(){return v.set("show","fps"),v},v.toggle=function(){return v.set("show",q?"ms":"fps"),v},v.hide=function(){return v.pause(),F.container.style.display="none",v},v.show=function(){return v.resume(),F.container.style.display="block",v},v.destroy=function(){v.pause(),U(),v.tick=v.tickStart=function(){}},V(),k()}var n,o=t.performance;n=o&&(o.now||o.webkitNow)?o[o.now?"now":"webkitNow"].bind(o):function(){return+new Date};for(var a=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,i=t.requestAnimationFrame,h=0,l=0,p=(o=["moz","webkit","o"]).length;l<p&&!a;++l)i=(a=t[o[l]+"CancelAnimationFrame"]||t[o[l]+"CancelRequestAnimationFrame"])&&t[o[l]+"RequestAnimationFrame"];a||(i=function(e){var o=n(),a=Math.max(0,16-(o-h));return h=o+a,t.setTimeout((function(){e(o+a)}),a)},a=function(t){clearTimeout(t)});var c="string"===H(document.createElement("div").textContent)?"textContent":"innerText";D.extend=I,window.FPSMeter=D,D.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var u=["toggleOn","theme","heat","graph","history"],d="position zIndex left top right bottom margin".split(" ")}(window),function(t,e){e.theme={};var n=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter));var Fps=pc.createScript("fps");Fps.prototype.initialize=function(){this.fps=new FPSMeter({heat:!0,graph:!0})},Fps.prototype.update=function(t){this.fps.tick()};var EVENTS;if(!EVENTS)try{EVENTS=new EventTarget}catch(E){EVENTS=new function(){this.addListener=function(E,n){}}}var TOY,DELAY=new function(){var n=this,e={},t=0;function Instance(n,e,t,u,c){var a=this;e=e||.01,u&&DELAY.start(u,e);var i=!1,l=0,r="MOTOR:on"+(c?"Steady":"Update");function onUpdate(t){i||(l+=t)<e||(a.cancel(),n())}a.cancel=function(){l=0,off(r,onUpdate)},a.pause=function(){i=!0},a.resume=function(){i=!1},on(r,onUpdate)}n.getID=function(n){return n||"delay"+t++},n.start=function(e,t,u,c,a){return n.unique(null,e,t,u,c,a)},n.unique=function(t,u,c,a,i,l){if(TOY){n.cancel(t),t=n.getID(t);var r=new Instance((function(){delete e[t],u()}),c,a,i,l);return e[t]=r,r}},n.cancel=function(t){if(t)if(Array.isArray(t))for(var u in t)n.cancel(t[u]);else{var c=e[t];c&&c.cancel(),delete e[t]}}},delay=DELAY.start,cancel=DELAY.cancel,delayUnique=DELAY.unique,unique=DELAY.unique;function steady(n,e,t,u){delay(n,e,t,u,!0)}function uniqueSteady(n,e,t,u,c){return unique(n,e,t,u,c,!0)}function DelayUnique(n,e){n=DELAY.getID(n),this.start=function(t,u){unique(n,t,u,null,null,e)},this.cancel=function(){cancel(n)}}function DelayGroup(n,e){var t=0,u={};this.start=function(c,a){var i=DELAY.getID(n)+t++;u[i]=!0,unique(i,(function(){delete u[i],c()}),a,null,null,e)},this.cancel=function(){for(var n in u)cancel(n);u={}}}var AutoMemoryHandler=pc.createScript("autoMemoryHandler");AutoMemoryHandler.attributes.add("assetTag",{type:"string",title:"Asset Tag",description:"A tag used on a list of assets to be loaded/unloaded automatically by this script. You can use the .setTag() method to update it in code."}),AutoMemoryHandler.prototype.initialize=function(){this.count=0,this.assets=void 0},AutoMemoryHandler.prototype.boot=function(){this.assetTag&&(this.assets=this.app.assets.findByTag(this.assetTag))},AutoMemoryHandler.prototype.setTag=function(t){log("=== MEMORY set  tag",t),this.assetTag=t,this.boot()},AutoMemoryHandler.prototype.setState=function(t){return log("MEMORY HANDLER setState",t,this.assetTag),new Promise(function(s){this.count=0;var e=!1;this.assets&&this.assets.forEach(function(o){!0===t?!1===o.loaded?(o.ready(function(){this.count++,this.count===this.assets.length&&s()}.bind(this)),this.app.assets.load(o),e=!0):(log("ASSET Was loaded",this.count),this.count++):(log("UNLOAD ASSET"),o.unload())}.bind(this)),!1===e&&s()}.bind(this))};function merge(r,n){return ARRAY.merge(r,n)}function clone(r){return ARRAY.clone(r)}function extract(r,n){return ARRAY.extract(r,n)}function push(r,n){return ARRAY.push(r,n)}function isArray(r){return Array.isArray(r)}function pushUnique(r,n){return ARRAY.pushUnique(r,n)}function getRandomItem(r,n,t){return ARRAY.getRandomItem(r,n,t)}function removeItem(r,n){return ARRAY.removeItem(r,n)}function shuffle(r,n){return ARRAY.shuffle(r,n)}function copy(r){return ARRAY.copy(r)}function sort(r,n){return ARRAY.sort(r,n)}var ARRAY=new function(){var r=this;r.push=function(r,n){var t=n||[];for(var e in r)t.push(r[e]);return t},r.clone=function(r){var n={};for(var t in r)n[t]=r[t];return n},r.deepClone=function(r){return JSON.parse(JSON.stringify(r))},r.extract=function(r,n){var t=n||{};if(!r)return t;if(r.__attributes)for(var e in r.__attributes)n[e]=r[e];else for(var u in r)t[u]=r[u];return t},r.fromObject=function(r){var n=[];for(var t in r)n.push(r[t]);return n},r.merge=function(n,t){var e=r.clone(t);for(var u in n)e[u]=n[u];return e},r.mergeUnique=function(r,n){for(var t in r)null==n[t]&&(n[t]=r[t]);return n},r.pushUnique=function(r,n){return-1==r.indexOf(n)&&r.push(n),n},r.copy=function(r){for(var n=[],t=0;t<r.length;t++)n[t]=r[t];return n},r.getRandomItem=function(n,t,e){if(!n.length)return null;var u=RANDOM.value(n.length-1),o=n[u];return o==e?r.getRandomItem(n,t,e):(t&&n.splice(u,1),o)},r.removeItem=function(r,n){var t=r.indexOf(n);return-1!=t&&(r.splice(t,1),n)},r.remove=r.removeItem,r.removeItems=function(n,t){for(var e in t)r.removeItem(n,t[e])},r.extractUnique=function(r,n){var t=n||[];for(var e in r)-1==t.indexOf(r[e])&&t.push(r[e]);return t},r.sort=function(r,n){return r.sort((function(r,t){return r[n]>t[n]?1:t[n]>r[n]?-1:0})),r},r.shuffle=function(n,t){for(var e=r.copy(n),u=[];e.length;)if(u.push(r.getRandomItem(e,!0)),u.length==t)return u;return u},r.shuffleLinear=function(n){for(var t=r.copy(n),e=0;e<n.length;e++)RANDOM.chance()&&r.firstToLast(t);return RANDOM.chance()&&t.reverse(),t},r.firstToLast=function(r){return r.push(r.shift()),r},r.lastToFirst=function(n){return n.reverse(),r.firstToLast(n.shift()),n.reverse(),n},r.searchObject=function(r,n){var t={};for(var e in r)STRING.containsStrict(e,n)&&(t[e]=r[e]);return t},r.pages=function(n,t){n=r.copy(n);for(var e=[];n.length;){for(var u=[],o=0;++o<=t&&n.length;)u.push(n.shift());e.push(u)}return e},r.toNameVar=function(r,n){var t={};for(var e in r)t[r[e][n]]=r[e];return t},r.parse=function(r){if(r){try{return JSON.parse(r)}catch(n){log("----------JSON PARSE ERROR---------",r)}return{}}return{}},r.rotate=function(n,t){t=null==t?RANDOM.value(3):t;var e=[],u=Math.sqrt(n.length);e.length=n.length;for(var o=0;o<n.length;o++){e[o%u*u+(u-Math.floor(o/u)-1)]=n[o]}return t>0?r.rotate(e,t-1):e},r.flip=function(n){for(var t=[],e=0,u=Math.sqrt(n.length),o=0;o<u;o++){for(var f=[],i=0;i<u;i++)f.push(n[e++]);r.push(f.reverse(),t)}return t},r.findItemByAttribute=function(r,n,t){for(var e in r)if(r[e][n]==t)return r[e]},r.salchiche=function(n,t){for(var e=r.clone(n),u=[];u.length<e.length;)u.push(e.shift());for(t&&(u=u.reverse());u.length;)e.push(u.shift());return e},r.mirror=function(n,t){n=r.clone(n);var e=[];for(t=t||n.length;e.length<t;)e.push(n.shift());var u=r.clone(e);for(u=u.reverse();u.length;)e.push(u.shift());return e},r.contains=function(r,n){return-1!=r.indexOf(n)},r.containsArray=function(r,n){if(!Array.isArray(r)||!r||!n)return 0;r=copy(r);let t=0;for(var e in n){removeItem(r,n[e])&&t++}return r.length?0:t},r.getCue=function(n,t){return n.length||r.push(r.shuffle(t),n),n.shift()},r.toString=function(r){var n="";for(var t in r)n+=r[t];return n},r.trim=function(r,n){for(var t=[],e=(n=n||r.length,0);e<n;e++)null!=r[e]&&t.push(r[e]);return t},r.cycle=function(r,n,t,e){for(var u=[],o=n||0,f=t||1,i=e||1;f;)(o+=i)>=r.length&&(o-=r.length),u.push(o),f--;return u},r.getClamp=function(r,n){return n>=r.length?r[r.length-1]:r[n]}};var SPRING=new function(){var r=this;new pc.Vec2,new pc.Vec2;r.max=function(r,t,n,x){var a=x||10,u=t.x-r.x,z=t.y-r.y,e=Math.sqrt(u*u+z*z);if(e>n)return!1;var i=(e-n)/e;return r.x+=u*i/a,r.y+=z*i/a,{x:u*i,y:z*i}},r.min=function(r,t,n,x){var a=x||1,u=t||{x:0,y:0},z=u.x-r.x,e=u.y-r.y,i=Math.sqrt(z*z+e*e);if(i<n)return!1;var c=(i-n)/i;return r.x+=z*c/a,r.y+=e*c/a,{x:z*c,y:e*c}},r.z=function(r,t,n,x){var a=x||1,u=t.x-r.x,z=t.z-r.z,e=Math.sqrt(u*u+z*z),i=(e-n)/e;return r.x+=u*i/a,r.z+=z*i/a,{x:u*i,z:z*i}},r.minZ=function(r,t,n,x,a){var u=x||1,z=t.x-r.x,e=t.z-r.z,i=Math.sqrt(z*z+e*e),c=(i-n)/i;return!(i<n)&&(r.x+=z*c/u,r.z+=e*c/u,z=t.x-r.x,e=t.z-r.z,i=Math.sqrt(z*z+e*e),a&&(t.x-=z*c/u,t.z-=e*c/u),{x:z*c,z:e*c})},r.maxZ=function(r,t,n,x,a){var u=x||1,z=t.x-r.x,e=t.z-r.z,i=Math.sqrt(z*z+e*e),c=(i-n)/i;return!(i>n)&&(r.x+=z*c/u,r.z+=e*c/u,a&&(t.x-=z*c/u,t.z-=e*c/u),{x:z*c,z:e*c})},r.minValue=function(r,t,n,x){var a=x||1,u=t-r,z=Math.sqrt(u*u*2);return z<n?r:r+u*((z-n)/z)/a},r.maxValue=function(r,t,n,x){var a=x||1,u=t-r,z=Math.sqrt(u*u*2);return z>n?r:r+u*((z-n)/z)/a}};var CURVE=new function(){var e=new pc.Vec3,n=new pc.Vec3,c=new pc.Color(1,1,1,1),r=new pc.Vec3,x=new pc.Vec3;this.get=function(c,r,x,i){if(r)return x=null!=x?x:RANDOM.chance(),r.add(n.copy(r).normalize().scale(i||0)),e.copy(c).lerp(c,r,.8),x?e.x+=(r.x-c.x)/2:e.x-=(r.x-c.x)/2,new Bezier(c.x,c.y,c.z,e.x,e.y,e.z,r.x,r.y,r.z)},this.draw=function(e,n){for(var i=e.getLUT(50),o=0;o<i.length-1;o++)r.x=i[o].x,r.y=i[o].y,r.z=i[o].z,x.x=i[o+1].x,x.y=i[o+1].y,x.z=i[o+1].z,n.renderLine(r,x,c)}};var ASSETS=new function(){var e=this,n={};function getPool(e,t){return n[e]||(n[e]={}),n[e][t]||(n[e][t]=[]),n[e][t]}e.getTemplate=function(n,t,a){var i=e.find(n,"template");if(i)return e.getFoundTemplate(i,t,a,!1)},e.getTemplateAsync=function(n,t){return new Promise(((a,i)=>{var s=e.find(n,"template");s||i(`Template not found: ${n}`),e.getFoundTemplate(s,t,a,!1)}))},e.getFoundTemplate=function(e,n,t,a){return entity=e.resource.instantiate(),a||(entity.enabled=!0),n&&addChild(entity,n),t&&t(entity),entity},e.getTemplatesByTag=function(e){return APP.assets.findByTag(e,"template")||[]},e.findByTag=function(e,n){return APP.assets.findByTag(e,n)||[]},e.findCompositeName=function(n,t,a){var i=a+"_"+t;if(!n)return i;var s=n+"_"+t;return n&&e.find(s)?s:i},e.loadAssetsAsync=async function(n){log("ASSETS loadAssetsAsync",n);for(const t of n)await e.loadAssetAsync(t)},e.getTemplateAsync=function(n,t){return console.warn("DEPRECATED! ASSETS.getTemplateAsync() is deprecated. Use .loadTemplateAsync() instead."),new Promise((async(a,i)=>{const s=e.find(n,"template");s||i(`Template not found: ${n}`),s.loaded||await e.loadAssetAsync(s),e.getFoundTemplate(s,t,a,!1)}))},e.loadTemplateAsync=function(n,t={}){return new Promise((async(a,i)=>{const{parent:s=SCENES.Game,skipEnable:o=!1,skipInstantiate:r=!1}=t,d=e.find(n,"template");d||i(`Unable to find template ${n}`),d.loaded||await e.loadAssetAsync(d),d.ready((e=>{if(r)return a(e.resource);const n=e.resource.instantiate();o||(n.enabled=!0),s&&addChild(n,s),a(n)})),APP.assets.load(d)}))},e.loadAssetAsync=function(e){return new Promise(((n,t)=>{e.loaded&&n(e),e.ready((e=>n(e))),APP.assets.load(e)}))},e.loadTemplatesAsync=async function(n,t={}){const{returnResult:a=!0,namedObject:i=!1}=t;let s;a&&(s=i?{}:[]);for(const o of n){const n=await e.loadTemplateAsync(o,t);a&&(i?s[o]=n:s.push(n))}return s},e.loadScripts=function(n,t){var a,i={},s=[],o=[];let r=APP.assets.list();for(a in r){var d=r;if("script"==d.type&&!d.loaded&&!d.loading&&-1!=d.name.indexOf(n)){var l=d.tags._list[0]||"9999999";i[l]||(s.push(l),i[l]=[]),i[l].push(d)}}s.sort(),s.forEach((e=>ARRAY.push(i[e],o))),e.loadAssets(o,(function(){t()}))},e.loadScript=function(n,t){var a=e.find(n+".js","script");if(!a)return t();a.ready(t),APP.assets.load(a)},e.insertScript=function(e,n){var t,a=document.getElementsByTagName("script")[0];(t=document.createElement("script")).onload=n,t.src=e,a.parentNode.insertBefore(t,a)},e.loadTemplate=function(n,t,a,i){var s,o=e.find(n,"template");o&&(o.ready((function onSuccess(){s=o.resource.instantiate(),i||(s.enabled=!0);t&&addChild(s,t);a&&a(s)})),APP.assets.load(o))},e.loadTemplates=function(n,t,a,i){var s=new Callback(n.length,a);for(var o in n)e.loadTemplate(n[o],t,s.increase,i)},e.loadTemplateAndModels=function(n,t,a){e.loadTemplate(n,t,(function(n){e.preloadEntityModels(n,(function(){t&&addChild(n,t),a&&a(n)}))}))},e.loadTemplateAndElements=function(n,t,a){e.loadTemplate(n,t,(function(n){e.preloadElements(n,(function(){t&&addChild(n,t),a&&a(n)}))}))},e.preloadEntityModels=function(n,t){if(n._isLoaded)return t(n);var a=[],i=[],s=[],o=[],r=[],d=[];function pushUniqueID(e){e&&ARRAY.pushUnique(a,e)}function pushUnique(e,n){e&&(ARRAY.pushUnique(i,e),n&&ARRAY.pushUnique(r,e))}function consolidateAssets(){for(var n in a)pushUnique(e.getAsset(a[n]));return i}n.enabled=!1,function scan(n){n.model&&(pushUnique(e.getAsset(n.model.asset),!0),s.push(n.model)),n.render&&(pushUnique(n.render._assetReference.asset),d.push(n.render)),n.collision&&"mesh"===n.collision.type&&n.collision.renderAsset&&pushUniqueID(n.collision.renderAsset),n.element&&o.push(n.element);var t=getChildren(n);for(var a in t)scan(t[a])}(n),consolidateAssets(),e.loadAssets(i,(function onMeshesLoaded(){var l;for(l in i=[],a=[],s)if(s[l]._mapping)for(var u in s[l]._mapping)pushUniqueID(s[l]._mapping[u]);for(l in r)if(r[l].data&&r[l].data.mapping)for(var c in r[l].data.mapping)pushUniqueID(r[l].data.mapping[c].material);for(l in d)d[l].materialAssets&&d[l].materialAssets.forEach((e=>{pushUniqueID(e)}));for(l in o)o[l].textureAsset&&pushUniqueID(o[l].textureAsset),o[l].spriteAsset&&pushUniqueID(o[l].spriteAsset),o[l].materialAsset&&pushUniqueID(o[l].materialAsset);consolidateAssets(),e.loadAssets(i,(function(){n._isLoaded=!0,t(n)}))}))},e.preloadElements=function(n,t){if(!n)return t();if(n._elementsLoaded)return t(n);var a,i=[],s=[];for(a in function scan(e){var n=e.element;if(n){var t=n.textureAsset||n.spriteAsset||n.materialAsset;t&&ARRAY.pushUnique(i,t)}var a=getChildren(e);for(var s in a)scan(a[s])}(n),i){var o=e.getAsset(i[a]);o&&!o.loaded&&ARRAY.pushUnique(s,o)}n.enabled=!1,e.loadAssets(s,(function(){n._elementsLoaded=!0,n.enabled=!0,t(n)}))},e.loadAssets=function(e,n,t){if(e&&e.length){var a=new Callback(e.length,n,t);for(var i in e)doLoad(e[i])}else n&&n();function doLoad(e){if(e.loaded)return a.increase();e.ready(a.increase),APP.assets.load(e)}},e.loadAsset=function(e,n){if(e.loaded)return n(e);e.ready((function(){n(e)})),APP.assets.load(e)},e.getAsset=function(e){return APP.assets.get(e)},e.getTemplateRandom=function(n){var t=ARRAY.getRandomItem(e.getTemplatesByTag(n));if(t){var a=t.resource.instantiate();return a.tags=t.tags,a}},e.getScene=function(n,t){var a=e.findScene(n);a&&APP.scenes.loadSceneHierarchy(a,(function(e,n){e?console.error(e):(n.enabled=!1,t(n))}))},e.loadScene=function(n,t){e.getScene(n,(function(n){e.preloadEntityModels(n,t)}))},e.findScene=function(e){var n=APP.scenes.find(e);if(n)return n.url},e.loadJSON=function(n,t){var a=e.find(n,"json");if(!a)return log("JSON",n,"DOES NOT EXIST");a.ready((function onSuccess(){t&&t(a.resource)})),APP.assets.load(a)},e.createElement=function(e){e=e||{};var n=new pc.Entity;return n.addComponent("element",{anchor:new pc.Vec4(.5,.5,.5,.5),pivot:new pc.Vec2(.5,.5),width:1,height:1,type:"image"}),e.parent&&addChild(n,e.parent),n.element.layers=e.layers||[],n},e.createGroup=function(e){e=e||{};var n=new pc.Entity;return n.addComponent("element",{anchor:new pc.Vec4(.5,.5,.5,.5),pivot:new pc.Vec2(.5,.5),width:0,height:0,type:"group"}),e.parent&&addChild(n,e.parent),n.element.layers=e.layers||[],n},e.getAsync=function(n,t){var a="element",i=n.texture;n.template&&(a="template",i=n.template),n.model&&(a="model",i=n.model||"Coin"),n.particle&&(a="particle",i=n.particle),n.sprite&&(a="sprite",i=n.sprite),Array.isArray(i)&&(i=getRandomItem(i)),"sprite"==a&&!e.find(i)&&e.find(i+".png")&&(a="element");var s=getPool(a,i).shift();if(s)return onEntity();if("particle"!=a&&"template"!=a){if(s=new pc.Entity,"model"==a)return s.addComponent("model",{type:"asset"}),s.model.asset=e.find(i,"model"),onEntity();if("element"==a||"sprite"==a){var o={anchor:new pc.Vec4(.5,.5,.5,.5),pivot:new pc.Vec2(.5,null!=n.anchorY?n.anchorY:.5),width:512,height:512,type:"image"};return"sprite"==a&&(o.spriteAsset=e.find(i,"sprite")),"element"==a&&(o.textureAsset=e.find(i+".png","texture")),s.addComponent("element",o),onEntity()}}else{if(!e.find(i,"template"))return;e.loadTemplate(i,null,(function(e){s=e,onEntity()}))}function onEntity(){s.model&&s.model.show(),s.type||(s.type=a,s.label=i),t(applyVars(s,n))}},e.remove=function(e){if(e&&e.type){if(ARRAY.pushUnique(getPool(e.type,e.label),e),e.model)return e.model.hide();e.enabled=!1}},e.applyBlendMode=function(n){if(n&&(e.NORMAL||function createBlendModes(){var n=FX.element;if(!n||!n._addedModels[0])return;var t=n._addedModels[0].meshInstances[0];e.NORMAL=t.material,e.OVERLAY=e.NORMAL.clone(),e.OVERLAY.blendType=pc.BLEND_ADDITIVEALPHA,e.OVERLAY.update()}(),n._addedModels[0])){var t=n._addedModels[0].meshInstances[0];if(t.material!=e.NORMAL){var a=t.material.clone();a.blendType=pc.BLEND_ADDITIVEALPHA,a.update(),t.material=a}else t.material=e.OVERLAY}},e.findByName=function(e,n){return(n||root).findByName(e)},e.find=function(n,t,a){var i;if(APP.assets.find(CONFIG.id+n)&&(n=CONFIG.id+n),a){var s=e.findByTag(a,t);for(var o in s){if((i=s[o]).name==n)return i;if("model"==t&&i.name==n+".glb")return i}}return"model"==t?(i=APP.assets.find(n+".glb",t))||(i=APP.assets.find(n+".json",t))?i:(i=APP.assets.find(n,"render"))||void 0:(i=APP.assets.find(n,t))?i:void 0},e.findAsset=e.find,e.findMP3Names=function(n){var t=[],a=e.find(n+".mp3"),i=0;a&&t.push(n);do{i++,(a=e.find(n+i+".mp3"))&&t.push(n+i)}while(a);return t},e.findMP3=function(n){return e.find(n+".mp3")},e.preloadSFX=function(){var n=[];let t=APP.assets.list();for(var a in t){var i=t[a];i.loaded||i.loading||!i.name.includes("SFX")||n.push(i)}steady((function(){e.loadAssets(n)}),3)},e.findAllNumeric=function(n){var t,a=0,i=[];do{a++;var s=STRING.fillZero(a);(t=e.find(s+n))&&i.push(s)}while(t);return i},e.findTexture=function(n){var t=n+".png",a=e.find(t,"texture");if(a)return a},e.findMaterial=function(n){var t=n,a=e.find(t,"material");if(a)return a},e.findNamesNumeric=function(e){var n=0,t=[];let a=APP.assets.list();return function nextScan(){for(var i in n++,a){var s=a[i],o=e+"_"+n;if(s.name.includes(o+"."))return t.push(o),nextScan()}}(),log("findNamesNumeric",e,t,n),t};var t={};function loadWasmModuleAsync(n,t,a,i){e.loadScriptAsync(t,(function(){var e=window[n];window[n+"Lib"]=e,e({locateFile:function(){return a}}).then((function(e){window[n]=e,i()}))}))}e.preload=function(n,t){if(n){var a=[];for(var i in n){var s=e.find(n[i]);s&&a.push(s)}e.loadAssets(a,(function(){t&&t(a)}))}},e.preloadByName=function(n,t){if(!n)return;var a=[];let i=APP.assets.list();for(var s in a){var o=i[s];if(!o.loaded)for(var r in n)if(o.name.includes(n[r])){a.push(o);break}}e.loadAssets(a,(function(){t&&t(a)}))},e.preloadTags=function(n,t){if(n){var a=[];for(var i in n)ARRAY.push(e.findByTag(n[i]),a);e.loadAssets(a,t)}},e.deleteLoaded=function(e){delete t[e]},e.load=function(n,a,i,s){if(n){if(t[n])return i(t[n]);var o;if("texture"==a&&-1!=n.indexOf("http"))return-1!=n.indexOf("fbsbx")?void e.urlToTexture(n,(function(n){if(n)return onLoaded(n);e.load("User.png","texture",(function(e){onLoaded(e)}))})):(APP.loader.getHandler(a).crossOrigin="anonymous",void APP.assets.loadFromUrl(n,a,(function(n,t){if(t)return onLoaded(t);e.load("User.png","texture",(function(e){onLoaded(e)}))})));(o=e.find(n,a,s))&&("sprite"==a?MOTOR.start((function waitForAtlas(){if(!o.resource.atlas)return;MOTOR.stop(waitForAtlas),onLoaded(o)})):o.ready((function(){onLoaded(o)})),APP.assets.load(o))}function onLoaded(e){t[n]=e,i(e)}},e.urlToTexture=function(e,n){var t=new Image;t.crossOrigin="Anonymous",t.src=e,t.onload=function(){var e=document.createElement("canvas"),a=e.getContext("2d");e.height=this.naturalHeight,e.width=this.naturalWidth,a.drawImage(this,0,0),function base64ToTexture(e){var a=new pc.Texture(APP.graphicsDevice,{mipmaps:!1});a.minFilter=pc.FILTER_LINEAR,a.magFilter=pc.FILTER_LINEAR,a.addressU=pc.ADDRESS_CLAMP_TO_EDGE,a.addressV=pc.ADDRESS_CLAMP_TO_EDGE,t.src=e,t.onload=e=>{a.setSource(t),n(a)}}(e.toDataURL("image/png"))},t.onerror=function(){n()}},e.loadTexture=function(n,t,a){if(n){if(e.find(n,"sprite",a))return e.loadSprite(n,t);if(-1!=n.indexOf("https"))return e.load(n,"texture",t,a);n=STRING.contains(n,".png")?n:n+".png",e.load(n,"texture",t,a)}},e.loadSprite=function(n,t){e.load(n,"sprite",t)},e.loadModel=function(n,t){e.load(n,"model",t)},e.loadMaterial=function(n,t){e.findAsset(n+"_Material")&&(n+="_Material"),e.load(n,"material",t)},e.loadUserPhoto=function(n,t){return!n||n.length<2?e.loadTexture("User",t):e.find(n+".png","texture")||-1!=n.indexOf("http")?e.loadTexture(n,t):e.find(n,"sprite")?e.loadSprite(n,t):void e.load(n,"texture",t)},e.loadSpine=function(n,t,a){var i,s=n+".atlas",o=n+".json",r=n+".png";e.preload([s,o,r],(function createSpine(){for(var n in s=e.find(s,"text"),o=e.find(o,"json"),r=[e.find(r,"texture")],t.addComponent("spine",{atlasAsset:s.id,textureAssets:r.map((function(e){return e.id})),skeletonAsset:o.id}),(i=t.spine.spine)._materials){var d=i._materials[n];d.diffuse.set(0,0,0),d.update()}ENTITY.setLayers(i,["Spine"]),a&&a(i)}))},e.loadScriptAsyncAsset=function(e,n){ASSETS.loadScriptAsync(APP.assets.find(e).getFileUrl(),n)},e.loadScriptAsync=function(e,n){var t=document.createElement("script");t.onload=function(){n&&n()},t.onerror=function(){throw new Error("failed to load "+e)},t.async=!0,t.src=e,document.head.appendChild(t)},e.loadLib=function(e,n,t,a,i){if(function wasmSupported(){try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){}return!1}()){const a=APP.assets.find(n),s=APP.assets.find(t);if(!a||!s)return void console.warn(`Warning! ${n} or ${t} was not found`);loadWasmModuleAsync(e,a.getFileUrl(),s.getFileUrl(),i)}else{const n=APP.assets.find(a);if(!n)return void console.warn(`Warning! ${a} was not found`);loadWasmModuleAsync(e,n.getFileUrl(),"",i)}}};function clamp(t,n,r){return MATH.clamp(t,n,r)}var MATH=new function(){var t=this,n=new pc.Vec2,r=new pc.Vec2,e=new pc.Vec3,o=new pc.Vec3,a=new pc.Mat4;t.hipotenusa=function(t,n){var r=n||{x:0,y:0},e=r.x-t.x,o=r.y-t.y;return Math.sqrt(e*e+o*o)},t.hipotenusaZ=function(t,n){var r=n.x-t.x,e=n.z-t.z;return Math.sqrt(r*r+e*e)},t.distanceNoSquare=function(t,n){var r=n.x-t.x,e=n.y-t.y;return r*r+e*e},t.distanceXY=function(t,n){return new pc.Vec2(n.x-t.x,n.y-t.y)},t.cycle=function(t,n,r,e){for(var o=e||1,a=r||0,c=n||100,i=t+o;i>c;)i-=c+o;for(;i<a;)i+=c+o;return i},t.getSinCos=function(t,n){var r=n.x-t.x,e=n.y-t.y,o=Math.sqrt(r*r+e*e),a=r/o,c=e/o;return new pc.Vec2(a,c)},t.getSinCosZ=function(t,n){var r=n.x-t.x,e=n.z-t.z,o=Math.sqrt(r*r+e*e);return{sin:e/o,cos:r/o}},t.getRotY=function(t){var n=t.getPosition(),r=e.copy(n).add(t.forward);return 180*Math.atan2(r.x-n.x,r.z-n.z)/Math.PI+180},t.aroundRadius=function(t,n){return{x:t*Math.cos(n),y:t*Math.sin(n)}},t.lerp=function(n,r,e){return n+(r-n)*t.hardLimit(e,0,1)};var c=[1e3,500,100,50,10,5];t.round=function(t){for(var n in c)if(t>c[n])return roundFactor(t,c[n]);return t;function roundFactor(t,n){return Math.round(t/n)*n}},t.ceil=function(t,n){return t>n?n:t},t.getPercent=function(n,r){return t.hardLimit(100*n/r,0,100)},t.hardLimit=function(n,r,e){return t.clamp(n,e,r)},t.clamp=function(t,n,r){var e=r||0;return t<e?e:n&&t>n?n:t},t.floor=function(t,n){return t<n?n:t},t.commas=function(t){return"number"==typeof t?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g," "):t},t.isNumber=function(t){return"number"==typeof t},t.forceNumber=function(n){if(!n)return 0;var r=parseInt(n);return t.isNumber(r)?r:0},t.tryParseInt=function(t){var n=parseInt(t);return isNaN(n)?t:n},t.parseInt=function(t){if(-1==(t=t.toString()).indexOf("E+"))return parseInt(t);var n=t.split("E+"),r=n[0].split("."),e=parseInt(n[1]);r[1]&&(r[0]+=r[1]);for(var o=r[0],a=0;a<e;a++)o+="0";return parseInt(o)},t.middlePoint=function(t,n){return{x:t.x+(n.x-t.x)/2,y:t.y+(n.y-t.y)/2}},t.getRotation=function(n,r){var e=n||{x:0,y:0},o=r||{x:0,y:0};return t.radiansToDegree(Math.atan2(o.y-e.y,o.x-e.x))+90},t.distance=function(t,n){return n-t},t.degreeToRadians=function(t){return.0174533*(t||0)},t.radiansToDegree=function(t){return t/.0174533},t.pointToIso=function(t,n){var r=n||{};return r.x=.5*(t.x-t.y),r.y=.289*(t.x+t.y),r},t.isoToPoint=function(t,n){var r=n||{};return r.x=(t.y/.289+t.x/.5)/2,r.y=(t.y/.289-t.x/.5)/2,r},t.getclosestPoint=function(t,n,r,e,o,a){var c=e-n,i=t-r,u=c*c+i*i;if(0!==u){var s=c*t+i*n,h=-i*o+c*a;return[(c*s-i*h)/u,(c*h+i*s)/u]}},t.higherValue=function(t,n){return t>n?t:n},t.lowerValue=function(t,n){return t<n?t:n},t.tsunami=function(t,n,r){var e=r||500,o=n.x-t.x,a=n.y-t.y,c=Math.sqrt(o*o+a*a);if(0==c)return!1;if(c>e)return!1;var i=o/c,u=a/c;return o=n.x,a=n.y,c<e/2?{x:o+=i*c/2,y:a+=u*c/2}:{x:o+=i*(e-c)/2,y:a+=u*(e-c)/2}},t.isBetween=function(t,n,r){return!(t<n||t>r)},t.isBetweenAB=function(t,n,r,e){return!(n<r||t>e)},t.isBetweenAABB=function(t,n,r,e,o,a,c,i){return!(n<r||t>e||a<c||o>i)},t.getClosest=function(n,r){var e=r||{x:0,y:0},o=null,a=9999999999999;for(var c in n){var i=n[c],u=t.hipotenusa(i,e);u>a||(a=u,o=i)}return o},t.roundDecimal=function(t,n){var r=n||10;return Math.round(t*r)/r},t.getSign=function(t){return t<0?-1:1},t.double=function(t,n){for(;--n>=1;)t*=2;return t},t.getMiddlePoint=function(t){var n,r,e,o;for(var a in t){var c=t[a];(!n||c.x<n)&&(n=c.x),(!r||c.x>r)&&(r=c.x),(!o||c.y<o)&&(o=c.y),(!e||c.y>e)&&(e=c.y)}return new pc.Vec2(n+(r-n)/2,o+(e-o)/2)},t.normalizePoints=function(n){var r=t.getMiddlePoint(n);for(var e in n){var o=n[e];o.x-=r.x,o.y-=r.y}return n},t.alignColumns=function(t,n,r){let e=[],o=0,a=0,c=getOffX(t>r?r:t);for(let i=0;i<t;i++){e.push(new pc.Vec3(o*n.x+c,a*n.y,0));let u=t-i-1;u>0&&++o>=r&&(o=0,a--,u<r&&(c=getOffX(u)))}let i=Math.abs(a)/2*n.y;for(let t in e)e[t].y+=i;function getOffX(t){return-(t-1)/2*n.x}return e},t.getFromToRotation=function(t,n){let r=(new pc.Vec3).cross(t,n);const e=this.angle(t,n);if(e>=179.9196){const n=(new pc.Vec3).cross(t,pc.Vec3.RIGHT);r=(new pc.Vec3).cross(n,t),r.lengthSq<1e-6&&(r=pc.Vec3.UP)}return(new pc.Quat).setFromAxisAngle(r.normalize(),e)},t.normalizeAndShiftPoints=function(t,e,o){void 0===o&&(o=1);const a=n,c=r;let i=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY;for(let n=0,r=t.length;n<r;++n){const r=t[n];r.x=r.x/e,r.y=r.y/e,r.x<i&&(i=r.x),r.y<u&&(u=r.y),r.x>s&&(s=r.x),r.y>h&&(h=r.y)}const f=i+(s-i)/2,p=u+(h-u)/2;a.set(f,p);for(let n=0,r=t.length;n<r;++n){const r=t[n];c.set(0,0,0).sub(a).normalize();const e=a.distance(pc.Vec2.ZERO),i=c.mulScalar(e);r.add(i).mulScalar(o)}return t},t.angle=function(t,n){const r=Math.sqrt(t.length()*n.length());if(r<1e-15)return 0;const e=pc.math.clamp(t.dot(n)/r,-1,1);return Math.acos(e)*pc.math.RAD_TO_DEG},t.signedAngle=function(n,r,e){const o=t.angle(n,r),a=n.y*r.z-n.z*r.y,c=n.z*r.x-n.x*r.z,i=n.x*r.y-n.y*r.x;return o*Math.sign(e.x*a+e.y*c+e.z*i)},t.gain=function(t,n){const r=.5*Math.pow(2*(t<.5?t:1-t),n);return t<.5?r:1-r},t.lookAt=function(t,n,r=pc.Vec3.UP){return t&&n?(a.setLookAt(t,n,r),(new pc.Quat).setFromMat4(a)):new pc.Quat},t.randomSpherePoint=function(t){var n=Math.random(),r=Math.random(),e=2*Math.PI*n,o=Math.acos(2*r-1),a=t*Math.sin(o)*Math.cos(e),c=t*Math.sin(o)*Math.sin(e),i=t*Math.cos(o);return new pc.Vec3(a,c,i)},t.barycenter=function(t,n,r,e){const o=new pc.Vec3,a=new pc.Vec3,c=new pc.Vec3,i=r.clone().sub(n),u=e.clone().sub(n),s=o.cross(i,u).lengthSq(),h=a.cross(e.clone().sub(r),t.clone().sub(r)).lengthSq(),f=c.cross(u,t.clone().sub(e)).lengthSq(),p=Math.sqrt(h/s),l=Math.sqrt(f/s),y=1-p-l;return new pc.Vec3(p,l,y)},t.randomRotation=function(t=new pc.Quat){const n=Math.random(),r=Math.random(),e=Math.random(),o=Math.sqrt(1-n),a=Math.sqrt(n);return t.set(a*Math.cos(2*Math.PI*e),o*Math.sin(2*Math.PI*r),o*Math.cos(2*Math.PI*r),a*Math.sin(2*Math.PI*e))},pc.Vec3.prototype.addScalars=function(t,n=0,r=0){return this.x+=t,this.y+=n,this.z+=r,this},pc.Vec3.prototype.addScaled=function(t,n){return this.x+=t.x*n,this.y+=t.y*n,this.z+=t.z*n,this},pc.Vec3.prototype.tangents=function(t,n){const r=this.length();if(r>0){const a=1/r;e.set(this.x*a,this.y*a,this.z*a),Math.abs(e.x)<.9?o.set(1,0,0):o.set(0,1,0),t.cross(e,o),n.cross(e,t)}else t.set(1,0,0),n.set(0,1,0)},pc.Mat3.prototype.transformVector=function(t){const n=this.data,r=t.x,e=t.y,o=t.z;return t.x=r*n[0]+e*n[3]+o*n[6],t.y=r*n[1]+e*n[4]+o*n[7],t.z=r*n[2]+e*n[5]+o*n[8],t},pc.Mat3.prototype.mul=function(t){const n=this.data,r=t.data,e=n[0],o=n[1],a=n[2],c=n[3],i=n[4],u=n[5],s=n[6],h=n[7],f=n[8],p=r[0],l=r[1],y=r[2],d=r[3],x=r[4],M=r[5],m=r[6],g=r[7],v=r[8];return n[0]=p*e+l*c+y*s,n[1]=p*o+l*i+y*h,n[2]=p*a+l*u+y*f,n[3]=d*e+x*c+M*s,n[4]=d*o+x*i+M*h,n[5]=d*a+x*u+M*f,n[6]=m*e+g*c+v*s,n[7]=m*o+g*i+v*h,n[8]=m*a+g*u+v*f,this},pc.Mat3.prototype.fromQuat=function(t){const n=t.x,r=t.y,e=t.z,o=t.w,a=n+n,c=r+r,i=e+e,u=n*a,s=n*c,h=n*i,f=r*c,p=r*i,l=e*i,y=o*a,d=o*c,x=o*i,M=this.data;return M[0]=1-(f+l),M[1]=s-x,M[2]=h+d,M[3]=s+x,M[4]=1-(u+l),M[5]=p-y,M[6]=h-d,M[7]=p+y,M[8]=1-(u+f),this},pc.Mat3.prototype.invert=function(){const t=this.data,n=t[0],r=t[1],e=t[2],o=t[3],a=t[4],c=t[5],i=t[6],u=t[7],s=t[8],h=s*a-c*u,f=-s*o+c*i,p=u*o-a*i;let l=n*h+r*f+e*p;return l?(l=1/l,t[0]=h*l,t[1]=(-s*r+e*u)*l,t[2]=(c*r-e*a)*l,t[3]=f*l,t[4]=(s*n-e*i)*l,t[5]=(-c*n+e*o)*l,t[6]=p*l,t[7]=(-u*n+r*i)*l,t[8]=(a*n-r*o)*l,this):this},pc.Mat3.prototype.transposeTo=function(t=new pc.Mat3){const n=t.data,r=this.data;for(var e=0;3!==e;e++)for(var o=0;3!==o;o++)n[3*e+o]=r[3*o+e];return t},pc.Mat3.prototype.scale=function(t){const n=this.data;for(let r=0;3!==r;r++)n[3*r+0]*=t.x,n[3*r+1]*=t.y,n[3*r+2]*=t.z;return this},pc.Mat3.prototype.mul=function(t,n=new pc.Mat3){const r=t.data,e=this.data,o=n.data;for(let t=0;t<3;t++)for(let n=0;n<3;n++){let a=0;for(let o=0;o<3;o++)a+=r[t+3*o]*e[o+3*n];o[t+3*n]=a}return n},pc.Quat.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},pc.Quat.prototype.mulScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},pc.Quat.prototype.integrate=function(t,n,r){const e=t.x*r.x,o=t.y*r.y,a=t.z*r.z,c=this.x,i=this.y,u=this.z,s=this.w,h=.5*n;return this.x+=h*(e*s+o*u-a*i),this.y+=h*(o*s+a*c-e*u),this.z+=h*(a*s+e*i-o*c),this.w+=h*(-e*c-o*i-a*u),this},pc.Quat.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},pc.Mat4.prototype.lerp=function(t,n,r){const e=this.data,o=t.data,a=n.data;for(let t=0;t<16;t++)e[t]=pc.math.lerp(o[t],a[t],r);return this},t.isLookingAt=function(t,n,r,e=!1){let o=t.forward.clone(),a=n.getPosition().clone().sub(t.getPosition()).normalize();e&&(o.y=a.y=0);var c=o.dot(a);return Math.acos(c)*pc.math.RAD_TO_DEG>=(r||174)},t.springPositionsZ=function(t=10,n=20,r=3){for(var e=[];e.length<t;){var o=new pc.Vec3(spectrum(n),0,spectrum(n));for(let t in e){let n=SPRING.maxZ(o,e[t],r,1);!n||0==n.x&&0==n.z||(collided=!0)}e.push(o)}return e},t.getNextAngle=function(t){let n=(t=Math.round(t))<0?360+t:t;return n>=0&&n<90?90:n>=90&&n<180?180:n>=180&&n<270?270:n>=270&&n<360?360:void 0},t.simulatePhysicsBody=function(t){const n=[],r=t.vel||new pc.Vec3,a=t.fixedDt||1/60,c=t.gravity||PHYSICS_CONFIG.gravity,i=t.start||new pc.Vec3;for(let u=0;u<(t.frames||100)&&(o.copy(c).mulScalar(a*a),e.copy(r).mulScalar(a).add(o),i.add(e),t.usableVectors&&t.usableVectors[u]?n.push(t.usableVectors[u]):n.push(new pc.Vec3),n[u].copy(i),e.copy(c).mulScalar(a),r.add(e),!(t.minHeight&&i.y<=t.minHeight));u++);return n},t.getCircularPoints=function(t,n,r=[]){let e=[];for(let o=0;o<t;o++){let a=2*Math.PI/t*o,c=r[o]?r[o]:new pc.Vec3;c.set(n*Math.sin(a),n*Math.cos(a),0),e.push(c)}return e.push(e[0]),e}};var JOINTS=new function(){const i=this,t=new pc.Vec3,n=new pc.Vec3,e=new pc.Quat,o=new pc.Mat4;new pc.Vec3,new pc.Vec3,new pc.Vec3,new pc.Vec3;class HingeConstraintConfig{constructor(){this.entityA=null,this.entityB=null,this.limits=new pc.Vec2(1,-1),this.axisA=new pc.Vec3(0,0,1),this.axisB=new pc.Vec3(0,0,1),this.pivotA=new pc.Vec3,this.pivotB=new pc.Vec3,this.softness=.9,this.biasFactor=.3,this.relaxationFactor=1,this.breakingThreshold=34e37,this.motorTargetVelocity=0,this.maxMotorImpulse=0,this.enableCollision=!1,this.enableMotor=!1}}class SixDOFSpringConstraintConfig{constructor(){this.entityA=null,this.entityB=null,this.axisA=new pc.Vec3(0,1,0),this.axisB=new pc.Vec3(0,1,0),this.pivotA=new pc.Vec3,this.pivotB=new pc.Vec3,this.breakForce=34e37,this.enableCollision=!1,this.linearMotionX=pc.MOTION_LOCKED,this.linearLimitsX=new pc.Vec2(1,-1),this.linearSpringX=!1,this.linearStiffnessX=0,this.linearDampingX=1,this.linearEquilibriumX=0,this.linearMotionY=pc.MOTION_LOCKED,this.linearLimitsY=new pc.Vec2(1,-1),this.linearSpringY=!1,this.linearStiffnessY=0,this.linearDampingY=1,this.linearEquilibriumY=0,this.linearMotionZ=pc.MOTION_LOCKED,this.linearLimitsZ=new pc.Vec2(1,-1),this.linearSpringZ=!1,this.linearStiffnessZ=0,this.linearDampingZ=1,this.linearEquilibriumZ=0,this.angularMotionX=pc.MOTION_LOCKED,this.angularLimitsX=new pc.Vec2(1,-1),this.angularSpringX=!1,this.angularStiffnessX=0,this.angularDampingX=1,this.angularEquilibriumX=0,this.angularMotionY=pc.MOTION_LOCKED,this.angularLimitsY=new pc.Vec2(1,-1),this.angularSpringY=!1,this.angularStiffnessY=0,this.angularDampingY=1,this.angularEquilibriumY=0,this.angularMotionZ=pc.MOTION_LOCKED,this.angularLimitsZ=new pc.Vec2(1,-1),this.angularSpringZ=!1,this.angularEquilibriumZ=0,this.angularDampingZ=1,this.angularStiffnessZ=0}}const getOrthogonalVectors=function(i,t,n){var e,o;Math.abs(i.z)>.7071067811865476?(e=i.y*i.y+i.z*i.z,o=1/Math.sqrt(e),t.x=0,t.y=-i.z*o,t.z=i.y*o,n.x=e*o,n.y=-i.x*t.z,n.z=i.x*t.y):(e=i.x*i.x+i.y*i.y,o=1/Math.sqrt(e),t.x=-i.y*o,t.y=i.x*o,t.z=0,n.x=-i.z*t.y,n.y=i.z*t.x,n.z=e*o)};i.getHingeConstraintConfig=function(){return new HingeConstraintConfig},i.get6DOFSpringConstraintConfig=function(){return new SixDOFSpringConstraintConfig},i.createHingeConstraint=function(i){const s=i.limits,r=i.entityA,a=i.entityB,l=i.axisA,m=i.axisB,c=i.pivotA,g=i.pivotB,p=r.rigidbody.body,u=new Ammo.btVector3(c.x,c.y,c.z);let h;getOrthogonalVectors(l,t,n),o.set([t.x,t.y,t.z,0,n.x,n.y,n.z,0,l.x,l.y,l.z,0,0,0,0,1]),e.setFromMat4(o);const y=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),M=new Ammo.btTransform(y,u);if(a&&a.rigidbody){const i=a.rigidbody.body,s=new Ammo.btVector3(g.x,g.y,g.z);getOrthogonalVectors(m,t,n),o.set([t.x,t.y,t.z,0,n.x,n.y,n.z,0,m.x,m.y,m.z,0,0,0,0,1]),e.setFromMat4(o);const r=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),l=new Ammo.btTransform(r,s);h=new Ammo.btHingeConstraint(p,i,M,l,!1),Ammo.destroy(l),Ammo.destroy(r),Ammo.destroy(s)}else h=new Ammo.btHingeConstraint(p,M,!1);let b=1,d=-1;s.x<s.y&&(b=s.x*Math.PI/180,d=s.y*Math.PI/180),h.setLimit(b,d,i.softness,i.biasFactor,i.relaxationFactor),h.setBreakingImpulseThreshold(i.breakingThreshold),h.enableAngularMotor(i.enableMotor,i.motorTargetVelocity*Math.PI/180,i.maxMotorImpulse);return APP.systems.rigidbody.dynamicsWorld.addConstraint(h,!i.enableCollision),Ammo.destroy(M),Ammo.destroy(y),Ammo.destroy(u),p.activate(),h},i.create6DOFSpringConstraint=function(i){const convertTransform=function(i,t){const n=i.getTranslation(),e=new pc.Quat;e.setFromMat4(i);const o=new Ammo.btVector3(n.x,n.y,n.z),s=new Ammo.btQuaternion(e.x,e.y,e.z,e.w);t.setOrigin(o),t.setRotation(s),Ammo.destroy(o),Ammo.destroy(s)},t=(i.axisA,i.axisB,i.pivotA,i.pivotB,i.entityA),n=i.entityB;if(t&&t.rigidbody){const e=t.rigidbody.body;e.activate();const s=t.getWorldTransform(),r=t.getWorldTransform().clone().invert();o.mul2(r,s);const a=new Ammo.btTransform;let l;if(convertTransform(o,a),n&&n.rigidbody){const t=n.rigidbody.body;t.activate();const r=n.getWorldTransform().clone().invert();o.mul2(r,s);const m=new Ammo.btTransform;convertTransform(o,m),l=new Ammo.btGeneric6DofSpringConstraint(e,t,a,m,!i.enableCollision),Ammo.destroy(m)}else l=new Ammo.btGeneric6DofSpringConstraint(e,a,!i.enableCollision);const m=["X","Y","Z","X","Y","Z"];for(let t=0;t<6;t++){const n=t<3?"linear":"angular";l.enableSpring(t,i[n+"Spring"+m[t]]),l.setDamping(t,i[n+"Damping"+m[t]]),l.setEquilibriumPoint(t,i[n+"Equilibrium"+m[t]]),l.setStiffness(t,i[n+"Stiffness"+m[t]])}l.setBreakingImpulseThreshold(i.breakForce),function(t){if(t){let n,e,o,s,r,a;i.linearMotionX===pc.MOTION_LIMITED?(n=i.linearLimitsX.x,s=i.linearLimitsX.y):i.linearMotionX===pc.MOTION_FREE?(n=1,s=0):n=s=0,i.linearMotionY===pc.MOTION_LIMITED?(e=i.linearLimitsY.x,r=i.linearLimitsY.y):i.linearMotionY===pc.MOTION_FREE?(e=1,r=0):e=r=0,i.linearMotionZ===pc.MOTION_LIMITED?(o=i.linearLimitsZ.x,a=i.linearLimitsZ.y):i.linearMotionZ===pc.MOTION_FREE?(o=1,a=0):o=a=0;const l=new Ammo.btVector3(n,e,o);t.setLinearLowerLimit(l),l.setValue(s,r,a),t.setLinearUpperLimit(l),Ammo.destroy(l)}}(l),function(t){if(t){let n,e,o,s,r,a;i.angularMotionX===pc.MOTION_LIMITED?(n=i.angularLimitsX.x*pc.math.DEG_TO_RAD,s=i.angularLimitsX.y*pc.math.DEG_TO_RAD):i.angularMotionX===pc.MOTION_FREE?(n=1,s=0):n=s=0,i.angularMotionY===pc.MOTION_LIMITED?(e=i.angularLimitsY.x*pc.math.DEG_TO_RAD,r=i.angularLimitsY.y*pc.math.DEG_TO_RAD):i._angularMotionY===pc.MOTION_FREE?(e=1,r=0):e=r=0,i.angularMotionZ===pc.MOTION_LIMITED?(o=i.angularLimitsZ.x*pc.math.DEG_TO_RAD,a=i.angularLimitsZ.y*pc.math.DEG_TO_RAD):i._angularMotionZ===pc.MOTION_FREE?(o=1,a=0):o=a=0;const l=new Ammo.btVector3(n,e,o);t.setAngularLowerLimit(l),l.setValue(s,r,a),t.setAngularUpperLimit(l),Ammo.destroy(l)}}(l);return APP.systems.rigidbody.dynamicsWorld.addConstraint(l,!i.enableCollision),Ammo.destroy(a),l}},i.destroyConstraint=function(i){APP.systems.rigidbody.dynamicsWorld.removeConstraint(i),Ammo.destroy(i)}};function random(n,r,t){return RANDOM.value(n,r,t)}function decimal(n,r){return RANDOM.decimal(n,r)}function chance(n){return RANDOM.chance(n)}function spectrum(n,r){return RANDOM.spectrum(n,r)}function spectrumDecimal(n,r){return RANDOM.spectrumDecimal(n,r)}var RANDOM=new function(){var n=this;n.value=function(r,t,c){var e=t||0,u=Math.round(Math.random()*(r-e))+e;return u!=c?u:n.value(r,t,c)},n.decimal=function(n=999,r=0){return Math.random()*(n-r)+r},n.int=function(n=999,r=0){return n=Math.ceil(n),r=Math.floor(r),Math.floor(Math.random()*(r-n+1))+n},n.chance=function(n){return 0!==n&&Math.random()<=(n||.5)},n.spectrum=function(r,t){var c=n.value(r,t);return n.chance(.5)?c:-c},n.spectrumDecimal=function(r,t){var c=n.decimal(r,t);return n.chance(.5)?c:-c},n.boolean=function(){return!!n.chance()},n.direction=function(){return n.chance()?1:-1},n.fortune=function(r){for(var t=0;t<r;t++)if(n.chance(1/(2*r)*(r-t)))return t;return 0}};function EntityPool(e,i,t){var n=this,r=[],l=n.pool=[];if(e.enabled=!1,!i&&e.script)for(var a in e.script)if(e.script[a]){i=e.script[a];break}n.get=function(a){var f=r.shift()||e.clone();if(f.enabled=!0,addChild(f,t),a&&ENTITY.applyVars(f,a),i&&f.script){var s=f.script[i];if(s){if(a){s.fill||s.spawn||s.initialize();var o=s.fill||s.spawn;o&&o(a)}f=s}}return l.push(f),n.length=l.length,n[n.length-1]=f,f},n.remove=function(e,i){e.disable&&e.disable(),ARRAY.removeItem(l,e);var t=e.entity||e;if(t.enabled=!1,ARRAY.pushUnique(r,t),i)for(var a in n.length=l.length,l)n[a]=l[a]},n.reset=function(){for(;l.length;)n.remove(l.shift(),!0);for(var e=0;e<n.length;e++)delete n[e];n.length=0}}var TEXT=new function(){var n=this,a=n.data={},e=n.locale="en";on("TOY:onFinalize",(function init(){if(n.setLanguage(),!CONFIG.TEXT)return;a=CONFIG.TEXT,extract(a,n)})),n.setLanguage=function(a){a=a||window.navigator.userLanguage||window.navigator.language||APP.i18n.locale||"en",e=n.locale=a.split("-")[0].split("_")[0]},n.get=function(a){var t=n[a];return t&&(t[e]||t.en)||a}};var COLOR=new function(){var E=this,e=[],a={},u=E.PALETTES={};function push(E,e,a,u,f){if(a&&push(E+"_DARK",a,null,null,f),u&&push(E+"_LIGHT",u,null,null,f),Array.isArray(e))for(var t in e){var L=e[t];0!=t?doPush(E+"_"+t,L,f):doPush(E,L,f)}else doPush(E,e,f)}function doPush(u,f,t){f=f.toUpperCase();var L=(new pc.Color).fromString(f);L.id=u.toUpperCase(),L.hex=f;var r=f.replace(/#/,"").match(/.{1,2}/g);if(L.r16=parseInt(r[0],16),L.g16=parseInt(r[1],16),L.b16=parseInt(r[2],16),E[L.id])for(var A in e)if(e[A].id==L.id){removeItem(e,e[A]);break}E[L.id]=a[L.hex]=pushUnique(e,L),t&&addPalette(t,u)}function addPalette(E,e){if(Array.isArray(e))for(var a in e)addPalette(E,e[a]);else u[E]||(u[E]=[]),pushUnique(u[E],e)}E.push=push,E.get=function(a){if(a)return"RANDOM"==(a=a.toUpperCase())?getRandomItem(e):E[a]||E.fromString(a)},E.getHex=function(e){var a=E.get(e);if(a)return a.hex},E.fromString=function(E){return a[E]||(a[E]=(new pc.Color).fromString(E)),a[E]},E.getRandom=function(){return getRandomItem(e)},E.interpolate=function(E,e,a){for(var u,f={},t=["r16","g16","b16"],L="#",r=0;r<t.length;r++){var A=t[r];f[A]=Math.round(E[A]+(e[A]-E[A])*a/100),(u=f[A].toString(16)).length<2&&(u="0"+u),L+=u}return L},E.addPalette=addPalette,push("WHITE",["#eff1f5"]),push("BLACK",["#000000"]),push("BROWN",["#66310E"],["#49200a"],["#fbb684","#fed9b4"],"PALETTE"),push("PINK",["#ea269b"],["#3f002f","#6b004a"],["#ea269b"]),push("PURPLE",["#7f42ba","#a367f9"],["#240038","#3c0456"],["#c09afc","#d5c0ff"],"PALETTE"),push("OCEAN",["#4c43a3","#6d60ea"],["#211d47","#211d47"],["#9090fc","#c0c0fc"],"PALETTE"),push("BLUE",["#1a7bd9","#1e90ff"],["#0a3259","#0a3259"],["#00c2f3","#99e7fa"],"PALETTE"),push("CYAN",["#00a4a8","#00a4a8"],["#124b6a","#05808e"],["#00cec9","#81ecec"],"PALETTE"),push("TURQUOISE",["#14a37a"],["#14a37a"],["#0aeaa4","#88ffd7"],"PALETTE"),push("FOREST",["#2bbc66","#32ed7d"],["#1c703e","#259e56"],["#61ffa1","#99ffb8"],"PALETTE"),push("GREEN",["#68c044"],["#167c29","#2cb34f"],["#a5ce39","#d5e26d"],"PALETTE"),push("CANDY",["#FF4757","EE4042"],["#7F232B"],null,"PALETTE"),push("ORANGE",["#FF7F50"],["#8E4514"],["#FF7F50"],"PALETTE"),push("SKIN",["#f6938a","#f4b09f"],["#f87675"],["#fbdfd9"],"PALETTE"),push("RED",["#ee2162"],["#8c153b","#c81e55"],null,"PALETTE"),push("GRAY",["#415e70"],["#002539","#003343"],["#90abbe","#dae2ea"],"PALETTE"),push("YELLOW",["#fad11f"],["#ffa502"],null,"PALETTE"),push("SKIN_PINK","#EC9C7B"),push("SKIN_YELLOW","#F1E4B0"),push("SKIN_ORANGE","#ff7f50"),push("SKIN_TAN","#BF8061"),push("SKIN_BLACK","#8e4514"),push("SKIN_WHITE","#9F7477"),push("SKIN_BLUE","#84A7ED"),push("SKIN_GREEN","#36AC25"),push("SKIN_PURPLE","#D47DF1"),push("EYES_BROWN","#9b5b33"),push("EYES_PINK","#e12da0"),push("EYES_GREEN","#0ea44b"),push("EYES_BLUE","#0891ca"),push("EYES_PURPLE","#8148c2"),push("EYES_DARKBROWN","#5c2c0d"),push("EYES_LIGHTBLUE","#a3b9c9"),addPalette("SKIN",["SKIN_PINK","SKIN_YELLOW","SKIN_TAN","SKIN_BLACK","SKIN_ORANGE","SKIN_BLUE","SKIN_GREEN","SKIN_PURPLE"]),addPalette("HAIR",["BLACK","BROWN_DARK","YELLOW","RED","BLUE_1","ORANGE","PURPLE_1","GREEN","GRAY_LIGHT_1"]),addPalette("EYES",["EYES_BROWN","EYES_GREEN","EYES_BLUE","EYES_LIGHTBLUE","EYES_PURPLE","EYES_PINK","RED","YELLOW"]),addPalette("SELECTED",["GRAY_DARK_1","GRAY","GRAY_LIGHT","GRAY_LIGHT_1","BLUE_1","BLUE_LIGHT","GREEN_DARK","ORANGE_DARK","RED_DARK","RED","CANDY_1","ORANGE","YELLOW_DARK","OCEAN_DARK_1","PURPLE","OCEAN_LIGHT"])};var Pickup=pc.createScript("pickup");Pickup.attributes.add("pickupID",{title:"Pickup ID",type:"string"}),Pickup.attributes.add("isDynamic",{title:"Is Dynamic",type:"boolean",default:!0}),Pickup.prototype.postInitialize=function(){var t=this;t.entity;PICKUP.call(t),t.onSpawn=function(){}};var PickupsConfig=pc.createScript("pickupsConfig");PickupsConfig.attributes.add("list",{type:"json",schema:[{title:"Id",name:"id",type:"string"},{title:"Title",name:"title",type:"string"},{title:"Spell",name:"spell",type:"string",array:!0},{title:"Symbol",name:"symbol",type:"string"},{title:"Value",name:"value",type:"string"},{title:"Text",name:"text",type:"string"},{title:"Amount",name:"amount",type:"number",default:1},{title:"Duration",name:"duration",type:"number",default:0},{title:"Respawn Time",name:"respawnTime",type:"number",default:0},{title:"Gravity",name:"gravity",type:"number",default:0},{title:"Speed",name:"speed",type:"vec3",default:[.05,.3,.05]},{title:"Sound FX",name:"soundFX",type:"string",default:"Pickup"},{title:"Is Collectible",name:"isCollectible",type:"boolean",default:!0},{title:"Player Only",name:"isPlayerOnly",type:"boolean",default:!1},{type:"string",name:"hitTest",title:"Hit Test Method",enum:[{Collider:"Collider"},{Radius:"Radius"},{Square:"Square"}],default:"Collider"},{title:"Radius",name:"radius",type:"number",default:0}],array:!0}),PickupsConfig.prototype.initialize=function(){var e={},t=0;for(var i in this.list){var l=this.list[i];l.id=l.id&&l.id.length>1?l.id:"Pickup"+t++,l.title=l.title||l.id,l.symbol=l.symbol||l.id,e[l.id]=l}CONFIG.add("MAGIC.PICKUPS",e)};var PHYSICS,PHYSICS_CONFIG,PhysicsConfig=pc.createScript("physicsConfig");PhysicsConfig.attributes.add("Physics",{title:"Physics",type:"string",enum:[{Ammo:"Ammo"},{"Ammo Light":"AmmoLight"},{"Ammo Debug":"AmmoDebug"},{"Ammo 3 (experimental)":"Ammo3"},{Rapier:"Rapier"},{"Rapier Debug":"RapierDebug"},{Disabled:"Disabled"}],default:"Disabled"}),PhysicsConfig.attributes.add("gravity",{title:"Gravity",type:"vec3",default:[0,-9.81,0]}),PhysicsConfig.attributes.add("fixedTimeStep",{title:"Ammo Fixed Time Step",type:"number",default:120}),PhysicsConfig.attributes.add("maxSubSteps",{title:"Ammo Max Substeps",type:"number",default:10}),PhysicsConfig.attributes.add("enableBallistics",{title:"Enable Ballistics",type:"boolean",default:!1}),PhysicsConfig.attributes.add("enableOrestis",{title:"Enable Orestis",type:"boolean",default:!1}),PhysicsConfig.attributes.add("enableCCD",{title:"Enable CCD",type:"boolean",default:!1}),PhysicsConfig.prototype.initialize=function(){const e=this;PHYSICS_CONFIG=e;const a=e.Physics;let i=!1,o=!1,t=!1;function onPhysicsLoaded(){i=!0,function loadOrestis(){if(!e.enableOrestis)return onOrestisLoaded();function onOrestisLoaded(){t=!0,onPhysicsReady()}ASSETS.loadScript("orestis-pathfinding",(function(){ASSETS.loadLib("Recast","recast.wasm.js","recast.wasm.wasm","recast.js",onOrestisLoaded)}))}()}function onPhysicsReady(){o&&i&&t&&(log("==PHYSICS:onInit"),fire("PHYSICS:onInit"))}function loadAmmo(a){let o="ammo3.js",t="ammo.wasm.wasm",s="ammo.wasm.js";switch(a){case"light":o="ammo.light.js",t="ammo.light.wasm.wasm",s="ammo.light.wasm.js";break;case"debug":o="ammo.debug.js",t="ammo.debug.wasm.wasm",s="ammo.debug.wasm.js";break;case"three":o="ammo3.js",t="ammo3.wasm.wasm",s="ammo3.wasm.js";break;default:o="ammo.js",t="ammo.wasm.wasm",s="ammo.wasm.js"}ASSETS.loadLib("Ammo",s,t,o,(function onAmmoLoaded(){const a=APP.systems,o=a.collision.store,t=a.rigidbody.store,s={};for(const[e,a]of Object.entries(t)){const i=a.entity.rigidbody,o={enabled:i.enabled,mass:i.mass,linearDamping:i.linearDamping,angularDamping:i.angularDamping,linearFactor:[i.linearFactor.x,i.linearFactor.y,i.linearFactor.z],angularFactor:[i.angularFactor.x,i.angularFactor.y,i.angularFactor.z],friction:i.friction,rollingFriction:i.rollingFriction,restitution:i.restitution,type:i.type,group:i.group,mask:i.mask};s[e]={data:o,entity:a.entity},a.entity.removeComponent("rigidbody")}const n=new pc.RigidBodyComponentSystem(APP);a.remove(a.rigidbody),a.add(n),n.gravity.copy(e.gravity),n.fixedTimeStep=1/e.fixedTimeStep,n.maxSubSteps=e.maxSubSteps,n.onLibraryLoaded(),i=!0;for(const[e,a]of Object.entries(s))a.entity.addComponent("rigidbody",a.data);for(const[e,a]of Object.entries(o)){const e=a.entity.collision;e.system.recreatePhysicalShapes(e)}if(e.enableCCD)return ASSETS.loadScript("ccd",onPhysicsLoaded);onPhysicsLoaded()}))}function loadRapier(i){let o=!1,t=!1;function _onRapier(){ASSETS.loadScript("rb-component",(()=>{o=!0,_onComponent()})),ASSETS.loadScript("col-component",(()=>{t=!0,_onComponent()}))}function _onComponent(){o&&t&&function onRapierLoaded(){(PHYSICS=window.gamebop.physics).gravity=e.gravity,log(PHYSICS),"RapierDebug"===a&&console.log(`Gamebop Physics ${PHYSICS.version}`);onPhysicsLoaded()}()}const s=e.app.assets.find(i?"physics.debug.js":"physics.js");window.__RAPIER_VERSION__=i?"rapier3d.debug.wasm":"rapier3d.wasm",ASSETS.loadScriptAsync(s.getFileUrl(),(async function done(){window.gamebop.physics=new window.gamebop.PhysicsLib("update",false),await window.gamebop.physics.initialize(e.app,_onRapier)}))}function onBallisticsLoaded(){o=!0,onPhysicsReady()}switch(e.enableBallistics?ASSETS.loadScript("ballistics.min",onBallisticsLoaded):onBallisticsLoaded(),a){case"Ammo":loadAmmo();break;case"Ammo3":loadAmmo("three");break;case"AmmoLight":loadAmmo("light");break;case"AmmoDebug":loadAmmo("debug");break;case"Rapier":loadRapier();break;case"RapierDebug":loadRapier(!0);break;default:onPhysicsLoaded()}};var SpellsIDS=0;function SpellInstance(e,n){var a=MAGIC.SPELLS[e];if(a){var o,t,u=this,i=n.vars;extract(a,u),u.kill&&(u.duration=-1),u.start=function(){if(apply(),u.interval&&(t=TIMER.spawn({duration:u.interval,onTimeUp:onInterval,autoStart:!0})),a.showInActiveFX&&fire("ACTIVEFX:Set",a),on("GAME:onPause",pause),on("GAME:onResume",resume),!(u.duration<0)){var n=e+ ++SpellsIDS;o=TIMER.spawn({id:n,duration:1e3*u.duration,onTimeUp:onTimeUp,autoStart:!0})}},u.stop=function(){t&&t.stop(),o&&o.stop(),a.showInActiveFX&&fire("ACTIVEFX:Remove",a),"Weapon"==a.type&&n.Weapon.remove(a.value||a.id),off("GAME:onPause",pause),off("GAME:onResume",resume)}}function onInterval(){apply(),t.restart()}function onTimeUp(){n.Spells.uncast(e)}function pause(){t&&t.pause(),o&&o.pause()}function resume(){t&&t.resume(),o&&o.resume()}function apply(){i.invulnerable&&u.isBlockable||"Weapon"==a.type&&n.Weapon.set(a.value||a.id)}}function fill(e,i,l,t){CONTENT.fill(e,i,l,t)}function fillText(e,i,l){CONTENT.fillText(e,i,l)}function fillModel(e,i){CONTENT.fillModel(e,i)}function fillTemplate(e,i,l){CONTENT.fillTemplate(e,i,l)}function fillMaterial(e,i,l){CONTENT.fillMaterial(e,i,l)}function fillTexture(e,i){CONTENT.fillTexture(e,i)}function fillPricetag(e,i){CONTENT.fillPricetag(e,i)}function fit(e,i,l,t){CONTENT.fit(e,i,l,t)}function alignText(e){CONTENT.alignText(e)}var CONTENT=new function(){var e=this;e.fill=function(i,l,t,n){if(i&&l){var o=i.entity||i;if(o.name){for(var r in i.data=l,l.color&&setColor(o.findByTag("color"),l.color),l)if(!MATH.isNumber(r)){var a=l[r];"function"!=typeof a&&"object"!=typeof a&&(fillFields(r,"Field",a)||fillFields(r,"Texture",a)||fillFields(r,"SpriteShadow",a)||fillFields(r,"Sprite",a)||fillFields(r,"Animation",a)||fillFields(r,"Shadow",a)||fillFields(r,"Model",a)||fillFields(r,"Material",a)||fillFields(r,"Template",a))}e.alignText(o.findByTag("alignText"))}}function fillFields(e,i,l){var t=e+i,n=o.findByName(t);n&&fillField(n,i,l);var r=o.findByTag(t);for(var a in r)fillField(r[a],i,l)}function fillField(i,o,r){if(i)return"Field"==o||"Shadow"==o?e.fillText(i,r,t):"Model"==o?e.fillModel(i,r):"Template"==o?e.fillTemplate(i,r):"Material"==o?e.fillMaterial(i,r):"Animation"==o?e.fillAnimation(i,r):"Sprite"==o||"Texture"==o||"SpriteShadow"==o?(l.fitRect&&(i._fitRect=l.fitRect),e.fillTexture(i,r,n)):void 0}},e.fillText=function(e,i,l){if(e.element){var t="number"!=typeof i||l?TEXT.get(i):STRING.commarize(i);e.element.text=t,-1!=e.tags._list.indexOf("canvasFont")&&CANVASFONT.apply(e,t)}},e.fillModel=function(e,i,l){(e.model||e.render)&&(e.enabled=!1,e.render?e.render.asset=null:e.model.asset=null,e._pendingModel=i,ASSETS.loadModel(i,(function(t){e._pendingModel==i&&(e.enabled=!0,e.render&&(e.render.asset=t),e.model&&(e.model.asset=t),fire("CONTENT:onLoaded_"+i),fire("CONTENT:on"+i),l&&l())})))},e.fillTemplate=function(e,i,l){var t=getChildren(e);for(var n in t)t[n].destroy();return e._pendingTemplate=i,ASSETS.loadTemplate(i,null,(function(t){if(e._pendingTemplate==i)return addChild(t,e),t.setLocalEulerAngles(0,0,0),t.setLocalPosition(0,0,0),t.setLocalScale(1,1,1),fire("CONTENT:on"+i),l?l(t):void 0}))},e.fillMaterial=function(e,i,l){if(i&&(e.model||e.render)){if(e.model&&e.model.meshInstances)return doLoad();if(e.render&&e.render.meshInstances)return doLoad();e.enabled=!1,MOTOR.start((function waitForModel(){if(!e.model||e.model&&!e.model.meshInstances)return;MOTOR.stop(waitForModel),doLoad()}))}function doLoad(){if(Array.isArray(i))for(var e=0;e<i.length;e++)loadMaterial(e,i[e]);else loadMaterial(0,i)}function loadMaterial(i,t){if(t){var n=e.render?e.render.meshInstances[i]:e.model?e.model.meshInstances[i]:null;n&&(e["_pendingMaterial"+i]=t,ASSETS.loadMaterial(t,(function onMaterial(o){if(e.enabled=!0,e["_pendingMaterial"+i]!=t)return;fire("CONTENT:on"+t),n.material=o.resource,l&&l()})))}}},e.fillAnimation=function(e,i){e.script.animationController&&(e.script.animationController.stop(),e.script.animationController.play(i)),fire("CONTENT:on"+i)},e.fillTexture=function(i,l,t){if(i&&i.element)return i._pendingTexture=l,i.enabled=!1,i.name.includes("userPhoto")?ASSETS.loadUserPhoto(l,onTexture):(i.element.sprite=null,ASSETS.loadTexture(l,onTexture));function onTexture(t){i._pendingTexture==l&&(i.enabled=!0,fire("CONTENT:on"+l),function applyAndFit(l){if(!l||!i||!i.element)return;if(!i._fitRect){var t=i.getLocalPosition();i._fitRect={x:t.x,y:t.y,z:t.z,width:i.element.width,height:i.element.height}}var n;l.resource&&l.resource.atlas?(n=l.resource.atlas.frames[l.resource.frameKeys[0]].rect,i.element.sprite=l.resource):l.resources&&l._resources[0]?(n={z:l._resources[0]._width,w:l._resources[0]._height},i.element.textureAsset=l):(n={z:l._width,w:l._height},i.element.texture=l);e.fit(i,i._fitRect,!1,n)}(t))}},e.fillPricetag=function(i,l){e.fill(i,l);var t,n=i.findByName("priceField"),o=i.findByName("symbolSprite");t=n.getLocalPosition(),n.setLocalPosition(.5*-n.element.width,t.y,t.z),t=o.getLocalPosition(),o.setLocalPosition(.5*o.element.width,t.y,t.z)},e.fit=function(e,i,l,t){if(e.element&&i&&!e.tags._list.includes("dontResize")){t&&(e.element.width=t.z,e.element.height=t.w);var n=e.element.width>e.element.height?i.width/e.element.width:i.height/e.element.height;e.setLocalScale(n,n,n),e.setLocalPosition(i.x,i.y,i.z)}},e.alignText=function(i){if(Array.isArray(i))for(var l in i)e.alignText(i[l]);else{var t=getTextfield(i);t&&(i.pos||getLocals(i),doAlign(),delay(doAlign,.1))}function doAlign(){i.setLocalPosition(i.pos.x-(t.getLocalPosition().x+t.element.width)*i.getLocalScale().x/2,i.pos.y,i.pos.z)}}};var WeaponsConfig=pc.createScript("weaponsConfig");WeaponsConfig.attributes.add("list",{type:"json",schema:[{type:"string",name:"type",title:"Type",enum:[{Universal:"Universal"},{Projectile:"Projectile"},{Launcher:"Launcher"},{Drop:"Drop"},{Melee:"Melee"},{Aura:"Aura"},{Custom:"Custom"}],default:"Universal"},{title:"Id",name:"id",type:"string"},{title:"Title",name:"title",type:"string"},{title:"Symbol",name:"symbol",type:"string"},{title:"Text",name:"text",type:"string"},{title:"Capacity",name:"capacity",type:"number",default:1},{title:"Bullet",name:"bullet",type:"string"},{title:"Bullets per shot",name:"bulletsPerShot",type:"number",default:1},{type:"string",name:"spread",title:"Spread",enum:[{Straight:"Straight"},{Spread:"Spread"},{Drunk:"Drunk"}],default:"Straight"},{title:"Fire Rate",name:"fireRate",type:"number",default:0},{title:"Shots per Fire",name:"shotsPerFire",type:"number",default:0},{title:"Auto Fire",name:"autoFire",type:"boolean",default:!1},{title:"Reload Time",name:"reloadTime",type:"number",default:0},{title:"Charge Time",name:"chargeTime",type:"number",default:0},{title:"Range (Distance)",name:"range",type:"number",default:0},{title:"Reload Sound FX",name:"reloadSoundFX",type:"string"},{title:"Self Reload",name:"selfReload",type:"boolean",default:!0}],array:!0}),WeaponsConfig.prototype.initialize=function(){var e={},t=0;for(var a in this.list){var i=this.list[a];i.id=i.id&&i.id.length>1?i.id:i.type+t++,i.title=i.title||i.id,i.symbol=i.symbol||i.id,e[i.id]=i}CONFIG.add("MAGIC.WEAPONS",e)};var SpellsConfig=pc.createScript("spellsConfig");SpellsConfig.attributes.add("list",{type:"json",schema:[{type:"string",name:"type",title:"Type",enum:[{Custom:"Custom"},{Currency:"Currency"},{Coin:"Coin"},{Shield:"Shield"},{Invulnerable:"Invulnerable"},{Heal:"Heal"},{Hurt:"Hurt"},{ExtraSpeed:"ExtraSpeed"},{LowerSpeed:"LowerSpeed"},{ExtraLife:"ExtraLife"},{ExtraTime:"ExtraTime"},{ExtraDamage:"ExtraDamage"},{LowerDamage:"LowerDamage"},{Freeze:"Freeze"},{Stun:"Stun"},{Poison:"Poison"},{Bomb:"Bomb"},{Fire:"Fire"},{Territory:"Territory"},{Kill:"Kill"},{Mute:"Mute"},{Weapon:"Weapon"}],default:"Custom"},{title:"Id",name:"id",type:"string"},{title:"Title",name:"title",type:"string"},{title:"Symbol",name:"symbol",type:"string"},{title:"Color",name:"color",type:"string"},{title:"Particle FX",name:"particleFX",type:"string"},{title:"Cast Spells",name:"spells",type:"string"},{title:"Value",name:"value",type:"string"},{title:"Amount",name:"amount",type:"number",default:1},{title:"Duration",name:"duration",type:"number",default:0},{title:"Interval",name:"interval",type:"number",default:0},{title:"Stack Max",name:"stackMax",type:"number",default:1},{title:"Cast Sound",name:"castSound",type:"string"},{title:"Activation Sound",name:"activationtSound",type:"string"},{title:"Collect Text",name:"collectText",type:"string"},{title:"Activation Text",name:"activationText",type:"string"},{title:"Damage Multiplier",name:"damageMultiplier",type:"number",default:1},{title:"Speed Multiplier",name:"speedMultiplier",type:"number",default:1},{title:"Health Increment",name:"healthIncrement",type:"number"},{title:"Shield Increment",name:"shieldIncrement",type:"number"},{title:"Speed Increment",name:"speedIncrement",type:"number"},{title:"Damage Increment",name:"damageIncrement",type:"number"},{title:"Coin Increment",name:"coinIncrement",type:"number"},{title:"CapacityIncrement",name:"capacityIncrement",type:"number"},{title:"Invulnerable",name:"invulnerable",type:"boolean"},{title:"Kill",name:"kill",type:"boolean"},{title:"Is Blockable",name:"isBlockable",type:"boolean"},{title:"Consumable",name:"isConsumable",type:"boolean",default:!1},{title:"Show In ActiveFX",name:"showInActiveFX",type:"boolean",default:!1}],array:!0}),SpellsConfig.prototype.initialize=function(){var e,t={},i={};for(e in i.Kill={kill:!0},i.Invulnerable={invulnerable:!0},i.Coin={coinIncrement:1,isConsumable:!0},i.LowerSpeed={speedMultiplier:.5},i.ExtraSpeed={speedMultiplier:1.25},i.Stun={speedMultiplier:.25},i.Poison={speedMultiplier:.8},i.Freeze={speedMultiplier:.1},i.Bomb={kill:!0},i)prefillItem({type:e});for(e in this.list)prefillItem(this.list[e]);function prefillItem(e){e.type||(e.type="Custom");var l=i[e.type];if(l)for(var n in l)(null==e[n]||null==e[n]||0==e[n]||l[n])&&(e[n]=l[n]);e.id=e.id&&e.id.length>1?e.id:e.type,e.title=e.title||e.id,e.icon=e.icon||e.id,e.symbol=e.symbol||e.id,e.particleFX=STRING.getArray(e.particleFX),e.particleFX[0]||(e.particleFX[0]=e.id),t[e.id]=e}CONFIG.add("MAGIC.SPELLS",t)};var MOTION=new function(){var T=this,t=.05,n=t,N=t,O=0,_=0,i=0,C=0,e=0;T.BOUNCE_Y=0,T.BOUNCESLOW_Y=0,T.FLOAT_Y=0,T.FLOATFAST_Y=0,T.ROT_Y=0,T.ROT_Z=0,T.SIN_A=0,T.SIN_B=0,T.SIN_C=0,T.INC_A=0,T.INC_B=0,T.TickAngle=0,T.Dots=0,T.COUNT10=0,T.COUNT30=0,T.dotsText="";T.init=function(){},T.pause=function(){!1},T.resume=function(){!0},T.onFixed=function(){if(n+=-.005*DT,T.BOUNCE_Y+=n*DT,T.BOUNCE_Y<0&&(T.BOUNCE_Y=0,n=t),N+=-.0025*DT,T.BOUNCESLOW_Y+=N*DT,T.BOUNCESLOW_Y<0&&(T.BOUNCESLOW_Y=0,N=t),C+=.04*DT,T.FLOAT_Y=.1*Math.sin(C)*DT,e+=.1*DT,T.FLOATFAST_Y=.1*Math.sin(e)*DT,T.ROT_Y+=3*DT,T.ROT_Z+=.2*DT,O+=.2*DT,T.SIN_A=Math.sin(O),_+=.05*DT,T.SIN_B=Math.sin(_),i+=.1*DT,T.SIN_C=Math.sin(i),T.INC_A+=.04*DT,T.INC_B+=.07*DT,T.INC_A>1&&(T.INC_A-=1*DT),T.INC_B>1&&(T.INC_B-=1*DT),T.COUNT10+=dtFixed,T.COUNT10>10&&(T.COUNT10=0),T.change30=!1,T.COUNT30+=dtFixed,T.COUNT30>30){T.COUNT30=0,T.change30=!0,T.dotsText="",++T.Dots>3&&(T.Dots=0);for(var D=0;D<T.Dots;D++)T.dotsText+="."}},T.onInterval=function(){T.TickAngle-=90,T.TickAngle<0&&(T.TickAngle=270)},T.getFloatY=function(T){return.1*Math.sin(C+T)},T.getFloatFastY=function(T){return.1*Math.sin(e+T)}};var SOULS=new function(){var n=[],i=this,r=0;i.push=function(i){return pushUnique(n,i),r++},i.enable=function(){for(var i in log("SOULS ENAB:E"),n)n[i].disable()},i.disable=function(){for(var i in log("SOULS DISABLE"),n)n[i].disable()},i.reset=function(){for(var i in log("SOULS RESET"),n)n[i].reset()},i.destroy=function(){n=[]},i.cast=function(i,r){for(var o in n){var e=n[o];e!=r&&e.Spells.cast(i)}}};var BulletsConfig=pc.createScript("bulletsConfig");BulletsConfig.attributes.add("list",{type:"json",schema:[{title:"Id",name:"id",type:"string"},{title:"Template",name:"template",type:"string"},{title:"Title",name:"title",type:"string"},{title:"Symbol",name:"symbol",type:"string"},{title:"Spell",name:"spell",type:"string"},{title:"Value",name:"value",type:"string"},{title:"Duration",name:"duration",type:"number",default:60},{title:"Spawn Sound",name:"spawnSound",type:"string"},{type:"string",name:"type",title:"Type",enum:[{Projectile:"Projectile"},{Grenade:"Grenade"},{Drop:"Drop"},{Melee:"Melee"},{Aura:"Aura"},{InstaHitAll:"InstaHitAll"},{Raycast:"Raycast"}],default:"Projectile"},{type:"string",name:"collision",title:"Collision",enum:[{Collider:"Collider"},{Radius:"Radius"},{Square:"Square"}],default:"Collider"},{title:"Radius",name:"radius",type:"number",default:0},{title:"Team Damage",name:"teamDamage",type:"boolean",default:!0},{title:"DestroyOnContact",name:"destroyOnContact",type:"boolean",default:!0}],array:!0}),BulletsConfig.prototype.initialize=function(){var e={},t=0;for(var i in this.list){var l=this.list[i];l.id=l.id&&l.id.length>1?l.id:l.type+t++,l.title=l.title||l.id,l.symbol=l.symbol||l.id,e[l.id]=l}CONFIG.add("MAGIC.BULLETS",e)};var PICKUPS=new function(){var n={},e=[],r=this,t=[];r.IDS=0,r.spawn=function(n,e,r,t){if(!t)return doSpawn();for(var i=[],o=0;o<t;o++)i.push(doSpawn());return i;function doSpawn(){return TEMPLATES.spawn(n,e,r)}},r.push=function(i){return i.isDynamic?pushUnique(t,i):(pushUnique(function getPool(e){return n[e]=n[e]||[],n[e]}(i.pickupID),i),pushUnique(e,i)),r.IDS++},r.disable=function(){for(var n in e)e[n].disable()},r.reset=function(){for(var n in e)e[n].reset()},r.remove=function(n){n.disable(),removeItem(t,n),n.entity.destroy()},r.destroy=function(){for(;t.length;)r.remove(t[0]);t=[]}};var SoulsConfig=pc.createScript("soulsConfig");SoulsConfig.attributes.add("list",{type:"json",schema:[{type:"string",name:"type",title:"Type",enum:[{Generic:"Generic"},{Player:"Player"},{NPC:"NPC"},{Object:"Object"},{Custom:"Custom"}],default:"Generic"},{title:"Id",name:"id",type:"string"},{title:"Title",name:"title",type:"string"},{title:"Health",name:"health",type:"number",default:1},{type:"string",name:"hitTest",title:"Hit Test Method",enum:[{Collider:"Collider"},{Radius:"Radius"},{Square:"Square"}],default:"Collider"},{title:"Radius",name:"radius",type:"number",default:0},{title:"Inventory Capacity",name:"inventoryCapacity",type:"number",default:1},{title:"Walk Speed",name:"walkSpeed",type:"number",default:7},{title:"Run Speed",name:"runSpeed",type:"number",default:10},{title:"Jump Force",name:"jumpForce",type:"number",default:11},{title:"Double Jump Force",name:"doubleJumpForce",type:"number",default:4},{title:"Roll Duration",name:"rollDuration",type:"number",default:1},{title:"Roll Speed",name:"rollSpeed",type:"number",default:4},{title:"Floor Slide Speed",name:"floorSlideSpeed",type:"number",default:4},{title:"Floor Slide Duration",name:"floorSlideDuration",type:"number",default:1},{title:"Walk Slide Speed",name:"wallSlideSpeed",type:"number",default:7}],array:!0}),SoulsConfig.prototype.initialize=function(){var e={},t=0;for(var l in this.list){var i=this.list[l];i.id=i.id&&i.id.length>1?i.id:i.type+t++,i.title=i.title||i.id,e[i.id]=i}CONFIG.add("MAGIC.SOULS",e)};class MeshCurveLine extends pc.Entity{constructor(e={}){if(super("Mesh Line"),e&&e.points&&e.points.length<2)return void console.warn("You should provide at least 2 points to generate a Mesh Curve Line.");const t=this,s=t._app,a=new pc.Vec3,n=new pc.Vec3,r=new pc.Vec3,c=new pc.Vec3,o=new pc.Vec3,i=new pc.Vec3,d=new pc.Vec3,h=new pc.Vec3,p=new pc.Vec3,u=new pc.Vec3,l=new Float32Array(3*(e.maxPoints?e.maxPoints:500)*2);let f,m,w,y,v,S,g,L,M=0,b=pc.Vec3.UP;!function setDefaults(e){void 0!==e.width?f=e.width:void 0!==e.startWidth&&void 0!==e.endWidth?(f=0,m=e.startWidth,w=e.endWidth):f=.1;g=e.buffer||transformToBuffer(e.points)||void 0,e.material?y=e.material:(y=new pc.StandardMaterial,y.name="Mesh Line Material",y.cull=pc.CULLFACE_NONE,y.update());const t=e.render,setDefault=(e,s)=>t?void 0===t[e]?s:t[e]:s;v={layers:setDefault("layers",[pc.LAYERID_WORLD]),castShadows:setDefault("castShadows",!1),castShadowsLightmap:setDefault("castShadowsLightmap",!0),isStatic:setDefault("isStatic",!1),receiveShadows:setDefault("receiveShadows",!0)},e.batchGroup||(S=s.batcher.getGroupByName("__MeshLine")||s.batcher.addGroup("__MeshLine",!0,100,pc.guid.create(),v.layers));e.normalFace&&(b=e.normalFace)}(e||{}),updateNormals(),updateMesh();const x=new pc.MeshInstance(L,y);function updateNormals(){if(!g)return;const e=g.length;r.set(g[0],g[1],g[2]),a.set(g[e-3],g[e-2],g[e-1]).sub(r),a.y=r.y,a.normalize(),n.cross(a,b)}function updateMesh(){L||(L=new pc.Mesh(s.graphicsDevice));const e=function getIndices(){const e=[];if(!g)return e;const t=M;for(let s=0;s<t-1;++s){const t=2*s;e.push(t+0,t+3,t+2,t+0,t+1,t+3)}return e}(),t=function calculateNormals(e,t){const s=t.length/3,a=e.length/3,n=r,l=c,f=o,m=i,w=d,y=h,v=p,S=u,g=[];for(let t=0,s=e.length;t<s;t++)g[t]=0;if(0===s)return g;for(let a=0;a<s;a++){const s=t[3*a],r=t[3*a+1],c=t[3*a+2];n.set(e[3*s],e[3*s+1],e[3*s+2]),l.set(e[3*r],e[3*r+1],e[3*r+2]),f.set(e[3*c],e[3*c+1],e[3*c+2]),m.sub2(l,n),w.sub2(f,n),y.cross(m,w).normalize(),a>2?(S.lerp(y,v,.5),g[3*s]+=S.x,g[3*s+1]+=S.y,g[3*s+2]+=S.z,g[3*r]+=S.x,g[3*r+1]+=S.y,g[3*r+2]+=S.z,g[3*c]+=S.x,g[3*c+1]+=S.y,g[3*c+2]+=S.z):(g[3*s]+=y.x,g[3*s+1]+=y.y,g[3*s+2]+=y.z,g[3*r]+=y.x,g[3*r+1]+=y.y,g[3*r+2]+=y.z,g[3*c]+=y.x,g[3*c+1]+=y.y,g[3*c+2]+=y.z),v.add(y).normalize()}for(let e=0;e<a;e++){const t=g[3*e],s=g[3*e+1],a=g[3*e+2],n=1/Math.sqrt(t*t+s*s+a*a);g[3*e]*=n,g[3*e+1]*=n,g[3*e+2]*=n}return g}(l,e);L.clear(!0,!0),L.setPositions(l),L.setNormals(t),L.setIndices(e),L.update(pc.PRIMITIVE_TRIANGLES)}function transformToBuffer(e){if(!e)return;const t=[];for(let s=0,a=e.length;s<a;++s)t.push(e[s].x,e[s].y,e[s].z);return t}s.systems.render.addComponent(t,{type:"asset",meshInstances:[x],castShadows:v.castShadows,castShadowsLightmap:v.castShadowsLightmap,isStatic:v.isStatic,receiveShadows:v.receiveShadows}),s.batcher.markGroupDirty(S.id),t.update=e=>{void 0!==e.width?f=e.width:void 0!==e.startWidth&&void 0!==e.endWidth&&(f=0,m=e.startWidth,w=e.endWidth),e.buffer?g=e.buffer:e.points&&(g=transformToBuffer(e.points)),updateNormals(),function updatePositions(){const e=g.length/3;let t,s,a;M=0,void 0!==f&&0!==f?t=f/2:(s=m/2,a=w/2);let i,d,h,p=0;for(let u=0,f=l.length;u<f;u+=6){let f;u/6>=e?(h=g[3*p-1],d=g[3*p-2],i=g[3*p-3]):(i=g[3*p],d=g[3*p+1],h=g[3*p+2],p++,M+=2),f=void 0!==t?t:pc.math.lerp(s,a,.5*M/e);const m=r.copy(n).scale(-f),w=c.copy(n).scale(f),y=o.set(i,d,h);y.add(m),l[u]=y.x,l[u+1]=y.y,l[u+2]=y.z,y.sub(m).add(w),l[u+3]=y.x,l[u+4]=y.y,l[u+5]=y.z}}(),updateMesh(),t.render.batchGroupId>-1&&pc.app.batcher.markGroupDirty(v.batchGroupId),e.material&&(v.meshInstances[0].material=e.material)}}}pc.MeshCurveLine=MeshCurveLine;var Surface=pc.createScript("surface");Surface.attributes.add("id",{title:"ID",type:"string"}),Surface.prototype.initialize=function(){var e=this,t=e.entity,i=e.collider=new Collider(e),r=e.id||t.name;i.setLabel(r)};var CHEATS=new function(){on("TOY:onFinalize",(function init(){if(!CONFIG.CHEATS)return;n=CONFIG.CHEATS,extract(n,e)}));var e=this,n={};function checkSequence(n,r){var c=copy(r.sequence).reverse();n=copy(n).reverse();for(var t=0;t<c.length;t++)if(c[t]!=n[t])return!1;return e.enabled[r.id]=r,POPUPS.show("DIALOG",extract({duration:3},r)),!0}e.enabled={},e.check=function(e){for(var r in n)if(checkSequence(e,n[r]))return},e.reset=function(){e.enabled={}}};function SoulInventoryItem(l){var e=this;e.data=l,e.isCollectible=l.isCollectible,e.spells=l.spell,e.spell=Array.isArray(l.spell)?getRandomItem(l.spell):l.spell}function BULLET(){var e=this,n=e.entity;n.bullet=e,BULLETS.push(e);var t=e.data={},o=new pc.Vec3,a=n.findByName("Container");e.teamID="None";var i,l="Bullet"+BULLETS.push(e);function onCollisionStart(e,n){}function remove(){BULLETS.remove(e)}function onUpdate(){a&&(a.enabled=UISIZE.frustum(n.getPosition())),e.onUpdate()}e.isEnabled=!1,e.spawn=function(a){(a=a||{}).entity&&(n=a.entity),n.setPosition(9999,9999,9999),o=a.x||a.y||a.z?new pc.Vec3(a.x||0,a.y||0,a.z||0):n.getPosition(),e.soul=a.soul,e.teamID=e.soul.teamID,t=e.data=MAGIC.BULLETS[a.id||n.name],extract(t,e),(i=e.collider=new Collider(e,onCollisionStart)).setLabel("Bullet"),delay((()=>{n.setPosition(o),n.rb&&n.rb.teleport(o),e.onSpawn(a),e.duration&&unique(l,remove,e.duration),"Drop"==e.type&&ANIMATION.bounceScaleTo(n.findByName("Content")),e.isEnabled=!0,startFixed(onUpdate)}),0)},e.onSpawn=function(e){},e.disable=function(){cancel(l),i.disable(),n.enabled=!1,e.isEnabled=!1;var t=n.findByName("Content");t&&(t.enabled=!1)},e.collide=function(n){e.removeOnContact&&remove()},e.onUpdate=function(){}}var BULLETS=new function(){var t=[],n=this,e=0;function onUpdate(){Container&&(Container.enabled=UISIZE.frustum(entity.getPosition())),n.onUpdate()}n.spawn=function(t){let n=MAGIC.BULLETS[t.id];if(n&&(t.entity=TEMPLATES.spawn(n.template||n.id,t,SCENES.Game||APP.root),t.entity))return t.entity=t.entity.entity,t.entity.bullet.spawn(t),t.entity.bullet},n.push=function(n){return pushUnique(t,n),e++},n.destroy=function(){for(;t.length;)n.remove(t[0]);t=[]},n.remove=function(n){n.disable(),TEMPLATES.remove(n.entity),removeItem(t,n),stop(onUpdate)},n.onUpdate=function(){}};var Soul=pc.createScript("soul");Soul.attributes.add("soulID",{type:"string",title:"Soul ID",default:"Generic"}),Soul.prototype.postInitialize=function(){var e=this,t=e.entity,l=e.vars={spells:{}};e.instanceID="Soul"+SOULS.push(e);e.isME=!1;var n=e.data=MAGIC.SOULS[e.soulID]||{},a=e.ParticleFX=new Soul_ParticleFX(e),r=e.Spells=new Soul_Spells(e),i=(e.Weapon=new Soul_Weapon(e),e.Inventory=new Soul_Inventory(e)),o=e.Skin=new Soul_Skin(e),s=e.Locomotion=new Soul_Locomotion(e),u=e.Animation=new Soul_Animation(e),S=e.Collider=t.collider=new Collider(e,(function onCollisionStart(t,n){if(!t||!l.isEnabled)return;if("Soul"==t)return e.fire("SOUL:onCollision",t,n);if("Pickup"==t)return i.collect(n);if("Bullet"==t)return o.hit(n);r.cast(t)}),(function onCollisionEnd(e,t){if(log("SOUL end",e),!e)return}));S.setLabel("Soul"),e.reset=function(){l.health=n.health||100,l.maxHealth=l.health,l.isEnabled=!1,l.walkSpeed=n.walkSpeed||0,l.runSpeed=n.runSpeed||0,l.jumpForce=n.jumpForce||0,l.rollSpeed=n.rollSpeed||0,l.shield=_shield=n.shield||1,l.extraSpeed=0,l.spells={},l.speedIncrement=0,l.speedMultiplier=1,l.damageMultiplier=1,i.reset(),r.reset(),o.reset(),s.reset(),u.reset()},e.setAvatar=function(t){Avatar=e.Avatar=t,extract(Avatar.vars,l),e.vars=l,e.isME=Avatar.avatarID==ME.avatarID,e.teamID=l.teamID=Avatar.avatarID,e.refresh()},e.enable=function(){l.isEnabled=!0,S.enable(),u.enable()},e.disable=function(){l.isEnabled=!1,S.disable(),r.reset(),a.stop(),u.disable()},e.refresh=function(){},e.reset()};var BulletInstance=pc.createScript("bulletInstance");BulletInstance.attributes.add("bulletID",{title:"Bullet ID",type:"string"}),BulletInstance.attributes.add("autoSpawn",{title:"Auto Spawn",type:"boolean",default:!1}),BulletInstance.prototype.initialize=function(){var t=this,e=t.entity;BULLET.call(t),t.onSpawn=function(t){},t.autoSpawn&&t.spawn({id:t.bulletID||e.name}),t.onUpdate=function(t){}},BulletInstance.prototype.update=function(t){this.onUpdate(t)};function Soul_ParticleFX(t){var i=this,r=t.entity,e=i.ParticleFX=i.Emitter={play:function(){},start:function(){},stop:function(){}},n=r.findByName("ParticleFX"),a=[];n&&(n.enabled=!0,n.script||n.addComponent("script"),n.script.particleFx||n.script.create("particleFx"),e=i.ParticleFX=n.script.particleFx,delay((function(){Emitter=i.Emitter=e.Emitter}),.1)),i.play=function(t){e.play(t)},i.stop=function(t){e.stop(t),i.Emitter.stop()},i.refresh=function(){var i,r,n={};for(i in t.vars.spells){var c=MAGIC.SPELLS[i];if(c)for(var p in c.particleFX)n[c.particleFX[p]]=!0}for(r in n)e.play(r);for(r in a)n[r]||e.stop(r);a=n}}var PickupSpawner=pc.createScript("pickupSpawner");PickupSpawner.attributes.add("id",{type:"string",title:"ID"}),PickupSpawner.attributes.add("pickupID",{type:"string",title:"Pickup ID",default:"PickupCoin"}),PickupSpawner.attributes.add("interval",{type:"number",title:"Interval",default:5}),PickupSpawner.attributes.add("amount",{type:"number",title:"Amount",default:1}),PickupSpawner.attributes.add("autoStart",{type:"boolean",title:"Auto Start"}),PickupSpawner.prototype.initialize=function(){var t=this,n=t.entity,i=t.id;function turnOn(){unique(i,doSpawn,random(1.2*t.interval,.8*t.interval))}function turnOff(){cancel(i)}function doSpawn(){PICKUPS.spawn(t.pickupID,{pos:n.getPosition()},SCENES.Game,t.amount),turnOn()}t.setID=function(t){i=t,on(i+":Start",turnOn),on(i+":Stop",turnOff)},t.id&&t.setID(t.id),t.autoStart&&turnOn()};var GAMEPAD,GamePad=pc.createScript("gamePad");GamePad.prototype.initialize=function(){var e,n=this,t=n.entity;n.isActive=!1;var o=new pc.Vec3,i=t.findByName("Left"),s=t.findByName("Right"),r=!0,a=t.findByName("Content");GAMEPAD=n,on("GAMEPAD:Reset",reset);var c={Up:pc.KEY_W,Down:pc.KEY_S,Left:pc.KEY_A,Right:pc.KEY_D},p={Up:pc.KEY_UP,Down:pc.KEY_DOWN,Left:pc.KEY_LEFT,Right:pc.KEY_RIGHT,Space:pc.KEY_SPACE},u={},f={};for(var P in c)u[c[P]]=P;for(var P in p)f[p[P]]=P;function reset(){for(var e in c)n[e]=!1;for(var e in p)n[e]=!1;n.isActive=!1}function update(){if(!TOUCH.isDown)return function onTouchUp(){stop(update),reset()}();getButtonsPressed()}function getButtonsPressed(){o.x=TOUCH.x-e.x,o.y=TOUCH.y-e.y;var t=90/1.3;MATH.hipotenusa(o)<t||(n.Up=o.y>t,n.Down=o.y<-t,n.Right=o.x>t,n.Left=o.x<-t)}function onPress(e){r&&e&&(n[e]=!0,n.isActive=!0)}function onUp(e){if(e){for(var t in n[e]=!1,c)if(n[t])return;n.isActive=!1}}n.onMousePress=a.onMousePress=i.onMousePress=s.onMousePress=function(o){var i=o.label;if("Area"==i)return e=t.getLocalPosition(),n.isActive=!0,startFixed(update),void getButtonsPressed();onPress(i)},n.onMouseRelease=a.onMouseRelease=i.onMouseRelease=s.onMouseRelease=function(e){var n=e.label;"Area"!=n&&onUp(n)},APP.keyboard.on(pc.EVENT_KEYDOWN,(function(e){e.key===pc.KEY_SPACE&&e.event.preventDefault(),onPress(u[e.key]||f[e.key])})),APP.keyboard.on(pc.EVENT_KEYUP,(function(e){onUp(u[e.key]||f[e.key])})),n.disable=function(){r=n.isActive=!1},n.enable=function(){r=!0},reset(),pc.platform.mobile||(a.enabled=!1)};function PICKUP(){var n=this,e=n.entity,i=n.data={},o=e.findByName("Container"),t=n.pos=e.getPosition().clone(),a="Pickup_"+PICKUPS.push(n);n.collider=new Collider(n,(function onCollisionStart(n,e){if("Wall"==n)return function hitWalls(){l.x*=-1.1,l.z*=-1.1}();if("Soul"==n||"Pickup"==n)return;bounce()}));var s=n.durationTimer=TIMER.spawn({id:"T"+a});n.collider.setLabel("Pickup"),n.isEnabled=!1,n.pickupID=n.pickupID||e.name;var c,l=n.speed=new pc.Vec3,p=t.y;function onTimeUp(){n.disable()}function cancelRespawn(){cancel(a)}function startBounce(){n.isEnabled=!1,c=0,l.y=i.speed.y,l.x=spectrumDecimal(i.speed.x),l.z=spectrumDecimal(i.speed.z),startFixed(onAir)}function onAir(){l.y-=.01,t.y+=l.y,t.x+=l.x,t.z+=l.z,e.setPosition(t),t.y>p||bounce()}function bounce(){if(n.isEnabled=!0,++c>3)return function land(){e.setPosition(t),n.isEnabled=!0,stop(onAir)}();l.y*=-.8,l.x*=.4,l.z*=.4}function onUpdate(){o&&(o.enabled=UISIZE.frustum(e.getPosition())),n.onUpdate()}n.spawn=function(o){(o=o||{}).id&&(n.pickupID=o.id),i=n.data=MAGIC.PICKUPS[n.pickupID],extract(i,o),fill(e,o),o.pos=o.pos||t,t.x=o.x||o.pos.x||0,t.y=o.y||o.pos.y||0,t.z=o.z||o.pos.z||0,p=t.y,o.spell&&(n.spell=o.spell),n.reset(),n.isEnabled=!0,i.gravity&&startBounce(),startFixed(onUpdate),n.onSpawn()},n.onSpawn=function(){},n.reset=function(){cancelRespawn(),e.setPosition(n.pos),e.enabled=!0,i||log("NO DATA FOR",n.pickupID,MAGIC.PICKUPS),n.collider.enable(),ANIMATION.bounceScaleTo(e),n.isEnabled=!0,i.gravity>0&&startBounce(),i.duration&&s.start({duration:i.duration,onTimeUp:onTimeUp}),n.onReset()},n.onReset=function(){},n.collect=function(){n.disable(),i.respawnTime&&unique(a,(function(){n.spawn()}),i.respawnTime),n.onCollect(),n.isDynamic&&n.remove()},n.remove=function(){PICKUPS.remove(n),stop(onUpdate)},n.onCollect=function(){},n.disable=function(){s.stop(),n.collider.disable(),cancelRespawn(),e.enabled=!1,stop(onAir)},n.onUpdate=function(){},n.isDynamic||n.spawn()}function Soul_Inventory(e){var n=this,l=e.data.inventoryCapacity,o=[];function consume(n){if(n=n||o[0])return removeItem(o,n),e.Spells.cast(n.spell),e.Weapon.shoot(n.spell),e.Weapon.add(n.spell),e.fire("INVENTORY:onConsume",n),n}n.reset=function reset(){o=[]},n.collect=function collect(n){var t=n.data;if(t&&n.isEnabled&&(!t.isPlayerOnly||e.isME)&&!(t.isCollectible&&o.length>=l)){var s=new SoulInventoryItem(t);t.isCollectible?(o.push(s),e.fire("INVENTORY:onAdd",s,t)):consume(s),n.collect()}},n.consume=consume}function Soul_Weapon(e){var t=this,n=e.entity,r=getChildrenNames(n.findByName("SpawnPoints"))||{},i=this.inventory=[],o=null,f={};t.set=function(n){MAGIC.WEAPONS[n]&&(t.add(n),o=t.current=f[n],e.fire("WEAPON:onSet",o))},t.add=function(t){if(!MAGIC.WEAPONS[t])return;if(f[t])return;let n=f[t]=new WeaponInstance(e,t);pushUnique(i,n)},t.remove=function(n){if(!f[n])return;let r=f[n];r.stop();let i=o==r;if(delete f[n],e.fire("WEAPON:onRemove",r),i)for(const e of Object.keys(f))return t.set(e)},t.fire=function(){if(o)return o.fire()},t.getSpawnPoint=function(e){!e&&o&&(e=o.data.bullet);var t=MAGIC.BULLETS[e];return t&&r[t.type]||n},t.refresh=function(){t.current&&t.current.refresh()},t.shoot=function shoot(n,r={}){if(Array.isArray(n))for(var i in n)shoot(n[i]);else{var o=MAGIC.BULLETS[n];if(o){if("InstaHitAll"==o.type)return SOULS.cast(o.spell,e);var f=t.getSpawnPoint().getPosition(),u={id:n,x:f.x,y:f.y,z:f.z};return extract(r,u),BULLETS.spawn(u)}}}}var SouldInventoryDisplayer=pc.createScript("souldInventoryDisplayer");SouldInventoryDisplayer.attributes.add("id",{title:"ID",type:"string"}),SouldInventoryDisplayer.prototype.initialize=function(){var i,l,e=this,n=e.entity,t=getChildScript(n,"SlotMachineSymbolsReel","slotMachineSymbolsReel");function show(i){l=i,t.entity.enabled=!0;var e=[];if(l.spells){var n,s=[];for(n in l.spells)pushUnique(s,l.spells[n]);for(n in s){var o=MAGIC[s[n]];o&&e.push({id:o.id,symbol:o.symbol,thumbnail:o.symbol})}return t.fill(e),void t.spin(MAGIC[l.spell]?MAGIC[l.spell].id:null)}e.push({id:i.id,symbol:i.symbol,thumbnail:i.symbol}),t.fill(e),t.spin()}function hide(i){i&&i!=l||(t.entity.enabled=!1)}e.setID=function(l){l&&(i=l,on(i+":Show",show),on(i+":Hide",hide))},e.setID(e.id)};function Soul_Skin(e){var t=this,a=e.vars;t.reset=function reset(){},t.hit=function hit(i){var n=i.data;(n.teamDamage||i.teamID!=e.teamID)&&(e.fire("SOUL:onHit",i),n&&!a.invulnerable&&e.Spells.cast(n.spell),i.collide(t))}}var GESTUREPAD,GesturePad=pc.createScript("gesturePad");GesturePad.attributes.add("isometric",{type:"boolean",default:!1}),GesturePad.prototype.initialize=function(){var e=this;e.entity;function update(){e.x=GESTURE.force.x,e.y=GESTURE.force.y}GESTUREPAD=e,e.onMousePress=function(){GESTURE.enable(),GESTURE.isVisible=!1,e.x=e.y=0,startFixed(update),fire("GESTUREPAD:onStart")},e.onMouseRelease=function(){stop(update);var t=GESTURE.getForce().clone(),o=new pc.Vec3(t.x,t.y);o.normalize();var r={force:t},i=.35;e.isometric&&(o=MATH.rotateVector(o,30)),o.y>i&&(r.Up=!0),o.y<-.35&&(r.Down=!0),o.x>i&&(r.Right=!0),o.x<-.35&&(r.Left=!0),GESTURE.disable(),fire("GESTUREPAD:onStop",r),fire("GESTUREPAD:onGesture",r)}};function Soul_Spells(e){var t=this,n=e.vars,a=e.ParticleFX,l=(e.entity,[]),r=t.stacks={};function uncast(e,t){!e||e&&!r[e]||r[e].uncast(t)}function uncastAll(){for(var e in r)r[e].reset();a.stop()}function refresh(){n.speedMultiplier=1,n.damageMultiplier=1,n.invulnerable=!1,n.speedIncrement=0,n.damageIncrement=0,n.capacityIncrement=0;let t=0,r=!1;for(var c in l){var i=l[c];i.invulnerable&&(n.invulnerable=!0),i.speedIncrement&&(n.speedIncrement+=i.speedIncrement),i.damageIncrement&&(n.damageIncrement+=i.damageIncrement),i.capacityIncrement&&(n.capacityIncrement+=i.capacityIncrement),i.speedMultiplier&&(n.speedMultiplier*=i.speedMultiplier),i.damageMultiplier&&(n.damageMultiplier*=i.damageMultiplier),i.healthIncrement&&(t+=i.healthIncrement),i.kill&&(r=!0)}r&&(t=-9999),t<0&&n.invulnerable&&(t=0);let s=MATH.clamp(n.health+t,n.maxHealth,0);s<=0&&n.health>0&&e.fire("SOUL:onDead"),n.health=s,n.walkSpeed=e.data.walkSpeed*n.speedMultiplier,n.runSpeed=e.data.runSpeed*n.speedMultiplier,a.refresh(),e.Weapon.refresh()}function SpellStack(t){var a=this,c=[],i=MAGIC.SPELLS[t],s=i.stackMax;function recount(){n.spells[t]=e.Spells[t]=c.length,n.spells[t]||(delete n.spells[t],delete e.Spells[t])}r[t]=a,a.reset=function(){a.uncast(c.length)},a.cast=function(){e.fire("SPELL:onBeforeCast",n),s>0&&c.length>=s&&uncast(t);var n=new SpellInstance(t,e);c.push(n),l.push(n),n.start(),recount(),refresh(),e.fire("SPELL:onStart",n)},a.uncast=function(t){if(c.length){e.fire("SPELL:onBeforeUncast",a),t=t||1;for(var n=0;n<t;n++){var a=c.shift();if(!a)break;a.stop(),ARRAY.removeItem(l,a)}return recount(),refresh(),i.deactivationSound&&SFX.play(i.deactivationSound),e.fire("SPELL:onEnd",i),i}}}t.reset=function(){l=[],n.spells={},uncastAll()},t.cast=function cast(e){if(e&&null!=e&&null!=e)if(Array.isArray(e))for(var t in e)cast(e[t]);else MAGIC.SPELLS[e]&&(r[e]||new SpellStack(e)).cast()},t.uncast=uncast,t.uncastAll=uncastAll}var Cinematic=pc.createScript("cinematic"),CINEMATIC=new function(){on("CINEMATIC:Play",(function(n,e){CINEMATIC.show()})),on("CINEMATIC:Hide",(function(n,e){CINEMATIC.hide()})),this.play=function(n,e){(function enable(){return!!UI.screens.CINEMATIC&&(addChild(UI.screens.CINEMATIC,UI.Layers.OVERLAY),UI.screens.CINEMATIC.enabled=!0,!0)})()&&CINEMATIC.play(n,e)},this.hide=function(){}};Cinematic.prototype.initialize=function(){var n,e=this,i=e.entity,o=getChildScript(i,"VideoController","videoController");function hide(){removeChild(i)}function onEnd(){hide(),o.stop(),MUSIC.resume(),n&&n()}CINEMATIC=e,e.onMouseDown=function(n){onEnd()},e.play=function play(e,t){addChild(i,UI.Layers.OVERLAY),MUSIC.pause(),n=t,o.play(e,onEnd)},e.hide=hide};var TextLocaleConfig=pc.createScript("textLocaleConfig");TextLocaleConfig.attributes.add("items",{type:"json",schema:[{title:"Text Key",name:"key",type:"string"},{name:"en",type:"string"},{name:"de",type:"string"},{name:"es",type:"string"},{name:"fr",type:"string"},{name:"hi",type:"string"},{name:"ja",type:"string"},{name:"ko",type:"string"},{name:"nl",type:"string"},{name:"ru",type:"string"},{name:"zh",type:"string"},{name:"ar",type:"string"},{name:"da",type:"string"},{name:"fa",type:"string"},{name:"fi",type:"string"},{name:"id",type:"string"},{name:"it",type:"string"},{name:"pt",type:"string"},{name:"th",type:"string"}],array:!0}),TextLocaleConfig.prototype.initialize=function(){var e=this,t={};for(var n in e.items){var i=e.items[n].key;i&&(t[i]=e.items[n])}CONFIG.add("TEXT",t)};var ParticleFx=pc.createScript("particleFx");ParticleFx.attributes.add("id",{type:"string",title:"ID"}),ParticleFx.attributes.add("animateIn",{type:"boolean",title:"Animate In",default:!1}),ParticleFx.attributes.add("disableOnExit",{type:"boolean",title:"Disable On Exit",default:!1}),ParticleFx.prototype.initialize=function(){var t=this,i=t.entity,e=getChildrenNames(i);getScript(i,"fxemitter")||i.script.create("fxemitter");var n=t.Emitter=i.script.fxemitter;for(var a in e)dynamicFunction(a);function dynamicFunction(i){e[i]=new FXInstance(t,e[i]),t[i]=function(){t.stop(),playFX(i)}}function playFX(t,a){i&&i.enabled&&(e[t]&&e[t].play(),n&&n.includes(t)&&n.play(t),a&&delay((function(){stopFX(t)}),a))}function stopFX(t){e[t]&&e[t].stop(),n&&n.includes(t)&&n.stop(t)}function FXInstance(t,i){var e=this,n=[];i.particlesystem&&n.push(i.particlesystem);let a=getChildren(i);for(let t in a)a[t].particlesystem&&n.push(a[t].particlesystem);var l=getLocals(i).sca.x,r=!0;e.play=function(){if(!r){r=!0,i.enabled=!0;for(let t in n)n[t].data&&n[t].play();t.animateIn&&ANIMATION.bounceScaleTo(i,l/2,l)}},e.stop=function(){if(r){r=!1;for(let t in n)n[t].stop();!e.disableOnExit&&n.length||(i.enabled=!1)}},e.stop()}t.play=function(t,e){if(i&&i.enabled)if(Array.isArray(t))for(var n in t)playFX(t[n],e);else playFX(t,e)},t.stop=function(t){if(Array.isArray(t))for(var i in t)stopFX(t[i]);else if(t)stopFX(t);else for(var n in e)stopFX(n)},t.id&&function setID(i){id=t.id=i,on(id+":Play",(function(i,e){t.play(i,e)})),on(id+":Stop",(function(i){t.stop(i)}))}(t.id)};var DialogBox=pc.createScript("dialogBox");DialogBox.attributes.add("id",{title:"ID",type:"string",default:"DIALOGBOX"}),DialogBox.attributes.add("screens",{title:"Screens",type:"json",schema:[{name:"delayTime",type:"number",default:0},{title:"Character",name:"character",type:"string"},{name:"Title",type:"string"},{name:"text",title:"Text",type:"string",array:!0}],array:!0}),DialogBox.attributes.add("autoStart",{title:"Auto Start",type:"boolean",default:!1}),DialogBox.prototype.initialize=function(){var e,t,n,i,a,r,o=this,c=o.entity,d=(c.findByName("Box"),c.findByName("Character")),l=(c.findByName("Text"),c.findByName("textField")),s=c.findByName("Arrow")||{};function show(e){c.enabled=!0,a=ARRAY.deepClone(e||o.screens),nextScreen()}function hide(){c.enabled=!1}function nextScreen(){if(r=a.shift(),i=s.enabled=!1,!r)return fire(e+":onHide"),hide();!function startAnimation(){n=r.character,ANIMATION.bounceScaleTo(d),t=r.text,nextText()}()}function nextText(){var a=t.shift();if(!a)return nextScreen();CONTENT.fill(c,{title:r.title,character:n}),ANIMATION.animateChars(l,a,(function(){i=s.enabled=!0})),fire(e+":onNext")}!function setID(t){t&&(e=o.id=t,on(e+":Show",show),on(e+":Hide",hide))}(o.id),o.onMouseDown=function(){i&&nextText()},o.autoStart&&o.screens&&show(o.screens)};var CheatsConfig=pc.createScript("cheatsConfig");CheatsConfig.attributes.add("list",{type:"json",schema:[{title:"Id",name:"id",type:"string"},{title:"Title",name:"title",type:"string"},{title:"Symbol",name:"symbol",type:"string"},{title:"Sequence",name:"sequence",type:"string"},{title:"Text",name:"text",type:"string"}],array:!0}),CheatsConfig.prototype.initialize=function(){var t={};for(var e in this.list){var i=this.list[e];i.sequence=STRING.getArray(i.sequence),t[i.id]=i}CONFIG.add("CHEATS",t)};var MAGIC=new function(){on("TOY:onFinalize",(function init(){if(!CONFIG.MAGIC)return;extractTab(CONFIG.MAGIC.SPELLS),extractTab(CONFIG.MAGIC.PICKUPS),extractTab(CONFIG.MAGIC.BULLETS),extractTab(CONFIG.MAGIC.WEAPONS),extractTab(CONFIG.MAGIC)}));var t=this;function extractTab(a){extract(a,t)}t.SPELLS={},t.PICKUPS={},t.BULLETS={},t.WEAPONS={}};var Minimap=pc.createScript("minimap");Minimap.attributes.add("offset",{type:"vec2"}),Minimap.attributes.add("scalar",{type:"number",default:1}),Minimap.prototype.initialize=function(){var e=this,t=e.entity,i=[],a=t.findByName("Content"),n=t.findByName("Template");n.enabled=!1;var o=e.scalar||1,r=e.offset||new pc.Vec2;function hide(e){for(var t in i)if(i[t].vars==e)return void removeItem(i,i[t])}function AvatarInstance(e){var t=this;t.vars=e,t.isME=e.isME;var i=t.avatar=n.clone();addChild(i,a);var d=e.isME?1:.8;i.setLocalScale(d,d,d),i.findByName("Stroke").enabled=t.isME,fill(i,e),t.update=function(){i.setLocalPosition(e.x*o+r.x,e.z*o+r.y,0)},t.destroy=function(){removeChild(i),i.destroy()},t.update()}on("MINIMAP:Reset",(function reset(){for(var e in i)i[e].destroy();i=[];var t=getChildren(a);for(;t.length;)t.shift().destroy()})),on("MINIMAP:Show",(function show(e){hide(e),i.push(new AvatarInstance(e))})),on("MINIMAP:Hide",hide),e.onUpdate=function(){for(var e in i)i[e].update()}},Minimap.prototype.update=function(e){isPaused||this.onUpdate()};var VideoController=pc.createScript("videoController");VideoController.attributes.add("videoAsset",{type:"asset",assetType:"audio"}),VideoController.attributes.add("autoStart",{type:"boolean",default:!0}),VideoController.prototype.initialize=function(){var e,t=this,o=t.entity,i=!0,n=o.element,a=new pc.Texture(t.app.graphicsDevice,{format:pc.PIXELFORMAT_R5_G6_B5,autoMipmap:!1});a.minFilter=pc.FILTER_LINEAR,a.magFilter=pc.FILTER_LINEAR,a.addressU=pc.ADDRESS_CLAMP_TO_EDGE,a.addressV=pc.ADDRESS_CLAMP_TO_EDGE,window.addEventListener("resize",resizeElement);var d=0;function resizeElement(){e&&n&&(n.height=n.calculatedWidth/(e.videoWidth/e.videoHeight))}t.play=function(o,i){if(videoAsset=o?pc.app.assets.find(o+".mp4"):t.videoAsset,!videoAsset)return++d<3?void delay((function(){t.play(o,i)}),1):(d=0,void(i&&i()));d=0,(e=document.createElement("video")).addEventListener("canplay",function(t){a.setSource(e),resizeElement(),e.play()}.bind(t)),e.addEventListener("ended",(function(e){i&&i()})),e.src=videoAsset.getFileUrl(),e.crossOrigin="anonymous",e.loop=!1,e.controls=!1,e.playsInline=!0,e.autoplay=!0,n.texture=a},t.pause=function(){e&&e.pause()},t.resume=function(){e&&e.play()},t.stop=function(){t.pause(),e=void 0},t.onUpdate=function(){e&&(i=!i)&&a.upload()},t.videoAsset&&t.autoStart&&t.play()},VideoController.prototype.update=function(){this.onUpdate()};var BITMOJIBINDER=new function(){let n={},t=[],e={LeftHand:"L_hand0001_bind_JNT",RightHand:"R_hand0001_bind_JNT"};function updateHandlerInstances(){t=Object.values(n)}function doUpdate(){for(const n of t)n.doUpdate()}function getBoneEntity(n,t){let i=function getBoneName(n){return e[n]?e[n]:log("Bone called: ",n," Doesnt Exists")}(t);if(i)return n.findByName(i)}function TargetHandler(n,t,e,i){let o,a=n.findByName("Bitmoji"),d=n.findByName(t);i||(i={}),this.doUpdate=function(){let n=function getBone(){o||(o=getBoneEntity(a,e));return o}();if(!n)return;let t=n.getPosition();if(d.setPosition(t),!i.keepOriginalRotation){let t=n.getRotation();d.setRotation(t)}}}this.bind=function(t,e,i,o,a){if(n[t])return log("A handler with: ",t," already exists");let d=new TargetHandler(e,i,o,a);n[t]=d,updateHandlerInstances()},this.unbind=function(t){n[t]&&(delete n[t],updateHandlerInstances())},on("TOY:onFinalize",(()=>{startFixed(doUpdate)}))};var BindEntitiesTobones=pc.createScript("bindEntitiesTobones");BindEntitiesTobones.attributes.add("Targets",{type:"json",array:!0,schema:[{name:"toAttachEntity",type:"entity"},{name:"boneName",type:"string"},{name:"bindOnEvent",type:"string"},{name:"unbindOnEvent",type:"string"},{name:"bindOnBitmojiLoaded",type:"boolean"},{name:"keepOriginalRotation",type:"boolean"}]}),BindEntitiesTobones.prototype.initialize=function(){let n=this,t=n.entity;for(let e=0;e<n.Targets.length;e++){let i=n.Targets[e],o=t.name+e,a=t.findByName("Bitmoji");log(a);let d={keepOriginalRotation:i.keepOriginalRotation};function doBind(){BITMOJIBINDER.bind(o,t,i.toAttachEntity.name,i.boneName,d),i.unbindOnEvent&&on(i.unbindOnEvent,(()=>{BITMOJIBINDER.unbind(o)}))}i.bindOnBitmojiLoaded?a.on("BITMOJI:onLoaded",doBind):i.bindOnEvent&&on(i.bindOnEvent,doBind)}};var HomeSlider=pc.createScript("homeSlider");HomeSlider.prototype.postInitialize=function(){var e=this;let n=e.entity,t=n.findByName("ScrollView"),o=n.findByName("Content"),i=n.findByName("Base"),l=n.findByName("Galleries"),r=n.findByName("Container"),a=getChildScript(n,"YourTurn","gallery"),s=getChildScript(n,"TheirTurn","gallery"),c=getChildScript(n,"Friends","gallery"),u=getChild(n,"NewGameButton"),d=getChild(u,"InviteButton"),y=CONFIG.GAME.MULTIPLAYER.module;var f=1920,h=!1;function getFriends(){conquer.Friends.get(!0).then((function(){c.fill(conquer.Friends.active,onFriendSelected)}))}function refreshTurns(){r.setLocalPosition(0,-350,0),a.clear(),s.clear(),delay((function(){on("TURNS:onRefresh",onRefreshTurns),GAME.Turns.get()}),.5)}function onRefreshTurns(){off("TURNS:onRefresh",onRefreshTurns),resetLocals(a.entity),a.entity.enabled=!0,s.entity.enabled=!0,"VS"==y&&(GAME.Turns.yourItems.length&&a.fill(GAME.Turns.yourItems,onYourTurn),GAME.Turns.theirItems.length&&s.fill(GAME.Turns.theirItems,onTheirTurn)),t.scrollview.enabled=!1,o.setLocalPosition(0,0,0),r.setLocalPosition(0,-350,0),delayUnique("HomeSlider",(function(){SFX.play("Pop2"),t.scrollview.enabled=!0,ANIMATION.moveTo(r,pc.Vec3.ZERO,1,EASING.ElasticOut),h=!0,start(onUpdate),onResize()}),.5)}function onYourTurn(e){if("Remove"==e.data.action)return e.data.remove(),a.removeButton(e),onResize();goPlayTurn(e)}function onTheirTurn(e){if("Remove"==e.data.action)return s.removeButton(e),onResize();goPlayTurn(e)}function goPlayTurn(e){UI.block(),GAME.Turns.select(e.data),goGameScreen()}function goGameScreen(){delay((function(){if("Disabled"==y)return GAME.play();SCREENS.show(y)}),.5)}function onFriendSelected(e){UI.block();let n=e.data.avatarID;if("VS"==y)return GAME.Turns.set(n).then(goGameScreen);PLATFORM.switchToFriend(n,goGameScreen)}function onResize(){if(!n.enabled)return;let e,r=UISIZE.HEIGHT;t.element.height=r+100,e=a.pool.length?a.entity.pos.y+a.posY-100:u.pos.y,u.setLocalPosition(0,e,0),d.enabled&&(e-=220),e-=280,s.pool.length&&(s.entity.setLocalPosition(s.entity.pos.x,e,0),e+=s.posY-100),c.pool.length&&(c.entity.setLocalPosition(c.entity.pos.x,e,0),e+=c.posY-100),i.element.height=800-e,o.element.height=r-e,l.setLocalPosition(0,o.element.height/2-r+555-50,0),f=100-UISIZE.HEIGHT}function onUpdate(){if(!n.enabled||!h)return;var e=o.getLocalPosition().y,t=l.getLocalPosition().y+e;hideShowGallery(a,t),hideShowGallery(s,t),hideShowGallery(c,t);let i=CINEMACAMERAS.HomeCamera.entity;i.pos||getLocals(i);let r=e/2e3;r>.7&&(r=.7),i.setLocalPosition(i.pos.x,i.pos.y-r,i.pos.z)}function hideShowGallery(e,t){var o=localToLocal(e.entity,n);if(o.y<f||e.pool.length<=0)e.entity.enabled=!1;else{e.entity.enabled=!0;var i=!1;for(var l in e.pool){var r=e.pool[l];i?r.entity.enabled=!1:(o=localToLocal(r.entity,n)).y<f?(r.entity.enabled=!1,i=!0):o.y>100?r.entity.enabled=!1:r.entity.enabled=!0}}}getLocals(a.entity),getLocals(s.entity),getLocals(c.entity),getLocals(u),d.enabled=PLATFORM.canInvite,a.entity.setLocalPosition(0,-5e3,0),s.entity.setLocalPosition(0,-5e3,0),c.entity.setLocalPosition(0,-5e3,0),on("GAME:onInit",getFriends),getFriends(),on("BUTTON:onClick",(function(e){return"PlayButton"==e?function doNewGame(){if(WALLET.Energy.value<5)return UPSALE.noEnergy();WALLET.Energy.decrease(5),GAME.Score.setPermanentMultiplier(),goGameScreen()}():"RewardedButton"==e?function doRewarded(){if(WALLET.Energy.value<5)return UPSALE.noEnergy();ADPLAYER.playRewarded((function(e){e&&(WALLET.Energy.decrease(5),GAME.Score.setPermanentMultiplier(2),goGameScreen())}))}():"InviteButton"==e?function doInvite(){PLATFORM.inviteFriends()}():void 0})),e.show=function(){let e=CINEMACAMERAS.HomeCamera.entity;return e.pos||getLocals(e),e.setLocalPosition(e.pos),t.scrollview.scroll.y=t.scrollview.scroll._y=0,t.scrollview.enabled=!1,o.setLocalPosition(0,0,0),h=!1,refreshTurns()},e.hide=function(){h=!1,stop(onUpdate),cancel("HomeSlider"),off("TURNS:onRefresh",onRefreshTurns)},on("UI:onResize",onResize),on("HOMESLIDER:Enable",(function enable(){})),on("HOMESLIDER:Disable",(function disable(){}))};var SlideButton=pc.createScript("slideButton");SlideButton.prototype.initialize=function(){var t=this,o=this.entity,e=o.findByName("Slide"),n=!1,a=o.findByName("RemoveButton");o.findByName("daysField");getLocals(e);var i=getScript(a,"simpleButton");i.onMousePress=i.onMouseUp=null,t.skipAnimation=!0,t.isMute=!0;var s=!1,l=!1;function callParent(){ANIMATION.click(o);var e=o.parent.script._scripts;for(var n in e)if(e[n].onMouseDown)return e[n].onMouseDown(t)}function stopUpdating(){stop(onUpdate)}function onMouseRelease(){stopUpdating(),fire("HOMESLIDER:Enable")}function onUpdate(){if(TOUCH.lastTouch){var t=TOUCH.lastTouch.distance.x;if(Math.abs(TOUCH.lastTouch.distance.y)>=2)return stopUpdating();if(!(Math.abs(t)<2))return!n&&t<0?function open(){l=!0,a.enabled=!0,fire("HOMESLIDER:Disable"),stopUpdating(),n=!0,ANIMATION.moveTo(e,{x:-115,y:e.pos.y,z:0},.6,EASING.ElasticOut)}():n&&t>0?function close(){return l=!0,fire("HOMESLIDER:Disable"),stopUpdating(),n=!1,void ANIMATION.moveTo(e,{x:e.pos.x,y:e.pos.y,z:0},.6,EASING.ElasticOut)}():void 0}}BUTTON.call(this),a.enabled=!1,t.fill=function(e){fill(o,{userPhoto:e.userPhoto,fullName:e.fullName,days:e.lastChange?DATE.days(DATE.now()-e.lastChange)+" Ago":"Your turn",button:"finished"==e.status?"Symbol_Trophy":"Symbol_Play2"}),t.data=e},t.onMousePress=function(t){l=!1,on("TOUCH:onRelease",onMouseRelease),start(onUpdate)},t.doClick=function(){s||l||(delete t.data.action,callParent())},i.doClick=function(){s=!0,onMouseRelease(),t.data.action="Remove",callParent()}};function HueSaturationEffect(t){pc.PostEffect.call(this,t),this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","uniform float uHue;","uniform float uSaturation;","","varying vec2 vUv0;","","void main() {","    gl_FragColor = texture2D( uColorBuffer, vUv0 );","","    float angle = uHue * 3.14159265;","    float s = sin(angle), c = cos(angle);","    vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","    float len = length(gl_FragColor.rgb);","    gl_FragColor.rgb = vec3(","        dot(gl_FragColor.rgb, weights.xyz),","        dot(gl_FragColor.rgb, weights.zxy),","        dot(gl_FragColor.rgb, weights.yzx)","    );","","    float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","    if (uSaturation > 0.0) {","        gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - uSaturation));","    } else {","        gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-uSaturation);","    }","}"].join("\n")}),this.hue=0,this.saturation=0}HueSaturationEffect.prototype=Object.create(pc.PostEffect.prototype),HueSaturationEffect.prototype.constructor=HueSaturationEffect,Object.assign(HueSaturationEffect.prototype,{render:function(t,e,r){var a=this.device,o=a.scope;o.resolve("uHue").setValue(this.hue),o.resolve("uSaturation").setValue(this.saturation),o.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(a,e,this.vertexBuffer,this.shader,r)}});var HueSaturation=pc.createScript("hueSaturation");HueSaturation.attributes.add("hue",{type:"number",default:0,min:-1,max:1,title:"Hue"}),HueSaturation.attributes.add("saturation",{type:"number",default:0,min:-1,max:1,title:"Saturation"}),HueSaturation.prototype.initialize=function(){this.effect=new HueSaturationEffect(this.app.graphicsDevice),this.effect.hue=this.hue,this.effect.saturation=this.saturation,this.on("attr",(function(t,e){this.effect[t]=e}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};function FxaaEffect(e){pc.PostEffect.call(this,e);var o={aPosition:pc.SEMANTIC_POSITION},t=["attribute vec2 aPosition;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","}"].join("\n"),a=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform vec2 uResolution;","","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","","void main()","{","    vec3 rgbNW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbNE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbSW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * uResolution ).xyz;","    vec3 rgbSE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * uResolution ).xyz;","    vec4 rgbaM  = texture2D( uColorBuffer,  gl_FragCoord.xy  * uResolution );","    vec3 rgbM  = rgbaM.xyz;","    float opacity  = rgbaM.w;","","    vec3 luma = vec3( 0.299, 0.587, 0.114 );","","    float lumaNW = dot( rgbNW, luma );","    float lumaNE = dot( rgbNE, luma );","    float lumaSW = dot( rgbSW, luma );","    float lumaSE = dot( rgbSE, luma );","    float lumaM  = dot( rgbM,  luma );","    float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","    float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","","    vec2 dir;","    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","","    float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","","    float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","    dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX), max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * uResolution;","","    vec3 rgbA = 0.5 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );","","    vec3 rgbB = rgbA * 0.5 + 0.25 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * -0.5 ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * 0.5 ).xyz );","","    float lumaB = dot( rgbB, luma );","","    if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )","    {","        gl_FragColor = vec4( rgbA, opacity );","    }","    else","    {","        gl_FragColor = vec4( rgbB, opacity );","    }","}"].join("\n");this.fxaaShader=new pc.Shader(e,{attributes:o,vshader:t,fshader:a}),this.resolution=new Float32Array(2)}FxaaEffect.prototype=Object.create(pc.PostEffect.prototype),FxaaEffect.prototype.constructor=FxaaEffect,Object.assign(FxaaEffect.prototype,{render:function(e,o,t){var a=this.device,r=a.scope;this.resolution[0]=1/e.width,this.resolution[1]=1/e.height,r.resolve("uResolution").setValue(this.resolution),r.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(a,o,this.vertexBuffer,this.fxaaShader,t)}});var Fxaa=pc.createScript("fxaa");Fxaa.prototype.initialize=function(){this.effect=new FxaaEffect(this.app.graphicsDevice);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(o){o?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};function BrightnessContrastEffect(t){pc.PostEffect.call(this,t),this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform sampler2D uColorBuffer;","uniform float uBrightness;","uniform float uContrast;","","varying vec2 vUv0;","","void main() {","    gl_FragColor = texture2D( uColorBuffer, vUv0 );","    gl_FragColor.rgb += uBrightness;","","    if (uContrast > 0.0) {","        gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - uContrast) + 0.5;","    } else {","        gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + uContrast) + 0.5;","    }","}"].join("\n")}),this.brightness=0,this.contrast=0}BrightnessContrastEffect.prototype=Object.create(pc.PostEffect.prototype),BrightnessContrastEffect.prototype.constructor=BrightnessContrastEffect,Object.assign(BrightnessContrastEffect.prototype,{render:function(t,e,s){var r=this.device,i=r.scope;i.resolve("uBrightness").setValue(this.brightness),i.resolve("uContrast").setValue(this.contrast),i.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(r,e,this.vertexBuffer,this.shader,s)}});var BrightnessContrast=pc.createScript("brightnessContrast");BrightnessContrast.attributes.add("brightness",{type:"number",default:0,min:-1,max:1,title:"Brightness"}),BrightnessContrast.attributes.add("contrast",{type:"number",default:0,min:-1,max:1,title:"Contrast"}),BrightnessContrast.prototype.initialize=function(){this.effect=new BrightnessContrastEffect(this.app.graphicsDevice),this.effect.brightness=this.brightness,this.effect.contrast=this.contrast,this.on("attr",(function(t,e){this.effect[t]=e}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};var SAMPLE_COUNT=15;function computeGaussian(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function calculateBlurValues(e,t,o,s,r){e[0]=computeGaussian(0,r),t[0]=0,t[1]=0;var i,l,a=e[0];for(i=0,l=Math.floor(SAMPLE_COUNT/2);i<l;i++){var u=computeGaussian(i+1,r);e[2*i]=u,e[2*i+1]=u,a+=2*u;var h=2*i+1.5;t[4*i]=o*h,t[4*i+1]=s*h,t[4*i+2]=-o*h,t[4*i+3]=-s*h}for(i=0,l=e.length;i<l;i++)e[i]/=a}function BloomEffect(e){pc.PostEffect.call(this,e);var t={aPosition:pc.SEMANTIC_POSITION},o=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition + 1.0) * 0.5;","}"].join("\n"),s=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),r=["precision "+e.precision+" float;","","#define SAMPLE_COUNT "+SAMPLE_COUNT,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets[SAMPLE_COUNT];","uniform float uBlurWeights[SAMPLE_COUNT];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),i=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:s}),this.blurShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:r}),this.combineShader=new pc.Shader(e,{attributes:t,vshader:o,fshader:i}),this.targets=[],this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(SAMPLE_COUNT),this.sampleOffsets=new Float32Array(2*SAMPLE_COUNT)}BloomEffect.prototype=Object.create(pc.PostEffect.prototype),BloomEffect.prototype.constructor=BloomEffect,BloomEffect.prototype._destroy=function(){var e;if(this.targets)for(e=0;e<this.targets.length;e++)this.targets[e].destroyTextureBuffers(),this.targets[e].destroy();this.targets.length=0},BloomEffect.prototype._resize=function(e){var t,o=e.colorBuffer.width,s=e.colorBuffer.height;if(o!==this.width||s!==this.height)for(this.width=o,this.height=s,this._destroy(),t=0;t<2;t++){var r=new pc.Texture(this.device,{name:"Bloom Texture"+t,format:pc.PIXELFORMAT_RGBA8,width:o>>1,height:s>>1,mipmaps:!1});r.minFilter=pc.FILTER_LINEAR,r.magFilter=pc.FILTER_LINEAR,r.addressU=pc.ADDRESS_CLAMP_TO_EDGE,r.addressV=pc.ADDRESS_CLAMP_TO_EDGE,r.name="pe-bloom-"+t;var i=new pc.RenderTarget({name:"Bloom Render Target "+t,colorBuffer:r,depth:!1});this.targets.push(i)}},Object.assign(BloomEffect.prototype,{render:function(e,t,o){this._resize(e);var s=this.device,r=s.scope;r.resolve("uBloomThreshold").setValue(this.bloomThreshold),r.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.extractShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),pc.drawFullscreenQuad(s,this.targets[1],this.vertexBuffer,this.blurShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),pc.drawFullscreenQuad(s,this.targets[0],this.vertexBuffer,this.blurShader),r.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),r.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(s,t,this.vertexBuffer,this.combineShader,o)}});var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",(function(e,t){this.effect[e]=t}),this),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect),this._destroy()}))};var GalleryTab=pc.createScript("galleryTab");GalleryTab.prototype.postInitialize=function(){var e,t,n,l=this,i=l.entity,o=getChildScript(i,"Gallery","gallery"),a=getChildScript(i,"Button","simpleButton"),c=i.findByName("Base");function onDown(t){e&&e(t)}l.width=128,l.init=function(e){t=e},l.fill=function(t,i){n=t,i&&(e=i),a.fill(n[0]),c.element.width=l.width=n.length*o.marginX,l.deselect()},l.select=function(){a.entity.enabled=!1,o.entity.enabled=!0,o.fill(n,onDown),o.pool[0].click(),t.select(l)},l.deselect=function(){a.entity.enabled=!0,o.clear(),o.entity.enabled=!1},l.onMouseDown=function(e){l.select()}};var GalleryTabs=pc.createScript("galleryTabs");GalleryTabs.prototype.postInitialize=function(){var t,e=this,l=e.entity,a=l.findByName("Tabs"),i=a.findByName("Template"),o=null,n=l.findByName("Content");getLocals(a),i.enabled=!1;var r=[];function sort(){var t=0;let e=localToLocal(o.entity,l).x;for(let e=0;e<r.length;e++){var i=r[e],s=i.script.galleryTab;i.setLocalPosition(t,0,0),t+=s==o?s.width:128}n.element.width=t,a.setLocalPosition(-t/2,a.pos.y,0);var c=n.getLocalPosition().x+(e-localToLocal(o.entity,l).x);c>0&&(c=0),n.setLocalPosition(c,0,0)}e.fill=function(l,o){for(let t in r)r[t].destroy();var n;t=l,r=[];for(let l=0;l<t.length;l++){var s=i.clone();addChild(s,a),(n=s.script.galleryTab).init(e),n.fill(t[l],o),r.push(n.entity)}if(!r[0])return sort();r[0].script.galleryTab.select()},e.select=function(t){o&&o.deselect(),o=t,sort()}};var AvatarControlsConfig=pc.createScript("avatarControlsConfig");AvatarControlsConfig.attributes.add("title",{title:"Title",type:"string"}),AvatarControlsConfig.attributes.add("max",{title:"Max",type:"number",default:1}),AvatarControlsConfig.attributes.add("min",{title:"Min",type:"number",default:0}),AvatarControlsConfig.attributes.add("hidden",{title:"Hidden",type:"boolean",default:!1}),AvatarControlsConfig.attributes.add("palette",{title:"Color Palette",type:"string"}),AvatarControlsConfig.attributes.add("colorTag",{title:"Color Tag",type:"string"}),AvatarControlsConfig.attributes.add("subcontrol",{type:"json",title:"Subcontrol",schema:[{title:"Id",name:"id",type:"string"},{title:"Strenght",name:"strenght",type:"number",default:1}],array:!0}),AvatarControlsConfig.prototype.initialize=function(){var t=this,a=t.entity;t.get=function(){var e={id:a.name,title:t.title||a.name,max:t.max,min:t.min};return t.subcontrol.length&&(e.subcontrol=t.subcontrol),t.palette&&(e.symbol="Symbol_Color",e.palette=t.palette,e.colorTag=t.colorTag),e}};var AvatarConfig=pc.createScript("avatarConfig");AvatarConfig.attributes.add("tabID",{title:"Tab ID",type:"string"}),AvatarConfig.attributes.add("title",{title:"Tab Title",type:"string"}),AvatarConfig.attributes.add("camera",{title:"Camera",type:"string",default:"AvatarBody"}),AvatarConfig.attributes.add("symbol",{title:"Symbol",type:"string"}),AvatarConfig.attributes.add("amount",{title:"Amount",type:"number",default:2}),AvatarConfig.attributes.add("extra",{title:"Extra",type:"number",default:0}),AvatarConfig.attributes.add("extraLabel",{title:"Extra Label",type:"string"}),AvatarConfig.attributes.add("symmetry",{title:"Symmetry",type:"boolean",default:!1}),AvatarConfig.attributes.add("hasEmpty",{title:"Has Empty",type:"boolean"}),AvatarConfig.attributes.add("container",{title:"Container",type:"boolean"}),AvatarConfig.attributes.add("isBodied",{title:"Is Bodied",type:"boolean"}),AvatarConfig.prototype.initialize=function(){var t=this,a=t.entity,e={};e.tabID=t.tabID||a.name,e.title=t.title||e.tabID,e.symbol=t.symbol||"Symbol_"+e.tabID,e.hasEmpty=t.hasEmpty,e.symmetry=t.symmetry,e.camera=t.camera||"AvatarBody",e.amount=t.amount,e.container=t.container,e.extra=t.extra,e.extraLabel=t.extraLabel,e.isBodied=t.isBodied,t.getNested=function(){var i=[t.get()],r=[],o=getChildren(a);for(var n in o){var l=o[n];if(l.script){var s=l.script.avatarControlsConfig;if(s){s.initialize();var d=s.get();d.title=e.title+" : "+d.title,"Color"!=d.id?r.push(d):i.push(d)}}}return r.length&&i.push({tabID:e.tabID,symbol:"Symbol_Controls",title:e.title+" : Controls",controls:r}),i},t.get=function(){return e}};var AvatarTabsConfig=pc.createScript("avatarTabsConfig");AvatarTabsConfig.prototype.postInitialize=function(){var a=this.entity,t=[],i=getChildren(a);for(var r in i){var e=i[r];if(e.script){var n=e.script.avatarConfig;n&&t.push(n.getNested())}}CONFIG.add("SNAPPY",{}),CONFIG.SNAPPY=t};var ButtonAvatarInventory=pc.createScript("buttonAvatarInventory");ButtonAvatarInventory.prototype.initialize=function(){var e=this,t=e.entity;BUTTON.call(e);var a=getChild(t,"Unblocked"),n=getChild(t,"Blocked"),l=getChild(t,"Chosen");let r=t.findByName("Unblocked").findByName("symbolTexture");function refresh(){l&&(l.enabled=!1),a.enabled=!1,n.enabled=!1,a.enabled=!0,r&&(r.element.color=COLOR.get(e.data.color||"WHITE")),l&&(l.enabled=e.data.selected)}e.fill=function(t){e.data=t,e.data.onRefresh=refresh,CONTENT.fill(n,e.data),CONTENT.fill(a,e.data),refresh()},e.refresh=refresh};var ButtonColor=pc.createScript("buttonColor");ButtonColor.prototype.initialize=function(){var e=this,t=e.entity,o=getChild(t,"Chosen");function refresh(){o.enabled=e.selected}BUTTON.call(e),e.fill=function(o){e.data=o,o.color&&(t.element.color=COLOR.get(o.color)),refresh()},e.refresh=refresh};var ButtonControls=pc.createScript("buttonControls");ButtonControls.prototype.initialize=function(){var t=this;t.entity;BUTTON.call(t);var o=0;function onUpdate(){++o>10&&(o=0),fire("SNAPPY:onControl",t.data.tabID,t.data)}t.onMousePress=function(n){o=0,startFixed(onUpdate),fire("SNAPPY:onControlPress",t.data.tabID,t.data)},t.onMouseRelease=function(t){stop(onUpdate)}};var ScreenChat=pc.createScript("screenChat");ScreenChat.prototype.postInitialize=function(){var e=this,t=e.entity;SCREEN.call(e);let i=getChildScript(t,"FriendsSlider","friendsSlider");e.onShow=function(){i.show()}};var ScreenInventory=pc.createScript("screenInventory");ScreenInventory.prototype.initialize=function(){var e=this,t=e.entity;SCREEN.call(e);var n,r=getChildScript(t,"GalleryTabs","galleryTabs"),a=t.findByName("titleField"),o=getChildScript(t,"InventoryGallery","scrollGallery");t.findByName("Interface");function onTabDown(e){var t=n=e.data;a&&(a.element.text=t.title),o.Gallery.clear(),FOG.set(),SKYBOX.set(),display("InventoryTab",t.tabKey),log("TAB DOWN"),fire("INVENTORY:onUpdate",{tab:t.tabKey,inventoryItem:GAME.Inventory.items[GAME.Inventory.selected[t.tabKey]]});let r=t.items;fire("CINEMACAMERA:Overlay",t.camera),r,o.entity.enabled=!0,o.fill(r,onItemDown)}function onItemDown(e){var t=e.data;t.isLocked&&!CONFIG.DEBUG.unlockShop||(GAME.Inventory.tabs[n.tabKey].select(t.key),o.Gallery.refresh())}e.onShow=function(){MUSIC.play("Inventory"),FOG.set(),SKYBOX.set();var e=[];for(var t in GAME.Inventory.tabs)e.push(GAME.Inventory.tabs[t]);e=ARRAY.sort(e,"sorting");for(let t in e)e[t]=[e[t]];r.fill(e,onTabDown),NAV.show()},e.onHide=function(){fire("CINEMACAMERAS:StopOverlay")}};class RbComponent extends pc.ScriptType{initialize(){const t=this,e=t.entity;APP.systems.rb&&(e.findComponent("rb")||t.initialized||(e.addComponent("rb",{type:t.type,centerOfMass:t.centerOfMass,gravityScale:t.gravityScale,linearDamping:t.linearDamping,angularDamping:t.angularDamping,angularFactor:t.angularFactor,linearFactor:t.linearFactor,friction:t.friction,restitution:t.restitution,dominanceGroup:t.dominanceGroup}),t.initialized=!0))}}pc.registerScript(RbComponent,"rb-component"),RbComponent.attributes.add("type",{type:"string",title:"Type",enum:[{Static:"static"},{Dynamic:"dynamic"},{"Kinematic Position Based":"kinematic-position"},{"Kinematic Velocity Based":"kinematic-velocity"}],default:"static"}),RbComponent.attributes.add("centerOfMass",{type:"vec3",title:"Center Of Mass",default:[0,0,0],description:"The initial center-of-mass of the rigid-body to create."}),RbComponent.attributes.add("dominanceGroup",{type:"number",title:"Dominance Group",precision:0,min:-127,max:127,default:0,description:"Each rigid-body is part of a dominance group in [-127; 127] (the default group is 0). If the colliders from two rigid-bodies are in contact, the one with the highest dominance will act as if it has an infinite mass, making it immune to the contact forces the other body would apply on it. If both bodies are part of the same dominance group, then their contacts will work in the usual way (both are affected by opposite forces with the same magnitude).For example, if a dynamic body A is in the dominance group 10, and a dynamic body B in the dominance group -20, then a contact between a collider attached to A and a collider attached B will result in A remaining immobile and B being pushed by A (independently from their mass)."}),RbComponent.attributes.add("gravityScale",{type:"number",title:"Gravity Scale",precision:2,default:1,description:"Scales the gravity affecting this particular rigidbody. Setting it to 0, means it will no longer be affected by gravity."}),RbComponent.attributes.add("linearDamping",{type:"number",title:"Linear Damping",precision:2,default:0,min:0,max:1}),RbComponent.attributes.add("angularDamping",{type:"number",title:"Angular Damping",precision:2,default:0,min:0,max:1}),RbComponent.attributes.add("angularFactor",{type:"vec3",title:"Angular Factor",default:[1,1,1]}),RbComponent.attributes.add("linearFactor",{type:"vec3",title:"Linear Factor",default:[1,1,1]}),RbComponent.attributes.add("friction",{type:"number",title:"Friction",precision:4,default:.5,min:0,max:1}),RbComponent.attributes.add("restitution",{type:"number",title:"Restitution",precision:4,default:.5,min:0,max:1});class ColComponent extends pc.ScriptType{initialize(){if(!APP.systems.col)return;if(this.entity.findComponent("col"))return;if(this.initialized)return;const e=this.collisionFilter;this.entity.addComponent("col",{type:this.type,halfExtents:this.halfExtents,radius:this.radius,height:this.height,axis:this.axis,asset:this.asset,renderAsset:this.renderAsset,density:this.density,normal:this.normal,contactForceThreshold:this.contactForceThreshold,filters:{collision:{membership:e.membership,filter:e.filter,invert:e.invert?1:0},solver:{membership:["DEFAULT"],filter:["DEFAULT"],invert:!1}}}),this.initialized=!0}}pc.registerScript(ColComponent,"col-component"),ColComponent.attributes.add("type",{type:"string",title:"Type",enum:[{Box:"box"},{Sphere:"sphere"},{Capsule:"capsule"},{Cylinder:"cylinder"},{Mesh:"mesh"},{Compound:"compound"},{Cone:"cone"},{"Half Space":"halfSpace"}],default:"box"}),ColComponent.attributes.add("density",{type:"number",title:"Density",precision:5,default:1,description:"Physics engine will automatically calculate the mass of the collider based its shape and density."}),ColComponent.attributes.add("mass",{type:"number",title:"Mass",precision:5,default:-1,description:"Keep it -1 to let the physics engine to automatically calculate the mass of the collider, based on its shape and density. Use 0 or more to override automatic calculation."}),ColComponent.attributes.add("contactForceThreshold",{type:"number",title:"Contact Force Threshold",precision:2,default:0,description:'Sets a minimum threshold of a contact force magnitude between two bodies. Contact events below this threshold will be ignored. Useful, when you want to ignore some light collisions. Defaults to zero (all collision events reported). The threshold will depend on the collider shape and size. For a 1m^3 box you could try starting somewhere at 500-1000 and tweak from there. To catch this event, listen for col component "contactforce" event. For example: entity.col.on("contactforce", this.myCallback, this);'}),ColComponent.attributes.add("halfExtents",{type:"vec3",title:"Half Extents",default:[.5,.5,.5]}),ColComponent.attributes.add("normal",{type:"vec3",title:"Local Normal",default:[0,1,0]}),ColComponent.attributes.add("radius",{type:"number",title:"Radius",precision:4,default:.5}),ColComponent.attributes.add("height",{type:"number",title:"Height",precision:4,default:1}),ColComponent.attributes.add("axis",{type:"number",title:"Axis",enum:[{X:0},{Y:1},{Z:2}],default:1}),ColComponent.attributes.add("asset",{type:"asset",title:"Model Asset"}),ColComponent.attributes.add("renderAsset",{type:"asset",title:"Render Asset"}),ColComponent.attributes.add("collisionFilter",{type:"json",title:"Collision Filter",description:"Specifies collision filtering groups. This filter is applied before contacts calculation in narrow phase. You normally want to use this one.",schema:[{name:"membership",title:"Membership",type:"string",array:!0,description:'Groups that this collider belong to. If none specified, a collider will be assigned to a default group "DEFAULT".'},{name:"filter",title:"Filter",type:"string",array:!0,description:'Groups that this collider can interact with. If none specified, a default group "DEFAULT" will be set.'},{name:"invert",title:"Invert",type:"boolean",default:!1,description:'Inverts the filter, so this collider will interact with all colliders that are part of "DEFAULT", except those groups that are listed in the filter.'}]});var FriendsSlider=pc.createScript("friendsSlider");FriendsSlider.prototype.postInitialize=function(){let e=this.entity,t=e.findByName("ScrollView"),n=e.findByName("Content"),o=e.findByName("Galleries"),i=getChildScript(e,"Friends","gallery"),l=getChildScript(e,"Pending","gallery"),a=getChildScript(e,"Upcoming","gallery"),s=getChildScript(e,"InviteButton","simpleButton"),d=getChildScript(e,"ChatModule","chatModule");var r=1920;getLocals(i.entity),getLocals(l.entity),getLocals(a.entity),getLocals(s.entity);let c=[];for(let e=0;e<2;e++)c.push({id:RANDOM.value(9999999999)});a.fill(c,(function onUpcoming(e){a.removeButton(e),"Remove"!=e.data.action&&(i.entity.enabled=!0,i.push(e.data));return onResize()})),c=[];for(let e=0;e<5;e++)c.push({id:RANDOM.value(9999999999)});i.fill(c,(function onFriends(e){if("Remove"==e.data.action)return i.removeButton(e),onResize();!function showChat(){t.enabled=!1,d.entity.enabled=!0,d.show(),stop(onUpdate),NAV.showSmart({onBack:showFriends})}()})),c=[];for(let e=0;e<5;e++)c.push({id:RANDOM.value(9999999999)});function onResize(){let e=UISIZE.HEIGHT;t.element.height=e;let d=-245;s.entity.setLocalPosition(0,d,0),d-=330,a.pool.length&&(a.entity.setLocalPosition(a.entity.pos.x,d,0),d+=a.posY-100),i.pool.length&&(i.entity.setLocalPosition(i.entity.pos.x,d,0),d+=i.posY-100),l.pool.length&&(l.entity.setLocalPosition(l.entity.pos.x,d,0),d+=l.posY-100),d-=280,n.element.height=-d,o.setLocalPosition(0,n.element.height/2-(1-UISIZE.SCALED)*UISIZE.HEIGHT/2,0),r=100-UISIZE.HEIGHT}function onUpdate(){if(e.enabled){var t=n.getLocalPosition().y,s=o.getLocalPosition().y+t;hideShowGallery(i,s),hideShowGallery(l,s),hideShowGallery(a,s)}}function hideShowGallery(t,n){var o=localToLocal(t.entity,e);if(o.y<r||t.pool.length<=0)t.entity.enabled=!1;else{t.entity.enabled=!0;var i=!1;for(var l in t.pool){var a=t.pool[l];i?a.entity.enabled=!1:(o=localToLocal(a.entity,e)).y<r?(a.entity.enabled=!1,i=!0):o.y>100?a.entity.enabled=!1:a.entity.enabled=!0}}}function showFriends(){d.hide(),t.enabled=!0,NAV.show(),start(onUpdate)}l.fill(c,(function onPending(e){if("Remove"==e.data.action)return l.removeButton(e),onResize()})),onResize(),on("UI:onResize",onResize),on("HOMESLIDER:Enable",(function enable(){t.scrollview.enabled=!0})),on("HOMESLIDER:Disable",(function disable(){t.scrollview.enabled=!1})),this.show=function(){showFriends()}};var ChatModule=pc.createScript("chatModule");ChatModule.prototype.initialize=function(){let e,t,n=this,i=n.entity,o=i.findByName("Slider"),a=[],s=new EntityPool(i.findByName("TextBoxLeft"),"chatTextBox",o),r=new EntityPool(i.findByName("TextBoxRight"),"chatTextBox",o),l=new EntityPool(i.findByName("Picture"),null,o),c=!0;function reset(){for(var n in t=null,e=-150,a)a[n].hide();a=[],o.setLocalPosition(0,0,0)}var u,p;function onStartDrag(e){u=e,p=o.getLocalPosition().y,startFixed(dragging)}function dragging(){if(!TOUCH.isDown)return stop(dragging);o.setLocalPosition(0,p+u.totalDistance.y,0)}n.show=function(){if(reset(),i.enabled=!0,on("TOUCH:onDown",onStartDrag),c)return delay(fakeFill,.2);function fakeFill(){c=!1,n.spawn(),n.spawn(),n.spawn(),n.spawn(),n.spawn(),n.spawn(),n.spawn(),n.spawn(),n.spawn()}fakeFill()},n.hide=function(){reset(),i.enabled=!1,off("TOUCH:onDown",onStartDrag)},n.spawn=function(e){a.push(new entryInstance(e))};var h=[];function entryInstance(n){var i,o,a=this;n=n||{},a.sender=n.sender||(RANDOM.chance()?1:2),a.text=n.text||ARRAY.getRandomItem(h);var c=1==a.sender;a.spawn=function(){let n=t!=a.sender;t=a.sender,n&&(e-=80,(i=l.get()).setLocalPosition(c?-430:430,e-57,0));let u={text:a.text,showPointer:n};(o=c?s.get(u):r.get(u)).entity.setLocalPosition(c?-330:330,e,0),e-=o.height+5},a.hide=function(){if(removeChild(i),removeChild(o.entity),i&&l.remove(i),c)return s.remove(o);r.remove(o)},a.spawn()}h.push("what"),h.push("Lorem Ipsum is simply dummy text"),h.push("Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC"),h.push("It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages")};var ChatTextBox=pc.createScript("chatTextBox");ChatTextBox.prototype.initialize=function(){let e=this,t=e.entity,i=t.findByName("Text"),h=t.findByName("Base"),n=t.findByName("Pointer");e.height=120,e.fill=function(t){i.element.autoFitWidth=!1,i.element.autoWidth=!0,h.element.width=h.element.height=120,i.element.text=t.text,n.enabled=t.showPointer,i.element.width>600&&(i.element.autoWidth=!1,i.element.autoFitWidth=!0,i.element.width=600);let l=i.element.width+90;h.element.width=l,h.element.height=i.element.height+90,e.height=h.element.height}};var conquer;function SoundChannel(n){var e,o,u,t,i,s,c,r,l=this,a=!1;l.sounds={};let d="Music"!=n&&"Ambiance"!=n;l.disable=function(){a=!1},l.enable=function(){a=!0,u=SOUNDS.component,t=u.slots,o&&(l.play(o.name,o.vars),o=null)};let f=[],m=new DelayUnique;function doPlay(a,f){r=a;var m=function get(n){if(contains(n))return SOUNDS.mappings[n].get()}(a);if(!d&&s&&(t[s]&&u.stop(s),e=s=o=i=null),s=m,m){if(!c&&!SOUNDS.isMuted&&(f=f||{},"Voice"==n&&(f.pitch=1+decimal(.08)),d||(f.loop=!0,f.volume=.2),i=u.play(m)))return i.myName||(i.myName=m),ARRAY.extract(f,i),i.volume=1*(f.volume||1),l.sounds[a]=i,!d&&conquer&&conquer.Sounds[n].stop(),i}else conquer&&conquer.Sounds[n].play(a,f)}function contains(n){return SOUNDS.findMP3(n)}l.play=function(n,e){if(a)f[n]=e||{},m.start((function(){for(let n in f)doPlay(n,f[n]);f=[]}),.01);else{if(d)return;o={name:n,vars:e}}},l.pause=function(){if(a)return conquer?conquer.Sounds[n].pause():void 0},l.resume=function(){if(a)return conquer?conquer.Sounds[n].resume():void 0},l.stop=function(o){if(a){if(conquer&&conquer.Sounds[n].stop(o),o)return t[o]&&u.stop(o),void(e!=o&&s!=o||(s=e=i=null));for(o in t)u.stop(o);e=s=i=null}},l.loop=function(e,o){if(a&&CONFIG.SOUNDS[e])return contains(e)?((o=o||{}).loop=!0,doPlay(e,o)):conquer?conquer.Sounds[n].loop(e,o):void 0},l.playPitch=function(e,o){if(a)return contains(e)?((o=o||{}).pitch=1.2+RANDOM.spectrumDecimal(.4),doPlay(e,o)):conquer?conquer.Sounds[n].playPitch(e,o):void 0},l.playPitchSmall=function(e,o){if(a)return contains(e)?((o=o||{}).pitch=1+RANDOM.spectrumDecimal(.12),doPlay(e,o)):conquer?conquer.Sounds[n].playPitchSmall(e,o):void 0},l.mute=function(e){c!=e&&(c=e,conquer&&conquer.Sounds[n].mute(e),c&&s?u.stop(s):c||!contains(r)||d||(s=null,doPlay(r)))}}var SOUNDS=new function(){var n=this;let e=1;n.mappings={};var o=!1;function setCue(e,o){let u=[],t=!1;for(let e in o){let i=n.getMp3(o[e]);i&&(t=!0,u.push(i))}t&&(n.mappings[e]=new Cue(!0)).copy(u)}function refresh(){let n=get("MusicMute");MUSIC.mute(n),n=get("SoundMute"),SFX.mute(n),VOICE.mute(n),AMBIANCE.mute(n)}function enableSounds(){off("TOUCH:onPress",enableSounds),SFX.enable(),VOICE.enable(),AMBIANCE.enable(),MUSIC.enable()}n.init=function(){if(!o){o=!0;var e=TOY.entity;e.addComponent("sound"),n.component=e.sound,n.component.positional=!1,APP.on("volumeChanged",(function(e){n.setVolume(e)})),window.onfocus=function(){n.setVolume(1)},window.onblur=function(){n.setVolume(0)},CONFIG.DEBUG.muteSounds&&n.mute(),conquer.Sounds.init&&conquer.Sounds.init(CONFIG.SOUNDS);for(let n in CONFIG.SOUNDS)setCue(n,CONFIG.SOUNDS[n]);on("TOUCH:onPress",enableSounds),on("MusicMute",refresh),on("SoundMute",refresh),on("SOUNDS:Mute",(function(e){if(e)return n.mute();n.unmute()})),refresh()}},n.findMP3=function(e){if(n.mappings[e])return!0;if(!(e=n.getMp3(e)))return;(n.mappings[e]=new Cue(!0)).push(e)},n.getMp3=function(e){let o=ASSETS.findMP3(e);if(o)return n.component.addSlot(e,{volume:1,startTime:0,duration:null,overlap:!0,autoPlay:!1,asset:o}),e},n.setVolume=function(o){e=o,conquer&&conquer.Sounds.setVolume(o),n.isMuted||(APP.systems.sound.volume=o)},n.mute=function(){conquer&&conquer.Sounds.mute(),n.isMuted=!0,APP.systems.sound.volume=0},n.unmute=function(){conquer&&conquer.Sounds.unmute(),n.isMuted=!1,APP.systems.sound.volume=e}},SFX=new SoundChannel("SFX"),VOICE=new SoundChannel("Voice"),AMBIANCE=new SoundChannel("Ambiance"),MUSIC=new SoundChannel("Music");var ACTIONS={MESSAGE:0,GAMEDATA:1,PLAYERJOIN:2,PLAYERLEFT:3,PLAYERVARS:4,SYNCREQUEST:5,GAMESTART:6,ROOMREADY:7,ROOMSTATUS:8,PLAYERSTATUS:9,TIME:10,TIMER:11,LOADING:12,PLAYERSTATE:13,INSYNC:14,ENTRY:15,CALL:16,ACCEPT_CALL:17,REJECT_CALL:18,AUTH_SET:19,AUTH_GET:20,FILE_SET:21,FILE_GET:22,ROOM_SET:231,ROOM_GET:23,ROOM_GETONE:24,ROOM_ENTRIES_GET:25,ROOM_ENTRIES_SET:26,ROOM_ENTRIES_CHANGE:27,ROOM_ENTRIES_REMOVE:28,FRIENDS_GET:29,FRIENDS_SET:30,FRIENDS_CHANGE:31,FRIENDS_REMOVE:32,CHAT:33,ANALYTICS_SET:34,ANALYTICS_GET:35,FOLLOWERS_GET:36,FOLLOWERS_SET:37,FOLLOWERS_REMOVE:38,GAME_GETONE:39,GAME_DATA_GET:43,GAME_DATA_SET:44,GAME_SCORE_SET:45,GAME_SCORE_GET:46,GAME_SCORE_GETALLTIME:47,GAME_SCORE_GETTODAY:48,GAME_SCORE_GETFRIENDSALLTIME:49,GAME_SCORE_GETFRIENDSTODAY:50,MATCHMAKING:51,TOURNAMENT_GET:52,TOURNAMENT_ENTRIES_GET:53,GAME_TURN_SET:54,GAME_TURN_GET:55,GAME_TURN_GETONE:56,GAME_TURN_CHANGE:57,GAME_SHOP_GET:58,GAME_SHOP_SET:59,GAME_PLAYERINVENTORY_BUY:60,GAME_PLAYERINVENTORY_GET:61,GAME_PLAYERINVENTORY_CHANGE:62,GAME_PLAYERINVENTORY_REMOVE:63,GAME_CURRENCY_GET:64,GAME_CURRENCY_GETONE:65,GAME_CURRENCY_CHANGE:66,GAME_DAILYREWARDS_GET:67,GAME_DAILYREWARDS_SET:68,INSTANCE_GETONE:69,INSTANCE_GET:70,TAG_ASSOCIATIONS_GET:71,TAG_ASSOCIATIONS_SET:72,AWESOME_GETONE:73,AWESOME_SET:74,STATS_GETONE:75,AVATAR_GET:76,AVATAR_GETONE:77,WALLET_GETSET:78,WALLET_HISTORY_GET:79,WALLET_ASSETS_GET:80,WALLET_SEND:81,SOCIAL_TWITTER_SHARE:82,SOCIAL_GOOGLE_SHARE:83,SOCIAL_GOOGLE_SHARE_GET:84,SOCIAL_DISCORD_SHARE:85,SOCIAL_DISCORD_SHARE_GET:86,EMAIL_SEND:87,NFT_COLLECTION_GET:88,NFT_COLLECTION_MINT:89,NFT_TOKEN_GET:90,NFT_TOKEN_REMOVE:91,NFT_TOKEN_CHANGE:92,NFT_HISTORY_GET:93,GAME_DATA_REMOVE:94,GAME_TURN_REMOVE:95,GAME_SET:96,AVATAR_PHOTO_SET:97,AVATAR_PHOTO_GET:98,SNAPPY_SET:99,SNAPPY_GETONE:100,BOT_GET:101,BOT_SET:102,GAME_MISSIONS_SET:103,GAME_MISSIONS_GET:104,get:function(E){for(var T in ACTIONS)if(ACTIONS[T]==E)return T}},STATUS={LOBBY:0,WAITING:1,COUNTDOWN:2,PLAYING:3,GAMEOVER:4,PLAYERSREADY:5,RESET:6};function SnappyPart(e,n,t){var a,r,l=this,i=n[0],o=i.tabID,s=t.data,f=i.symmetry,c=[];f?(r=e.findByName(o+"L"),a=e.findByName(o+"R")):r=e.findByName(o),l.load=function(){},l.save=function(){},l.refresh=function(){for(let e in c)c[e].refresh()},l.clear=function(){for(let e in c)c[e].clear()},l.changeVisible=function(e){for(let n in c)c[n].changeVisible(e)},l.control=function(e){var n=s.parts[o],t=n.pos,a=n.sca;let r=e.mode;"Wider"==r&&a.x<e.max&&(a.x+=.01),"Thinner"==r&&a.x>e.min&&(a.x-=.01),"Taller"==r&&a.y<e.max&&(a.y+=.01),"Shorter"==r&&a.y>e.min&&(a.y-=.01),"Grow"==r&&(a.x<e.max&&(a.x+=.01),a.y<e.max&&(a.y+=.01),a.z<e.max&&(a.z+=.01)),"Shrink"==r&&(a.x>e.min&&(a.x-=.01),a.y>e.min&&(a.y-=.01),a.z>e.min&&(a.z-=.01)),"Up"==r&&t.y<e.max&&(t.y+=.001),"Down"==r&&t.y>e.min&&(t.y-=.001),"Left"==r&&t.x<e.max&&(t.x+=.001),"Right"==r&&t.x>e.min&&(t.x-=.001);for(let e in t)t[e]=Math.round(1e3*t[e])/1e3;for(let e in a)a[e]=Math.round(1e3*a[e])/1e3;for(let e in c)c[e].refresh()},l.fill=function(e){if(e<=0){for(let e in c)c[e].clear();return}let n=s.parts[o],t="_";i.isBodied&&(t+=s.body+"_");let a=o.toLowerCase()+t+STRING.fillZero(e,2);a!=n.asset&&(n.asset=a,l.refill())},l.refreshBody=function(){let e=s.parts[o];if(!i.isBodied||!e.asset)return;let n="_"+s.body+"_",t=e.asset;if(t.includes(n))return;let a="_m_"==n?"_f_":"_m_";e.asset=STRING.doReplace(t,a,n),l.refill()},l.refill=function(){for(let e in c)c[e].refill()},r&&(r=new AvatarControllerInstance(o,r,e.findByName(o+"Container"),!1,t),c.push(r),a&&(a=new AvatarControllerInstance(o,a,null,!0,t),c.push(a)))}function AvatarControllerInstance(e,n,t,a,r){var l=this,i=r.data,o=n.findByName("model");a=a?-1:1,t=t||n,getLocals(n),getLocals(t),l.refill=function(){let n=i.parts[e];o&&(o.enabled=!1),n.asset&&CONTENT.fillModel(o,n.asset,(function(){l.refresh(),"Head"==e&&r.refreshFace()}))},l.changeVisible=function(n){i.parts[e]&&i.parts[e].asset&&(o.enabled=n)},l.clear=function(){i&&i.parts[e]&&(i.parts[e].asset=null),o&&(o.enabled=!1)},l.refresh=function(){var n=i.parts[e],r=n.pos,l=n.sca,s=t.sca,f=t.pos;if(t.setLocalScale(s.x*l.x,s.y*l.y,s.z*l.z),t.setLocalPosition(f.x+r.x*a,f.y+r.y,f.z),o&&o.enabled)for(let e in i.color)o.tags._list.includes(e)&&fillMaterial(o,i.color[e])},l.clear()}var AnimationLayerController=function(){var n,t,a,i,e,o,r=this,c=(r.isStopped=!0,r.label=!0),l={},s=!1;function animOnceID(){return t.entity._guid+a+"ANIMONCE"}r.fill=function(e,o,r,c){a=e,n=o,t=r,i=c},r.play=function(u,m){if(m=m||{},(!s||m.important)&&u&&c!=u)return c=r.label=u,cancel(animOnceID()),m&&m.important&&(s=!0),l[c]?doIt():(ANIMLIB.get(c,(function(t){"base"!=a?n.assignAnimation(c,t,i.name):n.assignAnimation(c,t),function createComponent(){if(o)return;if("base"==a)return void(o=n.baseLayer);e={};for(const n of i.masks)e[n]={children:!0};(o=n.addLayer(i.name,i.weight,void 0,i.blendType)).mask=e}(),l[c]=t,doIt()})),!0);function doIt(){return o.transition(c,.2),r.isStopped=!1,!m.playOnce||(unique(animOnceID(),(function(){r.stop(),t.handlePlayonceFinish(a),m.callback&&m.callback()}),l[c].duration*(m.stopAt||.985)),!0)}},r.stop=function(){r.removeImportantMark(),r.isStopped=!0,c=r.label=null,cancel(animOnceID())},r.removeImportantMark=function(){s=!1}};var FACEMAKER,FaceMaker=pc.createScript("faceMaker");FaceMaker.prototype.initialize=function(){var e,t,a,r=this,n=r.entity;FACEMAKER=r;var o,s,i,l=n.findByName("Export"),y=n.findByName("Face"),f=n.findByName("UserPhoto");getLocals(f),f.enabled=!1;var p=new SnappyFace(f,r);y.enabled=!0;var E,u={},h=!0;r.export=function(){E||(fire("INVENTORY:onLoading"),unique("exportFace",(function(){log("EXPORT FACE"),function doExport(){log("FACE:doExport"),h=!1,e=TEXTURE.renderLayersToTexture(["STICKER"],null,512,512,!0),l.element.texture=e,SNAPPYFACES.setTexture("FaceMaker",e)}(),E=!1,fire("INVENTORY:onLoaded")}),h?.3:.01))},r.setSnappy=function(e){a=(t=e).data,o=new FaceControllerInstance("Eye",n.findByName("EyeL"),!0,a),s=new FaceControllerInstance("Eye",n.findByName("EyeR"),!1,a),i=new FaceControllerInstance("Mouth",n.findByName("Mouth"),!1,a);for(let e in CONFIG.SNAPPY)u[CONFIG.SNAPPY[e][0].tabID]=new SnappyPart(f,CONFIG.SNAPPY[e],t)},r.load=function(){i.fill("Mouth",{mouth:a.parts.Mouth.asset});var e=a.parts.Eye,t={iris:e.iris,eyeshape:e.asset};e.eyelash&&(t.eyelash=e.eyelash),o.fill("Eye",t),s.fill("Eye",t),r.export()},r.fill=function(e,t){let n,l=STRING.fillZero(t.id+1,2);if("Mouth"==e){if(n="mouth_"+l,a.parts.Mouth.asset==n)return;return a.parts.Mouth.asset=n,i.fill(e,{mouth:n}),r.export()}if("Eye"==e){let i={};if(t.isExtra){if(n="blackeye_"+l,a.parts.Eye.asset==n)return;a.parts.Eye.iris=!1,a.parts.Eye.asset=n,delete a.parts.Eye.eyelash,i={eyeshape:n,iris:!1}}else{if(n="eyeshape_"+l,a.parts.Eye.asset==n)return;a.parts.Eye.iris=!0,a.parts.Eye.asset=n,a.parts.Eye.eyelash="eyelash_"+l,i={eyeshape:n,eyelash:a.parts.Eye.eyelash,shapemask:n,iris:!0}}return o.fill(e,i),s.fill(e,i),r.export()}},r.control=function(e,t){let n=t.mode,l=a.parts[e],y=l.pos,f=l.sca;"Wider"==n&&f.x<t.max&&(f.x+=.05),"Thinner"==n&&f.x>t.min&&(f.x-=.05),"Taller"==n&&f.y<t.max&&(f.y+=.05),"Shorter"==n&&f.y>t.min&&(f.y-=.05),"Grow"==n&&(f.x<t.max&&(f.x+=.05),f.y<t.max&&(f.y+=.05),f.z<t.max&&(f.z+=.05)),"Shrink"==n&&(f.x>t.min&&(f.x-=.05),f.y>t.min&&(f.y-=.05),f.z>t.min&&(f.z-=.05)),"Up"==n&&y.y<t.max&&(y.y+=.05),"Down"==n&&y.y>t.min&&(y.y-=.05),"Left"==n&&y.x>t.min&&(y.x-=.05),"Right"==n&&y.x<t.max&&(y.x+=.05),"Eye"==e&&(o.refresh(),s.refresh()),"Mouth"==e&&i.refresh(),r.export()},r.refreshEyeColor=function(){o.refreshColor(),s.refreshColor(),r.export()},r.getBase64=function(){return TEXTURE.textureToBase64(TEXTURE.renderLayersToTexture(["STICKER"],null,512,512))},r.getUserPhoto64=function(e){log("getUserPhoto64"),y.enabled=!1,f.enabled=!0;for(let e in u)u[e].refill();p.set("FaceMaker",!0),delay((function(){e(r.getBase64()),y.enabled=!0,f.enabled=!1}),.5)},r.save=function(a){var n={};e=n.snappyFace64=r.getBase64(),SNAPPYFACES.save(t.Avatar.avatarID),r.getUserPhoto64((function(e){n.userPhoto64=e,a(n)}))}};// disable-scenes.js
// const app = pc.Application.getApplication();
// app.on('start', disableToyScenes);
// function disableToyScenes()
// {
//     console.log('DISABLE')
//     const scenes = app.root.findByName('SCENES');
//     scenes.children.forEach(child => child.enabled = false);
// }

function FaceControllerInstance(e,r,l,o){var n=this,s=l?-1:1;getLocals(r);var a=r.findByName("IrisFill"),i=r.findByName("Iris"),t=r.findByName("eyelashTexture");n.fill=function(e,l){"Eye"==e&&(i.enabled=t.enabled=l.iris),CONTENT.fill(r,l),n.refresh()},n.refresh=function(){var l=o.parts[e],a=l.pos,i=l.sca,t=r.sca,c=r.pos;r.setLocalScale(t.x*i.x,t.y*i.y,t.z*i.z),r.setLocalPosition(c.x+a.x*s*100,c.y+100*a.y,c.z),n.refreshColor()},n.refreshColor=function(){if(!a)return;let e=o.color.Eye;e&&(a.element.color=COLOR.get(e))}}var TITLE=new function(){var e=this;on("PLAYERS:onNext",(function(t){e.show({template:"GetReady",title:t.fullName.toUpperCase()+"'s",subtitle:"TURN"})})),e.show=function(e){OVERLAYS.show("TITLE",e)}},DisplayerTitle=pc.createScript("displayerTitle");DisplayerTitle.prototype.initialize=function(){var e=this;SCREEN.call(e);var t,l,o=e.entity,i=o.findByName("Container"),s=o.findByName("Titles"),a=o.findByName("titleShadow"),n=o.findByName("titleField"),r=o.findByName("subtitleShadow"),u=o.findByName("subtitleField"),O=o.findByName("Base"),c=o.findByName("Top"),C=o.findByName("Bottom"),F=[];getLocals(i),getLocals(a),getLocals(r),getLocals(O),getLocals(c),getLocals(C);var p=e.templates={},L={pos:i.pos,rot:new pc.Vec3(0,0,0),baseColor:COLOR.get("#FFFFFF"),borderColor:COLOR.get("#FFFFFF"),titleColor:COLOR.get("#FFFFFF"),subtitleColor:COLOR.get("#FFFFFF"),subtitleScale:1,titleScale:1,time:1};function pushTemplate(e){p[e.id]=ARRAY.merge(e,L)}function Out(){ANIMATION.fadeOut(C),ANIMATION.moveTo(C,{x:500,y:C.pos.y,z:0}),ANIMATION.fadeOut(c),ANIMATION.moveTo(c,{x:-500,y:c.pos.y,z:0}),unique(F.shift(),(function(){ANIMATION.fadeOut(O,null,null,.6),ANIMATION.moveTo(O,{x:500,y:0,z:0})}),.4)}pushTemplate({id:"Title",title:"TITLE",subtitle:"SUBTITLE"}),pushTemplate({id:"GetReady",title:"READY",subtitleColor:COLOR.get("#F303B7"),subtitleScale:.5}),pushTemplate({id:"Excellent",title:"EXCELLENT",baseColor:COLOR.get("#fad11f"),borderColor:COLOR.get("#fad11f"),time:.1}),pushTemplate({id:"Strike",title:"STRIKE",baseColor:COLOR.get("#FFBF00"),borderColor:COLOR.get("#FFEA00"),time:4.2,subtitleColor:COLOR.get("#F303B7"),subtitleScale:.5}),pushTemplate({id:"Spare",title:"SPARE",baseColor:COLOR.get("#12BAFF"),borderColor:COLOR.get("#0CE1FF"),time:4.2,subtitleColor:COLOR.get("#F303B7"),subtitleScale:.5}),pushTemplate({id:"Victory",title:"VICTORY",pos:new pc.Vec3(0,100,0),baseColor:COLOR.get("#CA00FF"),borderColor:COLOR.get("#EA00FF"),time:5}),pushTemplate({id:"LastWind",title:"LAST",subtitle:"WIND",pos:new pc.Vec3(0,-150,0),baseColor:COLOR.get("#68c044"),borderColor:COLOR.get("#a5ce39"),titleColor:COLOR.get("#fcdf63"),subtitleColor:COLOR.get("#ee2162"),time:2}),pushTemplate({id:"TryAgain",title:"TRY",subtitle:"AGAIN",baseColor:COLOR.get("#EE2162"),borderColor:COLOR.get("#EE2162"),titleColor:COLOR.get("#fad11f"),subtitleColor:COLOR.get("#fad11f")}),pushTemplate({id:"Strike2",title:"STRIKE",titleColor:COLOR.get("#FF006A"),subtitleScale:.5}),pushTemplate({id:"Level",title:"PINK",baseColor:COLOR.get("#00B5FF"),borderColor:COLOR.get("#00FFEA"),titleColor:COLOR.get("#FFFFFF"),subtitleColor:COLOR.get("#FFFFFF")}),pushTemplate({id:"Booster",title:"PINK",subtitleScale:.5,baseColor:COLOR.get("#FFEA00"),borderColor:COLOR.get("#FFFF00"),titleColor:COLOR.get("#FF00AA"),subtitleColor:COLOR.get("#FFFFFF")}),e.onShow=function(o){t=o||{template:"Title"},(l=ARRAY.merge(t,p[t.template]||p.Title)).title&&(l.title=l.title.toUpperCase()),l.subtitle&&(l.subtitle=l.subtitle.toUpperCase()),function Animate(){F=["t1","t2","t3","t4","t5","t6","t7","t8","t9","t10"],cancel(F),function reset(){i.setLocalPosition(l.pos),i.setLocalEulerAngles(l.rot),resetLocals(a),resetLocals(r),s.enabled=!0,a.setLocalPosition(-300,a.pos.y,0),a.enabled=r.enabled=!1,O.element.opacity=0,c.element.opacity=C.element.opacity=0,O.element.color=l.baseColor,c.element.color=C.element.color=l.borderColor,n.element.color=l.titleColor,u.element.color=l.subtitleColor,e.titlePosY=a.pos.y,e.subtitlePosY=r.pos.y,O.setLocalPosition(-500,0,0),c.setLocalPosition(500,c.pos.y,0),C.setLocalPosition(-500,C.pos.y,0);var t=l.subtitleScale;r.setLocalScale(t,t,t);var o=l.titleScale;if(a.setLocalScale(o,o,o),!l.subtitle)return e.titlePosY=0,void a.setLocalScale(1.3,1.3,1.3);t<1&&(e.titlePosY=40,e.subtitlePosY=-85,a.setLocalScale(1.1,1.1,1.1));o<1&&(e.titlePosY=100,e.subtitlePosY=-30,r.setLocalScale(1.3,1.3,1.3))}(),function In(){ANIMATION.fadeIn(O,null,null,.6),ANIMATION.moveTo(O,O.pos,1,EASING.ElasticOut),unique(F.shift(),(function(){ANIMATION.fadeIn(c,null,null,.9),ANIMATION.fadeIn(C,null,null,.9),ANIMATION.moveTo(c,c.pos,1,EASING.ElasticOut),ANIMATION.moveTo(C,C.pos,1,EASING.ElasticOut)}),.3)}(),function TitleIn(){if(fill(i,l),a.enabled=!0,a.setLocalPosition(-300,e.titlePosY,0),r.setLocalPosition(300,e.subtitlePosY,0),ANIMATION.moveTo(a,new pc.Vec3(0,e.titlePosY,0),1,EASING.ElasticOut),unique(F.shift(),(function(){ANIMATION.blink(s,3*l.time,.1,!0,"Blink")}),1),!l.subtitle)return;unique(F.shift(),(function(){r.enabled=!0,r.setLocalPosition(300,e.subtitlePosY,0),ANIMATION.moveTo(r,new pc.Vec3(0,e.subtitlePosY,0),1,EASING.ElasticOut)}),.2)}(),unique(F.shift(),Out,.6+.6*l.time),unique(F.shift(),OVERLAYS.hide,1.3+1.7*l.time)}()}};var SaveLoadForm=pc.createScript("saveLoadForm");SaveLoadForm.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),SaveLoadForm.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),SaveLoadForm.prototype.initialize=function(){var e=document.createElement("style");document.head.appendChild(e),e.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container"),this.div.innerHTML=this.html.resource||"",document.body.appendChild(this.div);var t=this.div.querySelector("#textField");this.onMouseDown=function(e){var a=e.label;if("LoadButton"==a){if(!t.value)return;fire("SNAPPY:Load",JSON.parse(t.value))}"SaveButton"==a&&fire("SNAPPY:Save")},on("SNAPPY:onSave",(function(e){log(e),t.value=JSON.stringify(e)}))};var UserXp=pc.createScript("userXp");UserXp.prototype.postInitialize=function(){var o=this;o.entity;function show(){GAME.UserXP&&fill(o,{userPhoto:ME.userPhoto,firstName:ME.firstName})}on("UI:onHome",show),show(),o.onMouseDown=function(){PLATFORM.isLogged((function(){POPUPS.show("Profile")}))},o.collect=function(t,e){if(t){var i={sprite:"Symbol_XP",follow:localToLocal(o.entity,UI.FX),time:2,amount:MATH.hardLimit(t,0,10)};e||(e=pc.Vec3.ZERO),i.x=e.x,i.y=e.y,i.z=e.z}}};class TextureCamera extends pc.ScriptType{initialize(){const e=this.app,r=this.entity.camera,a=new pc.Texture(e.graphicsDevice,{width:512,height:512,format:pc.PIXELFORMAT_RGB8,mipmaps:!0,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE}),t=new pc.RenderTarget({name:"RT",colorBuffer:a,depth:!0,flipY:!0,samples:2});r.renderTarget=t;const i=e.root.findByName("Screen").render.material;i.emissiveMap=a,i.update(),log("WHAT"),TEXTURE.base64Download(TEXTURE.textureToBase64(a))}}pc.registerScript(TextureCamera,"textureCamera");var PopupProfile=pc.createScript("popupProfile");PopupProfile.prototype.postInitialize=function(){var e=this,t=e.entity,r=t.findByName("UserBox"),a=getChildScript(t,"Gallery","gallery"),o=(t.findByName("Content"),getChildScript(t,"Bar","bar"));SCREEN.call(e),e.userStats=[],e.onShow=function(){fill(r,{userPhoto:ME.userPhoto,fullName:ME.fullName,rank:GAME.UserXP.rank,level:GAME.UserXP.level});var e=CONFIG.PROFILE,t=[];for(var l in e){var i=extract(e[l]);i.value=get(i.varName),i.varNameBase&&(i.value+=" / "+get(i.varNameBase)),t.push(i)}a.fill(t);a.posY;if(!GAME.UserXP.isComplete)return o.setAmount(GAME.UserXP.value,GAME.UserXP.min,GAME.UserXP.max);o.setPercent(100,!0),o.entity.findByName("amountField").element.text="MAX"},e.onMouseDown=function(e){let t=e.label;POPUPS.hide(),"LogoutButton"==t&&(conquer.Auth.logout(),UI.showLoader())}};var SnappyMaker=pc.createScript("snappyMaker");SnappyMaker.prototype.postInitialize=function(){var e=this,t=e.entity;SCREEN.call(e);t.findByName("Interface");var o,l=getChildScript(t,"GalleryTabs","galleryTabs"),a=t.findByName("titleField"),r=getChildScript(t,"InventoryGallery","scrollGallery"),n=getChildScript(t,"ColorGallery","scrollGallery"),i=getChildScript(t,"ControlsGallery","scrollGallery"),s={},c={};function onTabDown(e){var t=e.data;if(a.element.text=t.title,r.Gallery.clear(),r.entity.enabled=!1,n.Gallery.clear(),n.entity.enabled=!1,i.Gallery.clear(),i.entity.enabled=!1,t.palette){var l=COLOR.PALETTES[t.palette];let e=c[o];if(!e){e=[];for(let o in l)e.push({color:l[o],colorTag:t.colorTag});c[o]=e}return n.entity.enabled=!0,void n.fill(e,onColorDown)}if(t.controls){let e=[];for(let l in t.controls){let a=t.controls[l],r=a.id;"Scale"==r&&(e.push(extract(a,{mode:"Grow",symbol:"Symbol_Grow",tabID:o})),e.push(extract(a,{mode:"Shrink",symbol:"Symbol_Shrink",tabID:o}))),"Width"==r&&(e.push(extract(a,{mode:"Wider",symbol:"Symbol_Wider",tabID:o})),e.push(extract(a,{mode:"Thinner",symbol:"Symbol_Thinner",tabID:o}))),"Height"==r&&(e.push(extract(a,{mode:"Taller",symbol:"Symbol_Taller",tabID:o})),e.push(extract(a,{mode:"Shorter",symbol:"Symbol_Shorter",tabID:o}))),"Horizontal"==r&&(e.push(extract(a,{mode:"Left",symbol:"Symbol_Left",tabID:o})),e.push(extract(a,{mode:"Right",symbol:"Symbol_Right",tabID:o}))),"Vertical"==r&&(e.push(extract(a,{mode:"Up",symbol:"Symbol_Up",tabID:o})),e.push(extract(a,{mode:"Down",symbol:"Symbol_Down",tabID:o})))}return i.entity.enabled=!0,void i.fill(e)}let y=[];for(o=t.tabID;y.length<t.amount;)pushItem(y.length);if(t.extra)for(let e=0;e<t.extra;e++)pushItem(e,t.extraLabel);function pushItem(e,o){let l="_";t.isBodied&&(l+=get("SnappyBody")+"_");let a=(o?o.toLowerCase():t.tabID.toLowerCase())+l+STRING.fillZero(e+1,2);y.push({tabID:t.tabID,symbol:a,id:e,isExtra:o})}t.hasEmpty&&y.unshift({tabID:t.tabID,symbol:"Symbol_Cancel",symbolColor:"#A6B8CE",id:-1}),s[t.tabID]=y,setCamera(t.camera),y,r.entity.enabled=!0,r.fill(y,onAvatarInventoryDown)}e.onShow=function(){MUSIC.play("SnappyMaker"),l.fill(CONFIG.SNAPPY,onTabDown),NAV.show(),TOP.hide(),onResize()},e.onHide=function(){fire("CINEMACAMERAS:StopOverlay")},e.onMousePress=function(e,t){"DragButton"==e.label&&fire("SNAPPY:StartDrag",t)};let y,b=["Shirt","Jacket","Pants","Belt","Tie"];function onAvatarInventoryDown(e){var t=e.data,o=s[t.tabID];for(let e in o)o[e].selected=!1;t.selected=!0;let l=t.tabID;"Body"==l&&fire("SNAPPY:onBody",t.id),b.includes(l)&&chance(.4)&&fire("SNAPPY:ShortAnim","Fashion1"),"Shoe"==l&&chance(.4)&&fire("SNAPPY:ShortAnim",getRandomItem(["Fashion2","Fashion3"])),r.Gallery.refresh(),fire("SNAPPY:Fill",t.tabID,t.id+1,t)}function onColorDown(e){var t=e.data,o=c[t.tabID];for(let e in o)o[e].selected=!1;t.selected=!0,n.Gallery.refresh(),fire("SNAPPY:onColor",t)}function setCamera(e){fire("SNAPPY:ResetDrag")}function onResize(){t.enabled&&(y=UISIZE.isLandscape,setCamera())}function selectBot(e){log("BOT SELECTED",e),fire("SNAPPY:FillPlayer",e)}on("UI:onResize",onResize),on("SNAPPY:BotSelector",(function(){POPUPS.show("BotSelector",{callback:selectBot})}))};var HUNT=new function(){var n,e="$C_HCollected";function onTimeUp(){display("HuntReady",1)}on("TOY:onFinalize",(function init(){n=TIMER.spawn({id:"HuntTimer",persistent:!0,duration:144e5,onTimeUp:onTimeUp,onSecond:!0,autoStart:!0}),get(e)||onTimeUp()})),on("HUNT:Play",(function onPlay(){set(e,!0),display("HuntReady",0),n.start()})),on("HUNT:Show",(function(){PLATFORM.isLogged((function(){SCREENS.show("Hunt")}))}))},ScreenHunt=pc.createScript("screenHunt");ScreenHunt.prototype.initialize=function(){var n,e=this,t=e.entity,o=getChildScript(t,"Bar","barStars"),i=(t.findByName("Header"),t.findByName("Container")),a=t.findByName("Rewards"),r=0,d=t.findByName("daysField");function onSecond(n){d.enabled=!0,d.element.text="Play again in "+DATE.days(1e3*n)}function exit(){off("HuntTimer:onSecond",onSecond),c.reset(),SCREENS.show("Home")}SCREEN.call(e),e.onShow=function(){if(c.reset(),TOP.hide(),MUSIC.play("Hunt"),get("HuntReady"))return c.start();c.lock()};var c={};c.reset=function(){CAMERA.FX.stop(),i.enabled=!1,d.enabled=!1,r=DATA.display("HuntRound",0),n=!1,display("EnergyReward",0),display("CoinReward",0),display("GemReward",0),o.setAmount(r),fire("HUNT:State","reset")},c.lock=function(){fire("HUNT:State","lock"),i.enabled=!1,on("HuntTimer:onSecond",onSecond),function showExit(){UI.unblock(),NAV.showSmart({template:"Exit",onAction1:function(){SCREENS.show("Home")}})}()},c.start=function(){i.enabled=!0,NAV.hide(),fire("HUNT:State","start")},on("HUNT:Intro",(function(){c.Intro()})),c.Intro=function(){UPSALE.huntIntro((function(n){if(!n)return SCREENS.show("Home");UI.block(),fire("HUNT:Play"),fire("HUNT:State","play")}))},on("HUNT:onSelection",(function onSelection(e){if(UI.block(),e)return doContinue();if(n)return exit();function doContinue(){CAMERA.FX.stop(),e&&(SFX.play("Ding"),r=DATA.displayIncrease("HuntRound",1),o.setAmount(r)),UI.block(),r>=9&&c.end(),fire("HUNT:CardsOut")}CAMERA.FX.grayscale(),delay((function(){UPSALE.revive((function(e){if(!e)return exit();n=!0,doContinue()}))}),1)})),c.end=function(){fire("HUNT:State","end"),NAV.hide(),delay((function(){let n;TOP.show(),FX3D.CONFETTI.play({z:7});let e=a.getLocalPosition();n=get("EnergyReward"),n&&WALLET.Energy.collect(n,e,!0),n=get("CoinReward"),n&&WALLET.Coin.collect(n,e,!0),n=get("GemReward"),n&&WALLET.Gem.collect(n,e,!0),display("EnergyReward",0),display("CoinReward",0),display("GemReward",0),c.lock()}),1)}};var SNAPPY,Snappy=pc.createScript("snappy");Snappy.attributes.add("ForceFill",{type:"string",enum:[{ME:"ME"},{RIVAL:"RIVAL"},{BOT:"BOT"},{PUPPET:"PUPPET"},{NONE:"NONE"}],default:"NONE"}),Snappy.attributes.add("defaultAnimation",{title:"Default Animation",type:"string"}),Snappy.attributes.add("defaultFace",{title:"Default Face",type:"string"}),Snappy.attributes.add("isRealtime",{type:"boolean",default:!0}),Snappy.attributes.add("faceMaker",{title:"Face Maker",type:"entity"}),Snappy.attributes.add("isEditable",{title:"Is Editable",type:"boolean"}),Snappy.attributes.add("saveToConquer",{title:"Save to Conquer",type:"boolean"}),Snappy.attributes.add("refillEvent",{title:"Refill Event",type:"string"}),Snappy.prototype.initialize=function(){var e,t=this,a=t.entity,n=t.data={color:{},parts:{Mouth:{asset:"mouth_001"}},body:"m",snappyFace:null,snappyFace64:null,userPhoto:null},o=new SnappyFace(a);a.script.animationController||a.script.create("animationController");var r,i,l,s=t.animationController=a.script.animationController,c={};for(let e in CONFIG.SNAPPY)c[CONFIG.SNAPPY[e][0].tabID]=new SnappyPart(a,CONFIG.SNAPPY[e],t);a.findByName("root");var p,d,f=a.findByName("Hand.L"),u=a.findByName("Hand.R");function refill(){t.fill()}function onAvatar(e){return(i=t.Avatar=e)?(t.avatarID=i.avatarID,r=i==ME,s.isME=r,l=null,t.defaultAnimation&&t.setAnimation(t.defaultAnimation),d?(d=!1,n.avatarID=t.avatarID,n.firstName=i.firstName,n.lastName=i.lastName,void doSave()):void i.Snappy.get().then((function(e){t.load(e)}))):t.load({color:{},parts:{Mouth:{asset:"mouth_001"}},body:"m",snappyFace:null,snappyFace64:null,userPhoto:null})}if(t.refillEvent&&on(t.refillEvent,(function(){refill()})),a.on("destroy",(function(){off("CHARACTERS:Refresh",refill)})),t.onUpdate=function(){!function refreshVisible(){let e=UISIZE.frustum(a.getPosition());if(e==p)return;p=e,f.enabled=u.enabled=e;for(let t in c)c[t].changeVisible(e)}(),i&&t.isRealtime&&t.setAnimation(i.vars.animation)},t.setAnimation=function(e,t){e&&l!=e&&((l=e).includes("Dance")&&GAME.Inventory.tabs.Dance&&("Dance"==l&&(l=getRandomItem(GAME.Inventory.tabs.Dance.items).key),"DanceInventory"==l&&(l=GAME.Inventory.selected.Dance)),i&&(i.vars.animation=l),s.play(l,t))},t.stop=function(){l=null,i&&(i.vars.animation=null),s.stop()},t.setFace=function(e,t){o.set(e,t)},t.unlockFace=function(){o.unlock()},t.refreshFace=function(){o.refreshMesh()},t.fill=function(e){return"ME"!=t.ForceFill||e?"RIVAL"==t.ForceFill&&GAME.Rivals.RIVAL?onAvatar(GAME.Rivals.RIVAL):("BOT"==t.ForceFill&&conquer.Bots.get(1).then((function(e){return onAvatar(e[0])})),void onAvatar(e)):onAvatar(ME)},t.load=function(a){for(var o in delete n.snappyFace,delete n.userPhoto,n)delete n[o];extract(ARRAY.deepClone(a),n),function processData(t){for(let e in CONFIG.SNAPPY){let n=CONFIG.SNAPPY[e][0].tabID;t.parts[n]||(t.parts[n]={});var a=t.parts[n];a.pos||(a.pos={x:0,y:0,z:0}),a.sca||(a.sca={x:1,y:1,z:1})}t.color||(t.color={});t.parts||(t.parts={});t.color.Body||(t.color.Body="DEFAULT");t.body||(t.body="m");e&&display("SnappyBody",t.body);t.parts.Body||(t.parts.Body={});t.parts.Body.asset||(t.parts.Body.asset="body_00"+("m"==t.body?1:2));t.parts.Head.asset||(t.parts.Head.asset="head_001");t.parts.Shoe.asset||(t.parts.Shoe.asset="shoe_002");t.parts.Eye.asset||(t.parts.Eye.asset="eyeshape_001",t.parts.Eye.eyelash="eyelash_001",t.parts.Eye.iris=!0)}(n),i&&(e&&t.isEditable?(e.load(),t.setFace("FaceMaker")):(SNAPPYFACES.setUrl(i.avatarID,n.snappyFace),t.setFace(t.defaultFace||i.avatarID)));for(let e in c)c[e].refill()},t.refillEvent||"NONE"==t.ForceFill||t.fill(),!t.faceMaker||!t.isEditable)return;let y,S;function doSave(){function onSave(){UI.unlock(),y=!1,SFX.play("Positive"),UI.hideLoader(),fire("SNAPPY:ShortAnim","Fashion1")}y||(y=!0,UI.lock(),UI.showLoader(),delay((function(){let a={color:n.color,parts:{}};for(var o in n.parts){let e=a.parts[o]=extract(n.parts[o]);e.pos&&0==e.pos.x&&0==e.pos.y&&0==e.pos.z&&delete e.pos,e.sca&&1==e.sca.x&&1==e.sca.y&&1==e.sca.z&&delete e.sca,e.asset||(e.asset=!1)}if(!t.saveToConquer)return onSave();e.save((function(e){extract(e,a),i.Snappy.set(a).then((function(e){log("SNAPPY SAVED=========="),log(JSON.stringify(e)),ASSETS.deleteLoaded(e.snappyFace),ASSETS.deleteLoaded(e.userPhoto)})),onSave()}))}),.4))}SNAPPY=t,(e=getScript(t.faceMaker,"faceMaker")).setSnappy(t),t.save=function(){if(PLATFORM.isLogged())return doSave();d=!0},on("SNAPPY:FillPlayer",(function(e){t.fill(e)})),on("SNAPPY:onBody",(function(e){n.body=0==e?"m":"f",display("SnappyBody",n.body);for(let e in c)c[e].refreshBody()})),on("SNAPPY:onColor",(function(t){let a=t.colorTag,o=t.color;if(n.color[a]!=o){n.color[a]=o;for(let e in c)c[e].refresh();"Eye"==a&&e.refreshEyeColor(o)}})),on("SNAPPY:clearColor",(function(e){delete n.color[e];for(let e in c)c[e].refresh()})),on("SNAPPY:Fill",(function(t,a,o){if("Eye"==t||"Mouth"==t)return e.fill(t,o);delete n.color[t],c[t]&&c[t].fill(a)})),on("SNAPPY:onControl",(function(e,t){c[e]&&c[e].control(t)})),on("SNAPPY:onControlPress",(function(t,a){if("Eye"==t||"Mouth"==t)return e.control(t,a)})),on("SNAPPY:Save",(function(){t.save()})),on("SNAPPY:Load",(function(e){t.load(e)})),on("SNAPPY:ShortAnim",(function(e){S||(S=!0,t.setAnimation(e),delayUnique(i.avatarID+"Anim",(function(){S=!1,t.setAnimation(t.defaultAnimation)}),2.4))}))},Snappy.prototype.update=function(){this.onUpdate()};var SceneHunt=pc.createScript("sceneHunt");SceneHunt.prototype.postInitialize=function(){var e,n,t=this.entity,o=t.findByName("CardsContainer"),a=getChildren(o),i={},l=t.findByName("Camera"),c=getScript(t.findByName("SkullCard"),"card"),y=[];for(var s in y.push({varName:"Coin",amount:1e3,symbol:"Symbol_Coin"}),y.push({varName:"Energy",amount:5,symbol:"Symbol_Energy"}),y.push({varName:"Gem",amount:5,symbol:"Symbol_Gem"}),y.push({varName:"Skull",amount:1,symbol:"Symbol_Skull"}),getLocals(l),i.reset=function(){c.entity.enabled=!1;for(var e=3;e>=0;e--){var n=a[e];n.GLOW.hide(),n.entity.enabled=!1}},i.onDown=function(n){UI.block(),n.ANIMATE.flip(),n.entity.findByName("Light").enabled=!0,ANIMATION.bounceScaleTo(n.entity,.7*n.entity.sca.x,n.entity.sca.x);var t=n.entity.pos;e="Skull"!=n.data.varName,delay((function(){ANIMATION.moveTo(n.entity,{x:t.x,y:t.y,z:t.z+50},1,EASING.ElasticOut),ANIMATION.bounceScaleTo(n.entity,.7*n.entity.sca.x,1.1*n.entity.sca.x);let o=n.entity.getPosition().clone();o.y+=1,e?(SFX.play("Positive"),SFX.playPitch("Cheers"),FX3D.SHOCKWAVE.play({position:o,rotation:new pc.Vec3(-90,0,0),time:.5,sprite:"FX_Condense"}),CAMERA.shake3D(.07,.07,.07),n.GLOW.good("#fad11f"),displayIncrease(n.data.varName+"Reward",n.data.amount)):(SFX.play("Negative"),SFX.play("Boo"),CAMERA.shake3D(.2,.2,.2),n.GLOW.bad(),FX2D.DAMAGE.play()),i.flip()}),.6),CAMERA.kick(0,-.2),delay((function(){fire("HUNT:onSelection",e)}),2)},on("HUNT:CardsOut",(function(){i.out()})),i.out=function(){e&&FX3D.CONFETTI.play({z:7,amount:4,scale:1.5});let t=l.pos;ANIMATION.moveTo(l,{x:t.x,y:t.y-3,z:t.z+2},2,EASING.ElasticOut);for(var o=e?-2e3:6e3,i=3;i>=0;i--){var c=a[i],y=c.entity;c.GLOW.hide(),doIt(y,.1*(3-i))}function doIt(e,n){delay((function(){SFX.playPitch("Throw2"),e.enabled=!0;let n=e.pos.clone();n.y+=o,ANIMATION.moveTo(e,n,.2,EASING.SineIn)}),n)}n||delay(u.next,.6)},i.deal=function(e){let n=l.pos;for(var t in ANIMATION.moveTo(l,{x:n.x,y:n.y-3,z:n.z+2},2,EASING.ElasticOut),y=ARRAY.shuffle(y),delay((function(){ANIMATION.moveTo(l,l.pos,2,EASING.ElasticOut)}),1),a){var o=a[t],i=o.entity;i.findByName("Light").enabled=!1,o.GLOW.hide(),o.fill(y[t]),i.enabled=!1,i.setLocalScale(i.sca);let n=i.pos;i.setLocalPosition(n.x,n.y,n.z+1e3),o.setFront(e),doDeal(i,.1*t)}function doDeal(e,n){delay((function(){e.enabled=!0;let n=e.pos;ANIMATION.moveTo(e,n,.5,EASING.SineIn,(function(){SFX.playPitch("Spawn"),CAMERA.kick(0,-.05),ANIMATION.moveTo(e,{x:n.x,y:n.y,z:n.z+30},.15,EASING.SineOut,(function(){ANIMATION.moveTo(e,n,.15,EASING.SineIn)}))}))}),n)}},i.flip=function(e){for(var n in a){let t=a[n];!e&&t.isFront||doFlip(t,.1*n+.2)}function doFlip(e,n){delay((function(){e.ANIMATE.flip()}),n)}delay(UI.unblock,1)},a){let e=a[s];e.enabled=!1,getLocals(e),a[s]=e.script.card,a[s].onCardDown=i.onDown}on("HUNT:State",(function doState(e){u[e]&&u[e]()}));var u={reset:function(){n=!1,i.reset()},start:function(){UI.block(),i.deal(!0),delay((function(){fire("HUNT:Intro")}),1.7)},play:function(){UI.block();let e=l.parent.getPosition().clone();ANIMATION.shakeIncrease(l.parent,e,.03,.03),SFX.play("Tension"),delay((function(){i.flip(!0)}),.45)},next:function(){UI.block(),i.deal(!1),delay(UI.unblock,1)},end:function(){UI.block(),n=!0},lock:function(){let e=l.pos;l.setLocalPosition(e),ANIMATION.moveTo(l,{x:e.x,y:e.y-3,z:e.z+2},1),c.entity.enabled=!0,c.fill({symbol:"Symbol_Skull"}),c.entity.findByName("symbolSprite").element.color=COLOR.get("RED"),delay((function flipSkull(){if(!t.enabled)return;c.ANIMATE.flip(),delay((()=>CAMERA.kick(0,-.1)),.35),delay(flipSkull,1)}),1)}}};var MySamplePiece=pc.createScript("mySamplePiece");MySamplePiece.prototype.initialize=function(){this.onMouseDown=function(e){var i=e.label;log("I WAS CLICKED",i)}};var EmotesLauncher=pc.createScript("emotesLauncher");EmotesLauncher.attributes.add("snappyMode",{title:"Snappy Mode",type:"boolean"}),EmotesLauncher.prototype.initialize=function(){var o=this,e=o.entity;let n=new EntityPool(e.findByName("Template"),"emoteDisplayer",e);var t=e.findByName("EmotesButton");function show(){t.enabled=!0,ANIMATION.bounceScale(t)}function onFinish(o){n.remove(o)}on("EMOTES:onEmote",(function onEmote(o){n.get(extract({onFinish:onFinish},o))})),on("EMOTES:onClose",show),on("UI:onGame",show),on("UI:onLobby",show),on("EMOTES:SetSnappyMode",(function setSnappyMode(e){o.snappyMode=e})),o.onMouseDown=function(e){t.enabled=!1,UNDERLAYS.show("Emotes",{snappyMode:o.snappyMode})}};var GridPiecesConfig=pc.createScript("gridPiecesConfig");GridPiecesConfig.attributes.add("list",{type:"json",schema:[{type:"string",name:"type",title:"Type",enum:[{Color:"Color"},{BombColor:"BombColor"},{BombColorBig:"BombColorBig"},{BombRadius:"BombRadius"},{BombRadiusBig:"BombRadiusBig"},{Line:"Line"},{LineBig:"LineBig"},{Cross:"Cross"},{CrossBig:"CrossBig"},{MidasBombRadius:"MidasBombRadius"},{MidasLine:"MidasLine"},{Crate:"Crate"},{Balloon:"Balloon"},{Boss:"Boss"}],default:"Color"},{title:"Id",name:"id",type:"string"},{title:"Color",name:"color",type:"string",enum:[{Custom:"Custom"},{Blue:"Blue"},{Green:"Green"},{Orange:"Orange"},{Purple:"Purple"},{Red:"Red"},{Yellow:"Yellow"}],default:"Custom"},{title:"Particle FX",name:"particleFX",type:"string"},{title:"Asset",name:"asset",type:"string"},{title:"Symbol",name:"symbol",type:"string"},{title:"Spawn Requirement",name:"spawnTrigger",type:"string",default:"0"}],array:!0}),GridPiecesConfig.prototype.initialize=function(){var e,i=this,o={},r={};for(e in r.Color={},r.BombColor={spawnTrigger:"9"},r.BombColorBig={spawnTrigger:"BombColor,BombColor"},r.BombRadius={spawnTrigger:"7",Match3:"Line5"},r.BombRadiusBig={spawnTrigger:"BombRadius,BombRadius",Connect:"Loop"},r.Line={spawnTrigger:"5",Connect:"Line4",Match3:"Line4"},r.LineBig={spawnTrigger:"Line,BombRadius"},r.Cross={spawnTrigger:"Line,Line"},r.CrossBig={spawnTrigger:"Line,Line,BombRadius"},r.MidasBombRadius={spawnTrigger:"BombColor,BombRadius"},r.MidasLine={spawnTrigger:"BombColor,Line"},r.MidasCross={spawnTrigger:"BombColor,Line,Line"},r.Crate={isLocked:!0,health:3,explodeOnProximity:!0},r.Balloon={isLocked:!0,explodeOnProximity:!0},r.Boss={},r)prefillItem({type:e,id:e,asset:"Cube"+e});for(e in i.__scriptType.attributes.index.list.schema[2].enum){let o=i.__scriptType.attributes.index.list.schema[2].enum[e];for(let e in o){if("Custom"==e)break;prefillItem({type:"Color",color:e});break}}for(e in i.list)prefillItem(i.list[e]);function prefillItem(e){e.type||(e.type="Custom");var i=r[e.type];if(i)for(var s in i)null!=e[s]&&null!=e[s]||null==i[s]||(e[s]=i[s]);e.id=e.id&&e.id.length>1?e.id:"Custom"!=e.color?e.color:e.type,e.asset=e.asset||"Cube"+("Custom"!=e.color?e.color:e.id),e.symbol=e.symbol||"Symbol_"+e.type,e.spawnTrigger||(e.spawnTrigger="0"),e.spawnTrigger=e.spawnTrigger.includes(",")?STRING.getArray(e.spawnTrigger):MATH.forceNumber(e.spawnTrigger),e.title=e.title||e.id,e.particleFX=STRING.getArray(e.particleFX),e.particleFX[0]||(e.particleFX[0]=e.id),o[e.id]=e}CONFIG.add("GRIDBOARD.PIECES",o)};var EmoteDisplayer=pc.createScript("emoteDisplayer");EmoteDisplayer.prototype.initialize=function(){var e=this,t=e.entity,i=t.findByName("Text"),n=t.findByName("Symbol");let a=i.findByName("textField"),l=i.findByName("Base");getLocals(t),e.fill=function(o){SFX.play("Emote"),fill(t,o),i.enabled=o.text,n.enabled=o.symbol,o.text&&(l.element.width=a.element.width+88),t.setLocalPosition(new pc.Vec3(0,1,0));ANIMATION.bounceScaleTo(t,.4,t.sca.x,1.6),ANIMATION.moveTo(t,new pc.Vec3(0,850,0),4,EASING.Linear),delay((function(){ANIMATION.scaleTo(t,pc.Vec3.ZERO,.5,EASING.SineIn)}),3.5),delay((function(){o.onFinish(e)}),4)}};var GridBoardConfig=pc.createScript("gridBoardConfig");GridBoardConfig.attributes.add("list",{type:"json",schema:[{type:"string",name:"type",title:"Type",enum:[{Custom:"Custom"},{Collapse:"Collapse"},{Match3:"Match3"},{Connect:"Connect"},{Bubbles:"Bubbles"},{Moves:"Moves"},{Punball:"Punball"},{Tsum:"Tsum"},{Arkanoid:"Arkanoid"}],default:"Color"},{title:"Id",name:"id",type:"string"},{title:"Margin",name:"margins",type:"vec2",default:[176,176]},{name:"size",title:"Size",type:"vec2",default:[5,5]},{name:"pieceFrontOffset",title:"Piece Front Offset",type:"vec3",default:[0,0,231]},{name:"preFill",title:"Pre Fill",type:"boolean",default:!0},{name:"refill",title:"Refill",type:"boolean",default:!0},{name:"invertY",title:"Invert Y",type:"boolean",default:!1},{name:"gravity",title:"Gravity",type:"boolean",default:!1},{name:"speed",title:"Speed",type:"number",default:0},{name:"diagonalGravity",title:"Diagonal Gravity",type:"boolean",default:!0},{name:"isActive",title:"Is Active",type:"boolean",default:!1}],array:!0}),GridBoardConfig.prototype.initialize=function(){var e=this,t={Collapse:{},Match3:{},Connect:{},Bubbles:{},Moves:{},Punball:{},Tsum:{},Arkanoid:{}};let l=e.list[0],i={};for(let t in e.list)prefillItem(e.list[t]);function prefillItem(e){var a=t[e.type];if(a)for(var n in a)null!=e[n]&&null!=e[n]||null==a[n]||(e[n]=a[n]);e.id=e.id&&e.id.length>1?e.id:e.type,i[e.id]=e,e.isActive&&(l=e)}CONFIG.add("GRIDBOARD.BOARDS",i),CONFIG.add("GRIDBOARD.BOARD",l)};var SCREENEMOTES=new function(){var e=this,t=e.texts=["Well played!","Hahaha!","Cool!","Wow!","Oops"];for(let e in t)t[e]={text:t[e]};let o=new Cue(!0,"emotesText"),n=new Cue(!0,"emotesCue");o.copy(t);var i=e.emotes=[];on("TOY:onFinalize",(function init(){if(!GAME.Inventory.tabs||!GAME.Inventory.tabs.Emote)return n.copy(t);let e=GAME.Inventory.tabs.Emote.items;for(let t in e)i.push({symbol:e[t].key});n.copy(i)})),e.getRandom=function(e){return RANDOM.chance(e||.9)?o.get():n.get()}},ScreenEmotes=pc.createScript("screenEmotes");ScreenEmotes.prototype.postInitialize=function(){var e,t=this,o=t.entity,n=o.findByName("Base"),i=getChildScript(o,"EmotesGallery","gallery"),l=getChildScript(o,"DancesGallery","gallery"),a=getChildScript(o,"DialogGallery","gallery"),s=o.findByName("Container"),r=o.findByName("ScrollViewEmotes").findByName("Content"),c=o.findByName("ScrollViewDances").findByName("Content"),E=!1,y=o.findByName("ChatInput").script.aphroditeTextInput;function hide(){UNDERLAYS.hide("Emotes"),fire("EMOTES:onClose")}function onGalleryDown(e){e.data.isLocked||sendMSG(e.data)}function sendMSG(t){hide(),fire(e,extract(t,{userPhoto:ME.userPhoto,color:"BLUE",avatarID:ME.avatarID}))}getLocals(i.entity),SCREEN.call(t),t.onMouseDown=s.onMouseDown=function(e){var t=e.label;if("CloseButton"==t)return hide();if("SendButton"==t){let e=y.validate();e&&sendMSG({text:e})}},t.onShow=function(o){SCREENEMOTES.isVisible=!0,E=o.snappyMode,e=E?"EMOTES:onSnappy":"EMOTES:onEmote",GESTURE.block(),FINGER.hide();var d=t.texts=["Good luck!","Well played!","Hahaha!","Cool!","Wow!","Oops"];for(let e in d)d[e]={text:d[e]};a.fill(d,onGalleryDown),y.reset();let h=[],m=GAME.Inventory.tabs.Emote?GAME.Inventory.tabs.Emote.items:[];for(let e in m)h.push({symbol:m[e].key,isLocked:m[e].isLocked});i.fill(h,onGalleryDown),r.element.width=170*i.pool.length;let f=i.entity.pos;if(i.entity.setLocalPosition(-r.element.width/2,f.y,0),l.clear(),ANIMATION.bounceScaleTo(s,.8),!E)return s.setLocalPosition(0,-544,0),void(n.element.height=600);n.element.height=756,s.setLocalPosition(0,-375,0),h=[],m=GAME.Inventory.tabs.Dance?GAME.Inventory.tabs.Dance.items:[];for(let e in m)h.push({dance:m[e].key,isLocked:m[e].isLocked,title:m[e].title});l.fill(h,onGalleryDown),c.element.width=260*l.pool.length,f=l.entity.pos,l.entity.setLocalPosition(-c.element.width/2,f.y,0)},t.onHide=function(){SCREENEMOTES.isVisible=!1,GESTURE.unblock()}};var GridBoardLayoutsConfig=pc.createScript("gridBoardLayoutsConfig");GridBoardLayoutsConfig.attributes.add("list",{type:"json",schema:[{type:"string",name:"type",title:"Type",enum:[{Custom:"Custom"}],default:"Custom"},{title:"Id",name:"id",type:"string"},{title:"Title",name:"title",type:"string"},{title:"Duration",name:"duration",type:"number",default:0},{title:"PieceIDs",name:"pieceIDs",type:"string"},{title:"JSON",name:"json",type:"string"}],array:!0}),GridBoardLayoutsConfig.prototype.initialize=function(){var t,i={};for(t in this.list)prefillItem(this.list[t]);function prefillItem(t){t.type||(t.type="Custom"),t.id=t.id&&t.id.length>1?t.id:t.type,t.duration=t.duration,t.title=t.title||t.id,t.pieceIDs=STRING.getArray(t.pieceIDs),i[t.id]=t}CONFIG.add("GRIDBOARD.LAYOUTS",i)};var ANIMLIB=new function(){var e={},t={},n={};function search(e){if(t[e])return e;let n=APP.assets.find("Animation_"+e+".glb","animation");return n?(t[e]=n,e):void 0}this.get=function(i,r){i=search(i);let a=e[i];if(a)return r(a);n[i]||(n[i]=[]);let s=n[i];s.push(r);let o=t[i];"Loading"!=o&&(t[i]="Loading",ASSETS.loadAsset(o,(function(){let t=e[i]=o.resource;for(let e in s)s[e](t);delete n[i]})))},this.search=search};var GRIDBOARDLAYOUTS=new function(){let n=!1;var e=[];this.get=function(){return function init(){if(!n)for(var i in n=!0,CONFIG.GRIDBOARD.LAYOUTS)e.push(CONFIG.GRIDBOARD.LAYOUTS[i])}(),new GridBoardLayoutInstance(e[0])}};function GridBoardLayoutInstance(n){var e=this;e.duration=n.duration,e.id=n.id,e.json=n.json,e.type=n.type,e.pieces=new Cue(!0);for(let i in n.pieceIDs)for(let t=0;t<5;t++)e.pieces.push(n.pieceIDs[i]);e.get=function(){}}var ScreenScoreboard=pc.createScript("screenScoreboard"),SCOREBOARD=new function(){on("SCOREBOARD:Show",(function(){PLATFORM.isLogged((function(){SCREENS.show("Scoreboard")}))}))};ScreenScoreboard.prototype.initialize=function(){var e=this,t=e.entity,o=t.findByName("ScrollView"),n=t.findByName("Content"),i=getChildScript(t,"Gallery","gallery"),a=t.findByName("daysField");let l;function exit(){let e=l.collect(),t="Home";if(e){let o=e.shopItem.variable,n=WALLET[o];return n&&n.collect(e),"Lootbox"==e.shopItem.variable&&(t="OpenLoot"),delay(doIt,.6)}function doIt(){SCREENS.show(t,e)}doIt()}getLocals(i.entity),SCREEN.call(e),e.onShow=function(){MUSIC.play("Scoreboard"),l=GAME.Scoreboard.current,a.element.text="Ends in "+DATE.days(l.endDate-DATE.getISO()),i.fill(l.items),n.element.height=2e3-i.posY;let e=i.entity.pos;i.entity.setLocalPosition(e.x,n.element.height/2-1200,0),function onResize(){if(!t.enabled)return;o.element.height=UISIZE.HEIGHT}(),NAV.showSmart({template:l.endDate<DATE.now()&&l.shopItem?"Collect":"Exit",onAction1:exit}),delay((function(){for(let e=0;e<l.items.length;e++){let t=l.items[e],o=l.items[e+1];if(t.avatarID==ME.avatarID&&o)return POPUPS.show("RankUp",{Me:t,Rival:o})}}),1)}};var GRIDPIECES=new function(){var i=this;var e=i.data={};i.init=function(){extract(CONFIG.GRIDBOARD.PIECES,e),extract(e,i)},i.getSpawn=function(i){let t,n=i.length,r=2;if(n<2)return;if("Color"==i[0].type){for(let o in e){let l=e[o],a=l[GRIDBOARD.CONFIG.type];if(a){let n=GRIDBOARD.grid.isShape(i,a);if(n){t=clone(e[o]),a.includes("Line")&&(t.isHorizontal="Horizontal"!=n);break}}else{let i=l.spawnTrigger;if(Array.isArray(i))continue;if(!i||i>n||r>i)continue;r=i,t=clone(e[o])}}return t}if("Powerup"!=i[0].matchID)return;let o=[],l=[];for(let e in i)o.push(i[e].id);for(let i in e){let t=e[i].spawnTrigger;ARRAY.containsArray(t,o)&&l.push({length:t.length,id:i})}if(sort(i,"length"),l.reverse(),l.length){if(t=e[l.shift().id],t.autoExplode=!0,t.id.includes("Line"))for(let e in i)if("Line"==i[e].id){t.isHorizontal=i[e].isHorizontal;break}if(t.id.includes("Midas"))for(let e in i)if("BombColor"==i[e].id){t.color=i[e].color;break}return t}}};function GridPieceData(i){}var ButtonScoreboard=pc.createScript("buttonScoreboard");ButtonScoreboard.prototype.initialize=function(){var e,a=this,t=a.entity,o=t.findByName("Reward"),l=t.findByName("Base"),r=t.findByName("rankField"),n=t.findByName("Rank"),i=t.findByName("scoreField");t.findByName("BaseBig");BUTTON.call(a),a.skipAnimation=!0,a.isMute=!0,a.fill=function(m){e=m.shopItem,a.data=m,o.enabled=!1,i.element.color=r.element.color=COLOR.get(e?"BLUE":"RED"),l.element.color=n.element.color=COLOR.get("#FFFFFF"),m.avatarID==ME.avatarID&&(l.element.color=n.element.color=COLOR.get("#FFD500"),i.element.color=r.element.color=COLOR.get("BLACK")),e&&(o.enabled=!0,fill(o,{amount:"Coin"==e.variable?e.amount:" ",symbol:e.symbol})),fill(t,{firstName:m.firstName||m.avatar.firstName,lastName:m.lastName||m.avatar.lastName,userPhoto:m.userPhoto,rank:STRING.fillZero(m.rank,1),score:STRING.commas(m.score)},!0)}};var GridPiece=pc.createScript("gridPiece");GridPiece.prototype.initialize=function(){var e,o,n,i,l=this,c=l.entity,a=c.findByName("Container"),s=getChildScript(c,"Sparks","fxsparks"),r=getChildScript(c,"Symbols","entityDisplayer");function destroy(e){if(e)return delay(doDestroy,e);function doDestroy(){c.destroy()}doDestroy()}function swapPositions(e,o){let t=e[0],n=e[1],i=t.key,c=n.key;if(t.key=n.key=null,t.setKey(c),n.setKey(i),t.ANIMATE.moveTo(),n.ANIMATE.moveTo(),!o)return GRIDBOARD.GRID.enable();delay((function(){if("Powerup"==t.matchID&&"Powerup"==n.matchID){let o=GRIDPIECES.getSpawn(e);return o&&(o.autoExplode=!0,l.morph(e,o)),void GRIDBOARD.EXPLODE.lines()}GRIDBOARD.EXPLODE.lines()||swapPositions(e)}),.3)}l.spawn=function(e){l.setPiece(CONFIG.GRIDBOARD.PIECES[e.pieceID||GRIDBOARD.layout.pieces.get()]),l.setKey(e.key),GRIDBOARD.set(l)},l.setPiece=function(o,t,n){"BombColor"==(o=clone(o)).id&&(o.color=l.color,o.asset+=l.color),"BombColorBig"==o.id&&(o.asset="CubeMidas"),o.id.includes("Midas")&&(o.asset="CubeMidas"),"Line"==o.id&&(o.color=o.color||l.color,o.isHorizontal=null!=o.isHorizontal?chance():o.isHorizontal,"Match3"==GRIDBOARD.CONFIG.type&&(o.asset+=o.color),o.asset+=o.isHorizontal?"Horizontal":"Vertical"),"LineBig"==o.id&&(o.asset+=o.isHorizontal?"Horizontal":"Vertical"),e=l.data=o,l.asset=e.asset,l.color=e.color,l.id=e.id,l.type=e.type,l.particleFX=e.particleFX,l.isHorizontal=e.isHorizontal,l.health=e.health||1,l.explodeOnGravity=e.explodeOnGravity,l.autoExplode=e.autoExplode,l.explodeOnProximity=e.explodeOnProximity,l.symbol=e.symbol,l.island=[],l.matchID="Powerup","Color"==l.type&&(l.matchID=l.color),r.hide&&r.hide(),l.canMatch=!e.isLocked,l.isLocked=e.isLocked,l.canMove=!e.isLocked,l.isLocked&&(l.matchID="CantMatch"),n||l.refill(t)},l.refill=function(e){if(!e)return doFill();function doFill(){e&&I.spawnPop(),fill(c,{asset:l.asset,health:l.health})}delay(doFill,e)},l.enable=function(){n=!0},l.disable=function(){n=!1},l.onMousePress=function(){n&&l.canMatch&&GRIDSELECTION.start(l)},l.onMouseDown=function(){n&&l.canMatch&&GRIDSELECTION.stop(l)},l.onSelection=function(e){return e.length<2?"Match3"==GRIDBOARD.CONFIG.type?I.onDeselect():"Powerup"==l.matchID?l.EXPLODE.do():void I.onDeselect():(GRIDBOARD.GRID.disable(),"Match3"==GRIDBOARD.CONFIG.type?swapPositions(e,!0):("Connect"==GRIDBOARD.CONFIG.type&&(l.nextSpawn=GRIDPIECES.getSpawn(e),l.nextSpawn&&(l.nextSpawn.autoExplode=!0)),l.nextSpawn?l.morph(e):void GRIDBOARD.EXPLODE.selection(e)))},l.addToSelection=function(){"Collapse"!=GRIDBOARD.CONFIG.type&&I.onSelect()},l.removeFromSelection=function(){I.onDeselect()},l.setKey=function(e){GRIDBOARD.GRID.pool[l.key]==l&&GRIDBOARD.GRID.remove(l.key),l.key=e;var o=GRIDBOARD.GRID.points[e];l.x=o.x,l.y=o.y,GRIDBOARD.GRID.set(l.x,l.y,l)},l.gravity=function(){if(l.isLocked)return;let e=GRIDBOARD.GRID.gravityPaths[l.key];if(e){var o=e.lastKey;o&&(l.setKey(o),l.gravityPath=e,I.gravity())}},l.refresh=function(e){i=!1,e=e||{};let o=l.nextSpawn,t=o?o.id:null;l.nextSpawn=e.nextSpawn;let n=l.nextSpawn?l.nextSpawn.id:null;if("Color"!=l.type||t==n)return;SFX.play("Rotate",{volume:.1});ANIMATION.rotateTo(a,new pc.Vec3(90,0,0),.2,EASING.SineIn),delay((function(){r.show(n),a.setLocalEulerAngles(-90,0,0),ANIMATION.rotateTo(a,pc.Vec3.ZERO,.2,EASING.SineOut)}),.2+.01)};var I=l.ANIMATE={};I.bounce=function(){c.setLocalEulerAngles(15,0,0),ANIMATION.rotateTo(c,new pc.Vec3,1,EASING.ElasticOut)},I.remove=function(){let e=c.getPosition().clone();e.z+=.2,FX3D.SHOCKWAVE.dust({position:e,color:l.color,scale:.5,sprite:"FX_Blur"})},I.pop=function(){let e=c._pos=c.getLocalPosition().clone();o=ANIMATION.moveTo(c,{x:e.x,y:e.y+GRIDBOARD.CONFIG.pieceFrontOffset.y,z:e.z+GRIDBOARD.CONFIG.pieceFrontOffset.z},.5,EASING.SineOut),ANIMATION.scaleTo(c,{x:1.5,y:1.5,z:1.5},.5,EASING.SineOut),c.setLocalEulerAngles(0,spectrum(180,170),0)},I.activate=function(e){c._pos=c.getLocalPosition().clone();ANIMATION.scaleTo(c,{x:1.5,y:1.5,z:1.5},.5,EASING.ElasticOut)},I.rotate=function(){},I.shake=function(e){ANIMATION.shake(c.findByName("assetTemplate"),null,10,10,e||.5)},I.shrink=function(){let e=decimal(.6,.4);ANIMATION.scaleTo(c,{x:e,y:e,z:e},.4,EASING.SineIn),ANIMATION.rotateTo(c,{x:spectrumDecimal(),y:spectrumDecimal(),z:spectrumDecimal()},1)},I.blink=function(){ANIMATION.blink(c.findByName("assetTemplate"))},I.snapBack=function(){ANIMATION.rotateTo(c,new pc.Vec3(0,0,0),.5,EASING.BounceOut),o=ANIMATION.moveTo(c,GRIDBOARD.GRID.positions[l.key],.5,EASING.BounceOut),ANIMATION.scaleTo(c,{x:1,y:1,z:1},.5,EASING.BounceOut)},I.moveTo=function(e){o=ANIMATION.moveTo(c,e||GRIDBOARD.GRID.positions[l.key],.5,EASING.ElasticOut)},I.spawnPop=function(){ANIMATION.bounceScaleTo(c,2)},I.onSelect=function(){if("Connect"==GRIDBOARD.CONFIG.type)return I.rotate(),void ANIMATION.bounceScaleTo(c,1,.7,.9);ANIMATION.bounceScaleTo(c,.7,null,1)},I.onDeselect=function(){ANIMATION.scaleTo(c,new pc.Vec3(1,1,1),.7)},I.bounceAngle=function(){ANIMATION.bounceAngle(c,null,20,"y")},I.gravity=function(){let e=l.gravityPath;o&&o.stop();let t,n=17,i=c.getLocalPosition();var a=new pc.Vec2;function update(){let e=c.getLocalPosition().clone();if(n+=4,n*=.99,e.x+=a.x*n,e.y+=a.y*n,e.y<t.y)return doNextPath();c.setLocalPosition(e.x,e.y,e.z)}function doNextPath(){t&&c.setLocalPosition(t.x,c.getLocalPosition().y,0);let o=e.shift();if(!o)return c.setLocalPosition(t.x,t.y,0),I.land(),stop(update);t=GRIDBOARD.GRID.getPosition(o.x,o.y),i.x==t.x&&(a.x=0),i.x<t.x&&(a.x=1),i.x>t.x&&(a.x=-1),a.y=-1}doNextPath(),start(update)},I.gravityTween=function(){var e=GRIDBOARD.GRID.getPosition(l.x,l.y);o&&o.stop(),o=null,ANIMATION.moveTo(c,e,.2,EASING.SineIn),delay((function(){I.land()}),.25)},I.land=function(){var e=GRIDBOARD.GRID.getPosition(l.x,l.y);t=.1,ANIMATION.moveTo(c,{x:e.x,y:e.y+10,z:e.z},t,EASING.SineOut),delay((function(){ANIMATION.moveTo(c,e,t,EASING.SineIn)}),t+.05)},I.explosion=function(e){let o=c.getPosition().clone();e=e||"WHITE",FX3D.SHOCKWAVE.dust({position:o,scale:.6,color:e}),SFX.play("Explode"),delay((function(){FX3D.SHOCKWAVE.dust({position:o,scale:1,color:e})}),.15)},I.consume=function(e){let o=c.getPosition().clone();o.z+=1,e=e||"WHITE",delay((function(){FX3D.SHOCKWAVE.dust({position:o,scale:1,color:e})}),.15)},I.condense=function(e){let o=c.getPosition().clone();o.z+=1,e=e||"WHITE",FX3D.SHOCKWAVE.condense({position:o,scale:2,color:e,blend:1,sprite:"FX_Hole"})},I.collect=function(e){l.remove();let o=decimal(.6,.4),t=decimal(.8,.4),n=c.getLocalPosition();ANIMATION.scaleTo(c,{x:o,y:o,z:o},.8,EASING.SineIn),ANIMATION.rotateTo(c,{x:spectrumDecimal(),y:spectrumDecimal(),z:spectrumDecimal()},1),t=.1+decimal(.4,.2),ANIMATION.moveTo(c,{x:n.x,y:n.y+GRIDBOARD.CONFIG.pieceFrontOffset.y,z:n.z+GRIDBOARD.CONFIG.pieceFrontOffset.z},t),delay((function(){ANIMATION.moveTo(c,e,.4,EASING.CircularIn),destroy(.5)}),t)},l.morph=function(e,o){r.hide(),GRIDBOARD.GRAVITY.stop(),a.setLocalEulerAngles(pc.Vec3.ZERO),c.setLocalEulerAngles(pc.Vec3.ZERO),ANIMATION.rotateTo(a,pc.Vec3.ZERO),ANIMATION.rotateTo(c,pc.Vec3.ZERO);let t=o||l.nextSpawn;l.setPiece(t),l.nextSpawn=null;let n=c.getLocalPosition().clone();for(let o in e)e[o]!=l&&e[o].ANIMATE.collect(n);let s=t.id,A="Morph";"Line"==s&&(A="MorphLine"),"BombRadius"==s&&(A="MorphBomb"),"BombColor"==s&&(A="MorphColor"),SFX.play(A),delay((function(){I.condense()}),.2),I.pop(!0),l.autoExplode?delay((function(){u.do()}),1):(i=!0,delay((function(){I.snapBack(),GRIDBOARD.GRAVITY.do(.1)}),.7))};var u=l.EXPLODE={};l.remove=function(){GRIDBOARD.GRID.remove(l.key)},u.do=function(e){if(!i){if(i=!0,s.start(.3),!e)return doExplode();delay(doExplode,e)}function doExplode(){--l.health<=0&&l.remove(),GRIDBOARD.SCORING.increase(),u[l.type](),"Powerup"==l.matchID&&I.activate()}},u.Color=function(){"Color"==l.type&&SFX.play("Remove"),I.remove(),destroy()},u.Cross=function(e){u.doLine(!0,e),u.doLine(!1,e),I.blink(),I.consume(),destroy(.3),GRIDBOARD.GRAVITY.do(.4)},u.CrossBig=function(){u.Cross(1)},u.LineBig=function(){u.Line(1)},u.Line=function(e){GRIDBOARD.GRAVITY.stop(),u.doLine(l.isHorizontal,e),I.blink(),I.consume(),destroy(.3)},u.doLine=function(e,o){if(o=o||0,SFX.play("Line"),o){let t=l.x,n=l.y;for(let i=-o;i<=o;i++)e?n=l.y+i:t=l.x+i,spawnLine(t,n);GRIDBOARD.GRAVITY.do(.4)}else spawnLine(l.x,l.y),GRIDBOARD.GRAVITY.do(.4);function spawnLine(o,t){let n=GRIDBOARD.GRID.key(o,t),i=GRIDBOARD.GRID.getLine(n,e),l=GRIDBOARD.GRID.positions[n];for(let e in i){let o=i[e],t=MATH.hipotenusa(l,o.entity.getLocalPosition())/GRIDBOARD.CONFIG.margins.x;o.EXPLODE.do(.05*t)}}},u.BombRadius=function(e){GRIDBOARD.GRAVITY.stop(),e=e||1,I.shake(),SFX.play("Activate"),delay((function(){I.explosion(),I.blink(),destroy(.1),GRIDBOARD.GRAVITY.do(.2);let o=GRIDBOARD.GRID.getRadius(l.key,e);for(let e in o)o[e].EXPLODE.do()}),.3)},u.BombRadiusBig=function(){u.BombRadius(2)},u.BombColor=function(e,o){GRIDBOARD.GRAVITY.stop(),LINE.reset();let t;if(l.autoExplode)return doActivate();function doActivate(){t=c.getLocalPosition().clone(),t.z=150,FX3D.SHOCKWAVE.play({position:t,scale:.5,endScale:2,color:"WHITE",sprite:"FX_Glow"});let n=GRIDBOARD.GRID.getColor(e?null:l.color);for(let e in n)rayToPiece(n[e]);function rayToPiece(e){delay((function(){o&&SFX.play("Transform",{volume:.3}),o||e.ANIMATE.shrink(),e.ANIMATE.blink(),LINE.vanish({from:t,to:e.entity.getLocalPosition().clone(),color:l.color,parent:GRIDBOARD.entity,layer:"UI3D"})}),decimal(.2,.01))}delay((function(){GRIDBOARD.GRAVITY.do(.2),I.shrink(),destroy(.3);for(let e in n){let t=decimal(.15,.001),i=n[e];o?i.setPiece(o,t):i.EXPLODE.do(t)}}),.8)}delay(doActivate,.3),SFX.play("Midas")},u.BombColorBig=function(){u.BombColor(!0)},u.MidasBombRadius=function(){u.doMidas(GRIDPIECES.BombRadius)},u.MidasLine=function(){u.doMidas(GRIDPIECES.Line)},u.MidasCross=function(){u.doMidas(GRIDPIECES.Cross)},u.doMidas=function(e){(e=clone(e)).explodeOnGravity=!0,e.isHorizontal=chance(),u.BombColor(!1,e)},u.Crate=function(){if(!l.health){s.start(.7),SFX.play("CrateBreak");let e=c.getLocalPosition().clone();return e.y=-2453,ANIMATION.moveTo(a,new pc.Vec3(0,0,400),.3,EASING.SineOut),ANIMATION.moveTo(c,e,.8,EASING.SineIn,destroy),fire("GAMEACTION:explodeCrate"),void SCORE.increase(10)}let e=c.getPosition().clone();e.z+=.3,FX3D.SHOCKWAVE.play({position:e,scale:.1,endScale:.3,color:"BROWN",sprite:"FX_Condense"}),SFX.play("CrateDamage",{volume:.5}),fill(c,{health:l.health}),I.shake(),I.bounceAngle()},u.Balloon=function(){let e=c.getPosition().clone();e.z+=.3,FX3D.SHOCKWAVE.play({position:e,scale:.2,endScale:.5,time:.3,color:"PINK",sprite:"FX_Condense"}),SFX.play("Balloon"),u.Color(),SCORE.increase(5)}};var GRIDSELECTION=new function(){var e,n,t,o=this,i=[],l=!1,a=[];function startDrag(){on("TOUCH:onDown",onDown),start(update)}function add(e){if(!(i.includes(e)&&i[0]!=e||i.length>2&&i[0]==i[i.length-1]))return e.addToSelection(),o.lastPiece=e,i.push(e),"Connect"==GRIDBOARD.CONFIG.type&&(n=GRIDBOARD.GRID.getRadius(e.key,1,t),function addLine(){if(i.length<2)return;a.push(LINE.spawn({from:i[i.length-2].entity.getLocalPosition(),to:i[i.length-1].entity.getLocalPosition(),color:i[0].color,parent:GRIDBOARD.entity,layer:"UI3D"}))}()),"Match3"==GRIDBOARD.CONFIG.type&&i.length>=2?o.stop():void 0}function removeLast(){let e=i[i.length-1];i.splice(i.length-1,1),e.removeFromSelection(),e=o.lastPiece=i[i.length-1],"Connect"==GRIDBOARD.CONFIG.type&&(n=GRIDBOARD.GRID.getRadius(e.key,1,t),function removeLastLine(){let e=a[a.length-1];e.remove(),removeItem(a,e)}())}function onDown(n){e=n||TOUCH.lastTouch,off("TOUCH:onDown",onDown),on("TOUCH:onMove",onMove),on("TOUCH:onRelease",onRelease)}function onMove(n){n==e&&(off("TOUCH:onMove",onMove),MOTOR.start(update))}function onRelease(n){n.id==e.id&&(o.stop(),function reset(){e=o.touch=null,off("TOUCH:onDown",onDown),off("TOUCH:onRelease",onRelease),off("TOUCH:onMove",onMove)}())}function update(){let t=CAMERA.touchInstanceToWorld(e);if("Connect"==GRIDBOARD.CONFIG.type||"Match3"==GRIDBOARD.CONFIG.type)for(let e in n){let l=n[e];if(!l||l==o.lastPiece)continue;let a=l.entity.getPosition();if(!(MATH.hipotenusa(a,t)>.35)){if(l==i[i.length-2])return removeLast();add(l),kickXY()}}}function kickXY(){if(i.length<2)return;let e=i[i.length-2],n=i[i.length-1],t=ENTITY.getDistanceXY(e,n),o=1.5,l=0,a=0;t.x>0&&(l=o),t.x<0&&(l=-1.5),t.y>0&&(a=o),t.y<0&&(a=-1.5),GRIDBOARD.ANIMATE.kickXY(l,a)}o.start=function(e){l=!0,i=o.selection=[],t=e.color,add(e),"Match3"==GRIDBOARD.CONFIG.type&&(n=GRIDBOARD.GRID.getCross(e.key,null,!0),startDrag()),"Connect"==GRIDBOARD.CONFIG.type&&startDrag()},o.stop=function(){l&&(l=!1,stop(update),function removeLines(){for(var e in a)a[e].remove();a=[]}(),"Collapse"==GRIDBOARD.CONFIG.type&&i[0].onSelection(i[0].island),"Connect"==GRIDBOARD.CONFIG.type&&i[i.length-1].onSelection(i),"Match3"==GRIDBOARD.CONFIG.type&&i[0].onSelection(i))}};var VsturnItem=pc.createScript("vsturnItem");VsturnItem.prototype.postInitialize=function(){var e=this,t=e.entity,l=t.findByName("Message"),a=t.findByName("textField"),o=a.script.motion,n=t.script.motion,c=t.element.color.clone();function refill(t){extract(t,e.data),i[e.data.state]&&i[e.data.state](),l.enabled=e.data.Message}function setText(e){a.element.text=e,resetLocals(a),o.enabled=!1,ANIMATION.bounceScaleTo(a,3.2,2.5,1)}l.enabled=!1,getLocals(a),getLocals(t),e.fill=function(t){e.data=t,t.refill=refill,t.setText=setText,refill()};var i=e.STATES={};i.Play=function(){o.opacity=0,o.isZooming=.1,o.enabled=!0,n.isZooming=.015,a.element.opacity=t.element.opacity=1,a.element.text="PLAYING",a.element.color=COLOR.get("BLACK"),t.element.color=COLOR.get("#FFF531")},i.Empty=function(){o.enabled=!1,resetLocals(a),resetLocals(t),n.enabled=!1,a.element.opacity=.5,t.element.opacity=0,a.element.text=". . .",a.element.color=COLOR.get("WHITE"),t.element.color=COLOR.get("BLACK")},i.Next=function(){i.Empty(),o.enabled=!1,ANIMATION.fadeFromTo(a,0,.5),a.element.text="PLAYS NEXT"},i.Score=function(){resetLocals(a),o.enabled=!1,resetLocals(t),n.enabled=!1,a.element.opacity=t.element.opacity=1,a.element.color=COLOR.get("BLACK"),t.element.color=COLOR.get("WHITE"),ANIMATION.fillField(a,{value:e.data.score,lastValue:0}),ANIMATION.bounceScaleTo(a,.5*a.sca.x,1.6*a.sca.x,.6),SFX.playPitchSmall("CountPoints")},i.OldScore=function(){i.Empty(),t.element.color=c,t.element.opacity=0,a.element.opacity=1,a.element.text=STRING.commarize(e.data.score);let l=1.6*a.sca.x;a.setLocalScale(l,l,l)},i.Defeat=function(){i.Empty(),a.element.text=STRING.commarize(e.data.score)}};var DragButton=pc.createScript("dragButton");DragButton.prototype.initialize=function(){var o,n=this,e=n.entity;function onDown(e){o=n.touch=e||TOUCH.lastTouch,off("TOUCH:onDown",onDown),on("TOUCH:onMove",onMove),on("TOUCH:onRelease",onRelease)}function onMove(n){n==o&&(off("TOUCH:onMove",onMove),MOTOR.start(update))}function onRelease(e){e.id==o.id&&function reset(){o=n.touch=null,MOTOR.stop(update),off("TOUCH:onDown",onDown),off("TOUCH:onRelease",onRelease),off("TOUCH:onMove",onMove)}()}function update(){let o=CAMERA.touchInstanceToWorld(1);e.setPosition(o)}n.onMousePress=function(){on("TOUCH:onDown",onDown)}};var ButtonVsturn=pc.createScript("buttonVsturn");ButtonVsturn.prototype.postInitialize=function(){var t=this,i=t.entity,l=t.Me=getChildScript(i,"Me","vsturnItem"),n=t.Rival=getChildScript(i,"Rival","vsturnItem");BUTTON.call(t),t.fill=function(t){l.fill(t.Me),n.fill(t.Rival)}};var ShopConfig=pc.createScript("shopConfig");ShopConfig.attributes.add("overwrite",{title:"Overwrite",type:"boolean",default:!0}),ShopConfig.prototype.initialize=function(){CONFIG.add("SHOP",this)};var VsturnsBoard=pc.createScript("vsturnsBoard");VsturnsBoard.prototype.postInitialize=function(){var e,t=this,l=t.entity,a=l.findByName("Container"),r=getChildScript(l,"Gallery","gallery"),o=l.findByName("MeField"),i=l.findByName("RivalField"),c=l.findByName("roundField");let s,f,u,y,d;function next(){!function clearScores(){for(let e in u)"Score"==u[e].state&&u[e].refill({state:"OldScore"});for(let e=0;e<u.length-1;e+=2){let t=u[e],l=u[e+1];t.score&&l.score&&t.score!=l.score&&(t.score>l.score?t:l).refill({Message:!0})}}(),c.element.text="Round "+MATH.clamp(Math.floor(s/2)+1,3,1)+" of 3";let e=u[s];if(!e)return function doWinners(){UI.block(),ANIMATION.shake(l,l.pos,10,10,2);let e=f.getWinner();e||FX2D.DAMAGE.play();let a=e?"Rival":"Me";for(let e in u)u[e].player==a&&u[e].refill({state:"Defeat"});fire("VS",e?"victory":"defeat"),delay((function(){t.hide()}),2)}();if(y.length){let t=y.shift();return extract(t,e),function doScore(e){u[s].refill({state:"Score",score:e}),ANIMATION.kickXY(l,l.pos,0,5),delay(tallyTotal,.5)}(t.score)}SFX.play("ChangeTurn"),d=e,e.refill({state:"Play"}),fire("VS","onScoreboard");let a=u[s+1];a&&a.refill({state:"Next"});let r=2==s||4==s;return conquer.Haptic.mini(),0!=s?r?ANIMATION.kickXY(l,l.pos,0,-10):"Me"==e.player?ANIMATION.kickXY(l,l.pos,-10,0):void ANIMATION.kickXY(l,l.pos,10,0):void 0}function tallyTotal(){tallyPlayer(u[s].player)}function tallyPlayer(e,t){let a=0;for(let t in u){let l=u[t];l.player==e&&(a+=l.score||0)}let r="Me"==e?o:i;t?r.element.text=a:(ANIMATION.kickXY(l,l.pos,0,-5),SFX.playPitchSmall("TallyPoints"),ANIMATION.fillField(r,{value:a,lastValue:r.lastScore}),ANIMATION.bounceScaleTo(r,.5*r.sca.x,r.sca.x),delay(nextTurn,1)),r.lastScore=a}function nextTurn(){s++,next()}getLocals(o),getLocals(i),getLocals(l),t.hide=function(){a.enabled=!1},t.show=function(){ANIMATION.bounceScaleTo(l,.5*l.sca.x,l.sca.x,3),f=GAME.Turns.selected,log("TURN INSTANCE",f),o.element.text=i.element.text="-",o.lastScore=i.lastScore=0,a.enabled=!0,u=[];let t=f.firstTurn==ME.avatarID?"Me":"Rival",c=1;for(log("PLAYER!",t,f.firstTurn,ME.avatarID),n=0;n<6;n++){let e={state:"Empty",player:t};2==++c&&(t="Me"==t?"Rival":"Me",c=0),u.push(e)}e=[];let d=copy(u);for(let t=0;t<3;t++){let t={played:0};for(let e=0;e<2;e++){let e=d.shift();t[e.player]=e}e.push(t)}d=[],y=[];for(let e=0;e<f.turnData.length;e++)d.push(extract(f.turnData[e]));if(s=0,d.length){d.reverse();let e=d.shift();e.avatarID;y.push(e),d.reverse();for(let e in d){let t=u[e];t.state="OldScore",extract(d[e],t)}s=d.length}tallyPlayer("Me",!0),tallyPlayer("Rival",!0),r.clear(),r.fill(e),delay(next,.3)},on("VSTimer:onSecond",(function onSecond(e){SFX.play("ClockTick"),d&&d.setText("PLAY IN "+e)})),a.onMouseDown=function(){let e=random(1e3);f.set({turnData:{score:e}},f.currentAvatarID).then((function(){show()}))}};var SoundConfig=pc.createScript("soundConfig");SoundConfig.attributes.add("name",{type:"string",title:"Sound Name"}),SoundConfig.attributes.add("array",{type:"string",title:"MP3s",array:!0}),SoundConfig.attributes.add("tabs",{title:"Multiple",type:"json",schema:[{title:"Sound Label",name:"name",type:"string",default:"( label )"},{title:"MP3s",name:"array",type:"string",array:!0,default:["( Mp3 names )"]}],array:!0}),SoundConfig.prototype.initialize=function(){var t=this,a=t.entity;if(!t.array.length)return;let e={};e[t.name||a.name]=t.array;for(let a in t.tabs)e[t.tabs[a].name]=t.tabs[a].array;CONFIG.add("SOUNDS",e)};var PopupRankUp=pc.createScript("popupRankUp");PopupRankUp.prototype.postInitialize=function(){var e,l,o=this,n=o.entity,a=getChildScript(n,"ME","buttonScoreboard"),t=getChildScript(n,"RIVAL","buttonScoreboard"),i=n.findByName("Container"),c=n.findByName("RankText");getLocals(a.entity),getLocals(t.entity),getLocals(i),c.enabled=!1,SCREEN.call(o),o.onShow=function(o){t.fill(o.Rival),a.fill(o.Me),e={rank:STRING.fillZero(o.Me.rank,1)},l={rank:STRING.fillZero(o.Rival.rank,1)},resetLocals(a.entity),resetLocals(t.entity),function animate(){delay((function(){POPUPS.hide()}),4),c.enabled=!1;let o=a.entity,n=t.entity;function doAnimation(){SFX.play("RankUp");var a=n.pos.clone();a.y+=350,ANIMATION.bounceAngle(o,null,3,"z"),ANIMATION.moveTo(o,a,.3,EASING.CircularOut,(function(){(a=n.pos.clone()).y+=180,ANIMATION.moveTo(o,a,.3,EASING.CircularIn,(function(){CONTENT.fill(o,e),CONTENT.fill(n,l),ANIMATION.bounceScaleTo(o,1.1,1,3),ANIMATION.bounceScaleTo(n,.9,1,3),ANIMATION.moveTo(n,o.pos,1.5,EASING.ElasticOut),ANIMATION.bounceAngle(n,null,4,"z"),UI.shake(10,10),SFX.playPitchSmall("Impact");let a=o.getLocalPosition().clone();a.y+=50,ANIMATION.moveTo(o,a,.2,EASING.CircularOut,(function(){ANIMATION.moveTo(o,n.pos,.3,EASING.CircularIn,(function(){ANIMATION.bounceAngle(n,null,2,"z");let e=o.pos.clone();e.y-=50,c.enabled=!0,ANIMATION.bounceScaleTo(c,3,5),SFX.playPitchSmall("Crash"),ANIMATION.bounceScaleTo(o,1.05,1,2),ANIMATION.bounceScaleTo(n,.95,1,2),ANIMATION.moveTo(n,e,.3,EASING.SineOut,(function(){ANIMATION.moveTo(n,o.pos,.2,EASING.SineIn),SFX.playPitchSmall("Cheers")})),UI.shake(15,10),i.setLocalPosition(0,-100,0),ANIMATION.moveTo(i,i.pos,2,EASING.ElasticOut)}))}))}))}))}resetLocals(o),resetLocals(n),CONTENT.fill(o,l),CONTENT.fill(n,e),ANIMATION.shakeIncrease(i,null,1,1),ANIMATION.fillField(o.findByName("scoreField"),{value:a.data.score,lastValue:0,time:.7}),SFX.playPitchSmall("CountPoints"),delay((function(){SFX.playPitchSmall("CountPoints")}),.4),delay((function(){let e=o.findByName("scoreField").getLocalScale().x;ANIMATION.bounceScaleTo(o.findByName("scoreField"),1.5*e,e),ANIMATION.bounceScaleTo(o,1.1,1),SFX.playPitchSmall("TallyPoints")}),.7),delay(doAnimation,1)}()}};var ScreenOpenLoot=pc.createScript("screenOpenLoot");ScreenOpenLoot.prototype.postInitialize=function(){var o,t=this;t.entity;SCREEN.call(t),t.onShow=function(t){t=t||{},TOP.hide(),NAV.hide(),MUSIC.play("OpenLoot"),t.loot||(t.loot=GAME.Shop.items.Loot_Common.set(!0)),o=t.callback||function(){SCREENS.show("Home")},fire("OPENLOOT:Setup",t)},t.onMouseDown=function(){fire("OPENLOOT:onClick")},on("OPENLOOTUI:Exit",(function(){NAV.showSmart({template:"Exit",onAction1:o})}))};var SlotMachineSymbols=pc.createScript("slotMachineSymbols");SlotMachineSymbols.attributes.add("reelsAmount",{title:"Reels Amount",type:"number",default:3}),SlotMachineSymbols.attributes.add("margin",{title:"Margin",type:"number",default:350}),SlotMachineSymbols.attributes.add("items",{title:"Items",type:"string",array:!0}),SlotMachineSymbols.prototype.initialize=function(){var t,e=this,i=e.entity,n=[],l=e.margin,o=[],a=i.findByName("Template");a.enabled=!1;for(var s=0;s<e.reelsAmount;s++){var r=a.clone().script.slotMachineSymbolsReel;n.push(r),addChild(r.entity,i),r.init(s,onStopReel),r.entity.setLocalPosition(s*l,0,0)}function onStopReel(e){o.push(e),o.length<n.length||(UI.unblock(),t&&t(o))}e.spin=function(e){for(var i in UI.block(),!0,o=[],t=e,SFX.playPitch("Spin"),n)n[i].spin()},e.onMouseDown=function(t){e.spin()},e.fill=function(t){if(t&&t.length)for(var e in n)n[e].fill(t)},e.fill(e.items)};var Fxsparks=pc.createScript("fxsparks");Fxsparks.attributes.add("id",{type:"string"}),Fxsparks.attributes.add("autoStart",{type:"boolean",default:!0}),Fxsparks.attributes.add("interval",{type:"number",default:30}),Fxsparks.attributes.add("pscale",{type:"number",default:.025}),Fxsparks.attributes.add("positionScale",{type:"number",default:0}),Fxsparks.attributes.add("particle",{type:"string",default:"FX_Particle"}),Fxsparks.attributes.add("color",{type:"string",default:"#fffc3b"}),Fxsparks.attributes.add("time",{type:"number",default:4}),Fxsparks.prototype.initialize=function(){var t=this,e=t.entity;t.sinCount=RANDOM.decimal(),t.useSprites=!0,t.hasSmoke=!0,t.delayUnique=new DelayUnique,t.pos=new pc.Vec3,t.smokeSprite=["FX_Cloud_1","FX_Cloud_2","FX_Cloud_3","FX_Cloud_4"],t.myforceZ=0,t.count1=RANDOM.value(10),t.count2=RANDOM.value(10),t.count3=RANDOM.value(10),t.count4=RANDOM.value(10),e.fireScript=t,t.scale=t.scale||e.getLocalScale().x,t.isActive=!1,t.autoStart&&t.start();var a=t.id;a&&(on(a+":Start",(function(e){t.start(e)})),on(a+":Stop",(function(){t.stop()})),on(a+":SetInterval",(function(e){t.interval=e})),on(a+":Get",(e=>e(t))))},Fxsparks.prototype.start=function(t){var e=this;e.isActive=!0,t&&e.delayUnique.start((function(){e.stop()}),t)},Fxsparks.prototype.stop=function(){this.isActive&&(this.isActive=!1)},Fxsparks.prototype.update=function(t){var e=this;if(e.isActive){var a=e.entity;e.sinCount+=.1,++e.count3,e.count3>=e.interval&&(e.count3=random(.83*e.interval),FX3D.SPARKS.play({entity:a,billboard:!0,time:e.time,scale:e.pscale,positionScale:e.positionScale||e.pscale}))}};var SlotMachineSymbolsReel=pc.createScript("slotMachineSymbolsReel");SlotMachineSymbolsReel.attributes.add("startSpeed",{title:"Start Speed",type:"number",default:0}),SlotMachineSymbolsReel.attributes.add("margin",{title:"Margin",type:"number",default:280}),SlotMachineSymbolsReel.attributes.add("slowDown",{title:"Slowdown Time",type:"number",default:2}),SlotMachineSymbolsReel.attributes.add("soundStopping",{type:"string",default:"SlotStopping"}),SlotMachineSymbolsReel.attributes.add("soundEnd",{type:"string",default:"SlotEnd"}),SlotMachineSymbolsReel.attributes.add("soundSpinStop",{type:"string",default:"spinStop"}),SlotMachineSymbolsReel.prototype.initialize=function(){var t=this,e=t.entity,o=e.findByName("Mask");BUTTON.call(t);var n,i,s,a=t.margin,l=0,r=0,u={y:0},f=0,d=!1,S=[],p=[],y=e.findByName("titleField"),c=new EntityPool(o.findByName("Symbol"),null,o),m=0;function resetPositions(t){s=copy(S),y&&(y.element.text=" "),t=null!=t?t:-RANDOM.value(s.length)*a,u.y=t;for(var e=0;e<s.length;e++)s[e]._offset=e;setPositions(),moveDown()}function setPositions(){for(var t,e=0;e<s.length;e++)(t=s[e]).setLocalPosition(0,u.y+t._offset*a,0);r>0?moveDown():moveUp()}function moveUp(){var t=s[0];t.getLocalPosition().y<1.2*-a&&(t._offset+=s.length,t.setLocalPosition(0,u.y+t._offset*a,0),s.push(s.shift()),moveUp())}function moveDown(){var t=s[s.length-1];t.getLocalPosition().y>a&&(t._offset-=s.length,t.setLocalPosition(0,u.y+t._offset*a,0),s.unshift(ARRAY.removeItem(s,t)),moveDown())}function spinning(){if(d&&(u.y+=r,(r-=.5)<-50-l*l*5)){var e=t.slowDown;if(r=0,d=!1,f=-RANDOM.value(i)*a,null!=m)for(var o in resetPositions(0),s){var n=s[o];n.data.key==m&&(f=-n.getLocalPosition().y)}resetPositions(f+s.length*a*3),ANIMATION.varsTo(u,{y:f-a/4},e,EASING.SineOut),DELAY.start((function(){SFX.playPitch(l<2?t.soundStopping:t.soundEnd),ANIMATION.varsTo(u,{y:f},.6,EASING.ElasticOut),DELAY.start(onStop,.2)}),e)}u.y+=r,setPositions();for(o=0;o<s.length;o++)(n=s[o]).getLocalPosition().y}function onStop(){stop(spinning),SFX.play(t.soundSpinStop),isSpinning=!1,t.data=s[0].data,y&&(y.element.text=t.data.title,ANIMATION.bounceScaleTo(y)),n&&n(t.data)}t.init=function(t,e){l=t,n=e},t.fill=function(t){for(var e in c.reset(),S=[],p=[],t){var o=c.get();o.data=t[e],fill(o,o.data),p.push(t[e].key),S.push(o)}i=t.length,resetPositions()},t.spin=function(e,o){o,m=e,y&&(y.element.text=" "),DELAY.start((function(){startFixed(spinning)}),l/10),r=t.startSpeed,d=!0}};var SceneOpenLoot=pc.createScript("sceneOpenLoot");SceneOpenLoot.prototype.postInitialize=function(){var e,o,t=this.entity,n=getScript(t.findByName("Lootbox"),"openLootbox"),i=getScript(t.findByName("CinemaCamera"),"openLootCamera"),l=getScript(t.findByName("Card"),"openLootCard"),r=getScript(t.findByName("LootGallery"),"lootGallery");on("OPENLOOT:Setup",(function setup(e){let o=e.loot;for(var t in e.callback,a=[],o.items){let e=o.items[t];a.push({symbol:e.symbol,title:e.title,description:e.description,rarity:e.data.rarity})}c=copy(a),display("LootLength",a.length),n.fill(o.key),r.fill(a,!1),p.reset(),p.set("intro")})),on("OPENLOOT:onClick",(function onClick(){if(e)return;if("intro"==o)return p.set("open");if("deal"==o)return c.length?p.set("deal"):p.set("reveal");if("reveal"==o)return SCREENS.show("Home")})),on("OPENLOOT:Finish",finish),on("OPENLOOT:Unlock",(function unlock(o){if(!o)return doUnlock();function doUnlock(){e=!1}delayUnique("OpenLootUnlock",doUnlock,o)})),on("OPENLOOT:Lock",lock),on("OPENLOOT:Deal",(function deal(){p.set("deal")}));var a=[],c=[];function lock(){e=!0,cancel("OpenLootUnlock")}var p=this.STATE={};p.set=function(e){lock(),o=e,fire("OPENLOOTUI:Hide"),"intro"==e&&(NAV.hide(),c=copy(a),display("LootLength",c.length)),"deal"==e&&(l.fill(c.shift()),display("LootLength",c.length)),"reveal"==e&&display("LootLength",0),r.ANIMATE[e]&&r.ANIMATE[e](),n.ANIMATE[e]&&n.ANIMATE[e](),i.ANIMATE[e]&&i.ANIMATE[e](),l.ANIMATE[e]&&l.ANIMATE[e]()},p.reset=function(){o=null,r.reset()};var finish=function(){p.finish()}};var FortuneWheel=pc.createScript("fortuneWheel");FortuneWheel.prototype.postInitialize=function(){var e,n,o=this.entity,t=o.findByName("Spinner"),l=o.findByName("Head"),a=0,i=0,c={},r=0,u=o.findByName("SpinContainer"),s=o.findByName("Container"),m=o.findByName("Halo"),p=o.findByName("LED"),N=o.findByName("GlowLinear"),y=CINEMACAMERAS.FortuneCamera.Camera,E=o.findByName("BlinkLight");m.enabled=!1,getLocals(m),getLocals(s);let A=getChildren(o.findByName("SpinLights"));for(let e in A)A[e].enabled=!1;let L,b=0;var d=this.ANIMATE={};function nextLight(){L=!L,L&&++b>=A.length&&(b=0);for(let e in A)A[e].enabled=L&&e==b,A[e].enabled&&ANIMATION.bounceScaleTo(A[e],.085*.9,.085,2);delayUnique("FortuneSpinLight",nextLight,.3)}function update(){n&&(u.rotateLocal(0,0,i),i-=.25,y.setLocalPosition(0,0,y.getLocalPosition().z+5e-4*i),i>0||(N.sprite.opacity<.9&&(N.sprite.opacity+=.03),a+=i/2,l.setLocalEulerAngles(0,0,a),a<-20&&(a=0)))}on("FORTUNEWHEEL:onShow",(function(){d.show()})),d.show=function(){N.enabled=!1,resetLocals(s),E.enabled=!1,s.setLocalEulerAngles(0,0,0);ANIMATION.rotateTo(s,new pc.Vec3(180,0,180),1,EASING.SineInOut),y.setLocalPosition(0,0,6),ANIMATION.moveTo(y,new pc.Vec3(0,0,3),3,EASING.ElasticOut),nextLight()},on("UI:offFortuneWheel",(function(){stop("FortuneSpinLight")})),on("FORTUNEWHEEL:Spin",(function(e){d.spin(e)})),d.spin=function(o){UI.block(),N.setLocalEulerAngles(0,0,spectrumDecimal(360)),N.enabled=!0,N.sprite.opacity=0,e=o,i=5,n=!0,m.enabled=!0,p.enabled=!1,r=random(9),SFX.play("FortuneStart"),delay((function(){SFX.play("FortuneSpin")}),.3),m.setLocalScale(0,0,0),ANIMATION.scaleTo(m,new pc.Vec3(1.374,1.374,1.374),.5),ANIMATION.click(l),ANIMATION.kickY(s,null,-.1),delay((function(){d.onSelect()}),2),startFixed(update)},d.onSelect=function(){n=!1,m.enabled=!1,p.enabled=!0,n=!1,N.enabled=!1,E.enabled=!1,SFX.play("FortuneStop"),SFX.play("Cheers"),l.setLocalEulerAngles(0,0,30),ANIMATION.rotateTo(l,pc.Vec3.ZERO,2,EASING.ElasticOut),ANIMATION.moveTo(y,new pc.Vec3(0,0,3),1,EASING.ElasticOut),S[r].win(),stop(update),UI.unblock(),ANIMATION.bounceAngle(s,null,35,"y"),CAMERA.shake(),delay(e,.2);var o=r*(360/S.length);c.angle=o+20,u.setLocalEulerAngles(0,0,c.angle),ANIMATION.varsTo(c,{angle:o},1,EASING.ElasticOut,(function(){u.setLocalEulerAngles(0,0,c.angle)}))},d.doCoins=function(e){FX3D.SPLATT.fountain(extract(e,{particle:"COIN_Particle",entity:s,scale:.7,forceZ:-10,velZ:-4,endScale:3,amount:50}))};var S=DEPTH.getChildren(t,"Slot"),h=[];h.push({title:100,value:100,varName:"Coin",symbol:"Symbol_Coin"}),h.push({title:200,value:200,varName:"Coin",symbol:"Symbol_Coin"}),h.push({title:300,value:300,varName:"Coin",symbol:"Symbol_Coin"}),h.push({title:5,value:5,varName:"Energy",symbol:"Symbol_Energy"}),h.push({title:"Common",value:"Loot_Common",varName:"Lootbox",symbol:"Loot_Common"}),h.push({title:500,value:500,varName:"Coin",symbol:"Symbol_Coin"}),h.push({title:20,value:20,varName:"Energy",symbol:"Symbol_Energy"}),h.push({title:2e3,value:1e3,varName:"Coin",symbol:"Symbol_Coin"}),h.push({title:10,value:10,varName:"Gem",symbol:"Symbol_Gem"}),h.push({title:"Epic",value:"Loot_Epic",varName:"Lootbox",symbol:"Loot_Epic"});for(let e in S)S[e]=new WheelItem(S[e],h[e]);function WheelItem(e,n){fill(e,n),this.win=function(){ANIMATION.blink(e),"Coin"==n.varName&&(WALLET.Coin.collect(n.value,pc.Vec3.ZERO,!0),d.doCoins()),"Gem"==n.varName&&(WALLET.Gem.collect(n.value,pc.Vec3.ZERO,!0),d.doCoins({particle:"GEM_Particle"})),"Energy"==n.varName&&WALLET.Energy.collect(5,pc.Vec3.ZERO,!0),"Lootbox"!=n.varName?DELAY.unique("FriendFace",(function(){}),.5):delay((function(){SCREENS.show("OpenLoot",{loot:GAME.Shop.items[n.value].set(!0)})}),1)},this.refreshValue=function(){isCoin&&fill(e,{title:label})}}};var OpenLootbox=pc.createScript("openLootbox");OpenLootbox.prototype.initialize=function(){var e=this,n=e.entity;getLocals(n);var o,l,a,t,c=n.findByName("Loot"),i=n.findByName("Light"),A=n.findByName("LightHalo");e.fill=function(e){!function setLoot(e){let n=getChildren(c);for(let e in n)n[e].enabled=!1;log("SET LOOT",e),(o=c.findByName(e)).enabled=!0,a=o.findByName("Bottom"),l=o.findByName("Top"),getLocals(l),getLocals(a),getLocals(o)}(e||"Loot_Common")};var N=e.ANIMATE={};N.closed=function(){I.hide(),l.setLocalEulerAngles(pc.Vec3.ZERO),i.enabled=!1},N.intro=function(){t="intro",cancelAnim(),N.closed();let e=n.pos;n.setLocalPosition(e.x,e.y+4,e.z),ANIMATION.moveTo(n,e,.95,EASING.CircularIn),delay((function(){SFX.play("LootHit")}),.7),delay((function(){FX3D.SHOCKWAVE.play({position:new pc.Vec3(0,.21,0),rotation:new pc.Vec3(-90,0,0),time:.5,scale:.18,sprite:"FX_Blur"})}),.9),delay((function(){CAMERA.shake(.01,.05),ANIMATION.bounceAngle(n,null,2,"x"),N.bounce()}),1),N.waiting(),delay((function(){fire("OPENLOOTUI:Intro"),fire("OPENLOOT:Unlock")}),1.1)},N.waiting=function(){!function delayAnim(e,n){delayUnique("OpenLootbox",e,n)}((function(){N.shake(),N.waiting(),SFX.playPitchSmall("LootShake")}),2)},N.shake=function(){ANIMATION.shake(n,null,.02,.01),ANIMATION.shake(l,null,.01,.09)},N.open=function(){cancelAnim(),N.closed(),t="open",CAMERA.shake(.05,.1,!1),i.enabled=!0,ANIMATION.bounceScaleTo(A,.4,1,.8,EASING.Linear),SFX.play("Halo");ANIMATION.rotateTo(l,{x:-10,y:0,z:0},.59,EASING.Linear),delay((function(){SFX.play("LootOpen"),i.enabled=!1,ANIMATION.bounceScaleTo(n,.7,1),ANIMATION.rotateTo(l,{x:-125,y:0,z:0},1.6,EASING.ElasticOut),FX3D.CONFETTI.spark({y:.5}),I.show()}),.6),delay((function(){fire("OPENLOOT:Deal")}),.7)},N.deal=function(){cancelAnim();var e=t;t="deal",SFX.play("LootDeal"),CAMERA.kick(0,-.1,0,1),I.show(),"intro"!=e&&(l.setLocalEulerAngles(-30,0,0),ANIMATION.rotateTo(l,{x:-125,y:0,z:0},1.6,EASING.ElasticOut),ANIMATION.bounceScaleTo(a,.7,1),ANIMATION.bounceAngle(n,null,10,"x"),N.bounce({y:.5}),fire("OPENLOOT:Unlock",1))},N.bounce=function(e){let o=(e=e||{}).y||.2,l=e.pos||n.pos,a=e.time||.2;ANIMATION.moveTo(n,{x:l.x,y:l.y+o,z:l.z},a,EASING.SineOut),delay((function(){ANIMATION.moveTo(n,l,a,EASING.SineIn)}),a)},N.reveal=function(){cancelAnim(),t="reveal",l.setLocalEulerAngles(-125,0,0),ANIMATION.rotateTo(l,pc.Vec3.ZERO,1,EASING.CircularIn),N.shake(),I.off(),SFX.play("Squeak"),delay((function(){SFX.play("LootClose")}),.9),delay((function(){I.hide(),ANIMATION.bounceScaleTo(n,.9),N.bounce(),ANIMATION.shake(a,null,.01,.09),ANIMATION.shake(l,null,.05,.05),ANIMATION.bounceAngle(n,null,2,"x"),CAMERA.kick(0,.1,0,1),SFX.play("Cheers")}),1)};var I=e.HALO={},u=n.findByName("Halo");function cancelAnim(){cancel("OpenLootbox")}I.show=function(){u.enabled=!0,u.setLocalScale(.8,0,1),ANIMATION.scaleTo(u,new pc.Vec3(1,1,1),2,EASING.ElasticOut)},I.off=function(){u.enabled=!0,u.setLocalScale(1,1,1),ANIMATION.scaleTo(u,new pc.Vec3(.8,0,1),1,EASING.CircularIn)},I.hide=function(){u.enabled=!1}};var LootGallery=pc.createScript("lootGallery");LootGallery.attributes.add("marginX",{type:"number",default:380}),LootGallery.attributes.add("marginY",{type:"number",default:380}),LootGallery.attributes.add("columns",{type:"number",default:3}),LootGallery.prototype.initialize=function(){var e=this,t=e.entity;let l,n=new EntityPool(t.findByName("Template"),"card",t);e.fill=function(t,n){if(e.reset(),l=copy(t),n)return a.reveal()},e.reset=function(){n.reset()};var a=e.ANIMATE={};function delayReveal(e,t,l){delay((function(){let l=n.get();l.fill(e),l.ANIMATE.airReveal(1.5);let a=l.entity;a.setLocalPosition(t),ANIMATION.bounceScaleTo(a,.8,1)}),l)}a.reveal=function(){e.reset();let t=e.columns,n=l.length;n==t+1&&t--;let a=MATH.alignColumns(n,new pc.Vec2(e.marginX,e.marginY),t);for(let e=0;e<a.length;e++)delayReveal(l[e],a[e],.1*e+.2);delay((function(){fire("OPENLOOTUI:Exit"),fire("OPENLOOT:Unlock",1)}),1)},a.intro=function(){e.reset()}};var BOTAI=new function(){let n="BotAI";var e=[];function onHome(){e.length||on("TURNS:onRefresh",onTurnsRefresh),delaySendChallenge(10)}function offHome(){cancel(n)}function delaySendChallenge(e){e=e||40,delayUnique(n,sendChallenge,random(e,e/2))}function sendChallenge(){return UI.Layers.POPUP.current||UI.isBlocked||UI.isShowingLoader||GAME.Turns.yourItems.length>2&&chance()?delaySendChallenge(60):void conquer.Bots.get(1).then((function(n){let e=n[0];UPSALE.incomingChallenge((function(n){if(!n)return delaySendChallenge();log("UPSALE.incomingChallenge"),GAME.Turns.setBot(e).then((function(n){UI.block(),SCREENS.show("VS")}))}),{userPhoto:e.userPhoto,fullName:e.fullName})}))}function onTurnsRefresh(){off("TURNS:onRefresh",onTurnsRefresh);let n=GAME.Turns.theirItems;if(n.length){e=[];for(let o in n)n[o].isBot&&e.push(n[o]);e=ARRAY.shuffle(e),delay((function sendBotTurn(){let n=e.shift();n&&n.currrentAvatarID!=ME.avatarID&&n.setBot();e.length&&delay(sendBotTurn,random(60,10))}),random(60,30))}}let o,t;function onGameStart(){o=0,t=Math.round(CONFIG.GAME.SCORING.scorePerMinute/5)||20,delayUnique(n,(function(){sendEmote({text:"Good Luck!"})}),decimal(3,2))}function onScoreIncrease(e){o+=e,o<t||(o=0,delayUnique(n,sendEmote,decimal(1,.5)))}function sendEmote(n){fire("EMOTES:onEmote",extract(n||SCREENEMOTES.getRandom(),{userPhoto:GAME.Rivals.RIVAL.userPhoto,color:"RED"}))}function onGameEnd(){cancel(n)}on("TOY:onFinalize",(function init(){if(CONFIG.DEBUG.disableBOTAI)return;on("TOY:onFinalize",init),on("GAME:onStart",onGameStart),on("GAME:onEnd",onGameEnd),on("PlayerScoreIncrease",onScoreIncrease),on("UI:onHome",onHome),on("UI:offHome",offHome)}))};var OpenLootCamera=pc.createScript("openLootCamera");OpenLootCamera.prototype.initialize=function(){var o=this.entity,e=o.findByName("Camera"),t=o.findByName("LookAt");getLocals(o),getLocals(e),getLocals(t);var a=this.ANIMATE={};a.intro=function(){"intro",resetLocals(o),resetLocals(e),t.setLocalPosition(0,1.4,0);let a=e.pos;e.setLocalPosition(a.x,a.y-1.3,a.z+1),ANIMATION.moveTo(e,a,1,EASING.Linear),ANIMATION.moveTo(t,t.pos,1,EASING.CircularIn)},a.open=function(){"open",resetLocals(o),resetLocals(e);let t=o.pos;delay((function(){ANIMATION.moveTo(o,{x:t.x,y:2.1,z:t.z},1,EASING.ElasticOut)}),.6)},a.deal=function(){e.setLocalPosition(e.pos),o.setLocalPosition(o.pos.x,2.1,o.pos.z)},a.reveal=function(){let t=e.pos;ANIMATION.moveTo(e,{x:t.x,y:t.y,z:t.z+1},1,EASING.SineOut),o.setLocalPosition(o.pos.x,2.1,o.pos.z)}};var SNAPPYFACES=new function(){var e=this;let t,a={},n={},r=e.textures={},l={};on("TOY:onFinalize",(function(){ASSETS.loadMaterial("FACE_Material",(function(a){t=a.resource,e.setUrl("FaceMaker","Face_Default"),e.setUrl("Dead","FACE_Dead"),e.setUrl("Happy","FACE_Happy"),e.setUrl("Sad","FACE_Sad"),e.setUrl("Skull","Symbol_Skull")}))})),e.setUrl=function(t,a){a&&!l[a]&&(l[a]=!0,ASSETS.loadTexture(a,(function(a){e.setTexture(t,a.resource)})))},e.setTexture=function(e,l){r[e]=l,a[e]||(a[e]=t.clone());let u=a[e];for(var o in u.diffuseMap=l,u.opacityMap=l,u.update(),n[e])n[e][o](u);delete n[e]},e.get=function(e,t){if(a[e])return t(a[e]);n[e]||(n[e]=[]),pushUnique(n[e],t)},e.save=function(e){a[e]&&(a[e]=a.FaceMaker.clone())}};var OpenLootCard=pc.createScript("openLootCard");OpenLootCard.prototype.initialize=function(){var e=this,t=e.entity,o=getScript(t,"card");getLocals(t),e.fill=function(e){o.fill(e)};var a=e.ANIMATE={};a.hide=function(){t.enabled=!1},a.intro=a.open=a.reveal=a.hide,a.deal=function(e){e=e||{},t.enabled=!0;var a=new pc.Vec3(0,-224,0);o.ANIMATE.deal({from:a,to:t.pos}),o.GLOW.show(),delay((function(){fire("OPENLOOTUI:Card",o.data)}),.6)}};var Diorama=pc.createScript("diorama");Diorama.attributes.add("enableEvent",{type:"string"}),Diorama.attributes.add("disableEvent",{type:"string"}),Diorama.attributes.add("downEvent",{type:"string",default:"TOUCH:onDown"}),Diorama.attributes.add("resetEvent",{type:"string"}),Diorama.attributes.add("friction",{type:"number",default:.01}),Diorama.prototype.initialize=function(){var t=this,n=t.entity;t.enableEvent&&on(t.enableEvent,(function enable(){on(t.downEvent,onDown)})),t.disableEvent&&on(t.disableEvent,(function disable(){off(t.downEvent,onDown),off("TOUCH:onMove",startDrag),reset(),stop(onUpdate)})),t.resetEvent&&on(t.resetEvent,reset);let e=new DelayUnique;var a,o;getLocals(n);var r=0;function onDown(){on("TOUCH:onMove",startDrag)}function reset(){ANIMATION.rotateTo(n,n.rot)}function startDrag(t){t&&(e.cancel(),o=t,off("TOUCH:onMove",startDrag),a=!0,startFixed(onUpdate))}function onUpdate(){if(a&&(r=o.totalDistance.x*t.friction),n.rotateLocal(0,r,0),r*=.88,a)return o.isDown?void 0:function stopDrag(){if(off("TOUCH:onMove",startDrag),!a)return;a=!1,o=null,e.start((function(){stop(onUpdate)}),1)}()}};var KEYB=new function(){var n=this;n.isActive=!1;var i={Up:pc.KEY_W,Down:pc.KEY_S,Left:pc.KEY_A,Right:pc.KEY_D},e={};for(var t in i)e[i[t]]=t;n.x=0,n.y=0;var o=new pc.Vec2;function update(){o.x=0,o.y=0,n.Up&&(o.y+=1),n.Down&&(o.y-=1),n.Left&&(o.x-=1),n.Right&&(o.x+=1),o.normalize(),n.x+=(o.x-n.x)/3,n.y+=(o.y-n.y)/3}on("TOY:onFinalize",(function initialize(){APP.keyboard.on(pc.EVENT_KEYDOWN,(function(i){!function onPress(i){if(!i)return;n[i]=!0,n.isActive||startFixed(update);n.isActive=!0,fire("KEYB:onPress",n),fire("KEYB:onChange",n)}(e[i.key])})),APP.keyboard.on(pc.EVENT_KEYUP,(function(t){!function onUp(e){if(!e)return;for(var t in n[e]=!1,i)if(n[t])return;fire("KEYB:onUp",n),fire("KEYB:onChange",n),function reset(){for(var e in i)n[e]=!1;n.isActive=!1,n.isActive=!1,n.x=0,n.y=0,stop(update)}()}(e[t.key])}))}))};function SnappyFace(e){var n,t=this,a=e.findByName("Head").findByName("model");function refreshMesh(){n&&function startLoading(){if(checkLoaded())return onLoaded();startFixed(loading)}()}function loading(){checkLoaded()&&onLoaded()}function checkLoaded(){return a.model&&a.model.meshInstances&&a.model.meshInstances[1]?(!0,!0):(!1,!1)}function onLoaded(){if(stop(loading),!n)return;let e=n;SNAPPYFACES.get(e,(function(t){e==n&&setMaterial(t)}))}function setMaterial(e){a.model&&(a.model.meshInstances[1].material=e)}t.set=function set(e,t){n=e,t&&refreshMesh()},t.refreshMesh=refreshMesh,t.setMaterial=setMaterial}function JoystickInstance(o){var n=this;o=o||{},n.radius=o.radius||50;var e,s=new pc.Vec3,i=new pc.Vec3,t=new pc.Vec3,a=new pc.Vec3,c=n.force=new pc.Vec3,p=o.isResetOnRelease;function onDown(o){off("TOUCH:onMove",onDown),e||(e=n.touch=o||TOUCH.lastTouch,n.isUp=!1,i.copy(e.pos),MOTOR.start(update),on("TOUCH:onMove",onMove),on("TOUCH:onRelease",onRelease))}function onMove(o){!n.isDown&&n.isEnabled&&o==e&&(off("TOUCH:onMove",onMove),i.x=e.pos.x,i.y=e.pos.y,n.isDown=!0)}function onRelease(o){o.id==e.id&&reset()}function reset(o){n.isDown=!1,p||o?(n.x=c.x=0,n.y=c.y=0):t.copy(c),n.isUp=!0,e=n.touch=null,MOTOR.stop(update),off("TOUCH:onRelease",onRelease),off("TOUCH:onMove",onMove)}function update(){n.isDown&&(s.copy(e.pos),s.x=t.x+(s.x-i.x)/n.radius,s.y=t.y+(s.y-i.y)/n.radius,SPRING.min(s,a,1,1),n.x=s.x,n.y=s.y,c.x+=(n.x-c.x)/1,c.y+=(n.y-c.y)/1,n.onUpdate&&n.onUpdate())}n.friction=1,n.isEnabled=!1,n.isUp=!1,n.isDown=!1,n.x=0,n.y=0,n.parent=o.parent,n.enable=function(o){n.isEnabled=!0,n.isDown=!1,n.isUp=!1,on("TOUCH:onDown",onDown),o&&on("TOUCH:onMove",onDown)},n.disable=function(){n.isEnabled=!1,n.isDown=!1,off("TOUCH:onDown",onDown),reset()},n.onDown=onDown,n.reset=reset}var OpenLootUi=pc.createScript("openLootUi");OpenLootUi.prototype.initialize=function(){var e=this.entity;let t=e.findByName("descriptionField"),i=e.findByName("titleField"),o=e.findByName("exitText"),n=e.findByName("startText"),d=e.findByName("rarityField"),r=[t,i,o,n,d];function hide(){for(let e in r)r[e].enabled=!1}function showText(e,t,i){if(!i)return doShow();function doShow(){t&&(e.enabled=!0,t&&(e.element.text=t),ANIMATION.bounceScaleTo(e))}delay(doShow,i)}on("OPENLOOTUI:Hide",hide),on("OPENLOOTUI:Intro",(function intro(){hide(),showText(n)})),on("OPENLOOTUI:Card",(function card(e){e=e||{},hide(),showText(i,e.title),showText(t,e.description,.2),showText(d,e.rarity,.4)})),on("OPENLOOTUI:Exit",(function exit(){hide(),showText(o)}))};var PopupAuth=pc.createScript("popupAuth");PopupAuth.prototype.postInitialize=function(){var e=this,r=e.entity.findByName("Container"),t=getChildrenNames(r);let n,o,i={},s={},a={};for(let e in t){t[e].onMouseDown=onMouseDown;let r=t[e].findByName("Container");r&&(r.onMouseDown=onMouseDown)}function setScreen(e){n=e;for(let e in t)t[e].enabled=!1;o=t[n],o.enabled=!0,ANIMATION.bounceScaleTo(o),s={};let r=o.findByName("Container");if(!r){extract(getChildrenNameScripts(o,"Input","aphroditeTextInput"),s);for(let e in s)s[e].reset();a={},extract(getChildrenNameScripts(o,"Boolean","buttonBoolean"),a);for(let e in a)a[e].setBoolean(!1);return}extract(getChildrenNameScripts(r,"Input","aphroditeTextInput"),s);for(let e in s)s[e].reset();a={},extract(getChildrenNameScripts(r,"Boolean","buttonBoolean"),a);for(let e in a)a[e].setBoolean(!1);r.setLocalPosition(0,0,0);let i=o.findByName("CrazyGamesButton");i.enabled=!1;let u=o.findByName("Base");u.element.height=765,"Login"==e&&PLATFORM.isCGUserAccountAvailable&&(i.enabled=!0,u.element.height=936,r.setLocalPosition(0,100,0))}function onMouseDown(e){let r=e.label;if(log("LABEL",r),"CrazyGamesButton"==r)return PLATFORM.login(),POPUPS.hide();if("Close"==r){if("Login"==n||"Success"==n)return POPUPS.hide();if("Register"==n||"Code"==n||"Recover"==n||"ChangePassword"==n)return setScreen("Login");if("FirstName"==n)return setScreen("Register")}if("ForgotButton"==r)return setScreen("Recover");if("RecoverButton"!=r)if("RecoverResendButton"==r&&conquer.Auth.sendResetPassword({email:i.email}).then((function(e){if(e.error)return DIALOG.customError(e.error);DIALOG.email()})),"SavePasswordButton"!=r){if("LoginButton"==r){if(!validate())return;let e={username:i.username,password:i.password};log("AUTH:",e),conquer.Auth.get(e).then((function(e){return log("LOGIN Result",e),e.error?(DIALOG.customError(e.error),s.LoginUsernameInput.reset(),void s.LoginPasswordInput.reset()):e.isVerified?(POPUPS.hide(),void UI.showLoader()):(DIALOG.email(),void setScreen("Code"))}))}if("NewUserButton"==r)return setScreen("Register");if("RegisterButton"==r){if(!validate())return;conquer.Username.getOne(i.username).then((function(e){return e&&e.username?s.UsernameInput.error("ALREADY IN USE"):setScreen("FirstName")}))}if("SendNameButton"==r){if(!validate())return;conquer.Email.exists(i.email).then((function(e){if(e)return s.EmailInput.error("ALREADY IN USE");let r={username:i.username,email:i.email,firstName:i.firstName,lastName:i.lastName,password:i.password+""};conquer.Auth.set(r).then((function(e){if(e.error)return DIALOG.customError(e.error);DIALOG.email(),setScreen("Code")}))}))}if("SendCodeButton"==r){if(!validate())return;let e={username:i.username,code:i.code};log("VERIFY",e),conquer.Auth.verify(e).then((function(e){if(log("CODE VARS",e),e.error)return DIALOG.customError(e.error),s.CodeInput.error("INVALID CODE");POPUPS.hide()}))}if("ResendButton"==r)return DIALOG.email(),void conquer.Auth.resend({username:i.username})}else{if(!validate())return;conquer.Auth.changePassword({password:i.password,resetKey:i.code,email:i.email}).then((function(e){if(e.error)return DIALOG.customError(e.error),s.NewCodeInput.reset(),s.NewPasswordInput.reset(),void s.NewConfirmPasswordInput.reset();DIALOG.success(),setScreen("Login")}))}else{if(!validate())return;conquer.Auth.sendResetPassword({email:i.email}).then((function(e){if(e.error)return DIALOG.customError(e.error),void s.RecoverEmailInput.reset();DIALOG.email(),setScreen("ChangePassword")}))}}function validate(){let e=!0;for(let r in s){let t=s[r];i[t.id]=t.validate(),i[t.id]||(e=!1)}for(let r in a)a[r].validate()||(e=!1);return log("VALIDATE",i),e}SCREEN.call(e),e.onShow=function(){i={},setScreen("Login"),display("AuthPopup",!0)},e.onHide=function(){display("AuthPopup",!1)}};var ScenePlanet=pc.createScript("scenePlanet");ScenePlanet.prototype.postInitialize=function(){var e=this.entity,n=e.findByName("Globe"),o=e.findByName("Container"),a=e.findByName("Template");a.enabled=!1;var t=[],c=e.findByName("Camera"),i=e.findByName("StarField").children;function bouncePic(e){var n=t[e];n&&(n.setLocalScale(0,0,0),delay((function(){ANIMATION.bounceScaleTo(n,0,1,.5)}),.5+.15*e))}conquer.Bots.get(14).then((function(e){for(var o in e){var c=a.clone();addChild(c,n),c.setLocalPosition(MATH.randomSpherePoint(1.3)),CONTENT.fill(c,{userPhoto:e[o].userPhoto,color:getRandomItem(COLOR.PALETTES.SELECTED)}),t.push(c)}})),on("PLANET:Show",(function show(){var e;for(CINEMACAMERAS.PlanetCamera.enable(),SFX.play("Space"),UI.block(),e=0;e<t.length;e++)bouncePic(e);for(e in ANIMATION.bounceScaleTo(o,.5,1,3),c.setLocalPosition(0,0,20),ANIMATION.moveTo(c,new pc.Vec3(0,0,2),2.5,EASING.CircularIn),i)i[e].setLocalPosition(RANDOM.spectrumDecimal(10),RANDOM.spectrumDecimal(10),RANDOM.spectrumDecimal(10));delay((function(){fire("PLANET:onFinish")}),2.5)}))};var JOYSTICKPAD,JOYSTICKLEFT,JOYSTICKRIGHT,JOYSTICKLOBBY,JoystickPad=pc.createScript("joystickPad");JoystickPad.attributes.add("id",{title:"ID",type:"string",enum:[{JOYSTICKPAD:"JOYSTICKPAD"},{JOYSTICKLEFT:"JOYSTICKLEFT"},{JOYSTICKRIGHT:"JOYSTICKRIGHT"},{JOYSTICKLOBBY:"JOYSTICKLOBBY"}],default:"JOYSTICKPAD"}),JoystickPad.attributes.add("radius",{title:"Radius",type:"number",default:50}),JoystickPad.attributes.add("isResetOnRelease",{title:"Reset On Release",type:"boolean",default:!0}),JoystickPad.attributes.add("autoRadius",{title:"Automatic Radius",type:"boolean",default:!1}),JoystickPad.attributes.add("isVisible",{title:"Is Visible",type:"boolean",default:!0}),JoystickPad.attributes.add("bigArea",{title:"Big Area",type:"boolean",default:!1}),JoystickPad.prototype.initialize=function(){var e=this,t=e.entity;e.x=0,e.y=0;var i=t.findByName("AreaBigButton"),a=t.findByName("AreaButton"),s=a.element.width/3,n=e.autoRadius?s:e.radius||s,o=new JoystickInstance({parent:e,radius:n,isResetOnRelease:e.isResetOnRelease});"JOYSTICKPAD"==e.id&&(JOYSTICKPAD=e),"JOYSTICKLEFT"==e.id&&(JOYSTICKLEFT=e),"JOYSTICKLOBBY"==e.id&&(JOYSTICKLOBBY=e),"JOYSTICKRIGHT"==e.id&&(i.enabled=!0,JOYSTICKRIGHT=e),e.bigArea&&(i.enabled=!0);var d=t.findByName("Handle");let l=a.element.opacity,c=d.element.opacity;e.show=function(){t.enabled=!0,e.enable()},e.hide=function(){t.enabled=!1,e.disable(),e.reset()},e.enable=function(){o.enable()},e.disable=function(){e.isActive=!1,o.disable()},e.invisible=function(){a.element.opacity=0,d.element.opacity=0},e.visible=function(){a.element.opacity=l,d.element.opacity=c},e.reset=function(){e.x=0,e.y=0,e.Up=e.Down=e.Right=e.Left=!1,o.reset(!0),d.setLocalPosition(0,0,0)},JOYSTICKLEFT==e&&on("KEYB:onPress",(function(){if(KEYB.isActive&&!e.isActive)return o.reset(),void(e.isActive=!0)})),e.onMousePress=function(){o.reset(),e.isActive=!0,o.enable(!0),fire(e.id+":onStart")},this.onUpdate=function(){if(e.isActive){if(e==JOYSTICKLEFT&&KEYB.isActive)return e.x=KEYB.x,e.y=KEYB.y,e.Up=KEYB.Up,e.Down=KEYB.Down,e.Right=KEYB.Right,e.Left=KEYB.Left,void d.setLocalPosition(50*e.x,50*e.y,0);e.x=o.force.x,e.y=o.force.y,d.setLocalPosition(50*e.x,50*e.y,0),function doGamePad(){var t=.8;if(MATH.hipotenusa(e)<t)return;e.Up=e.y>t,e.Down=e.y<-t,e.Right=e.x>t,e.Left=e.x<-t}(),o.isUp&&function stopDrag(){fire(e.id+":onStop"),e.isResetOnRelease&&e.reset();e.isActive=!1,o.disable()}()}},pc.platform.mobile||(e.isVisible=!1),e.isVisible?e.visible():e.invisible()},JoystickPad.prototype.update=function(){this.onUpdate()};var Pet=pc.createScript("pet");Pet.attributes.add("id",{title:"ID",type:"string"}),Pet.attributes.add("forceFill",{title:"Force Fill",type:"string",enum:[{ME:"ME"},{RIVAL:"RIVAL"},{NONE:"NONE"}],default:"NONE"}),Pet.attributes.add("defaultState",{title:"State",type:"string",enum:[{Float:"Float"},{Happy:"Happy"},{Dead:"Dead"},{None:"None"}],default:"Float"}),Pet.attributes.add("refillEvent",{title:"Refill Event",type:"string"}),Pet.attributes.add("followTarget",{title:"Follow Target",type:"entity"}),Pet.attributes.add("followFriction",{title:"Follow Friction",type:"number",default:15}),Pet.attributes.add("floatY",{title:"Float Y",type:"number",default:1.4}),Pet.attributes.add("lookAt",{title:"Look At",type:"entity"}),Pet.attributes.add("snapTo",{title:"Snap To",type:"entity"}),Pet.attributes.add("spawnEvent",{title:"Spawn Event",type:"string"}),Pet.prototype.postInitialize=function(){var t=this,e=t.entity,o=e.findByName("Motion"),i=e.findByName("Body"),n=getScript(o,"motion"),l=getChildScript(e,"Ribbon","ribbon"),a=getChildScript(e,"Sparks","fxsparks");t.id||"NONE"==t.forceFill||(t.id="Pet"+t.forceFill),getLocals(o),getLocals(i),getLocals(e);let s=new pc.Entity;s.setLocalPosition(e.pos),addChild(s,e.parent);var c,r,f,u;t.spawnEvent&&on(t.spawnEvent,(function(){l&&(l.lifetime=0),e.setLocalPosition(e.pos),l&&delay((function(){l.lifetime=.9}),.1)})),t.fill=function(o){if("NONE"!=t.forceFill){let e=GAME.Inventory.tabs.Pet;e&&(o="ME"==t.forceFill?GAME.Inventory.selected.Pet:getRandomItem(e.items).key)}o&&fill(e,{value:o})},t.onUpdate=function(){c&&p.LookingAt(),r&&p.SnappingTo(),f&&p.Following()},t.id&&on(t.id,(function(e,o,i){t.set(e,o,i)})),t.set=function(t,e,o){p[t]&&p[t](e,o)};var p=t.STATE={};p.Reset=function(){n.reset(),resetLocals(i),resetLocals(o),n.isBreathing=1.5,p.LookAt(),p.Follow(),p.SnapTo()},p.ResetAll=function(){p.Reset(),resetLocals(e)},p.ResetRotation=function(){e.setLocalEulerAngles(e.rot)},p.Float=function(e){p.Reset(),e=e||{},n.isFloatY=e.isFloatY||t.floatY,n.isBreathing=e.isBreathing||1,n.isWindyX=e.isWindyX||.7},p.Ribbon=function(t){l&&(l.lifetime=t?.8:0)},p.Sparks=function(t){if(a)return t?a.start():void a.stop()},p.Wiggle=function(t){ANIMATION.bounceAngle(i,null,t||10,"z")},p.Happy=function(t){p.Reset(),t=t||{},n.isBreathing=5,n.isBounceY=t.isBounceY||2,n.isRotateY=t.isRotateY||1},p.Jumpy=function(t){p.Reset(),t=t||{},n.isBounceY=t.isBounceY||2},p.Dead=function(){p.Float(),p.ResetRotation(),n.isRotateY=.5,n.isBreathing=3,n.isWindyX=2,i.setLocalEulerAngles(180,0,0)},p.LandBounce=function(t){var o=e.sca.x;ANIMATION.bounceScaleTo(e,1.3*o,o,1.5)},p.TakeOff=function(t){t=t||{};var o=e.sca.x,i=e.getPosition(),n=t.position||new pc.Vec3(i.x,i.y+6,i.z);ANIMATION.scaleTo(e,{x:1.5*o,y:.7*o,z:o},.2,EASING.SineOut,(function(){ANIMATION.bounceScaleTo(e,1.5*o,o,.7),p.SnapTo(),p.Follow(n,{friction:40}),p.LookAt()}))},p.LookAt=function(e){c=null,e&&(n.isFloatY=t.floatY,n.isBreathing=1,n.isWindyX=.7,c=e)},p.LookingAt=function(){ANIMATION.lookAt(e,c,.1)},p.SnapTo=function(t){r=null,t&&(p.Reset(),r=t)},p.SnappingTo=function(){e.setPosition(r.getPosition())},p.GoBack=function(){p.Follow(s.getPosition(),{friction:15})},p.Follow=function(e,o){f=null,e&&(o=o||{},f=e,t.followFriction=o.friction||t.followFriction,u=o.maxZ||0,p.LookAt(e))},p.Following=function(){let o=f.getPosition?f.getPosition():f,i=ANIMATION.A2BFrictionVector(e.getPosition(),o,t.followFriction);u&&(i.z=MATH.clamp(i.z,u,-9999)),e.setPosition(i)},t.refillEvent?on(t.refillEvent,t.fill):"NONE"!=t.forceFill&&t.fill(),t.set(t.defaultState),t.snapTo&&p.SnapTo(t.snapTo),t.followTarget&&p.Follow(t.followTarget),t.lookAt&&p.LookAt(t.lookAt)},Pet.prototype.update=function(t){this.onUpdate()};var ActiveFxdisplayer=pc.createScript("activeFxdisplayer");ActiveFxdisplayer.prototype.initialize=function(){var e=this.entity,t=new EntityPool(e.findByName("Template"),"activeFxinstance",e),i=[],n={};on("ACTIVEFX:Set",(function set(o){let r=n[o.id];r?r.fill(o):(r=t.get(o),i.push(r),addChild(r.entity,e),n[o.id]=r,function resort(){for(let e=0;e<i.length;e++)i[e].entity.setLocalPosition(0,115*-e,0)}());ANIMATION.bounceScaleTo(r.entity,.6,1,2)})),on("ACTIVEFX:Remove",(function remove(e){let o=n[e.id];if(!o)return;removeItem(i,o),delete n[e.id],t.remove(o)})),on("ACTIVEFX:Reset",(function reset(){t.reset(),n={}}))};function WeaponInstance(e,n){var i,t=this,a=(e.entity,e.Weapon),o=t.data=MAGIC.WEAPONS[n],r=(o.type,o.title,o.id,o.symbol,o.text,o.capacity),d=o.bullet,l=o.bulletsPerShot||1,s=(o.spread,o.fireRate),u=o.shotsPerFire,c=(o.autoFire,o.reloadTime),F=(o.chargeTime,o.reloadSoundFX,o.selfReload),f=e.vars,p=new DelayUnique,h=!1,R=r,y=t.canFire=!0,C=t.isReloading=!1;function doFire(){let n=[];for(let i=0;i<l;i++)n.push(a.shoot(d,{soul:e}));i++,e.fire("WEAPON:onShot",n),r&&--R<=0&&F&&reload(),!C&&u&&i<u?s?p.start(doFire,s):doFire():function onShotsEnded(){h=!1,updateCanFire()}()}function reload(){if(!c)return onFinishReload();C=t.isReloading=!0,p.start(onFinishReload,c),updateCanFire()}function updateCanFire(){y=t.canFire=!C&&!h}function onFinishReload(){C=t.isReloading=!1,R=r,updateCanFire()}t.fire=function(){return!(e.Spells.Mute||!y)&&(h=!0,i=0,updateCanFire(),doFire(),!0)},t.refresh=function refresh(){let e=r;r=o.capacity+f.capacityIncrement,R<=e?R+=r-e:R=r},t.reload=reload,t.stop=function(){h=!1,cancel(doFire),updateCanFire()}}var ScreenLobby=pc.createScript("screenLobby");ScreenLobby.prototype.initialize=function(){var e=this;e.entity;SCREEN.call(e),e.onShow=function(){fire("LOBBY:SetState","Show"),TOP.show()},e.onHide=function(){fire("LOBBY:SetState","Hide")}};class FW_Manager extends pc.ScriptType{initialize(){const e=this;if(e.scene=e.entity.parent,e.group=e.entity,e.__id=FW_Manager.counter++,e.group.__counter=0,e.group.__state={preload:0,config:0,ready:0},0===FW_Manager.state.ready){const r=e.scene.children.length;for(let e=0;e<r;e++)FW_Manager.state.ready^=1<<e}if(0===e.group.__state.ready){const r=e.group.script?.scripts;let t=0;for(const e of r){if(!e.enabled)continue;const r=Object.getPrototypeOf(e.constructor).name;"FW_Sequence"===r?t++:"FW_Manager"!==r&&console.warn(`FW: Warning! Invalid script type in the FW tree. Expected FW_Manager or FW_Sequence, found ${r} in ${this.group.name} group`)}0===t&&(t=1);for(let r=0;r<t;r++)e.group.__state.ready^=1<<r}on("gameplay:prepare",e.__preload,e),e.scene.on("fw:preloaded",e.__configure,e),e.group.on("fw:preloaded",e.__preloaded,e),e.group.on("fw:configured",e.__configured,e),e.init()}init(){}postInit(){}postInitialize(){this.postInit()}__preload(){this.group.fire("fw:preload")}__configure(){this.group.fire("fw:configure")}__preloaded(){const e=FW_Manager.state;e.preload^=1<<this.__id,e.preload===e.ready&&(log("FW: PRELOAD DONE"),e.preload=0,this.scene.fire("fw:preloaded"))}__configured(){const e=FW_Manager.state;e.config^=1<<this.__id,e.config===e.ready&&(log("FW: CONFIG DONE"),e.config=0,this.scene.fire("ready"),GAMEPLAY.start())}}pc.registerScript(FW_Manager,"FW_Manager"),FW_Manager.state={preload:0,config:0,ready:0},FW_Manager.counter=0;var ScreenVs=pc.createScript("screenVs");ScreenVs.prototype.postInitialize=function(){var e=this,t=e.entity,n=getChildScript(t,"UserboxME","userBox"),i=getChildScript(t,"UserboxRIVAL","userBox"),o=TIMER.spawn({id:"VSTimer",duration:3e3,onSecond:!0}),r=getChildScript(t,"VSTurnsBoard","vsturnsBoard");let s=new DelayUnique;function share(){PLATFORM.share({text:"I scored "+SCORE.get()+", try to beat it!"},exit)}function exit(){s.cancel(),SCREENS.show("Home")}SCREEN.call(e),e.onShow=function(e){if(NAV.hide(),r.hide(),n.fill(ME),log("SCREENVS",GAME.Turns.selected),!GAME.Turns.selected)return MUSIC.play("MatchMaking"),a.search();GAME.Rivals.RIVAL.isBot||PLATFORM.switchToFriend(GAME.Rivals.RIVAL.avatarID,(function(){})),MUSIC.play("VS"),a.play()},on("VS",(function(e){a[e]&&a[e]()}));var a={search:function(){i.spin(),fire("VS:Show","search"),unique("VS",(function(){t.enabled&&a.found()}),3)},found:function(){GAME.Rivals.set(),log("FOUND",GAME.Rivals.RIVAL.userID),GAME.Turns.set(GAME.Rivals.RIVAL.userID).then((function(){fire("VS:Show","found"),CAMERA.kick(0,-.035,0),a.ui(),GAME.Rivals.RIVAL.isBot||PLATFORM.switchToFriend(GAME.Rivals.RIVAL.avatarID,(function(){}))}))},play:function(){fire("VS:Show","play"),a.ui()},onScoreboard:function(){let e=GAME.Turns.selected;log("ONSCOREBOARD",e.currentAvatarID,ME.avatarID),e.currentAvatarID==ME.avatarID?o.start({onTimeUp:function onTimeUp(){GAME.play()}}):"finished"!=e.status&&PLATFORM.setTournament((function(){if(s.start(exit,8),PLATFORM.canShare)return NAV.showSmart({template:"Share",onAction1:share,onBack:exit});NAV.showSmart({template:"JustBack",onAction1:exit})}))},ui:function(){i.setFound(GAME.Rivals.RIVAL),fire("VS:Show","ui"),unique("VS",(function(){r.show()}),2)},defeat:function(){UI.unblock(),MUSIC.play("Defeat"),SFX.play("Boo"),fire("VS:Show","defeat"),n.clearWinner(),i.setWinner(),NAV.showSmart({template:"Exit",onAction1:function(){GAME.Turns.selected&&(GAME.Turns.selected.setWinner(),GAME.Turns.selected.viewResults()),exit()}})},victory:function(){UI.unblock(),fire("VS:Show","victory"),fire("VS:onVictory"),MUSIC.play("Victory"),n.setWinner(),i.clearWinner(),NAV.showSmart({template:"Collect",onAction1:function(){GAME.Turns.selected&&(GAME.Turns.selected.setWinner(),GAME.Turns.selected.viewResults()),SCREENS.show("OpenLoot",{loot:GAME.Shop.items.Loot_Common.set(!0)})}})}}};var ThirdPersonCamera=pc.createScript("thirdPersonCamera");ThirdPersonCamera.attributes.add("cameraXVel",{type:"number",default:.1}),ThirdPersonCamera.attributes.add("cameraYVel",{type:"number",default:.0035}),ThirdPersonCamera.attributes.add("cameraAimXVel",{type:"number",default:.07}),ThirdPersonCamera.attributes.add("cameraAimYVel",{type:"number",default:.0035}),ThirdPersonCamera.prototype.initialize=function(){let e=this,a=(new pc.Vec3,new pc.Vec3,entity.findByName("CinemaCamera")),t=a.findByName("Camera"),r=new pc.Entity;r.reparent(t.parent);entity.findByName("LookAt"),entity.findByName("AimHolder");let i=new pc.Vec3;getLocals(a),getLocals(t),e.start=function(){t.setLocalPosition(t.pos),a.setLocalPosition(a.pos),t.setLocalPosition(t.pos),a.setLocalPosition(a.pos),i.copy(t.pos),i||(i=t.pos.clone())}};var FORTUNEWHEEL=new function(){var n,e="$C_FCollected";function onTimeUp(){display("FortuneReady",1)}on("TOY:onFinalize",(function init(){n=TIMER.spawn({id:"FortuneTimer",persistent:!0,duration:9e5,onTimeUp:onTimeUp,onSecond:!0,autoStart:!0}),get(e)||onTimeUp()})),on("FORTUNEWHEEL:onSpin",(function onSpin(){set(e,!0),display("FortuneReady",0),n.start()})),on("FORTUNEWHEEL:Show",(function(){PLATFORM.isLogged((function(){SCREENS.show("FortuneWheel")}))}))},ScreenFortuneWheel=pc.createScript("screenFortuneWheel");ScreenFortuneWheel.prototype.postInitialize=function(){var n=this,e=n.entity.findByName("daysField");function spin(){ADPLAYER.playRewarded((function(n){n&&(fire("FORTUNEWHEEL:Spin",onSpin),NAV.hide())}))}function onSpin(){fire("FORTUNEWHEEL:onSpin"),showButtons()}function showButtons(){if(get("FortuneReady"))return NAV.showSmart({template:"Spin",onAction1:spin,onBack:exit});e.element.text=" ",e.enabled=!0,NAV.showSmart({template:"Exit",onAction1:exit})}function onSecond(n){e.element.text=n?"Play again in "+DATE.days(1e3*n):" "}function exit(){SCREENS.show("Home")}SCREEN.call(n),n.onShow=function(n){e.enabled=!1,MUSIC.play("Lounge"),fire("FORTUNEWHEEL:onShow",n),on("FortuneTimer:onSecond",onSecond),on("FortuneReady",showButtons),display("FortuneReady",1),showButtons()},n.onHide=function(){off("FortuneTimer:onSecond",onSecond),off("FortuneReady",showButtons)}};var SceneLobby=pc.createScript("sceneLobby");SceneLobby.prototype.initialize=function(){var e,t=this.entity,n=new EntityPool(t.findByName("Template"),"lobbyPlayer",t),a=TIMER.spawn({id:"LobbyTimer",duration:5e3,onTimeUp:function onTimeUp(){for(const e of s)e.stop();GAME.play()},onSecond:!0}),i=t.findByName("ResultsLadder");i.enabled=!1;var o=t.findByName("SearchLights");o.enabled=!1,on("LOBBY:SetState",(function setState(e,t){r[e]&&r[e](t)})),on("LobbyTimer:onSecond",(function onSecond(e){fire("LobbyText","Starts in "+e)})),on("SCENES:offLobby",(function(){n.reset()}));var r=this.STATE={};r.Show=function(){if(!GAME.Players.items)return r.Search();r.Results()};let s,l=CONFIG.GAME.MULTIPLAYER.maxPlayers;function updateWaitingText(){fire("LobbyText","Waiting for players "+s.length+"/"+l),s.length<l||(NAV.hide(),a.start())}function askExit(){DIALOG.lose((function(e){e&&exit()}))}function exit(){SCREENS.show("Home")}r.Search=function(){JOYSTICKLOBBY.show(),FOG.setColor("#C6DDE8"),MUSIC.play("Lounge"),fire("EMOTES:SetSnappyMode",!0),NAV.showSmart({template:"Exit",onAction1:askExit}),o.enabled=!0,e=GAME.Players.get(l),s=[];let t=MATH.springPositionsZ(l,10,1);for(var a=0,i=0;i<l&&(spawnPlayer(i),e[i].avatarID!=ME.avatarID);i++);function spawnPlayer(i){a=i;let o=t[i];o.y=2+parseInt(a)/2;let r=n.get({Avatar:e[i],position:o});s.push(r)}updateWaitingText(),function delaySpawn(){if(++a>=l)return;delay((function(){spawnPlayer(a),updateWaitingText(),delaySpawn()}),decimal(4,2))}()},r.Results=function(){SFX.play("Cheers"),GAME.Players.get(l);let e=GAME.Players.items;for(let t in e)e[t].score=e[t].vars.score;e=ARRAY.sort(e,"score"),e.reverse(),GAME.Players.reset();for(let t in e)log(t,e[t].score);e.indexOf(ME)<3?(fire("WinGames"),MUSIC.play("Victory")):MUSIC.play("Defeat"),i.enabled=!0;let t=getChildren(i.findByName("Positions"));for(let n in t){let a=e[n],i=t[n];if(!a){i.enabled=!1;continue}i.enabled=!0;let o=i.script.snappy;o&&o.fill(a)}fire("EMOTES:SetSnappyMode",!1),CINEMACAMERAS.LobbyCamera.enable(),fire("LobbyResultsPan"),o.enabled=!1,JOYSTICKLOBBY.hide(),fire("LobbyText"," "),NAV.hide(),delay((function(){FX3D.CONFETTI.sides(),NAV.showSmart({template:"Exit",onAction1:exit})}),4)},r.Hide=function(){o.enabled=i.enabled=!1,CINEMACAMERAS.LobbyCamera.disable(),JOYSTICKLOBBY.hide(),a.stop(),POSITIONDISPLAYER.reset(),n.reset(),s=[]}};var QuestTierItem=pc.createScript("questTierItem");QuestTierItem.prototype.postInitialize=function(){var e=this,t=e.entity;e.scale=t.getLocalScale().clone(),t.buttonScript=e;var i,r=getChildScript(t,"Premium","buttonQuestTier"),l=getChildScript(t,"Free","buttonQuestTier"),n=t.findByName("Enabled"),s=t.findByName("Disabled"),a=t.findByName("Medal"),c=t.findByName("Glow");function refresh(){var e=i.isCurrent?1.3:1;a.setLocalScale(e,e,e),n.enabled=i.isCurrent||!i.isLocked,s.enabled=!n.enabled,c.enabled=i.isCurrent,r.refresh(),l.refresh()}e.fill=function(e){i=e,fill(n,{level:i.id}),fill(s,{level:i.id}),on("Quest:onRefresh",refresh),r.fill(i.Premium),l.fill(i.Free),refresh()},e.select=e.deselect=function(){}};var JoystickConfig=pc.createScript("joystickConfig");JoystickConfig.attributes.add("joystick",{title:"Use Joystick",type:"boolean",default:!0}),JoystickConfig.attributes.add("isDraggable",{title:"Is Draggable",type:"boolean",default:!1}),JoystickConfig.attributes.add("isResetOnRelease",{title:"Reset On Release",type:"boolean",default:!0}),JoystickConfig.attributes.add("isVisible",{title:"Is Visible",type:"boolean",default:!0}),JoystickConfig.attributes.add("radius",{title:"Radius",type:"number",default:50}),JoystickConfig.attributes.add("friction",{title:"Friction",type:"number",default:1}),JoystickConfig.attributes.add("minScreenPos",{title:"Min Position of Touch to allow joystick",description:"Min Position of Touch to allow joystick. -1 to avoid/",type:"vec2",default:[0,0]}),JoystickConfig.attributes.add("maxScreenPos",{title:"Max Screen Position",description:"Max Position of Touch to allow joystick. -1 to avoid",type:"vec2",default:[0,0]}),JoystickConfig.attributes.add("limitPosition",{title:"Limit Position",description:"If we should limit the use of the joystick in a section of the screen",type:"boolean",default:!1}),JoystickConfig.prototype.postInitialize=function(){CONFIG.add("GAME.JOYSTICK",this),JOYSTICK.init()};var SceneVs=pc.createScript("sceneVs");SceneVs.prototype.postInitialize=function(){var e=this.entity,t=getChildScript(e,"SnappyME","snappy"),n=getChildScript(e,"SnappyRIVAL","snappy"),a=e.findByName("Room"),o=e.findByName("Boxes"),i=getScript(o,"motion"),l=e.findByName("SpotLight"),s=e.findByName("ChestLight"),c=e.findByName("VSCamera"),d=e.findByName("PartyLights"),y=getScript(c,"motion"),p=getScript(l,"motion"),m=getScript(s,"motion"),f=getScript(e.findByName("PetME"),"pet"),A=getScript(e.findByName("PetRIVAL"),"pet"),N=e.findByName("EmoteME"),b=e.findByName("EmoteRIVAL");d.enabled=!1,m.enabled=p.enabled=y.enabled=!1,getLocals(c),getLocals(l),getLocals(s),getLocals(o),getLocals(a),getLocals(n.entity),on("VS:Show",(function show(e,n){(function doDefaults(){i.enabled=!1,m.enabled=p.enabled=y.enabled=!1,d.enabled=!1,resetLocals(l),resetLocals(s),resetLocals(c),resetLocals(c),resetLocals(a),i.enabled=!1,resetLocals(o),f.set("Float"),A.set("Float",{isFloatY:-1.5}),N.enabled=b.enabled=!1,t.setAnimation(GAME.Inventory.selected.Dance)})(),r[e]&&r[e](n)}));var r={};r.search=function(){n.fill(),n.setAnimation("Waving")},r.found=function(){r.play();let e=n.entity.sca.x;ANIMATION.bounceScaleTo(n.entity,.7*e,e)},r.play=function(){n.fill(GAME.Rivals.RIVAL),n.setAnimation("Dance")},r.ui=function(){delay((function(){let e=c.pos;ANIMATION.moveTo(c,{x:e.x,y:e.y,z:-9},2)}),1)},r.defeat=function(){c.setPosition(c.pos.x,c.pos.y,-9),ANIMATION.moveTo(c,c.pos,4),t.setAnimation("Defeat"),n.setAnimation("Dance"),f.set("Dead"),A.set("Happy"),delay((function(){t.setFace("Sad",!0),n.setFace("Happy",!0)}),2),delay((function(){CONTENT.fill(b,{symbol:getRandomItem(GAME.Inventory.tabs.Emote.items).key}),CONTENT.fill(N,{symbol:GAME.Inventory.selected.Emote}),N.enabled=b.enabled=!0,m.enabled=p.enabled=y.enabled=!0,CAMERA.shake();let e=a.pos.clone();e.x-=15,ANIMATION.moveTo(a,e,1,EASING.SineIn),i.enabled=!0}),3.5)},r.victory=function(){c.setPosition(c.pos.x,c.pos.y,-9),ANIMATION.moveTo(c,c.pos,4),n.setAnimation("Defeat"),f.set("Happy"),A.set("Dead"),delay((function(){t.setFace("Happy",!0),n.setFace("Sad",!0)}),2),delay((function(){CONTENT.fill(b,{symbol:getRandomItem(GAME.Inventory.tabs.Emote.items).key}),CONTENT.fill(N,{symbol:GAME.Inventory.selected.Emote}),N.enabled=b.enabled=!0,d.enabled=!0,m.enabled=p.enabled=y.enabled=!0,CAMERA.shake();let e=a.pos.clone();e.x+=15,ANIMATION.moveTo(a,e,1,EASING.SineIn),i.enabled=!0,FX3D.CONFETTI.play({scale:.7,gravity:.07,speed:2})}),3.5)}};var AphroditeTextInput=pc.createScript("aphroditeTextInput");AphroditeTextInput.attributes.add("id",{type:"string",title:"ID",description:"A unique ID that would be used to fire an app event when a new value is submitted. If non is provided the entity GUID will be used. The event signature is 'AphroditeTextInput:[ID]:value' with one argument containg the submitted value."}),AphroditeTextInput.attributes.add("placeholder",{type:"string",default:"Type...",title:"Placeholder",description:"A placeholder text to be displayed when no value has been inputted."}),AphroditeTextInput.attributes.add("type",{type:"string",default:"Text",enum:[{Text:"Text"},{Word:"Word"},{Numbers:"Numbers"},{Password:"Password"},{ConfirmPassword:"ConfirmPassword"},{Email:"Email"}],description:"The type of the input field."}),AphroditeTextInput.attributes.add("maxLength",{type:"number",default:0,title:"Max Length",description:"Max number of characters allowed. Type 0 for unlimited characters."}),AphroditeTextInput.attributes.add("minLength",{type:"number",default:0,title:"Min Length"}),AphroditeTextInput.vars={},AphroditeTextInput.values={},AphroditeTextInput.focusGuid=void 0,AphroditeTextInput.inFocus=!1,AphroditeTextInput.prototype.initialize=function(){var e=this,t=e.entity,i=t.findByName("InputField"),r=t.findByName("Hover"),n=e.type;e.isValid=!1;var o=t._guid;r.enabled=!1,e.value=e.placeholder;var u,a=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document;function reset(){u.value="",setText(u.value)}function error(e){return reset(),i.element.color=COLOR.get("RED"),i.element.text=e,!1}function setText(r){if(!(r&&e.maxLength>0&&r.length>e.maxLength)){var u=r;if(e.value=r,""===r||r==e.placeholder)u=e.placeholder||"";else switch(n){case"Numbers":e.value=r.replace(/\D/g,""),u=e.value;break;case"Password":case"ConfirmPassword":u=Array(e.value.length+1).join("*")}t.element.color=COLOR.get("#DADADA"),AphroditeTextInput.values[o]=AphroditeTextInput.vars[e.id]=e.value,i.element.text=u;var a="#BLACK";u==e.placeholder&&(a="#B2B2B3"),i.element.color=COLOR.get(a)}}function setFocus(t){!0===t?(r.enabled=!0,!0===a?u.focus():window.setTimeout(function(){u.focus()}.bind(e),90),AphroditeTextInput.values[o]=AphroditeTextInput.values[o]||"",u.value=AphroditeTextInput.values[o],setText(AphroditeTextInput.values[o]),""!=e.value&&e.value!=e.placeholder||function clear(){e.reset(),i.element.text=""}()):(r&&(r.enabled=!1),!0===a?APP.graphicsDevice.canvas.focus():window.setTimeout(function(){APP.graphicsDevice.canvas.focus()}.bind(e),90)),AphroditeTextInput.inFocus=t}(u=document.createElement("input")).id="aphrodite-ui-text-input",u.setAttribute("type","text"),u.style.position="absolute",u.style.zIndex=-1,u.style.opacity=1e-4,u.style.width="10px",document.body.insertBefore(u,document.body.firstChild),on("AphroditeTextInput:focus",(function(t){setFocus(!1),AphroditeTextInput.focusGuid===o&&(AphroditeTextInput.focusGuid=void 0,fire("AphroditeTextInput:"+o+":value",e.value))})),on("AphroditeTextInput:"+o+":value",(function(e){setText(e||"")})),on("AphroditeTextInput:"+o+":copy",(function(){const e=i.element.text;navigator.clipboard.writeText(e)})),u.addEventListener("change",(function(e){if(AphroditeTextInput.focusGuid!==o)return!1;setFocus(!1)})),u.addEventListener("keypress",(function(e){13==(e.keyCode?e.keyCode:e.which)&&fire("AphroditeTextInput:focus",!1)})),u.addEventListener("input",(function(t){if(AphroditeTextInput.focusGuid!==o)return!1;setText(u.value),fire("AphroditeTextInput:"+o+":typing",e.value)})),u.addEventListener("blur",(function(e){fire("AphroditeTextInput:focus",!1)})),u.addEventListener("focus",(function(e){})),t.element.on("click",(function(e){AphroditeTextInput.focusGuid!==o&&(fire("AphroditeTextInput:focus",!1),u.value=""),AphroditeTextInput.focusGuid=o,setFocus(!0)})),e.reset=reset,e.validate=function validate(){e.isValid=!1;let t=AphroditeTextInput.values[o];if(!t||""==t||t==this.placeholder)return error(e.placeholder);if("ConfirmPassword"==n&&t!=AphroditeTextInput.vars.password)return error(e.placeholder);if(e.minLength&&t.length<e.minLength)return error("MIN "+e.minLength+" CHARACTERS");if("Email"==n&&!STRING.validateEmail(t))return error("INVALID EMAIL");if("Text"==n&&STRING.hasBadWords(t))return error("HAS BAD WORDS");if("Word"==n){if(STRING.hasBadWords(t))return error("HAS BAD WORDS");if(STRING.hasBadCharacters(t))return error("INVALID CHARACTERS")}return e.isValid=!0,t},e.error=error,setText(e.placeholder)};var LobbyPlayer=pc.createScript("lobbyPlayer");LobbyPlayer.prototype.postInitialize=function(){var t,a=this,e=a.entity,n=getChildScript(e,"Character","snappy"),i=getScript(e,"locomotionController"),c=!1,o=e.findByName("SpotLight"),l=getChildScript(e,"Emote","snappyEmote"),s=getScript(e,"soul"),r=new DelayUnique;getLocals(n.entity),a.x=a.y=a.z=0,a.isActive=!1,a.spawn=function(e){t=e.Avatar,n.fill(t);let r=(c=t.avatarID==ME.avatarID)?JOYSTICKLOBBY:a;i.spawn({position:e.position,Avatar:t,isME:c,Input:r,Soul:s}),POSITIONDISPLAYER.set(t.vars),o.enabled=c,ANIMATION.bounceScaleTo(n.entity,.5*n.entity.sca.x,n.entity.sca.x),l.fill(n,s),s.enable()};var p=a.STATE={};p.Reset=function(){a.x=a.y=0,a.isActive=!1},p.Think=function(){if(chance(.3))return p.Dance();chance(.7)?p.Idle():p.Walk()},p.Idle=function(){p.Reset(),chance()&&fire("EMOTES:onSnappy",extract(SCREENEMOTES.getRandom(.4),{avatarID:t.avatarID})),r.start((function(){p.Think()}),decimal(7,2))},p.Dance=function(){p.Reset(),s.Animation.set("Dance"),r.start((function(){p.Think()}),decimal(3,2))},p.Walk=function(){a.x=spectrumDecimal(.7),a.y=spectrumDecimal(.7);let t=e.getPosition();t.x<-1&&(a.x=Math.abs(a.x)),t.x>1&&(a.x=-Math.abs(a.x)),t.z<-1&&(a.y=-Math.abs(a.y)),t.z>1&&(a.y=Math.abs(a.y)),a.isActive=!0,r.start((function(){p.Think()}),decimal(2,1))},a.enable=function(){p.Walk()},a.disable=function(){r.cancel(),p.Reset()},a.stop=function(){i.disable()}};var ScreenPlanet=pc.createScript("screenPlanet");ScreenPlanet.prototype.postInitialize=function(){var n,e=this;e.entity;SCREEN.call(e),e.onShow=function(e){n=e.callback,NAV.hide(),TOP.hide(),BACKGROUND.hide(),MUSIC.stop(),UIFX.stop(),fire("PLANET:Show",e)},e.onMouseDown=function(){fire("PLANET:Show")},on("PLANET:onFinish",(function onFinish(){if(UI.unblock(),n)return n();if(!XP.value)return GAME.play();SCREENS.show("Home")}))};var JOYSTICK,Joystick=pc.createScript("joystick");Joystick.attributes.add("radius",{type:"number",default:50}),Joystick.attributes.add("roundForce",{type:"boolean"}),Joystick.prototype.initialize=function(){var e=this,n=e.entity;JOYSTICK=e,e.isVisible=!0;var o,i=e.Handle=getChild(n,"JHandle"),s=getChild(n,"JBase"),t=new pc.Vec3,c=new pc.Vec3,a=new pc.Vec3,l=new pc.Vec3,u=e.radius,f=e.force=new pc.Vec3,d=new pc.Vec3;let y=new pc.Vec2,r=new pc.Vec2,p=!1;function onDown(n){UI.isBlocked||o||function isValidTouch(e){return!p||!(-1!=r.x&&e.start.x<r.x)&&(!(-1!=r.y&&e.start.y<r.y)&&(!(-1!=y.x&&e.start.x>y.x)&&!(-1!=y.y&&e.start.y>y.y)))}(n)&&(o=n||TOUCH.lastTouch,e.isUp=!1,touchPosOffset(),l.copy(c),MOTOR.start(update),FINGER&&FINGER.hide(),on("TOUCH:onMove",onMove),on("TOUCH:onRelease",onRelease))}function onMove(n){!e.isDown&&e.isEnabled&&n==o&&(off("TOUCH:onMove",onMove),touchPosOffset(),l.x=e.x=c.x,l.y=e.y=c.y,e.isDown=!0)}function onRelease(e){e.id==o.id&&hide()}function hide(){e.isDown=!1,s.enabled=i.enabled=!1,e.isUp=!0,o=null,MOTOR.stop(update),e.isResetOnRelease&&function reset(){e.x=f.x=0,e.y=f.y=0}(),off("TOUCH:onRelease",onRelease),off("TOUCH:onMove",onMove)}function touchPosOffset(){c.copy(o.pos),c.x+=d.x,c.y+=d.y}function update(){e.isDown&&(touchPosOffset(),t.copy(c),a.copy(c),e.isDraggable&&SPRING.min(l,t,u,1),SPRING.min(t,l,u,1),SPRING.min(a,l,50,1),s.enabled=i.enabled=e.isVisible,e.x=(t.x-l.x)/u,e.y=(t.y-l.y)/u,i.setLocalPosition(a),s.setLocalPosition(l),f.x+=(e.x-f.x)/1,f.y+=(e.y-f.y)/1)}e.friction=1,e.isEnabled=!1,e.isUp=!1,e.isResetOnRelease=!0,e.setRadius=function(n){u=n||e.radius},e.init=function(){let n=CONFIG.GAME.JOYSTICK;n&&(e.isVisible=n.isVisible,e.friction=n.friction||1,e.isDraggable=n.isDraggable,y.copy(n.maxScreenPos),r.copy(n.minScreenPos),p=n.limitPosition,e.setRadius(n.radius))},e.isDown=!1,e.x=0,e.y=0,on("JOYSTICK:Enable",(function(n){e.enable(n)})),on("JOYSTICK:Disable",(function(){e.disable()})),e.enable=function(n){if(e.isEnabled=!0,e.isDown=!1,n)return onDown(n);on("TOUCH:onDown",onDown)},e.disable=function(){e.isEnabled=!1,e.isDown=!1,hide(),off("TOUCH:onDown",onDown)},e.pause=function(){},e.unpause=function(){},e.onDown=onDown,hide()};var PopupBotSelector=pc.createScript("popupBotSelector");PopupBotSelector.prototype.initialize=function(){var t,e=this,o=e.entity,n=getChildScript(o,"Gallery","gallery"),i=o.findByName("Content");function onGalleryDown(t){exit(t.data)}function exit(e){POPUPS.hide("BotSelector"),t&&t(e)}SCREEN.call(e),e.onShow=function(e){e&&(t=e.callback),conquer.Bots.get().then((function(t){n.fill(t,onGalleryDown),function onResize(){let t=-n.posY;i.element.height=t+200,n.entity.setLocalPosition(-520,t/2+100,0)}()}))},e.onMouseDown=function(){exit()}};class FW_Physics extends FW_Manager{init(){const e=this.scene,i=this.group;i.on("contact",(function onContact(r,n,o,t){if(void 0===n)return;let l=!1;if("coin"==r||"spike"==r)return;if("coin"===n){if(!t)return;let e=t.getPosition().clone();return e.y+=1.5,FX3D.SHOCKWAVE.play({position:e,sprite:"FX_Condense",billboard:!0,time:.35,scale:.1,endScale:.45,color:"YELLOW"}),t.destroy(),SFX.play("Coin"),COINS.increase(),void SCORE.increase()}if("spike"===n)return t&&t.destroy(),void fire("VEHICLE:Die");if("wall"===r||"wall"===n)return t&&t.destroy(),void i.fire("wall-collision");if("wheel:front"===r&&"wheel:back"===n||"wheel:back"===r&&"wheel:front"===n)return;if("wheel:front"===r||"wheel:back"===r)return e.fire("physics:wheel-contact",r,n,o);if("wheel:front"===r&&"ground"===n||"ground"===r&&"wheel:front"===n)return;if("wheel:back"===r&&"ground"===n||"ground"===r&&"wheel:back"===n)return;if("driver"!==r&&void 0===n)return;"finish-line"!==r&&"finish-line"!==n||!0;fire("VEHICLE:Die")})),e.on("ready",(function simulate(){i.fire("simulate")})),i.on("world-prepared",(function notifyWorldPrepared(){e.fire("physics:world-prepared")})),on("VEHICLE:Die",(function(){}))}}pc.registerScript(FW_Physics,"FW_Physics");var BATCH=new function(){let t=["MAINATLAS","Font1","FontMedium1","SimpleButton1"];this.update=function(){for(let e in t){let n=APP.batcher.getGroupByName(t[e]);n&&APP.batcher.generate([n.id])}}};class ToyMesh extends pc.Entity{constructor(e={}){super(e.name||"TOY Mesh");const t={front:{},left:{},top:{}},{front:o={},left:s={},top:n={}}=e,i=this,c=i._app,r=ToyMesh.v1;!function _parseOptions(){let n;e.material?n=e.material:(n=new pc.StandardMaterial,n.name="TOY Mesh Material",n.cull=e.cull??pc.CULLFACE_NONE,n.diffuseVertexColor=!0,n.update());const i=e.render,__setDefault=(e,t)=>i?void 0===i[e]?t:i[e]:t;t.render={layers:__setDefault("layers",[pc.LAYERID_WORLD]),castShadows:__setDefault("castShadows",!1),castShadowsLightmap:__setDefault("castShadowsLightmap",!0),isStatic:__setDefault("isStatic",!1),receiveShadows:__setDefault("receiveShadows",!1)},t.material=n,t.batchGroup=e.batchGroup||null,t.physics=e.physics||!1,t.position=e.position||null,t.rotation=e.rotation||null,t.hide=e.hide||!1,t.dynamicVertexValues=!1,t.dynamicVertexCount=!1,t.color=e.color||new pc.Color(88/255,88/255,202/255),t.stripes=e.stripes||null,t.direction={forward:new pc.Vec3,right:new pc.Vec3},t.positions=[],(t.color||t.stripes)&&(t.colors=[]);(function _parseFrontSection(){if(o.curvePoints)_parseCurvePoints(e.front,t.front);else if(o.points)t.front.points=o.points;else{const o=e.front?.width||2;t.front.points=[new pc.Vec3(.5*-o,0,0),new pc.Vec3(.5*o,0,0)]}})(),function _parseLeftSection(){if(s.curvePoints)_parseCurvePoints(e.left,t.left);else if(s.points)t.left.points=s.points;else{const o=e.left?.width||2;t.left.points=[new pc.Vec3(0,0,.5*-o),new pc.Vec3(0,0,.5*o)]}void 0!==s.clampRightSide&&(t.left.clampRightSide=s.clampRightSide);void 0!==s.clampLeftSide&&(t.left.clampLeftSide=s.clampLeftSide)}()}(),function _updateDirection(){const e=t.direction,o=t.front.points,s=o?.length;s?(e.forward.copy(o[s-1]).sub(o[0]).normalize(),e.right.cross(e.forward,pc.Vec3.UP)):(e.forward.copy(pc.Vec3.FORWARD),e.right.copy(pc.Vec3.RIGHT))}(),function _updatePositions(){const e=t.positions,o=t.front.points,s=t.left.points,n=t.color,i=t.colors,c=t.left.clampLeftSide,a=t.left.clampRightSide;let p=0,l=0;t.stripes&&t.physics&&console.warn("[TOY MESH] Warning! Stripes option will be ignored, since physics option is enabled.");if(t.stripes&&!t.physics){const n=t.stripes.color1,d=t.stripes.color2;let h=!0;for(let t=0,f=o.length;t<f;t++){const u=o[t];for(let o=0;o<2;o++){if(0===t&&0===o||t===f-1&&1===o)continue;let m=0;const y=h?n:d;for(let t=0,o=s.length;t<o;t++){const n=s[t];r.copy(n).add(u),e[l]=r.x,e[l+1]=0===t&&void 0!==c?c:t===o-1&&void 0!==a?a:r.y,e[l+2]=r.z,m++,l+=3,i.push(y.r,y.g,y.b,1)}p+=m,0===o&&(h=!h)}}}else for(let t=0,d=o.length;t<d;t++){const d=o[t];let h=0;for(let t=0,o=s.length;t<o;t++){const p=s[t];r.copy(p).add(d),e[l]=r.x,e[l+1]=0===t&&void 0!==c?c:t===o-1&&void 0!==a?a:r.y,e[l+2]=r.z,h++,l+=3,n&&i.push(n.r,n.g,n.b,1)}p+=h}t.pointsCount=p}(),function _updateMesh(e){t.mesh||(t.mesh=new pc.Mesh(c.graphicsDevice));const o=t.positions,s=t.mesh,n=t.colors,i=function _getIndices(){const e=[],o=t.left.points.length,s=t.pointsCount/o-1;let n=0;for(let t=0;t<s;++t)for(let s=0,i=o-1;s<i;s++){const s=n+t;e.push(s+0,s+o+1,s+o+0,s+0,s+1,s+o+1),n++}return e}(),r=pc.calculateNormals(o,i);s.clear(t.dynamicVertexValues,t.dynamicVertexCount),s.setPositions(o),s.setNormals(r),s.setColors(n),e&&s.setIndices(i);s.update(pc.PRIMITIVE_TRIANGLES)}(!0);const a=new pc.MeshInstance(t.mesh,t.material),p=t.render;function _parseCurvePoints(e,t){const o=[],s=[];if(e.curvePoints instanceof Array){const t=e.curvePoints;for(let e=0,n=t.length;e<n;++e){const n=t[e];_parsePoints(o,s,n,t[e-1]||n)}}else _parsePoints(o,s,e.curvePoints);t.curves=o,t.points=s}function _parsePoints(e,t,s,n){const i=o.tesselation??10,c=o.adaptiveTess||!0,r=s.start||n.end,{c1:a,c2:p,end:l}=s;let d,h;d=p?new Bezier(r.x,r.y,r.z,a.x,a.y,a.z,p.x,p.y,p.z,l.x,l.y,l.z):new Bezier(r.x,r.y,r.z,a.x,a.y,a.z,l.x,l.y,l.z),c&&(h=d.getLUT(i));for(const e of h)t.push(new pc.Vec3(e.x,e.y,e.z));d.lut=undefined,e.push(d)}i.addComponent("render",{type:"asset",meshInstances:[a],castShadows:p.castShadows,castShadowsLightmap:p.castShadowsLightmap,isStatic:p.isStatic,receiveShadows:p.receiveShadows}),t.batchGroup&&(i.render.layers=batchGroup.layers,i.render.batchGroupId=t.batchGroup.id,c.batcher.markGroupDirty(t.batchGroup.id)),t.physics&&(t.position&&i.setPosition(t.position),t.rotation&&i.setRotation(t.rotation),i.addComponent("rb",{type:"static"}),i.addComponent("col",{type:"mesh"}),i.render.meshes=[t.mesh],i.col.render=i.render,i.col.system.implementations.mesh.doRecreatePhysicalShape(i.col)),t.hide&&(i.render.enabled=!1)}}ToyMesh.v1=new pc.Vec3,ToyMesh.mapRange=function map(e,t,o,s,n){const i=(e-t)*(n-s)/(o-t)+s;return pc.math.clamp(i,s,n)};var PARALLAX,Parallax=pc.createScript("parallax");Parallax.prototype.postInitialize=function(){var e,t=this,n=t.entity;PARALLAX=t,on("PARALLAX:Reset",(function(){n&&(n.enabled=!0,t.reset())})),on("PARALLAX:Disable",(function(){e=!1,n&&(n.enabled=!1)})),on("PARALLAX:Enable",(function(){e=!0})),on("PARALLAX:SetSpeedMultiplier",(function setSpeedMultiplier(e){for(let t in a)a[t].setSpeedMultiplier(e)}));let a=getChildrenNames(n);for(let e in a)a[e]=a[e].script.parallaxLane;t.reset=function(){for(let e in a)a[e].reset()},t.onUpdate=function(){if(e)for(let e in a)a[e].onUpdate()}},Parallax.prototype.update=function(){this.onUpdate()};var SnappyEmote=pc.createScript("snappyEmote");SnappyEmote.prototype.initialize=function(){var e,a,t,n,i,o=this,l=o.entity,d=l.findByName("fullNameField"),m=l.findByName("Text"),r=l.findByName("Symbol"),c=l.findByName("Container");let f=m.findByName("textField"),p=m.findByName("Base");function show(i){if(!i)return;if(i.avatarID!=a.avatarID)return;if(m.enabled=r.enabled=!1,i.dance)return n&&n.Animation.set(i.dance),e.setAnimation(i.dance);d.enabled=!1;let o=i.text?m:r;fill(o,i),i.text&&(p.element.width=f.element.width+88);var l=o.sca.x;ANIMATION.bounceScaleTo(o,.3*l,l,1.6),unique(t,showName,4)}function showName(){if(!d.enabled&&(m.enabled=r.enabled=!1,!i)){d.enabled=!0;var e=d.sca.x;ANIMATION.bounceScaleTo(d,.3*e,e,1.6)}}getLocals(m),getLocals(r),getLocals(d),o.fill=function(o,l){n=l,a=(e=o).Avatar,t=a.avatarID+"emote",i=a.avatarID==ME.avatarID,d.element.text=a.fullName,d.enabled=!1,showName(),on("EMOTES:onSnappy",show)},o.onUpdate=function(){c&&(c.enabled=UISIZE.frustum(l.getPosition()))}},SnappyEmote.prototype.update=function(){this.onUpdate()};var ParallaxItems=pc.createScript("parallaxItems");ParallaxItems.attributes.add("respawn",{title:"Respawn",type:"boolean",default:!0}),ParallaxItems.attributes.add("margin",{title:"Margin",type:"number",default:1}),ParallaxItems.attributes.add("randomDistFactor",{type:"number",default:.8,min:0,max:1,description:"Randomize distance between items, 0 = no randomization, 1 = randomize to full slot size"}),ParallaxItems.attributes.add("minZ",{type:"number"}),ParallaxItems.attributes.add("maxZ",{type:"number"}),ParallaxItems.attributes.add("minY",{type:"number"}),ParallaxItems.attributes.add("maxY",{type:"number"}),ParallaxItems.attributes.add("rotateY",{type:"number",default:360}),ParallaxItems.attributes.add("minScale",{type:"number",default:.8}),ParallaxItems.attributes.add("maxScale",{type:"number",default:1.2}),ParallaxItems.attributes.add("keepProportions",{type:"boolean",default:!1}),ParallaxItems.attributes.add("rotate180",{title:"rotate180",type:"vec3",description:"if enabled, the segment will randomly rotate to 180",default:[0,0,0]}),ParallaxItems.prototype.initialize=function(){var e=this,t=e.entity,a=getChildren(t);let l,r=new pc.Vec3,n=new pc.Vec3,i=new pc.Vec3;for(let e in a)getLocals(a[e]);function adjustItem(t,a){if(!e.respawn)return;i.copy(t.sca);let m=getScale();i.x*=m,e.keepProportions?(i.y*=m,i.z*=m):(i.y*=getScale(),i.z*=getScale()),r.z=decimal(e.maxZ,e.minZ),r.y=decimal(e.maxY,e.minY),r.x=a+spectrumDecimal(l-e.margin*m)*e.randomDistFactor,n.y=spectrumDecimal(e.rotateY);var s=0!=e.rotate180.x&&RANDOM.boolean(),o=0!=e.rotate180.y&&RANDOM.boolean(),d=0!=e.rotate180.z&&RANDOM.boolean();s&&(n.x+=180),o&&(n.y+=180),d&&(n.z+=180),t.setLocalPosition(r),t.setLocalEulerAngles(n),t.setLocalScale(i)}function getScale(){return decimal(e.maxScale,e.minScale)||1}e.spawn=function(t){if(!e.respawn)return;l=t/a.length;let r=-t/2;a=shuffle(a);for(let e=0;e<a.length;e++)adjustItem(a[e],r+l/2),r+=l}};function InputJoystick(){var e=this;function update(){e.isActive=JOYSTICK.isDown,e.x=JOYSTICK.force.x,e.y=JOYSTICK.force.y}e.enable=function(){e.reset(),JOYSTICK.enable(),start(update)},e.reset=function(){e.x=0,e.y=0,e.isActive=!1},e.disable=function(){JOYSTICK.disable(),stop(update)},e.reset()}var Frustum=pc.createScript("frustum");Frustum.attributes.add("target",{title:"Target",type:"entity"}),Frustum.prototype.initialize=function(){var t=this,e=t.entity;t.onPostUpdate=function(){t.target&&(t.target.enabled=UISIZE.frustum(e.getPosition()))}},Frustum.prototype.postUpdate=function(t){this.onPostUpdate()};const ANIMATION_PRIORITY={GAME:2,LOCOMOTION:1,USER:0};function Soul_Animation(t){var n,e,i=this,a=t.vars,o=getScript(t.entity,"locomotionController"),r=getChildScript(t.entity,"Character","animationController");a.animation=null;let d={};function update(){if(!n)return;let t=n.get();t&&t.desiredAnimation&&e!=t.desiredAnimation&&(e=t.desiredAnimation,i.set(e))}i.setStatesHandler=function(t){n=t,update()},i.setAnimationController=function(t){r=t,update()},i.reset=function reset(){d={active:0},e=!1,i.disable(),update()},i.enable=function(){!n&&o&&(n=o.STATE),startFixed(update),update()},i.disable=function(){stop(update)},i.set=function(t,n={}){t!=a.animation&&(a.animation=t,r&&r.play(t,n))}}var INSTRUMENT=new function(){var n=this;n.play=function(n,o=0){SFX.play("Instrument_"+o+"_"+n,{volume:.35})},n.dry=function(){SFX.play("Xylophone_Dry",{volume:.35})},n.low=function(){SFX.play("Instrument_0_0",{volume:.35})}};var ButtonQuestTier=pc.createScript("buttonQuestTier");ButtonQuestTier.prototype.initialize=function(){var e,i=this,t=i.entity,o=t.findByName("Get"),n=t.findByName("symbolSprite"),a=t.findByName("Base");let l;BUTTON.call(i),i.fill=function(i){l=(e=i).shopItem;var o={symbol:l.symbol,value:MATH.isNumber(l.amount)&&l.amount>1?l.amount:" "};fill(t,o)},i.refresh=function(){o.enabled=!e.isLocked&&!e.isConsumed,a.element.opacity=e.isConsumed?.25:1,n.element.opacity=e.isConsumed?.25:1},i.click=function(){if(conquer.Haptic.mini(),ANIMATION.click(i.entity),e.isLocked&&!e.isConsumed)return DIALOG.missions();if(!e.isLocked){if(!e.isPremium)return doIt();ADPLAYER.playRewarded((function(e){e&&doIt()}))}function doIt(){SFX.playPitchSmall("Coin");let i=e.get();"Lootbox"!=l.variable?WALLET[l.variable]&&WALLET[l.variable].collect(l.amount):delay((function(){SCREENS.show("OpenLoot",i)}),.6)}}};class FW_Sequence extends pc.ScriptType{initialize(){const t=this;t.__active=!1,t.group=t.entity,t.__id=t.group.__counter++,t.__maxFixedFrames=5,t.__accumulator=0,t.__fixedDT=1/60,t.group.on("fw:preload",t.__preload,t),t.group.on("fw:configure",t.__configure,t),t.group.on("fw:reset",t.__reset,t),t.init()}init(){}bindEvents(){}start(){this.__active?console.warn("Warning! Trying to start a sequence while it is running.",this):this.__active=!0}stop(){this.__active=!1}preload(){this.preloaded()}preloaded(){const t=this.group.__state;t.preload^=1<<this.__id,t.preload===t.ready&&(log(`FW: ${this.group.name} preloaded`),t.preload=0,this.group.fire("fw:preloaded"))}configure(){this.configured()}configured(){const t=this.group.__state;t.config^=1<<this.__id,t.config===t.ready&&(t.config=0,this.group.fire("fw:configured"))}update(t){if(!this.__active)return;if(0===t)return;this.__accumulator+=t;if(Math.floor(this.__accumulator/this.__fixedDT)>this.__maxFixedFrames){const i=(this.__maxFixedFrames-this.__accumulator)*this.__fixedDT;this.__accumulator-=i,t-=i}for(;this.__accumulator>=this.__fixedDT;)this.fixedUpdate(this.__fixedDT),this.__accumulator-=this.__fixedDT;const i=this.__accumulator/this.__fixedDT;this.updateMotionStates(i,this.__fixedDT),this.onUpdate(t)}postUpdate(t){this.__active&&this.onPostUpdate(t)}fixedUpdate(t){this.__active&&this.onFixedUpdate(t)}onUpdate(t){}onPostUpdate(t){}onFixedUpdate(t){}updateMotionStates(){}__preload(){this.preload()}__configure(){this.configure()}}pc.registerScript(FW_Sequence,"FW_Sequence");var UranusInstancerLite=pc.createScript("uranusInstancerLite");UranusInstancerLite.attributes.add("frustumCulling",{type:"boolean",default:!1,title:"Frustum Culling",description:"Controls the culling of instances against the camera frustum (frustum culling needs to enabled on each camera component). If false all instances will be rendered regardless of their visibility. Changing this setting requires application reload."}),UranusInstancerLite.attributes.add("autoUpdate",{type:"boolean",default:!0,title:"Auto Update",description:"Run the instancer update method automatically per frame. If Frustum Culling is selected this property doesn't have any effect."}),UranusInstancerLite.attributes.add("cloneMaterials",{type:"boolean",default:!0,title:"Clone Materials",description:"If selected all instances will use a clone of the original model material. This is useful when the original material is being used in non instanced models and otherwise it will produce render artifacts. Changing this setting requires application reload."}),UranusInstancerLite.attributes.add("disableShadows",{type:"boolean",default:!1,title:"Disable Shadows",description:"If selected no shadows buffers will be created (optimization). Requires app reload."}),UranusInstancerLite.attributes.add("disableTransparent",{type:"boolean",default:!0,title:"Disable Transparent",description:"If selected transparent mesh instances will not be instanced."}),UranusInstancerLite.attributes.add("excludeTag",{type:"string",default:"INSTANCING:Disable",title:"Exclude Tag",description:"The tag that can be used on entities to exclude them from instancing."}),UranusInstancerLite.attributes.add("excludeLayers",{type:"string",array:!0,default:["Depth","Skybox","Immediate","UI"],title:"Exclude Layers",description:"Mesh instances rendered in these layers won't be instanced."}),UranusInstancerLite.prototype.initialize=function(){UranusInstancerLite.api=this,this.payloads=void 0,this.vec=new pc.Vec3,this.vec2=new pc.Vec3,this.quat=new pc.Quat,this.matrix=new pc.Mat4,this.checkBatchGroups=!0,this.prepare(),window.setTimeout((()=>this.onState(!0)),0),this.on("state",this.onState,this),this.on("attr:disableShadows",this.onDisableShadows,this),this.on("attr:autoUpdate",this.changeUpdateState,this)},UranusInstancerLite.prototype.prepare=function(){this.overrideEngine(),this.payloads={},!this.frustumCulling&&this.autoUpdate&&this.app.on("update",this.onUpdate,this),this.app.on("uranusInstancerLite:update",this.onUpdate,this)},UranusInstancerLite.prototype.changeUpdateState=function(e){e?this.app.on("update",this.onUpdate,this):this.app.off("update",this.onUpdate,this)},UranusInstancerLite.prototype.onState=function(e){if(e){const e=this.app.scene.layers.layerList;for(let t=0;t<e.length;t++){const a=e[t];if(!1===this.isLayerValid(a))continue;const n=[];a.opaqueMeshInstances.forEach((e=>n.push(e)));const s=a.transparentMeshInstances;this.disableTransparent||a.transparentMeshInstances.forEach((e=>s.push(e))),UranusInstancerLite.removeMeshInstancesFunc.apply(a,[n]),a.addMeshInstances(n),this.disableTransparent||(UranusInstancerLite.removeMeshInstancesFunc.apply(a,[s]),a.addMeshInstances(s))}}else{for(let e in this.payloads){const t=this.payloads[e],a=t.refMeshInstances,n=t.layer;this.clearPayload(t),n.addMeshInstances(a)}this.payloads={}}},UranusInstancerLite.prototype.onDisableShadows=function(e){this.enabled&&(this.enabled=!1,this.enabled=!0)},UranusInstancerLite.prototype.setShadows=function(e){this.disableShadows=!e},UranusInstancerLite.prototype.setCheckBatchGroups=function(e){this.checkBatchGroups=e},UranusInstancerLite.prototype.isLayerValid=function(e){return-1===this.excludeLayers.indexOf(e.name)},UranusInstancerLite.worldMatX=new pc.Vec3,UranusInstancerLite.worldMatY=new pc.Vec3,UranusInstancerLite.worldMatZ=new pc.Vec3,UranusInstancerLite.prototype.shouldFlipFaces=function(e){const t=UranusInstancerLite.worldMatX,a=UranusInstancerLite.worldMatY,n=UranusInstancerLite.worldMatZ,s=e.getWorldTransform();return s.getX(t),s.getY(a),s.getZ(n),t.cross(t,a),!(t.dot(n)>=0)},UranusInstancerLite.prototype.getPayloadId=function(e,t,a,n){const s=n||e.material,i=this.shouldFlipFaces(e.node);return BigInt(65535&t.id)<<34n|BigInt(a?1:0)<<33n|BigInt(i?1:0)<<32n|BigInt(65535&e.mesh.id)<<16n|BigInt(65535&s.id)},UranusInstancerLite.prototype.getMeshInstanceEntity=function(e){let t=e.node;if(t instanceof pc.Entity==!1){for(;t instanceof pc.Entity==!1&&t.parent;)t=t.parent;if(t instanceof pc.Entity==!1)return}return t},UranusInstancerLite.prototype.addMeshInstance=function(e,t,a,n){if(!e.material||e.mesh.skin)return!1;if("uranus-instancer-payload"===e.node.name)return!1;if(this.disableTransparent&&e.material.blendType!==pc.BLEND_NONE)return!1;const s=this.getMeshInstanceEntity(e);if(!s)return!1;const i=e.node!==s?e.node:s;if(s.tags.has(this.excludeTag))return!1;const r=s.render?s.render:s.model;return!(!r||this.checkBatchGroups&&r&&r.batchGroupId>-1)&&(n||this.addToPayload(s,i,e,t,!1),this.disableShadows||a||!e.castShadow||this.addToPayload(s,i,e,t,!0),this.overrideMeshInstance(e,(()=>{this.removeFromPayload(e,t,!1,null),this.removeFromPayload(e,t,!0,null),n||this.addToPayload(s,i,e,t,!1),this.disableShadows||a||!e.castShadow||this.addToPayload(s,i,e,t,!0)})),!0)},UranusInstancerLite.prototype.addToPayload=function(e,t,a,n,s){const i=this.getPayloadId(a,n,s);let r=this.payloads[i];if(r){if(r.refMeshInstances.indexOf(a)>-1)return r}else r=this.createPayload(i,a,n,s);const o={};return o.entity=e,r.refMeshInstances.push(a),a.uranusPayloadMaterial=a.material,o.meshInstance=a,o.node=t,r.instances.push(o),this.updateVertexBuffer(r,!0),this.frustumCulling||this.isMeshInstanceVisible(null,r),r},UranusInstancerLite.prototype.removeMeshInstance=function(e,t,a,n){if(e.mesh.skin)return!1;if("uranus-instancer-payload"===e.node.name)return!1;let s=!1;return n||(s=this.removeFromPayload(e,t,!1)),this.skipShadowCasters||a||(s=this.removeFromPayload(e,t,!0)),this.overrideMeshInstance(e),s},UranusInstancerLite.prototype.removeFromPayload=function(e,t,a){const n=e.uranusPayloadMaterial?e.uranusPayloadMaterial:e.material;if(!n)return!1;const s=this.getPayloadId(e,t,a,n),i=this.payloads[s];if(!i)return!1;if(i.refMeshInstances.length>0){const t=i.refMeshInstances.indexOf(e);if(-1===t)return!1;i.instances.splice(t,1),i.refMeshInstances.splice(t,1)}0===i.instances.length?(this.clearPayload(i),delete this.payloads[s]):(this.updateVertexBuffer(i,!0),this.frustumCulling||this.isMeshInstanceVisible(null,i))},UranusInstancerLite.prototype.clearPayload=function(e){e.vertexBuffer.destroy(),e.shadowCaster?e.layer.removeShadowCasters([e.meshInstance]):e.layer.removeMeshInstances([e.meshInstance],!0);const t=e.refMaterial;t&&(t.onUpdateShader=function(e){return e.litOptions.useInstancing=!0,e},t.update(),this.cloneMaterials&&e.meshInstance.material.destroy())},UranusInstancerLite.prototype.updateVertexBuffer=function(e,t,a){let n;n=void 0!==a?a:e.instances.length;const s=e.vertexBuffer,i=s.format;if(s.numBytes=i.verticesByteSize?i.verticesByteSize:i.size*n,t||!s.originalStorage)s.originalStorage=new Float32Array(16*n),s.setData(s.originalStorage);else{const e=s.originalStorage.subarray(0,16*n);s.setData(e)}e.meshInstance.instancingData.count=n,s.numVertices=n},UranusInstancerLite.prototype.createPayload=function(e,t,a,n){const s=this.getPayloadMaterial(t.material),i=new pc.MeshInstance(t.mesh,s,new pc.GraphNode("uranus-instancer-payload"));i.pick=!1,i.flipFaces=this.shouldFlipFaces(t.node),i.flipFacesFactor=t.node.worldTransform.scaleSign,i.castShadow=n,i.aabb.center.copy(t.aabb.center),i.aabb.halfExtents.copy(t.aabb.halfExtents),n?a.addShadowCasters([i]):a.addMeshInstances([i],!0);const r=this.app.graphicsDevice,o=new pc.VertexBuffer(r,pc.VertexFormat.getDefaultInstancingFormat(r),0,pc.BUFFER_DYNAMIC,new Float32Array);i.setInstancing(o);const c={id:e,instances:[],layer:a,meshInstance:i,refMaterial:t.material,refMeshInstances:[],shadowCaster:n,vertexBuffer:o};return c.shadowCaster&&(c.shouldUpdateShadows=!0),this.setPayloadCulling(this.frustumCulling,c),this.payloads[e]=c,c},UranusInstancerLite.prototype.setPayloadCulling=function(e,t){e?(t.meshInstance.cull=!0,t.meshInstance.isVisibleFunc=e=>this.isMeshInstanceVisible(e,t)):(t.meshInstance.cull=!1,delete t.meshInstance.isVisibleFunc)},UranusInstancerLite.prototype.isMeshInstanceVisible=function(e,t){if(this.updatePayload(t,e),t.shadowCaster&&t.shouldUpdateShadows){let e=!0;const a=t.meshInstance.aabb,n=t.instances;for(let t=0;t<n.length;t++){const s=n[t];if(s.cell)continue;const i=s.meshInstance;0!==i.visibleThisFrame&&(e?(e=!1,a.copy(i.aabb)):a.add(i.aabb))}}return!0},UranusInstancerLite.prototype.getPayloadMaterial=function(e){const t=this.cloneMaterials,a=t?e.clone():e;return a.onUpdateShader=function(e){return e.litOptions.useInstancing=!0,e},a.update(),t&&this.app.fire("UranusInstancer:materialCloned",a),a},UranusInstancerLite.prototype.onUpdate=function(){const e=this.payloads;if(e&&this.cloneMaterials)for(let t in e)this.updatePayload(e[t])},UranusInstancerLite.prototype.updatePayload=function(e,t){let a=0;const n=e.instances;for(let s=0;s<n.length;s++){const i=n[s];a=this.updateInstance(i,e,a,t)}const s=a/16;this.updateVertexBuffer(e,!1,s),this.cloneMaterials&&this.checkPayloadMaterial(e)},UranusInstancerLite.prototype.checkPayloadMaterial=function(e){const t=e.refMeshInstances[0];if(!t)return;const a=t.material!==e.refMaterial;a&&(e.refMaterial=t.material);const n=e.refMaterial;if(n&&(n.dirty||a)){const t=this.getPayloadMaterial(n);e.meshInstance.material=t,this.app.once("postrender",(function(){e.refMaterial&&(e.refMaterial.dirty=!1)}),this)}},UranusInstancerLite.prototype.updateInstance=function(e,t,a,n){if(!e.meshInstance.visible)return a;if(n){if(!this.cullInstance(e,t,n))return a}const s=t.vertexBuffer.originalStorage,i=e.data?e.data:e.node.getWorldTransform().data;for(let e=0;e<16;e++)s[a++]=i[e];return a},UranusInstancerLite.prototype.cullInstance=function(e,t,a){const n=e.meshInstance;e.data&&n.aabb.center.copy(e.cullPosition);let s=n._isVisible(a);return n.visibleThisFrame=s,s>0},UranusInstancerLite.prototype.overrideEngine=function(){const e=pc.Layer.prototype.addMeshInstances;pc.Layer.prototype.addMeshInstances=function(t,a){if(UranusInstancerLite.api&&UranusInstancerLite.api.enabled&&UranusInstancerLite.api.isLayerValid(this)){let n=[];t.forEach((e=>{UranusInstancerLite.api.addMeshInstance(e,layer=this,a,!1)||n.push(e)})),arguments[0]=n,e.apply(this,arguments)}else e.apply(this,arguments)};const t=pc.Layer.prototype.removeMeshInstances;UranusInstancerLite.removeMeshInstancesFunc=t,pc.Layer.prototype.removeMeshInstances=function(e,a){if(UranusInstancerLite.api&&UranusInstancerLite.api.enabled&&UranusInstancerLite.api.isLayerValid(this)){let n=[];e.forEach((e=>{UranusInstancerLite.api.removeMeshInstance(e,layer=this,a,!1)||n.push(e)})),arguments[0]=n,t.apply(this,arguments)}else t.apply(this,arguments)};const a=pc.Layer.prototype.addShadowCasters;pc.Layer.prototype.addShadowCasters=function(e){if(UranusInstancerLite.api&&UranusInstancerLite.api.enabled&&UranusInstancerLite.api.isLayerValid(this)){let t=[];e.forEach((e=>{UranusInstancerLite.api.addMeshInstance(e,layer=this,!1,!0)||t.push(e)})),arguments[0]=t,a.apply(this,arguments)}else a.apply(this,arguments)};const n=pc.Layer.prototype.removeShadowCasters;pc.Layer.prototype.removeShadowCasters=function(e){if(UranusInstancerLite.api&&UranusInstancerLite.api.enabled&&UranusInstancerLite.api.isLayerValid(this)){let t=[];e.forEach((e=>{UranusInstancerLite.api.removeMeshInstance(e,layer=this,!1,!0)||t.push(e)})),arguments[0]=t,n.apply(this,arguments)}else n.apply(this,arguments)}},UranusInstancerLite.prototype.overrideMeshInstance=function(e,t){t?Object.defineProperty(e,"material",{set:function(e){if(this.clearShaders)this.clearShaders();else for(let e=0;e<this._shader.length;e++)this._shader[e]=null;const a=this._material;if(a&&a.removeMeshInstanceRef(this),this._material=e,this._material){this._material.addMeshInstanceRef(this),this.updateKey();if((a&&a.blendType!==pc.BLEND_NONE)!==(this._material.blendType!==pc.BLEND_NONE)){let e=this._material._scene;!e&&a&&a._scene&&(e=a._scene),e?e.layers._dirtyBlend=!0:this._material._dirtyBlend=!0}t&&this._mesh&&t()}},get:function(){return this._material},configurable:!0}):Object.defineProperty(e,"material",{set:function(e){if(this.clearShaders)this.clearShaders();else for(let e=0;e<this._shader.length;e++)this._shader[e]=null;const t=this._material;if(t&&t.removeMeshInstanceRef(this),this._material=e,this._material){this._material.addMeshInstanceRef(this),this.updateKey();if((t&&t.blendType!==pc.BLEND_NONE)!==(this._material.blendType!==pc.BLEND_NONE)){let e=this._material._scene;!e&&t&&t._scene&&(e=t._scene),e?e.layers._dirtyBlend=!0:this._material._dirtyBlend=!0}}},get:function(){return this._material},configurable:!0})};var ScreenQuest=pc.createScript("screenQuest");ScreenQuest.prototype.postInitialize=function(){var e=this,n=e.entity,t=n.findByName("ScrollView"),o=n.findByName("Content"),i=getScript(n.findByName("Gallery"),"gallery"),s=n.findByName("ProgressBar"),a=n.findByName("ProgressBarBase"),r=n.findByName("daysField"),l=n.findByName("MissionDisplayer"),c=getChildScript(l,"Bar","bar");function onResize(){t.element.height=UISIZE.HEIGHT;let e=i.entity.pos,n=e.y-i.posY+500;o.element.height=n,i.entity.setLocalPosition(e.x,o.element.height/2-1100,0)}function onSecond(e){r.enabled=!0,r.element.text=DATE.days(e)}function refresh(){s.element.height=340*GAME.Quest.state.progression/3}function onGalleryDown(e){log("GAL DOWN",e.data)}a.element.height=2040,getLocals(i.entity),getLocals(l),SCREEN.call(e),e.onShow=function(e){TOP.show("Quest"),MUSIC.play("Quest"),i.fill(GAME.Quest.items,onGalleryDown),onResize(),on("Quest:onRefresh",refresh),r.enabled=!1,refresh(),on("QuestTimer:onSecond",onSecond),l.enabled=!1,GAME.Missions.get().then((function(e){l.enabled=!0,ANIMATION.bounceScaleTo(l,.5*l.sca.x,l.sca.x),e.start(),fill(l,e),e.stop();let n="Survive"!=e.category;c.entity.enabled=n,n&&c.setAmount(e.value||0,0,e.amount,!0),fire("Quest:onRefresh")}))},on("UI:onResize",onResize),e.onHide=function(){off("Quest:onRefresh",refresh),off("QuestTimer:onSecond",onSecond)}};var GAME_EVENTS=new function(){function unlinkGameplay(){off("UI:onSettings",pause),off("UI:offSettings",resume)}function pause(){CAMERA.FX.grayscale(),GAME.isActive&&GAME.pause()}function resume(){CAMERA.FX.stop(),GAME.isActive&&GAME.resume()}function askContinue(n){log("ASK CONTINUE!"),CAMERA.shake(.1,.1),CAMERA.FX.grayscale(),POPUPS.hideAll(),UI.block(),GAMEPLAY.onAskContinue(),steady((function(){if(n)return UPSALE.revive((function(n){GAME.onRevive(n)}));UPSALE.extraTime((function(n){GAME.onExtraTime(n)}))}),.5)}on("GAME:onPlay",(function(){log("=== GAME ON PLAY"),NAV.hide(),UI.hidePopups(),SCENES.hide(),LOADSCENE.lock(!0);let n=0;function onLoaded(){++n<2||(log("======= ON GAME and SCENE"),off("UI:onGame",onLoaded),off("SCENES:onShowGame",onLoaded),GAME.ready())}on("UI:onGame",onLoaded),on("SCENES:onShowGame",onLoaded),SCREENS.show("Game")})),on("GAME:onReady",(function(){POPUPS.hideAll(),GAMEPLAY.onReady()})),on("GAME:AskExit",(function(){GAME.pause(),DIALOG.lose((function(n){if(n)return SCORE.save(),GAME.exit(),GAME.Players.reset(),void ADPLAYER.playInterstitial((()=>SCREENS.show("Home")));GAME.resume()}))})),on("GAME:onExit",(function(){unlinkGameplay(),GAMEPLAY.onExit(),UI.hide(),FINGER.hide(),fire("JOYSTICK:Disable")})),on("GAME:onReset",(function(){})),on("GAME:onPause",(function(){log("GAME:onPause"),fire("JOYSTICK:Disable"),GAMEPLAY.pause()})),on("GAME:onResume",(function(){log("GAME:onResume"),GAMEPLAY.resume(),CONFIG.GAME.JOYSTICK.joystick&&JOYSTICK.enable()})),on("GAME:onReveal",(function(){fire("PARALLAX:Reset"),LOADSCENE.unlock(),GAMEPLAY.onReveal()})),on("GAME:onStartCountDown",(function(){COUNTDOWN.start()})),on("GAME:onStart",(function(){MUSIC.play("Game"),GAMEPLAY.onStart(),delay((()=>fire("PARALLAX:Enable")),.5),SCORE.permanentMultiplier>1&&fire("ACTIVEFX:Set",{id:"PermanentMultiplier",text:"X"+SCORE.permanentMultiplier}),CONFIG.GAME.JOYSTICK.joystick&&JOYSTICK.enable(),CONFIG.GAME.showMissions&&fire("MISSION:Show"),function linkGameplay(){on("UI:onSettings",pause),on("UI:offSettings",resume)}()})),on("GAME:onTimeUp",(function(){askContinue()})),on("GAME:onDie",(function(){log("GAMEPLAY ON DIE"),GAMEPLAY.onDie(),askContinue(!0)})),on("GAME:onContinue",(function(){log("GAME ON CONTEINUE"),CAMERA.FX.stop(),GAMEPLAY.onContinue(),fire("PARALLAX:Reset")})),on("GAME:onEnd",(function(){unlinkGameplay(),CAMERA.FX.reset(),UI.hide(),MUSIC.stop(),MUSIC.play("GameWin"),SFX.playPitchSmall("Cheers"),SFX.playPitchSmall("Impact2"),fire("ACTIVEFX:Reset"),fire("JOYSTICK:Disable"),fire("POSITIONDISPLAYER:HideAll"),GAMEPLAY.onEnd(),steady((function(){GAME.over()}),CONFIG.GAME.delayGameOverTime||1)})),on("GAME:onOver",(function(){UI.hide(),log("REWARD BONUS"),UPSALE.rewardBonus((function(){delay((function(){GAME.exit();let n=CONFIG.GAME.MULTIPLAYER.module,e="Home";if("VS"==n&&GAME.Turns.selected&&(e="VS"),"Lobby"==n&&(e="Lobby"),"Home"==e)return PLATFORM.setTournament((()=>SCREENS.show(e)));SCREENS.show(e)}),.5)}),{currency:"Coin",profits:COINS.get()*(get("ADBOOST")||1)})}))};var PropsFiller=pc.createScript("propsFiller");PropsFiller.attributes.add("amount",{title:"Amount",type:"number",default:20}),PropsFiller.attributes.add("maxDistance",{title:"Max Distance",type:"vec3",default:[100,0,100]}),PropsFiller.attributes.add("scale",{title:"Scale",type:"vec3",default:[.5,.5,.5]}),PropsFiller.prototype.initialize=function(){var e=this,t=e.entity;let a=getChildren(t);for(let l in a){let i=a[l];getLocals(i),spawn(i,i.sca);for(let a=0;a<e.amount;a++){let e=i.clone();addChild(e,t),spawn(e,i.sca)}}function spawn(t,a){t.setLocalPosition(decimal(e.maxDistance.x),decimal(e.maxDistance.y),decimal(e.maxDistance.z));let l=e.scale;t.setLocalScale(a.x+a.x*spectrumDecimal(l.x),a.y+a.y*spectrumDecimal(l.y),a.z+a.z*spectrumDecimal(l.z)),t.setLocalEulerAngles(0,spectrumDecimal(360),0)}};var GameTimerBar=pc.createScript("gameTimerBar");GameTimerBar.prototype.initialize=function(){let e=this.entity.script.bar;on("GAME:onReveal",(function(){e.setPercent(100)})),on("GAMETIMER:onSecond",(function(t){e.setPercent(t/1e3*100/CONFIG.GAME.TIME.duration)}))};function Soul_Locomotion(o){this.reset=function reset(){}}var PLATFORM,conquer,gdsdk,Wortal,YaGames,ysdk,kongregate,API_callback,PlatformConfig=pc.createScript("platformConfig");PlatformConfig.attributes.add("devConquer",{title:"Dev Conquer",type:"boolean",default:!1}),PlatformConfig.attributes.add("user",{title:"Test as User",type:"string",enum:[{Disable:"Disable"},{user001:"user001"},{user002:"user002"},{user003:"user003"}],default:"user003"}),PlatformConfig.attributes.add("platform",{title:"Platform",type:"string",enum:[{SuperSnappy:"SuperSnappy"},{Azerion:"Azerion"},{CrazyGames:"CrazyGames"},{Discord:"Discord"},{Kongregate:"Kongregate"},{VK:"VK"},{OK:"OK"},{Wortal:"Wortal"},{Yandex:"Yandex"},{Steam:"Steam"}],default:"SuperSnappy"}),PlatformConfig.attributes.add("azerionID",{title:"Azerion ID",type:"string"}),PlatformConfig.attributes.add("vkID",{title:"VK ID",type:"string"}),PlatformConfig.attributes.add("discordID",{title:"Discord ID",type:"string"}),PlatformConfig.attributes.add("steamID",{title:"Steam ID",type:"string"}),PlatformConfig.prototype.initialize=function(){let n=this;PLATFORM=n,n.proxyUser=null,"Disable"==n.user&&(n.user=null),CONFIG.add("PLATFORM",n),n.canInvite=!1,n.canShare=!1,n.setLoadingProgress=function(){},n.onFinalize=function(){},n.login=function(){},n.canLinkAccount=function(n){},n.linkAccount=function(){},n.getFriends=function(n){log("GET FRIENDS DISABLED"),n()},n.friendPicker=function(n,e){},n.inviteFriends=function(){},n.showPreroll=function(n){n&&n()},n.share=function(n,e){},n.switchToFriend=function(n,e){return e()},n.getTournament=function(n){return n(!1)},n.setTournament=function(n){return n()};var e=n.SDK={};function initConquer(){if(log("PLATFORM initialized",PLATFORM.platform,"User",n.user),"SuperSnappy"==n.platform&&(conquer=window.conquer||(window.parent&&window.parent.conquer?window.parent.conquer:null)))return doInit();let e=n.devConquer?"https://supersnappy.io/home/lib/CONQUER2.js":"https://supersnappy.io/home/lib/CONQUER.js";log("conquerLink",e),ASSETS.insertScript(e+"?date="+DATE.getNow(),(function onLoad(){log("Conquer loaded"),(conquer=new CONQUER(n.user)).init().then(doInit)}))}function doInit(){if(log("CONQUER initialized",PLATFORM.platform),!n.proxyUser)return onAuth();function onAuth(){log("onAuth",conquer.User),n.proxyUser&&"Player"==conquer.Avatars.ME.firstName&&conquer.Avatars.ME.change({firstName:n.proxyUser.firstName,lastName:n.proxyUser.lastName||""}),conquer.Signal.get("AUTH:onLogin",onLogin),ME=conquer.Avatars.ME,n.getFriends((function(){log("Ready to init game"),GameInit((function(){IAP.init(),ADPLAYER.init(),n.showPreroll(),log("==PLATFORM:onInit"),fire("PLATFORM:onInit")}))}))}conquer.Auth.get(n.proxyUser).then(onAuth)}function onLogin(){if(log("AUTH:onLogin",conquer.User),!get("AuthPopup"))return doLogin();on("AuthPopup",checkAuthPopup)}function checkAuthPopup(n){log("checkAuthPopup",n),n||(off("AuthPopup",checkAuthPopup),doLogin())}function doLogin(){log("DO LOGIN",conquer.User),ME=conquer.Avatars.ME,n.getFriends((function(){GAME.init().then((function(){SCREENS.show("Planet")}))}))}e.Azerion=function(e){n.showPreroll=function(){ADPLAYER.playInterstitial((function(){}))},window.GD_OPTIONS={gameId:n.azerionID,onEvent:function(n){switch(log("AZERION EVENT",n.name),n.name){case"SDK_READY":log("Azerion SDK ready",e),e(),e=null;break;case"SDK_GAME_START":fire("SOUNDS:Mute",!1);break;case"SDK_GAME_PAUSE":PLATFORM.pause();break;case"SDK_GDPR_TRACKING":case"SDK_GDPR_TARGETING":break;case"SDK_REWARDED_WATCH_COMPLETE":PLATFORM.resume()}}},ASSETS.insertScript("https://html5.api.gamedistribution.com/main.min.js")},e.CrazyGames=function(e){function getUser(n){function doIt(e){n(parseUser(e))}window.CrazyGames.SDK.user.getUser((function(n,e){if(log("getUser",n,e),e)return doIt(e);UI.showLoader(),window.CrazyGames.SDK.user.showAuthPrompt((function(n,e){UI.hideLoader(),log("showAuthPrompt",n,e),e&&doIt(e)}))}))}function parseUser(n){return{username:"CG_"+n.id,firstName:n.username,type:"CrazyGames"}}n.login=function(){getUser((function(n){conquer.Auth.get(n)}))},n.canLinkAccount=function(e){"USERNAME"==conquer.User.type&&n.isCGUserAccountAvailable&&conquer.Auth.getProxy().then((function(n){let t=!1;for(let e in n)if("CrazyGames"==n[e].type){t=!0;break}t||e()}))},n.linkAccount=function(){getUser((function(n){window.CrazyGames.SDK.user.showAccountLinkPrompt((function(e,t){e||"yes"!=t.response||(UI.showLoader(),n.usernameID=conquer.User.usernameID,conquer.Auth.get(n).then((function(n){if(n.error)return DIALOG.customError(n.error)})))}))}))};var t=!1;function onPause(){t&&(t=!1,window.CrazyGames.SDK.game.gameplayStop())}function onResume(){t||(t=!0,GAME.isActive&&GAME.isAlive&&window.CrazyGames.SDK.game.gameplayStart())}on("TOY:onFinalize",(function(){window.CrazyGames.SDK.game.sdkGameLoadingStop()})),on("VS:onVictory",(function(){window.CrazyGames.SDK.game.happytime()})),on("GAME:onStart",onResume),on("GAME:onResume",onResume),on("GAME:onTimeUp",onPause),on("GAME:onDie",onPause),on("GAME:onContinue",onResume),on("GAME:onPause",onPause),on("GAME:onEnd",onPause),on("GAME:onExit",onPause),ASSETS.insertScript("https://sdk.crazygames.com/crazygames-sdk-v2.js"),start((function waiting(){if(!window.CrazyGames)return;stop(waiting),window.CrazyGames.SDK.game.sdkGameLoadingStart(),window.CrazyGames.SDK.user.isUserAccountAvailable((function(e,t){log("isUserAccountAvailable",t),n.isCGUserAccountAvailable=t})),window.CrazyGames.SDK.user.addAuthListener((function(n){log("on CG Login"),fire("LINKACCOUNT:Refresh")})),window.CrazyGames.SDK.user.getUser((function(t,o){log("getUser",t,o),o&&(n.proxyUser=parseUser(o)),e()}))}))},e.Wortal=function(e){function onTournament(e,t){if(log("ON TOURNAMENT",e),e.id)return n.tournamentID=e.id,t(!0);t(!1)}on("TOY:onFinalize",(function(){Wortal&&Wortal.player.canSubscribeBotAsync().then((function(n){n&&Wortal.player.subscribeBotAsync()}))})),n.getFriends=function(e){Wortal.player.getConnectedPlayersAsync().then((function(t){if(n.canInvite=n.canShare=!0,!t||!t.length)return e();let o=[];for(let n in t)o.push("Wortal_"+t[n].id+"_WORTAL");conquer.Friends.setUsernames(o).then(e)})).catch((n=>{log("Cant get friends, move on"),e()}))},n.inviteFriends=function(n){STICKER.get(null,null,(function(e){Wortal.context.inviteAsync({image:e,text:ME.firstName+" wants to play with you!",cta:"Play",data:{}}).then((function(e){n&&n()}))}))},n.friendPicker=function(n){Wortal.context.chooseAsync().then(console.log(Wortal.context.getId()))},n.switchToFriend=function(e,t){function doCallback(){t&&t()}function onSwitchContext(){n.postToChat(),doCallback()}conquer.Username.getFromAvatarID(e).then((function(n){if(!n)return doCallback();n=n.replace("Wortal_","").replace("_WORTAL",""),Wortal.context.createAsync(n).then(onSwitchContext).catch(doCallback)}))},n.getContextPlayers=function(n){Wortal.context.getPlayersAsync().then((n=>{console.log(n.length),console.log(n[0].id),console.log(n[0].name)}))},n.share=function(n,e){n=n||{},STICKER.get(null,n,(function(t){Wortal.context.shareAsync({image:t,text:n.text||ME.firstName+" wants to play with you!",caption:"Play",data:{}}).then((function(n){e&&e()}))}))},n.postToChat=function(n){n=n||{},STICKER.get(null,n,(function(e){Wortal.context.updateAsync({image:e,text:n.text||ME.firstName+" wants to play with you!",caption:"Play",data:{}})}))},n.getTournament=function(n){Wortal.tournament.getCurrentAsync().then((e=>{log("CURRENT TOURNAMENT",e),onTournament(e,n)})).catch((function(e){return n(!1)}))},n.setTournament=function(e){if(n.tournamentID)return n.tournamentID==Wortal.context.getId()?doPostScore():joinTheTournament();function joinTheTournament(){!function joinTournament(e,t){Wortal.tournament.joinAsync(e).then((function(o){if(o.id)return log("JOINED TOURNAMENT",e),n.tournamentID=o.id,t(!0);t(!1)})).catch((()=>t(!1)))}(n.tournamentID,(function(n){if(n)return doPostScore();e(!1)}))}function doPostScore(){Wortal.tournament.postScoreAsync(SCORE.get()).then((function(){!function shareTournament(n){Wortal.tournament.shareAsync({score:SCORE.get(),data:{}}).then((function(){n()})).catch((function(e){n()}))}(e)})).catch(e)}!function getAllTournaments(n){Wortal.tournament.getAllAsync().then((e=>{if(log("GOT TOURNAMENTS",e),!e.length)return n(!1);onTournament(ARRAY.getRandomItem(e),n)})).catch((()=>n(!1)))}((function(n){if(n)return joinTheTournament();!function createTournament(n){Wortal.tournament.createAsync({initialScore:SCORE.get(),config:{title:"Tournament"},data:{}}).then((e=>{log("CREATED TOURNAMENT",e),onTournament(e,n)})).catch((function(e){log("COULD NOT CREATE TOURNAMENT",e),n(!1)}))}(e)}))},n.getAllTournaments=function(n){return n()},n.setLoadingProgress=function(n){Wortal&&Wortal.setLoadingProgress(n)},n.onFinalize=function(){Wortal.setLoadingProgress(100),Wortal.startGameAsync(),stop(loadingProgress)};let t=10;function loadingProgress(){t>99||(t+=.08,Wortal.setLoadingProgress(t))}ASSETS.insertScript("https://storage.googleapis.com/html5gameportal.com/wortal-sdk/wortal-core-1.6.4.js",(function onLoad(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",addLoader):addLoader();function addLoader(){const n=document.createElement("script");n.type="text/javascript",n.text="var app = pc.Application.getApplication();\n                    app.on('preload:progress', setProgress);\n                    function setProgress(value) {\n                        if (window.Wortal) {\n                            window.Wortal.setLoadingProgress(value * 100);\n                        }\n                    }",document.body.appendChild(n)}start((function doLogin(){if(!Wortal.isInitialized)return;stop(doLogin);let t,o,r=Wortal.player.getName();r&&(r=r.split(" "),t=r[0],o=r[1]),n.proxyUser={username:"Wortal_"+Wortal.player.getID(),type:"WORTAL",firstName:t,lastName:o},Wortal.notifications&&(Wortal.notifications.cancelAllAsync(),Wortal.notifications.scheduleAsync({title:"Your energy is full!",body:"Your energy is full, come back and play again.",mediaURL:"https://supersnappy.io/images/Logo512.png",label:"resources-full",scheduleInterval:900}),Wortal.notifications.scheduleAsync({title:"Your bonus is ready!",body:"Your bonus is ready, collect it!",mediaURL:"https://supersnappy.io/images/Logo512.png",label:"12-hours",scheduleInterval:43200}),Wortal.notifications.scheduleAsync({title:"Someone is beating your score!",body:"Someone is beat your score, beat them back!",mediaURL:"https://supersnappy.io/images/Logo512.png",label:"24-hours",scheduleInterval:86400}),Wortal.notifications.scheduleAsync({title:"It's your turn to play!",body:"It's your turn, let's play",mediaURL:"https://supersnappy.io/images/Logo512.png",label:"48-hours",scheduleInterval:172800}),Wortal.notifications.scheduleAsync({title:"Your Lootbox is ready!",body:"Your Lootbox is ready, collect it!",mediaURL:"https://supersnappy.io/images/Logo512.png",label:"3-days",scheduleInterval:345600})),e()})),start(loadingProgress)}))},e.Yandex=function(e){ASSETS.insertScript("https://yandex.ru/games/sdk/v2",(function onLoad(){function shortcut(){ysdk.shortcut.canShowPrompt().then((n=>{n.canShow&&ysdk.shortcut.showPrompt().then((n=>{n.outcome}))})),e()}YaGames.init().then((e=>{console.log("Yandex SDK initialized"),ysdk=window.ysdk=e,function getPlayer(){ysdk.getPlayer().then((e=>{if(e){let t,o,r=e.getName();r&&(r=r.split(" "),t=r[0],o=r[1]),n.proxyUser={username:"Yandex_"+e.getUniqueID(),type:"YANDEX",firstName:t,lastName:o}}shortcut()})).catch((n=>{shortcut()}))}()}))})),on("TOY:onFinalize",(function(){ysdk&&ysdk.features.LoadingAPI?.ready()}))},e.VK=function(n){ASSETS.insertScript("https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js",(function onLoad(){console.log("VK SDK initialized"),vkBridge.send("VKWebAppInit",{}),n()})),on("TOY:onFinalize",(function(){}))},e.Kongregate=function(e){ASSETS.insertScript("https://cdn1.kongregate.com/javascripts/kongregate_api.js",(function onLoad(){function getUser(){let t=kongregate.services.getUsername().split(" ");n.proxyUser={username:"Kongregate_"+kongregate.services.getUserId(),type:"Kongregate",firstName:t[0],lastName:t[1]},e()}console.log("Kongregate SDK initialized"),kongregateAPI.loadAPI((function(){if((kongregate=window.kongregate=kongregateAPI.getAPI()).services.connect(),kongregate.services.isGuest())return kongregate.services.showRegistrationBox(),void kongregate.services.addEventListener("login",(function(){getUser()}));getUser()}))})),on("TOY:onFinalize",(function(){}))},e.OK=function(n){let e,t;API_callback=window.API_callback=function(n,e,t){return"loadAd"==n?fire("OK:onAdLoaded",e):"showLoadedAd"==n?fire("OK:onAdComplete",e):"showAd"==n?fire("OK:onAdComplete",e,t):void 0},ASSETS.insertScript("https://api.ok.ru/js/fapi5.js",(function onLoad(){log("OK API LOADED");var o=FAPI.Util.getRequestParameters();e=o.api_server,t=o.apiconnection,FAPI.init(e,t,(function(){init(),FAPI.Util.getRequestParameters().logged_user_id}),(function(n){})),n()})),on("TOY:onFinalize",(function(){}))},log("PLATFORM",CONFIG.PLATFORM),e[n.platform]?e[n.platform](initConquer):initConquer(),n.isLogged=function isLogged(e){return n.user||"GUEST"!=conquer.User.type?(e&&e(),e=null,!0):(POPUPS.show("Auth"),!1)},n.pause=function(){SOUNDS.mute(),UI.showLoader()},n.resume=function(){SOUNDS.unmute(),UI.hideLoader()}};var Rotator=pc.createScript("rotator");Rotator.prototype.initialize=function(){},Rotator.prototype.update=function(t){this.entity.rotate(0,2,0)};var SlotMachine=pc.createScript("slotMachine");function ReelItem(e,n,t,o){var l,i,a=this,s=(n=n,t=t,!1),u=0,r={},c=0,S=!1,p=(o=o||15,!1),f=0;function onStop(){i=null,s=!1,t(c)}(e=e).setLocalEulerAngles(60*-RANDOM.value(6)+o,0,0),a.pause=function(){l=!0,i&&i.pause()},a.pause=function(){l=!1,i&&i.resume()},a.spin=function(e,t){SFX.playPitch("SlotStopping"),f=10+15*n,(p=n>=1&&t)&&(f*=2*n),c=e,u=0,S=!0,i=delay((function(){i=null,s=!0}),.05*n)},a.update=function(){if(s&&!l)if(S){if(e.rotateLocal(u,0,0),(u+=1.5)>f){var t=60*-c+o,a=p?1:.5;r.vel=u,S=!1,r.angle=t-360,p&&(r.angle-=360*n),e.setLocalEulerAngles(r.angle,0,0),ANIMATION.varsTo(r,{angle:t+5,vel:0},a,EASING.SineOut),i=delay((function(){SFX.playPitchSmall("SlotEnd"),ANIMATION.varsTo(r,{angle:t},.5,EASING.ElasticOut),i=delay(onStop,.2)}),a)}}else u=r.vel,e.setLocalEulerAngles(r.angle,0,0)}}SlotMachine.attributes.add("offsetR",{type:"number",default:15}),SlotMachine.attributes.add("rotateOnWin",{type:"boolean",default:!0}),SlotMachine.attributes.add("hasUpAnim",{type:"boolean",default:!0}),SlotMachine.prototype.postInitialize=function(){for(var e,n,t=this,o=t.entity,l=[],i=setSpinning(!1),a=o.findByName("Arrows"),s=o.findByName("CoinSpawner"),u=DEPTH.getChildren(o.findByName("Slots")),r=0;r<u.length;r++)l.push(new ReelItem(u[r],r,(function(e){onStopReel(e)}),t.offsetR));function setSpinning(e){return i=DATA.display("SLOTMACHINE:isSpinning",e)}function onStopReel(n){if(t.results.push(n),!(t.results.length<l.length)){a.enabled=!0,ANIMATION.bounceScaleTo(a,1.2,1,2),leverUp(),SFX.playPitchSmall("Kaching");var i=e.varName,u=e.value;if(fire("SLOTMACHINE:onResult",e),"Coin"==i)return ANIMATION.bounceAngle(o,null,RANDOM.value(30,20),"y"),FX3D.SPLATT.fountain({particle:"COIN_Particle",entity:s,scale:.15,forceY:15,velY:15,forceZ:4,velZ:3,velX:5,endScale:2,amount:50}),WALLET.Coin.increase(u),fire("SLOTMACHINE:TextPayout",STRING.commarize(u)),doComplete();ANIMATION.bounceAngle(o,null,10,"x"),fire("SLOTMACHINE:TextPayout",i.toUpperCase()),FX3D.CONFETTI.sides({scale:.25}),delay((function(){"Energy"==i&&(fire("SLOTMACHINE:ShowCloseUp",i),delay((function(){WALLET.Energy.increase(u),doComplete()}),2)),"Shield"==i&&(fire("SLOTMACHINE:ShowCloseUp",i),delay((function(){WALLET.Shield.collect(1,null,!0),doComplete()}),2)),"Heist"!=i&&"Attack"!=i||(fire("SLOTMACHINE:ShowCloseUp",i),delay((function(){SCREENS.show("Planet",{callback:()=>SCREENS.show("Land",{state:i})})}),2))}),.5)}function doComplete(){TOP.show(),NAV.show(),fire("SLOTMACHINE:onStop")}}function leverUp(){fire("SLOTMACHINE:ButtonRelease")}on("SLOTMACHINE:Spin",(function spin(){isBigWin=!1,a.enabled=!1,setSpinning(!0),t.results=[],SFX.playPitch("Spin"),increase("totalSlotMachineSpins"),display("SLOTMACHINE:isSpinning",!0),fire("SLOTMACHINE:TextPayout",!1);var n=(e=PAYOUTS.get()).slots[0]==e.slots[1];for(var o in l)l[o].spin(e.slots[o],n);!function leverDown(){fire("SLOTMACHINE:ButtonDown")}()})),on("SLOTMACHINE:Pause",(function pause(){for(var e in n=!0,l)l[e].pause&&l[e].pause()})),on("SLOTMACHINE:Resume",(function resume(){for(var e in n=!1,l)l[e].resume&&l[e].resume()})),leverUp(),t.onUpdate=function(e){if(i&&!n)for(var t in l)l[t].update()}},SlotMachine.prototype.update=function(){this.onUpdate()};var ParallaxLane=pc.createScript("parallaxLane");ParallaxLane.attributes.add("id",{title:"ID",type:"string"}),ParallaxLane.attributes.add("prefill",{title:"Prefill",type:"number",default:2}),ParallaxLane.attributes.add("despawnPos",{title:"De-Spawn Pos",type:"vec3",default:[-17,0,0]}),ParallaxLane.attributes.add("biggerThan",{title:"BiggerThan",type:"boolean",default:!0}),ParallaxLane.attributes.add("invertSpawnDirection",{title:"invertSpawnDirection",type:"boolean",default:!1}),ParallaxLane.attributes.add("speed",{title:"Speed",type:"number",default:0}),ParallaxLane.prototype.postInitialize=function(){var e=this,t=e.entity;e.id||t.name;let a=getChildrenNames(t),n={},i=new pc.Vec3,l=[],r=new Cue(!0);var o=1;let s="x";e.despawnPos.y&&(s="y"),e.despawnPos.z&&(s="z");let p=e.despawnPos[s];for(let e in a){a[e]=a[e].script.parallaxSegment;for(let t=0;t<4;t++)r.push(e);remove(a[e])}function spawnSegment(){let n=r.get(),o=getUnusedPool(n).shift()||a[n].entity.clone().script.parallaxSegment;addChild(o.entity,t),o.spawn(i),l.push(o),e.invertSpawnDirection?i.x+=o.margin:i.x-=o.margin}function remove(e){let t=getUnusedPool(e.id);e.entity.setPosition(e.entity.getPosition().x-99999999,0,0),t.push(e)}function getUnusedPool(e){return n[e]||(n[e]=[]),n[e]}e.reset=function(){for(i=new pc.Vec3;l.length;)remove(l.shift());l=[];for(let t=0;t<e.prefill;t++)spawnSegment()},e.setSpeedMultiplier=function(e){o=e},e.onUpdate=function(){let t=l[0];if(!t)return;if(e.speed){let t=e.speed*o*DT;i.x+=t;for(let e in l)l[e].onUpdate(t)}let a=CAMERA.entity.getPosition()[s]-t.entity.getPosition()[s];if(e.biggerThan){if(a>p)return}else if(a<p)return;l.shift(),remove(t),spawnSegment()}};var FxFire=pc.createScript("fxFire");FxFire.attributes.add("hasSmoke",{type:"number",default:1}),FxFire.attributes.add("useSprites",{type:"number",default:0}),FxFire.attributes.add("scale",{type:"number",default:0}),FxFire.attributes.add("space3D",{type:"boolean",default:!0}),FxFire.attributes.add("autoStart",{type:"boolean",default:!1}),FxFire.attributes.add("hasFire",{type:"boolean",default:!0}),FxFire.attributes.add("useParent",{type:"boolean",default:!1}),FxFire.attributes.add("randomX",{type:"number",default:0}),FxFire.attributes.add("randomZ",{type:"number",default:0}),FxFire.prototype.initialize=function(){var e=this,t=e.entity;e.sinCount=RANDOM.decimal(),e.Ash=t.findByName("Ash"),e.Burn=DEPTH.getChild(t,"Burn"),e.fireSprite="FX_Blur",e.smokeSprite="FX_Blur",e.layers=[TOY.app.scene.layers.getLayerByName("World").id],e.myforceZ=0,e.count1=RANDOM.value(10),e.count2=RANDOM.value(10),e.count3=RANDOM.value(10),e.count4=RANDOM.value(10),e.count5=RANDOM.value(10),t.fireScript=e,e.scale=e.scale||t.getLocalScale().x,e.Burn&&(e.Burn.element.opacity=0),e.isActive=!1,e.Ash&&(e.Ash.enabled=!1),e.autoStart&&e.start()},FxFire.prototype.setPlaying=function(e){if(e)return this.start();this.stop()},FxFire.prototype.start=function(){var e=this;e.isActive=!0,e.entity.enabled=!0,e.Ash&&(e.Ash.enabled=!0,ANIMATION.bounceScaleTo(e.Ash,0,1,2)),e.Burn&&(e.Burn.element.opacity=.5)},FxFire.prototype.explode=function(){var e=this;e.start();var t=e.entity;e.scale,t.getLocalPosition();FX2D.SHOCKWAVE.play({sprite:"FX_Condense",color:"#ffe000",entity:t,time:.6})},FxFire.prototype.stop=function(){var e=this;e.isActive&&(e.isActive=!1,e.Ash&&(e.Ash.enabled=!1),e.Burn&&ANIMATION.fadeOut(e.Burn))},FxFire.prototype.update=function(e){var t=this;if(t.isActive){var a,i,r,s,c=t.entity,l=t.space3D?c.getPosition():c.getLocalPosition(),o=t.space3D?UI.FX3D:c;t.useParent&&(o=c.parent),o=c,l=pc.Vec3.ZERO;var n=t.scale,u=["#f33908","#ff8600","#ffe000"];if(t.sinCount+=.1,++t.count5,++t.count4,++t.count3,++t.count2,++t.count1,t.hasSmoke&&(t.count4>=30&&(FX2D.SMOKE.play({layers:t.layers,sprite:"FX_Blur",forceZ:t.myforceZ,x:.1*Math.sin(t.sinCount)*n+l.x+RANDOM.spectrumDecimal(t.randomX),y:RANDOM.decimal(.2)*n+l.y,z:.1*Math.cos(t.sinCount)*n+l.z+RANDOM.spectrumDecimal(t.randomX),sinVelS:RANDOM.decimal()*n,offsetX:RANDOM.spectrumDecimal(10)*n,alpha:RANDOM.decimal(1,.7),endAlpha:0,scale:RANDOM.decimal(.05,.02)*n,endScale:RANDOM.decimal(.3,.2)*n,speedY:RANDOM.decimal(5,2)*n*.4*.1,speedX:RANDOM.decimal(.3,.1)/2*n,time:RANDOM.decimal(8,5),space3D:t.space3D,parent:o}),t.count4=RANDOM.value(20)),t.count5>=15)){t.count5=RANDOM.value(10),r=RANDOM.spectrumDecimal(10),z=RANDOM.spectrumDecimal(30);FX2D.SMOKE.play({layers:t.layers,sprite:t.smokeSprite,forceZ:t.myforceZ*n,x:.1*-Math.sin(t.sinCount)*n+l.x+RANDOM.spectrumDecimal(t.randomX),z:.1*-Math.cos(t.sinCount)*n+l.z+RANDOM.spectrumDecimal(t.randomZ),y:RANDOM.decimal(.2,0)*n+l.y,sinVelX:RANDOM.decimal()*n,color:["#c5aeab","#6e6867","#ac9d98"],speedX:.01,alpha:RANDOM.decimal(.8,.02),speedY:RANDOM.decimal(5,2)*n*.2,endAlpha:0,offsetX:r*n,offsetZ:z*n,scale:RANDOM.decimal(.3,.1)*n,endScale:.3*n,space3D:t.space3D,time:RANDOM.decimal(10,8),parent:o})}t.hasFire&&(t.count3>=20&&(i=a=RANDOM.decimal(.09,.03)*n*2,r=RANDOM.spectrumDecimal(60),s=RANDOM.spectrumDecimal(60),z=0,FX2D.FADE.vanish({layers:t.layers,sprite:t.fireSprite,offsetY:s,offsetX:r,offsetZ:z,color:u,parent:c,space3D:t.space3D,scale:a,scaleY:i,anchorY:.5,alpha:.7,endAlpha:0}),t.count3=RANDOM.value(15)),t.count2>=40&&(i=a=.7*RANDOM.decimal(.09,.03)*n*2,r=RANDOM.spectrumDecimal(60),s=RANDOM.spectrumDecimal(60),z=0,FX2D.FADE.vanish({layers:t.layers,sprite:t.fireSprite,offsetY:s,offsetX:r,offsetZ:z,color:u,parent:c,space3D:t.space3D,scale:a,scaleY:i,anchorY:.5,alpha:.7,endAlpha:0,billboard:!0}),t.count2=RANDOM.value(20)),t.count1>=60&&(i=a=1.6*RANDOM.decimal(.09,.03)*n*2,r=RANDOM.spectrumDecimal(60),s=RANDOM.spectrumDecimal(60),z=0,FX2D.FADE.vanish({layers:t.layers,sprite:t.fireSprite,offsetY:s,offsetX:r,offsetZ:z,color:u,parent:c,space3D:t.space3D,scale:a,scaleY:i,anchorY:.5,alpha:.3,endAlpha:0,billboard:!0}),t.count1=RANDOM.value(20)))}};class FW_Level extends FW_Manager{init(){const e=this.scene,r=this.group;e.on("physics:world-prepared",(function prepareLevel(){r.fire("prepare-level")})),e.on("vehicle:generated",(function onVehicleGenerated(e){r.fire("vehicle-generated",e)})),e.on("ready",(function startSimulation(){r.fire("simulate")}))}}pc.registerScript(FW_Level,"FW_Level");var DICTIONARY=new function(){let n=[],t=this;t.set=function(t,e){if(null==t)return e();ASSETS.loadJSON(t,(function(t){n=t.words.split(","),e()}))},t.get=function(){return getRandomItem(n)},t.search=function(t){return n.includes(t.toLowerCase())}};var SlotmachineButton=pc.createScript("slotmachineButton");SlotmachineButton.prototype.initialize=function(){var n,t=this,e=!1,o=new DelayUnique,i=new DelayUnique,u=!1;function spin(){if(WALLET.Energy.value<=0)return e=!1,setAuto(!1),o.cancel(),i.cancel(),n=!1,fire("SLOTMACHINE:ButtonRelease"),UPSALE.noEnergy();WALLET.Energy.decrease(1),n=!0,fire("SLOTMACHINE:Spin")}function setAuto(n){u=display("SLOTMACHINE:isAuto",n)}on("SLOTMACHINE:onStop",(function onStop(){if(n=!1,!u)return;i.start((function(){spin()}),1)})),t.onMousePress=function(){setAuto(!1),i.cancel(),n||(e=!0,display("SLOTMACHINE:isAuto",u),o.start((function(){setAuto(!0)}),.8),spin())},t.onMouseDown=t.onMouseUp=function(){e&&(e=!1,o.cancel())}};var ParallaxSegment=pc.createScript("parallaxSegment");ParallaxSegment.attributes.add("margin",{title:"Margin",type:"number",default:1}),ParallaxSegment.attributes.add("randomFlip",{title:"randomFlip",type:"boolean",description:"if enabled, the segment will randomly rotate Y to 180 degrees",default:!1}),ParallaxSegment.prototype.postInitialize=function(){var e=this,t=e.entity,a=(e.id=t.name,getChildren(t)),n=[];let l=new pc.Vec3;for(let e in a)a[e].enabled&&n.push(a[e].script.parallaxItems);e.spawn=function(a){t.setLocalPosition(a);var l=!!e.randomFlip&&RANDOM.boolean();t.setLocalEulerAngles(0,l?180:0,0);for(let t in n)n[t].spawn(e.margin)},e.onUpdate=function(e){l.copy(t.getLocalPosition()),l.x+=e,t.setLocalPosition(l)}};var ActiveFxinstance=pc.createScript("activeFxinstance");ActiveFxinstance.prototype.initialize=function(){var e,t,n=this,i=n.entity,a=i.findByName("textField"),o=i.findByName("titleField"),l=i.findByName("symbolSprite"),r=i.findByName("Header"),d=(i.findByName("Base"),getScript(i.findByName("Bar"),"bar"));function onSecond(e){d.setAmount(e,n.data.duration)}function onTimeUp(){}n.fill=function(i){if(function createTimer(t){if(!t.duration)return void(d.entity.enabled=!1);e||(e=TIMER.spawn());e.start({duration:t.duration,onTimeUp:onTimeUp,onSecond:!0}),e.onSecond=onSecond}(i),t==i.id)return function refresh(e){e.text&&(a.enabled=!0,a.element.text=e.text)}(i);t=n.id=i.id,c.get(i),i.color=i.color||"WHITE",l.enabled=o.enabled=a.enabled=r.enabled=!1,i.symbol||(o.enabled=i.title,a.enabled=i.text,r.enabled=o.enabled),fill(n,i)},n.disable=function(){t=n.id=null,e&&e.stop()};var c={get:function(e){c[e.id]&&extract(c[e.id](),e)},PermanentMultiplier:function(){return log("PermanentMultiplier"),{title:"BONUS",color:"#FFD500"}},ScoreMultiplier:function(){return log("ScoreMultiplier"),{title:"COMBO"}}}};var PLAYER,LocomotionController=pc.createScript("locomotionController");LocomotionController.attributes.add("useCompass",{type:"boolean"}),LocomotionController.prototype.postInitialize=function(){let n,t,e,i,o=this,c=o.entity,a=c.findByName("Body"),r=c.findByName("Compass"),u=c.findByName("CinemaCamera"),l=getScript(u,"cinemaCamera"),s={},p=new pc.Vec3,d=new pc.Vec3,f=new pc.Vec3,m=new pc.Vec3,y=new pc.Vec3,b=!0;getGlobals(c);var A=o.STATE=new STATEMACHINE;o.spawn=function(a={}){e=a.Avatar,i=a.Soul,s=i.vars,t=a.isME,c.rb.teleport(a.position||c.gPos),o.setInput(a.Input),n&&o.enable()},o.setInput=function(t){n&&n.disable(),n=t},o.enable=function(){isEnabled=!0,t&&o.activateCamera(),A.do(A.OnIdle),start(doUpdate),n&&n.enable()},o.disable=function(){isEnabled=!1,c.enabled&&resetInputs(),stop(doUpdate),n&&n.disable()},o.activateCamera=function(){l.enable()},o.disableCamera=function(){l.disable()};const h={membership:["DEFAULT"],filter:["TERRAIN"]};let C=new pc.Mat4,O=new pc.Quat,w=new pc.Vec3;function doUpdate(){if(s.jumpForce?function checkOnAir(){function onResult(n){b=!n}m.copy(c.getPosition()),m.y+=.3,y.copy(m),y.y-=.4,PHYSICS.raycastFirst(m,y,onResult,{filter:h})}():b=!1,w.copy(c.getPosition()),w.y=d.y,C.setLookAt(w,d,pc.Vec3.UP),O.setFromMat4(C),o.useCompass&&r.setRotation(O),O.slerp(a.getRotation(),O,.2),a.setRotation(O),o.x=w.x,o.y=w.y,o.z=w.z,e&&(e.vars.x=o.x,e.vars.y=o.y,e.vars.z=o.z),!n.isActive)return resetInputs();let t=-1*n.y,i=-1*n.x;m.copy(u.forward).mulScalar(t),p.copy(u.right).mulScalar(i),p.add(m),d.copy(p).mulScalar(-1).add(c.getPosition()),f.copy(p).mulScalar(s.walkSpeed),f.y=c.rb.linearVelocity.y,c.rb.linearVelocity=f,A.get().update()}function resetInputs(){m.copy(c.rb.linearVelocity),m.y=Math.max(m.y,-40),m.y=c.rb.linearVelocity.y,m.x=m.z=0,c.rb.linearVelocity=m,A.get().update()}var S=o.ACTIONS={};S.Disable=function(){},S.Enable=function(){},S.Idle=function(){o.jumpCount=0},S.Run=function(){},S.Sprint=function(){onAir},S.Jump=function(n){o.jumpCount>=2||!o.canDoubleJump||(++o.jumpCount,c.rb.linearVelocity.y=n||s.jumpForce)},S.SuperJump=function(){b||S.Jump(2*s.jumpForce)},S.Roll=function(){},S.OnAir=function(){},S.Roll=function(){},S.Slide=function(){},S.WallRun=function(){o.gravity=0,o.WallSlide()},S.WallSlide=function(){o.jumpCount=0},S.Ragdoll=function(){},S.Kinematic=function(){return o.gravity=0,A.do(A.OnKinematic),A.get(A.OnKinematic)},A.Checks=new function(){this.checkOnAir=function(){if(b)return A.do(A.OnAir)}},A.OnIdle=new function(){this.desiredAnimation="Idle",this.update=function(){A.get(A.Checks).checkOnAir(),n.isActive&&A.do(A.OnRun)}},A.OnAir=new function(){this.desiredAnimation="OnAir",this.update=function(){this.desiredAnimation=c.rb.linearVelocity.y>0?"Jump":"OnAir"}},A.OnRun=new function(){this.desiredAnimation="Run",this.update=function(){A.get(A.Checks).checkOnAir(),n.isActive||A.do(A.OnIdle)}},A.OnWall=new function(){},A.OnSlide=new function(){},A.OnRoll=new function(){},A.OnKinematic=new function(){this.desiredAnimation="Idle";let n=!1;this.onEnter=function(){c.rb.type="kinematic",n=!0},this.onExit=function(){c.rb.type="dynamic"},this.setAnimation=function(n){this.desiredAnimation=n},this.finish=function(){n=!1,A.do(A.OnIdle)},this.canDo=function(t){return!n}}};var ScrollViewController=pc.createScript("scrollViewController");ScrollViewController.prototype.initialize=function(){var o=this.entity,l=o.scrollview;on("TOUCH:onDown",(function onDown(){n=!0,t=!1,e=l.scroll.y})),on("TOUCH:onUp",(function onUp(){n=!1,t&&o.enabled&&delay((()=>UI.unblock()),.01);t=!1}));let n,t,e=0;this.onUpdate=function(){n&&!t&&(Math.abs(l.scroll.y-e)<.002||(t=!0,UI.block()))}},ScrollViewController.prototype.update=function(o){this.onUpdate()};var ButtonUrl=pc.createScript("buttonUrl");ButtonUrl.attributes.add("url",{type:"string"}),ButtonUrl.prototype.initialize=function(){var t=this;BUTTON.call(t),t.click=function(){SFX.play("Button"),window.open(t.url)}};var LinkAccount=pc.createScript("linkAccount");LinkAccount.prototype.initialize=function(){var n=this.entity.findByName("Button");function refresh(){log("LinkAccount Refresh"),function hide(){n.enabled=!1}(),delay((function(){PLATFORM.canLinkAccount(show)}),3)}function show(){n.enabled=!0}this.onMouseDown=function(){PLATFORM.linkAccount()},on("LINKACCOUNT:Refresh",refresh),conquer.Signal.get("AUTH:onLogin",refresh),refresh()};var ADS,ADPLAYER=new function(){var o=this;ADS=o;o.pool=[];var r=o.Rewarded=[],e=o.Interstitial=[];function push(r){let e=new ADPlayer(r);ADPLAYER.pool.push(e),o[r].push(e)}o.hasRewardedLoaded=!0,o.init=function(){log("INTIALIZING ADS"),DATE.getNow(),push("Rewarded"),push("Interstitial")};o.playInterstitial=function(o){var r=function getInterstitial(){for(var o in e)if(e[o].isLoaded)return e[o]}();if(!r)return o();DATE.getNow(),r.play(o,!0)},o.playRewarded=function(e){let n=function getRewarded(){for(var o in r)if(r[o].isLoaded)return r[o]}();if(!n)return o.noAds();DATE.getNow(),n.play(e,!1)},o.refresh=function(){for(var e in o.hasRewardedLoaded=!1,r)if(r[e].isLoaded)return o.hasRewardedLoaded=!0,void fire("ADS:onRewardedLoaded")},o.noAds=function(o){DIALOG.noAds((function(){o&&o(!1)}))}};function ADPlayer(o){var r,e=this,n=0,a=null,d=!1;function setLoaded(o){e.isLoaded=o,ADPLAYER.refresh()}function onLoadError(r){if(log(o,"onLoadError",r),setLoaded(!1),ANALYTICS.onAdError(o,r),!(++n>20))return delay(reload,1)}function reload(){log(o,"reload"),setLoaded(!1),ANALYTICS.onAdRequest(o),a&&a.load(onLoaded,onLoadError)}function onLoaded(){n=0,setLoaded(!0)}function onPlayError(r){log(o,"ON PLAY ERROR",d,r),d||doFinish("Interstitial"==o,r)}function doFinish(e,n){d=!0,n&&onPlayError(n),PLATFORM.resume(),log(o,"AD FINISH",e),reload(),r&&r(e),r=null}e.type=o,e.onLoadError=onLoadError,e.reload=reload,e.onLoaded=onLoaded,e.play=function(o){r=o,setLoaded(!1),d=!1,PLATFORM.pause(),a&&a.play()},e.onPlayComplete=function onPlayComplete(){log(o,"onPlayComplete"),ANALYTICS.onAdComplete(o),doFinish(!0)},e.onPlayError=onPlayError,log("new ADPlayer",o),"Azerion"==PLATFORM.platform&&(a=new ADWrapper_Azerion(e)),"CrazyGames"==PLATFORM.platform&&(a=new ADWrapper_CrazyGames(e)),"Wortal"==PLATFORM.platform&&(a=new ADWrapper_Wortal(e)),"Yandex"==PLATFORM.platform&&(a=new ADWrapper_Yandex(e)),"SuperSnappy"==PLATFORM.platform&&(a=new ADWrapper_SuperSnappy(e)),"OK"==PLATFORM.platform&&(a=new ADWrapper_OK(e)),reload()}function ADWrapper_Azerion(o){var r=o.type;this.load=function(){if("Interstitial"==r)return o.onLoaded();gdsdk.preloadAd("rewarded").then((r=>o.onLoaded())).catch((r=>o.onLoadError()))},this.play=function(){gdsdk&&gdsdk.showAd&&gdsdk.showAd("Rewarded"==r?"rewarded":null).then((e=>o.onPlayComplete(r))).catch((r=>o.onPlayError(r)))},on("AZERION_AD:onComplete",(function(){o.onPlayComplete(r)}))}function ADWrapper_CrazyGames(o){var r=o.type;this.load=function(){return o.onLoaded()},this.play=function(){if(!window.CrazyGames||!window.CrazyGames.SDK)return o.onPlayError("No CG SDK");window.CrazyGames.SDK.ad.requestAd("Rewarded"==r?"rewarded":"midgame",{adFinished:()=>o.onPlayComplete(!0),adError:r=>o.onPlayError(r),adStarted:()=>console.log("Start rewarded ad (callback)")})}}function ADWrapper_Wortal(o){var r=o.type;function beforeAd(){}function afterAd(){log(r,"afterAd")}function adDismissed(){log(r,"Dismissed"),o.onPlayError({error:"dismissed"})}function adViewed(){log(r,"adViewed"),o.onPlayComplete()}function noFill(){log(r,"noFill"),o.onPlayError({error:"nofFill"})}this.load=function(){return log(r,"Load"),o.onLoaded()},this.play=function(){return Wortal?"Interstitial"==r?Wortal.ads.showInterstitial("Interstitial","Interstitial",beforeAd,adViewed,noFill):void Wortal.ads.showRewarded("Rewarded",beforeAd,afterAd,adDismissed,adViewed,noFill):o.onPlayError("No Wortal SDK")}}function ADWrapper_Yandex(o){var r=o.type;this.load=function(){return o.onLoaded()},this.play=function(){return ysdk?"Interstitial"==r?ysdk.adv.showFullscreenAdv({callbacks:{onClose:function(r){o.onPlayComplete()},onError:function(r){o.onPlayError(r)}}}):void ysdk.adv.showRewardedVideo({callbacks:{onOpen:()=>{console.log("Video ad open.")},onRewarded:()=>{o.onPlayComplete()},onClose:()=>{o.onPlayError(error)},onError:r=>{o.onPlayError(error)}}}):o.onPlayError("No Yandex SDK")}}function ADWrapper_SuperSnappy(o){var r=o.type;this.load=function(){"Interstitial"!=r&&conquer.Ads.loadRewarded().then((function(r){if(log("LOAD REWARDED",r),r.error)return o.onLoadError();o.onLoaded()}))},this.play=function(){if("Interstitial"==r)return o.onPlayComplete();conquer.Ads.showRewarded().then((function(r){if(log("SHOW REWARDED",r),r.error)return o.onPlayError();o.onPlayComplete()}))}}function ADWrapper_OK(o){var r,e,n=o.type;on("OK:onAdLoaded",(function onAdLoaded(e){if(!r)return;if(r=!1,"error"==e)return o.onLoadError();o.onLoaded()})),on("OK:onAdComplete",(function onAdComplete(r,n){if("ad_prepared"==n||!e)return;if(e=!1,"error"==r)return o.onPlayError();o.onPlayComplete()})),this.load=function(){"Interstitial"!=n&&(r=!0,FAPI.UI.loadAd())},this.play=function(){if(e=!0,"Interstitial"==n)return FAPI.UI.showAd();FAPI.UI.showLoadedAd()}}var SlotMachineButton3d=pc.createScript("slotMachineButton3d");SlotMachineButton3d.prototype.initialize=function(){var t=this.entity,e=t.findByName("Button"),o=t.findByName("Container"),n=t.findByName("SparksFX").particlesystem;function pushButton(t){!t&&get("SLOTMACHINE:isAuto")||(ANIMATION.moveTo(e,new pc.Vec3(0,-.2,0),.6,EASING.ElasticOut),delay((function(){ANIMATION.moveTo(o,new pc.Vec3(0,-.05),1.2,EASING.ElasticOut)}),.05))}on("SLOTMACHINE:ButtonRelease",(function releaseButton(){if(get("SLOTMACHINE:isAuto"))return;ANIMATION.moveTo(e,pc.Vec3.ZERO,.6,EASING.ElasticOut),delay((function(){ANIMATION.moveTo(o,pc.Vec3.ZERO,1.2,EASING.ElasticOut)}),.05)})),on("SLOTMACHINE:ButtonDown",pushButton),on("SLOTMACHINE:isAuto",(function(i){if(i)return FX2D.SHOCKWAVE.play({entity:t,sprite:"FX_Condense",color:"YELLOW"}),n.play(),ANIMATION.moveTo(e,new pc.Vec3(0,-.25,0),.6,EASING.ElasticOut),void ANIMATION.moveTo(o,new pc.Vec3(0,-.2),1.2,EASING.ElasticOut);n.stop(),pushButton(!0)}))};var ScreenAvatarPicker=pc.createScript("screenAvatarPicker");ScreenAvatarPicker.prototype.initialize=function(){var t,e=this,n=e.entity,i=n.findByName("Content"),o=getChildScript(n,"Gallery","gallery");function doFill(t){o.fill(t,onGalleryDown);let e=-o.posY;i.element.height=e+200,o.entity.setLocalPosition(o.entity.pos.x,e/2+50,0)}function onGalleryDown(e){exit(),t&&t(e.data)}function exit(){POPUPS.hide()}SCREEN.call(e),getLocals(o.entity),e.onShow=function(e){if(t=(e=e||{}).callback,e.array)return doFill(e.array);conquer.Bots.get(10).then(doFill)},e.onMouseDown=function(){exit()}};var AnimateMemulti=pc.createScript("animateMemulti");function AnimateMeInstance(t,n){var e=this;extract(n,e);var a,o;e=this;getLocals(t),e.fromX=e.fromX,e.fromY=e.fromY,e.fromZ=e.fromZ;var i=e.id;function animateIn(){if(a&&a.stop(),o&&o.stop(),t.enabled&&(!e.Platform||PLATFORM.Platform==e.Platform)){if((e.fromX||e.fromY||e.fromZ)&&t.setLocalPosition(9999,9999,0),e.delay)return DELAY.start(doAnimateIn,e.delay);doAnimateIn()}}function doAnimateIn(){t.enabled=!0,e.sound&&SFX.playPitchSmall(e.sound),hide(),!0,t.setLocalPosition(t.pos.x+e.fromX,t.pos.y+e.fromY,t.pos.z+e.fromZ),(e.fromX||e.fromY||e.fromZ)&&(a=ANIMATION.moveTo(t,t.pos,e.time,EASING[e.easing])),e.fromScale&&(o=ANIMATION.bounceScaleTo(t,e.fromScale,t.sca.x,e.time))}function show(){!0,t.enabled=!0,resetLocals(t)}function hide(){!1,t.setLocalPosition(t.pos.x+e.fromX,t.pos.y+e.fromY,t.pos.z+e.fromZ),e.fromScale&&t.setLocalScale(e.fromScale,e.fromScale,e.fromScale)}i&&(on(i+":In",doAnimateIn),on(i+":Out",(function doAnimateOut(){t.enabled=!0,show(),!1,e.soundOut&&SFX.playPitchSmall(e.soundOut);a=ANIMATION.moveTo(t,new pc.Vec3(t.pos.x+e.fromX,t.pos.y+e.fromY,t.pos.z+e.fromZ),e.time,EASING[e.easing]),e.fromScale&&(o=ANIMATION.bounceScaleTo(t,e.fromScale,t.sca.x,e.time))})),on(i+":Show",show),on(i+":Hide",hide),on(i+":MoveTo",(function moveTo(n,o,i){a&&a.stop();a=ANIMATION.moveTo(t,n,o||e.time,i||EASING[e.easing])})),on(i+":Restore",(function restore(n,e){a&&a.stop();if(!n)return t.setLocalPosition(t.pos);a=ANIMATION.moveTo(t,t.pos,n,e||EASING.SineInOut)}))),e.autoStart&&(e.event||(e.event=SCENES&&SCENES.getStartEvent(t)),e.event||animateIn()),e.event&&on(e.event,animateIn)}AnimateMemulti.attributes.add("animations",{type:"json",schema:[{name:"id",type:"string"},{name:"event",title:"In Event",type:"string"},{name:"hideEvent",title:"Out Event",type:"string"},{name:"fromX",type:"number",default:0},{name:"fromY",type:"number",default:0},{name:"fromZ",type:"number",default:0},{name:"fromScale",type:"number",default:0},{name:"time",type:"number",default:.8},{name:"delay",type:"number",default:0},{name:"sound",title:"Sound IN",type:"string"},{name:"soundOut",title:"Sound Out",type:"string"},{name:"Platform",type:"string"},{name:"autoStart",type:"boolean"},{name:"enableButton",type:"boolean"},{name:"easing",title:"Easing",type:"string",default:"ElasticOut",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"}]}],array:!0}),AnimateMemulti.prototype.initialize=function(){var t=this,n=t.entity;getLocals(n);for(let e in t.animations)new AnimateMeInstance(n,t.animations[e])};(()=>{class BloomEffect extends pc.PostEffect{constructor(e,t){super(e),this.width=this.device.width,this.height=this.device.height,this.hdr=!0,this.params={blendmode:"add",iterations:12,miplimit:4,strength:5,thresholdA:0,thresholdB:1,radius:new pc.Vec2(1,1),hdrformat:pc.PIXELFORMAT_111110F,tonemapper:pc.TONEMAP_NONE,gamma:pc.GAMMA_SRGB,exposure:1},this.targets={downsampled:[],upsampled:[]},this.shader={downsample:null,upsample:null,combine:null},this.configure(t)}configure(e){this.params={...this.params,...e},void 0===e.iterations&&void 0===e.miplimit&&void 0===e.hdrformat||(this.clearRenderTargets(),this.setupRenderTargets(this.params)),void 0===e.blendmode&&void 0===e.tonemapper||this.setupShaders(this.params)}render(e,t,i){this.checkResize();for(let t=0;t<this.targets.downsampled.length;t++){let r=0==t?e:this.targets.downsampled[t-1],s=this.targets.downsampled[t],a=0==t?[this.params.thresholdA,this.params.thresholdB]:[0,0];this.device.scope.resolve("uSource").setValue(r.colorBuffer),this.device.scope.resolve("uResolution").setValue([r.width,r.height]),this.device.scope.resolve("uThreshold").setValue(a),this.drawQuad(s,this.shader.downsample,i)}for(let e=this.targets.downsampled.length-1;e>0;e--){let t=e==this.targets.downsampled.length-1?this.targets.downsampled[e]:this.targets.upsampled[e],r=this.targets.downsampled[e-1],s=this.targets.upsampled[e-1],a=this.params.radius.clone().mulScalar(.01);this.device.scope.resolve("uSource").setValue(t.colorBuffer),this.device.scope.resolve("uSource1").setValue(r.colorBuffer),this.device.scope.resolve("uResolution").setValue([t.width,t.height]),this.device.scope.resolve("uFilterRadius").setValue(a.data),this.drawQuad(s,this.shader.upsample,i)}let r=e,s=this.targets.upsampled[0],a=t;this.device.scope.resolve("uSource").setValue(r.colorBuffer),this.device.scope.resolve("uBloom").setValue(s.colorBuffer),this.device.scope.resolve("uStrength").setValue(.01*this.params.strength),this.device.scope.resolve("uGamma").setValue(this.params.gamma===pc.GAMMA_NONE?1:2.2),this.device.scope.resolve("exposure").setValue(this.params.exposure),this.drawQuad(a,this.shader.combine,i)}checkResize(){this.device.width===this.width&&this.device.height===this.height||(this.clearRenderTargets(),this.setupRenderTargets(this.params),this.width=this.device.width,this.height=this.device.height)}setupShaders(e){this.shader={downsample:this.createDownsampleShader(e),upsample:this.createUpsampleShader(e),combine:this.createCombineShader(e)}}setupRenderTargets(e){this.targets.downsampled=[],this.targets.upsampled=[];for(let t=0;t<e.iterations;t++){let i=this.device.width>>t+1,r=this.device.height>>t+1;i>=e.miplimit&&r>=e.miplimit&&(this.targets.downsampled.push(this.createRenderTarget(i,r,e.hdrformat)),this.targets.upsampled.push(this.createRenderTarget(i,r,e.hdrformat)))}}clearRenderTargets(){for(let e of this.targets.downsampled)this.destroyRenderTarget(e);for(let e of this.targets.upsampled)this.destroyRenderTarget(e)}createRenderTarget(e,t,i){let r=new pc.Texture(this.device,{format:this.requestHDRFormat(i),width:e,height:t,mipmaps:!1,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE});return new pc.RenderTarget({colorBuffer:r,samples:0,depth:!1})}destroyRenderTarget(e){e&&(e.destroyTextureBuffers(),e.destroy())}requestHDRFormat(e){const t=this.device.extTextureHalfFloat&&this.device.textureHalfFloatRenderable,i=this.device.extTextureFloat&&this.device.textureFloatRenderable;return e===pc.PIXELFORMAT_RGBA32F?i?pc.PIXELFORMAT_RGBA32F:t?pc.PIXELFORMAT_RGBA16F:pc.PIXELFORMAT_111110F:e===pc.PIXELFORMAT_RGBA16F&&t?pc.PIXELFORMAT_RGBA16F:pc.PIXELFORMAT_111110F}destroy(){this.clearRenderTargets()}createDownsampleShader(e){const t=`\n            precision ${this.device.precision} float;\n\n            uniform sampler2D uSource;\n            uniform vec2 uResolution;\n            uniform vec2 uThreshold;\n            varying vec2 vUv0;\n\n            vec3 prefilter (vec3 color, vec2 threshold)\n            {\n                float thres1 = min (threshold.x, threshold.y);\n                float thres2 = max (threshold.x, threshold.y);\n                float brightness = (color.r + color.g + color.b) / 3.0;\n                float factor = smoothstep (thres1, thres2, brightness);\n                return color * factor;\n            }\n\n            void main()\n            {\n                float x = 1.0 / uResolution.x;\n                float y = 1.0 / uResolution.y;\n\n                vec3 a = texture2D (uSource, vec2 (vUv0.x - 2.0 * x, vUv0.y + 2.0 * y)).rgb;\n                vec3 b = texture2D (uSource, vec2 (vUv0.x,           vUv0.y + 2.0 * y)).rgb;\n                vec3 c = texture2D (uSource, vec2 (vUv0.x + 2.0 * x, vUv0.y + 2.0 * y)).rgb;\n\n                vec3 d = texture2D (uSource, vec2 (vUv0.x - 2.0 * x, vUv0.y)).rgb;\n                vec3 e = texture2D (uSource, vec2 (vUv0.x,           vUv0.y)).rgb;\n                vec3 f = texture2D (uSource, vec2 (vUv0.x + 2.0 * x, vUv0.y)).rgb;\n\n                vec3 g = texture2D (uSource, vec2 (vUv0.x - 2.0 * x, vUv0.y - 2.0 * y)).rgb;\n                vec3 h = texture2D (uSource, vec2 (vUv0.x,           vUv0.y - 2.0 * y)).rgb;\n                vec3 i = texture2D (uSource, vec2 (vUv0.x + 2.0 * x, vUv0.y - 2.0 * y)).rgb;\n\n                vec3 j = texture2D (uSource, vec2 (vUv0.x - x, vUv0.y + y)).rgb;\n                vec3 k = texture2D (uSource, vec2 (vUv0.x + x, vUv0.y + y)).rgb;\n                vec3 l = texture2D (uSource, vec2 (vUv0.x - x, vUv0.y - y)).rgb;\n                vec3 m = texture2D (uSource, vec2 (vUv0.x + x, vUv0.y - y)).rgb;\n\n                vec3 downsample = vec3 (0.0);\n                downsample += e * 0.125;\n                downsample += (a + c + g + i) * 0.03125;\n                downsample += (b + d + f + h) * 0.0625;\n                downsample += (j + k + l + m) * 0.125;\n\n                downsample = prefilter (downsample, uThreshold);\n\n                gl_FragColor = vec4 (downsample, 1.0);\n            }\n        `;return pc.createShaderFromCode(this.device,pc.PostEffect.quadVertexShader,t,`Bloom_Downsample_${Date.now()}`,{aPosition:pc.SEMANTIC_POSITION})}createUpsampleShader(e){const t=`\n            precision ${this.device.precision} float;\n\n            uniform sampler2D uSource;\n            uniform sampler2D uSource1;\n            uniform vec2 uFilterRadius;\n            uniform vec2 uResolution;\n            varying vec2 vUv0;\n\n            void main()\n            {\n                float x = uFilterRadius.x * uResolution.y / uResolution.x;\n                float y = uFilterRadius.y;\n\n                vec3 a = texture2D (uSource, vec2 (vUv0.x - x, vUv0.y + y)).rgb;\n                vec3 b = texture2D (uSource, vec2 (vUv0.x,     vUv0.y + y)).rgb;\n                vec3 c = texture2D (uSource, vec2 (vUv0.x + x, vUv0.y + y)).rgb;\n\n                vec3 d = texture2D (uSource, vec2 (vUv0.x - x, vUv0.y)).rgb;\n                vec3 e = texture2D (uSource, vec2 (vUv0.x,     vUv0.y)).rgb;\n                vec3 f = texture2D (uSource, vec2 (vUv0.x + x, vUv0.y)).rgb;\n\n                vec3 g = texture2D (uSource, vec2 (vUv0.x - x, vUv0.y - y)).rgb;\n                vec3 h = texture2D (uSource, vec2 (vUv0.x,     vUv0.y - y)).rgb;\n                vec3 i = texture2D (uSource, vec2 (vUv0.x + x, vUv0.y - y)).rgb;\n\n                vec3 upsample = vec3 (0.0);\n                upsample += e * 4.0;\n                upsample += (b + d + f + h) * 2.0;\n                upsample += (a + c + g + i);\n                upsample *= 1.0 / 16.0;\n\n                vec3 previous = texture2D (uSource1, vUv0).rgb;\n\n                gl_FragColor = vec4 (upsample + previous, 1.0);\n            }\n        `;return pc.createShaderFromCode(this.device,pc.PostEffect.quadVertexShader,t,`Bloom_Upsample_${Date.now()}`,{aPosition:pc.SEMANTIC_POSITION})}createCombineShader(e){let t,i;switch(e&&e.blendmode){case"add":default:t="#define BLENDMODE_ADD";break;case"screen":t="#define BLENDMODE_SCREEN"}switch(e&&e.tonemapper){case pc.TONEMAP_LINEAR:i=pc.shaderChunks.tonemappingLinearPS;break;case pc.TONEMAP_FILMIC:i=pc.shaderChunks.tonemappingFilmicPS;break;case pc.TONEMAP_HEJL:i=pc.shaderChunks.tonemappingHejlPS;break;case pc.TONEMAP_ACES:i=pc.shaderChunks.tonemappingAcesPS;break;case pc.TONEMAP_ACES2:i=pc.shaderChunks.tonemappingAces2PS;break;default:i=pc.shaderChunks.tonemappingNonePS}const r=`\n            precision ${this.device.precision} float;\n\n            uniform sampler2D uSource;\n            uniform sampler2D uBloom;\n            uniform float uStrength;\n            uniform float uGamma;\n            varying vec2 vUv0;\n\n            ${t}\n            ${i}\n\n            void main()\n            {\n                vec3 color = texture2D (uSource, vUv0).rgb;\n                vec3 bloom = texture2D (uBloom, vUv0).rgb;\n\n                #ifdef BLENDMODE_ADD\n                    color = mix (color, bloom, uStrength);\n                    color = toneMap (color);\n                #endif\n\n                #ifdef BLENDMODE_SCREEN\n                    vec3 c = toneMap (color);\n                    vec3 b = toneMap (uStrength * (bloom - color));\n                    color = 1.0 - (1.0 - c) * (1.0 - b);\n                #endif\n\n                color = pow (color + 0.0000001, vec3 (1.0 / uGamma));\n\n                gl_FragColor = vec4 (color, 1.0);\n            }\n        `;return pc.createShaderFromCode(this.device,pc.PostEffect.quadVertexShader,r,`Bloom_Combine_${Date.now()}`,{aPosition:pc.SEMANTIC_POSITION})}}const e=pc.createScript("HDR Bloom");e.attributes.add("camera",{title:"Camera (Optional)",type:"entity",description:"The camera object to apply bloom effect to. If no camera is provided the script tries\n    to use camera component on its current entity. Eventually if no camera is found there as well -\n    the first camera in pc.app.systems.camera.cameras is used."}),e.attributes.add("blendmode",{title:"Blend Mode",type:"string",default:"add",enum:[{Add:"add"},{Screen:"screen"}],description:"Bloom blending mode. [Add] is using standard additive mixing, [Screen] results in higher\n    contrast in extreme cases like super bright lights, maxed out iterations and low mip limit."}),e.attributes.add("iterations",{title:"Iterations",type:"number",default:12,min:1,max:12,precision:0,description:"Richness of bloom effect. The difference between 1 and 12 in terms of performance is\n    truly negligible so it's recommended to leave it at maximum unless you're targeting specific artistic\n    look. Not all iterations may be used internally since downscaling stops at Mip Limit resolution. Low\n    and medium number of iterations may produce different results on retina and non-retina displays\n    (pc.app.graphicsDevice.maxPixelRatio = 2 or 1), especially with non-zero filter radius."}),e.attributes.add("strength",{title:"Strength",type:"number",default:5,min:0,max:100,precision:1,description:"Blending factor. High values together with bright lights result in a steam room look! :D"}),e.attributes.add("miplimit",{title:"Mip Limit",type:"number",default:4,min:1,max:16,precision:0,description:"This parameter controls the depth of the mip chain by limiting the lowest resolution\n    allowed during downscaling. Going below 4 with maxed out iterations may result in a beautiful full\n    screen glow which is possible only at sufficiently high resolutions (1024 and up at pixel ratio 1)."}),e.attributes.add("thresholdA",{title:"Threshold A",type:"number",default:0,min:0,max:10,precision:1,description:"Thresholding function lower limit. Pixels dimmer than A do not contribute to bloom,\n    pixels brighter than B contribute fully, pixels in (A, B) range contribute with smoothstep curve."}),e.attributes.add("thresholdB",{title:"Threshold B",type:"number",default:1,min:0,max:10,precision:1,description:"Thresholding function upper limit. Pixels dimmer than A do not contribute to bloom,\n    pixels brighter than B contribute fully, pixels in (A, B) range contribute with smoothstep curve."}),e.attributes.add("radius",{title:"Filter Radius",type:"vec2",default:[1,1],description:"Radius of additional blur applied during upsampling stage. It's mostly used to\n    dilute a minor moire artefact that is visible at radius (0, 0). Due to the nature of texture\n    filtering Filter Radius may produce slightly different bloom kernel depending on device pixel\n    ratio (i.e. retina and non-retina displays), so you may want to adjust it dynamically depending\n    on window.devicePixelRatio or pc.app.graphicsDevice.maxPixelRatio."}),e.attributes.add("hdrformat",{title:"HDR Format",type:"number",default:pc.PIXELFORMAT_111110F,enum:[{"11 bit":pc.PIXELFORMAT_111110F},{"16 bit":pc.PIXELFORMAT_RGBA16F},{"32 bit":pc.PIXELFORMAT_RGBA32F}],description:"Preferred HDR format. Actual format chosen by system may differ due to hardware\n    compatibility. 11 bit is the best choice overall, it provides tangible performance benefits and\n    is also widely supported even on old devices like iPhone 8. If selected format is not supported\n    by target system the first valid lower format will be used."}),e.prototype.initialize=function(){this.effect=null,this.camcam=null,this.on("enable",this.handleEnable,this),this.on("disable",this.handleDisable,this),this.on("attr",this.handleAttribute,this),this.once("destroy",this.destroy,this)},e.prototype.postInitialize=function(){this.handleEnable()},e.prototype.handleEnable=function(){this.camcam=this.camera&&this.camera.camera||this.entity.camera||this.app.systems.camera.cameras[0],!this.effect&&this.camcam&&(this.effect=this.createEffect(),this.camcam.postEffects.addEffect(this.effect))},e.prototype.handleDisable=function(){this.effect&&(this.camcam&&this.camcam.postEffects.removeEffect(this.effect),this.destroyEffect(this.effect),this.effect=null)},e.prototype.handleAttribute=function(e,t){this.effect&&("camera"===e?(this.handleDisable(),this.handleEnable()):this.effect.configure({[e]:t}))},e.prototype.update=function(){this.effect&&this.updateEffect(this.effect)},e.prototype.createEffect=function(){return new BloomEffect(this.app.graphicsDevice,{blendmode:this.blendmode,iterations:this.iterations,strength:this.strength,miplimit:this.miplimit,thresholdA:this.thresholdA,thresholdB:this.thresholdB,radius:this.radius,hdrformat:this.hdrformat,tonemapper:this.app.scene.toneMapping,exposure:this.app.scene.exposure,gamma:this.app.scene.gammaCorrection})},e.prototype.updateEffect=function(e){this.app.scene.toneMapping!==pc.TONEMAP_NONE&&(e.configure({tonemapper:this.app.scene.toneMapping}),this.app.scene.toneMapping=pc.TONEMAP_NONE),this.app.scene.gammaCorrection===pc.GAMMA_SRGB||this.app.scene.gammaCorrection===pc.GAMMA_SRGBFAST?(e.configure({gamma:this.app.scene.gammaCorrection}),this.app.scene.gammaCorrection=pc.GAMMA_SRGBHDR):this.app.scene.gammaCorrection===pc.GAMMA_NONE&&e.configure({gamma:pc.GAMMA_NONE}),e.configure({exposure:this.app.scene.exposure})},e.prototype.destroyEffect=function(e){this.app.scene.toneMapping=e.params.tonemapper,this.app.scene.gammaCorrection=e.params.gamma,e.destroy()},e.prototype.destroy=function(){this.off("enable",this.handleEnable,this),this.off("disable",this.handleDisable,this),this.off("attr",this.handleAttribute,this),this.handleDisable()}})();var Chest=pc.createScript("chest");Chest.prototype.initialize=function(){var e=this,n=e.entity;getLocals(n);var o,a,l,c=n.findByName("Loot"),t=n.findByName("Light"),A=n.findByName("LightHalo"),i=n.findByName("TextContainer");a=c.findByName("Bottom"),o=c.findByName("Top"),getLocals(o),getLocals(a),getLocals(c);var N=e.ANIMATE={};N.closed=function(){I.hide(),o.setLocalEulerAngles(pc.Vec3.ZERO),t.enabled=!1,i.enabled=!1},N.waiting=function(){i.enabled=!1,function delayAnim(e,n){delayUnique("OpenLootbox",e,n)}((function(){N.shake(),N.waiting(),SFX.playPitchSmall("LootShake")}),2)},N.shake=function(){ANIMATION.shake(n,null,.02,.01),ANIMATION.shake(o,null,.01,.09)},N.open=function(){cancelAnim(),N.closed(),l="open",CAMERA.shake(.05,.1,!1),t.enabled=!0,ANIMATION.bounceScaleTo(A,.4,1,.8,EASING.Linear),SFX.play("Halo");ANIMATION.rotateTo(o,{x:-10,y:0,z:0},.59,EASING.Linear),delay((function(){SFX.play("LootOpen"),t.enabled=!1,ANIMATION.bounceScaleTo(n,.7,1),ANIMATION.rotateTo(o,{x:-125,y:0,z:0},1.6,EASING.ElasticOut),FX3D.CONFETTI.spark({entity:n}),I.show(),delay((function(){i.enabled=!0,ANIMATION.bounceScaleTo(i)}),.1)}),.6)},N.deal=function(){cancelAnim();var e=l;l="deal",SFX.play("LootDeal"),CAMERA.kick(0,-.1,0,1),I.show(),"intro"!=e&&(o.setLocalEulerAngles(-30,0,0),ANIMATION.rotateTo(o,{x:-125,y:0,z:0},1.6,EASING.ElasticOut),ANIMATION.bounceScaleTo(a,.7,1),ANIMATION.bounceAngle(n,null,10,"x"),N.bounce({y:.5}),fire("OPENLOOT:Unlock",1))},N.bounce=function(e){let o=(e=e||{}).y||.2,a=e.pos||n.pos,l=e.time||.2;ANIMATION.moveTo(n,{x:a.x,y:a.y+o,z:a.z},l,EASING.SineOut),delay((function(){ANIMATION.moveTo(n,a,l,EASING.SineIn)}),l)},N.reveal=function(){cancelAnim(),l="reveal",o.setLocalEulerAngles(-125,0,0),ANIMATION.rotateTo(o,pc.Vec3.ZERO,1,EASING.CircularIn),N.shake(),I.off(),SFX.play("Squeak"),delay((function(){SFX.play("LootClose")}),.9),delay((function(){I.hide(),ANIMATION.bounceScaleTo(n,.9),N.bounce(),ANIMATION.shake(a,null,.01,.09),ANIMATION.shake(o,null,.05,.05),ANIMATION.bounceAngle(n,null,2,"x"),CAMERA.kick(0,.1,0,1),SFX.play("Cheers")}),1)};var I=e.HALO={},u=n.findByName("Halo");function cancelAnim(){cancel("OpenLootbox")}I.show=function(){u.enabled=!0,u.setLocalScale(.8,0,1),ANIMATION.scaleTo(u,new pc.Vec3(1,1,1),2,EASING.ElasticOut)},I.off=function(){u.enabled=!0,u.setLocalScale(1,1,1),ANIMATION.scaleTo(u,new pc.Vec3(.8,0,1),1,EASING.CircularIn)},I.hide=function(){u.enabled=!1}};var SimplePopup=pc.createScript("simplePopup");SimplePopup.prototype.initialize=function(){var i,o=this;o.entity;SCREEN.call(o),o.onShow=function(o){i=(o=o||{}).callback},o.onMouseDown=function(){POPUPS.hide(),i&&i()}};var CameraPan=pc.createScript("cameraPan");CameraPan.attributes.add("id",{type:"string"}),CameraPan.attributes.add("enableEvent",{type:"string"}),CameraPan.attributes.add("disableEvent",{type:"string"}),CameraPan.attributes.add("downEvent",{type:"string",default:"TOUCH:onDown"}),CameraPan.attributes.add("resetEvent",{type:"string"}),CameraPan.attributes.add("friction",{type:"number",default:.01}),CameraPan.attributes.add("bottomY",{type:"number",default:0}),CameraPan.attributes.add("topY",{type:"number",default:0}),CameraPan.prototype.initialize=function(){var t,e,n=this,a=n.entity,o=new pc.Vec3,r=new pc.Vec3,i=new pc.Vec3,s=new pc.Vec3,c=new pc.Vec3,d=n.id;d&&on(d+":SetBoundaries",(function setBoundaries(t,e){t&&(n.bottomY=t);e&&(n.topY=e)})),n.enableEvent&&on(n.enableEvent,(function enable(){on(n.downEvent,onDown)})),n.disableEvent&&on(n.disableEvent,(function disable(){off(n.downEvent,onDown),off("TOUCH:onMove",startDrag),reset(),stop(onUpdate)})),n.resetEvent&&on(n.resetEvent,reset);let u=new DelayUnique;function onDown(){on("TOUCH:onMove",startDrag)}function reset(){ANIMATION.rotateTo(a,a.rot)}function startDrag(n){!UI.Layers.POPUP.current&&n&&(e=n,o.y=e.y,o.x=e.x,u.cancel(),i.copy(a.getPosition()),off("TOUCH:onMove",startDrag),t=!0,startFixed(onUpdate),UI.block())}function onUpdate(){let d=10;if(t&&(i.y+=.015*-(e.y-o.y),o.y=e.y,n.bottomY&&n.topY&&(i.y=MATH.clamp(i.y,n.topY,n.bottomY)),s.y=MATH.clamp(.06*-(e.x-o.x),20,-20),d=25),r.copy(a.getPosition()),s.x=MATH.clamp(r.y-i.y,15,-15),r.y+=(i.y-r.y)/10,a.setPosition(r),c.x+=(s.x-c.x)/2,a.setLocalEulerAngles(2*c.x,c.y,0),t)return e.isDown?void 0:function stopDrag(){if(off("TOUCH:onMove",startDrag),!t)return;UI.unblock(),t=!1,e=null,s.y=0,u.start((function(){stop(onUpdate)}),1)}()}getLocals(a)};var InventoryButton=pc.createScript("inventoryButton");InventoryButton.prototype.postInitialize=function(){var e=this,t=e.entity,n=t.findByName("symbolTexture"),i=t.findByName("Locked"),l=getChildScript(t,"Bar","bar"),a=t.findByName("Level");BUTTON.call(e),e.fill=function(t){CONTENT.fill(e,t),e.Locked.enabled=!1,n.element.opacity=1,a.enabled=!1;let o=t.shopItem;if(t.onRefresh=function(){e.fill(e.data)},t.isLocked)return i.enabled=!0,void(n.element.opacity=.14);if(o.canLevelUp){if(a.enabled=!0,CONTENT.fill(a,{level:o.level}),!o.isMaxxed)return l.setAmount(o.quantity,o.min,o.max,!0);l.setPercent(100,!0),l.entity.findByName("amountField").element.text="MAX"}}};class FW_Physics_simulate extends FW_Sequence{init(){const e=this,t=e.group,n=.5,i=[];let o,s,l;function _dampen(e,t){const n=e.linvel();n.x*=t,n.y*=t,e.setLinvel(n,!0)}t.on("stop",(function stopSequence(){e.stop()})),t.on("simulate",(function simulate(){e.start()})),t.on("wall-collision",(function onWallCollision(){_dampen(body,n),_dampen(wheel1,n),_dampen(wheel2,n),_dampen(chassis1,n),_dampen(chassis2,n)})),t.on("world-prepared",(function onWorldPrepared(){o=RAPIER2D.world,s=RAPIER2D.events,l=RAPIER2D.kinematics})),e.onFixedUpdate=function fixedUpdate(){if(o.step(s),i.length=0,s.drainCollisionEvents(((e,n,s)=>{const l=o.getCollider(e),c=o.getCollider(n),a=l?.event,d=c?.event;l?.entity&&(l.entity.destroy(),i.push(l)),c?.entity&&(c.entity.destroy(),i.push(c)),a&&t.fire("contact",a,d,s,c?.entity),d&&t.fire("contact",d,a,s,l?.entity)})),i.length>0)for(const e of i)o.removeCollider(e,!0);!function _syncKinematics(){for(const e of l){const t=o.getCollider(e);if(!t||t&&"ground"===t.event){l.delete(e);continue}const n=t.pivot.getPosition();t.setTranslation(n)}}()}}}pc.registerScript(FW_Physics_simulate,"FW_Physics_simulate");var UpgradeInventory=pc.createScript("upgradeInventory");UpgradeInventory.prototype.initialize=function(){var e,n,l,i=this.entity,t=i.findByName("Content"),a=i.findByName("Enabled"),r=i.findByName("Disabled"),o=i.findByName("Maxxed"),c=getChildScript(i,"Bar","bar");function refill(){function fillPrice(e){e.enabled=!0,CONTENT.fill(e,{price:n.priceLevelUp,currSymbol:"Symbol_"+n.levelUpCurrency})}UI.unblock(),l=!1,c.setAmount(n.quantity,n.min,n.max,!0),CONTENT.fill(t,{level:"LEVEL: "+n.level,bonus:"MULTIPLIER: X"+n.level}),a.enabled=r.enabled=o.enabled=!1,n.isMaxxed?o.enabled=!0:n.quantity>=n.max&&WALLET[n.levelUpCurrency].value>=n.priceLevelUp?(l=!0,fillPrice(a)):fillPrice(r)}on("INVENTORY:onUpdate",(function onUpdate(l){let i=l.inventoryItem;if(!i||!i.shopItem.canLevelUp)return function hide(){t.enabled=!1}();n=(e=i).shopItem,function show(){t.enabled=!0,ANIMATION.bounceScaleTo(t,null,null,2),CONTENT.fill(t,{key:e.key,title:e.title}),refill()}()})),t.onMouseDown=function(e){l&&(UI.block(),n.buyLevelUp().then(refill))}};var Walker=pc.createScript("walker");Walker.attributes.add("lootAtCamera",{type:"boolean",default:!1}),Walker.prototype.initialize=function(){var t,e=this,n=e.entity,o=new pc.Entity;new pc.Vec3,new pc.Vec3;addChild(o,n.parent);var a,i,c=getChildScript(n,"Snappy","snappy"),l=new GridPathFinder,s=new pc.Vec3,r=new pc.Vec3,d=new pc.Vec3;getLocals(n),e.init=function(t){t.enabled=!1,l.scan(t),t.setLocalPosition(n.pos),e.spawn()},e.hide=function(){n.enabled=!1},e.spawn=function(){n.enabled=!0,s=l.getRandomPosition(),n.setLocalPosition(s.x,n.pos.y,s.y),n.setLocalEulerAngles(n.rot),e.stand()},e.stand=function(){t=!1,r.copy(s),DELAY.start((function(){e.walk()}),decimal(3,1)),c&&c.setAnimation(ARRAY.getRandomItem(["Idle","Idle","Idle","Idle","Waving","Dance","Fashion1","Fashion2","Fashion3"])),e.lootAtCamera&&ANIMATION.rotateTo(n,n.rot)},e.deSpawn=function(){n.enabled=!1,t=!1},e.walk=function(){c&&c.setAnimation("Run"),.04,i=0;let e=l.getRandomAt(s.x,s.y,6);s=e[e.length-1],a=new PathXY(e),t=!0},e.onUpdate=function(){if(!t)return;if((i+=.001*DT)>a.duration)return e.stand();if(d=a.getPositionTime(i),r.x+=(d.x-r.x)/5,r.y+=(d.y-r.y)/5,n.setLocalPosition(r.x,n.pos.y,r.y),i+.01>a.duration)return;let c=a.getPositionTime(i+.01);o.setLocalPosition(c.x,n.pos.y,c.y),ANIMATION.lookAt(n,o,.2)}},Walker.prototype.update=function(){this.onUpdate()};var ADBOOST=new function(){var e=this;on("TOY:onFinalize",(function init(){for(var e=0;e<6;e++){var i="ADBT_"+e;n.push(TIMER.spawn({id:i,duration:144e5,persistent:!0})),on(i+":onTimeUp",refresh)}refresh()}));var n=[];function refresh(){for(var i in e.amount=0,n)n[i].isPlaying&&e.amount++;e.multiplier=set("ADBOOST",2*e.amount||1),e.remaining=e.max-e.amount,e.nextMultiplier=e.remaining<=0?2*e.amount:2*(e.amount+1),fire("IDLE:Refresh")}e.multiplier=1,e.nextMultiplier=2,e.amount=0,e.max=6,e.refresh=refresh,e.increase=function(){for(var e in log("INCREASE ADBOOST"),n)if(!n[e].isPlaying){n[e].start();break}refresh()}},AdBoost=pc.createScript("adBoost");AdBoost.prototype.initialize=function(){var e=this.entity,n=e.findByName("Bar").script.bar,i=e.findByName("descriptionField"),t=e.findByName("Bonus"),r=e.findByName("Button");on("UPSALE:onAdBoost",(function show(){log("ADBOOST show"),ADBOOST.refresh(),n.setAmount(ADBOOST.amount,0,ADBOOST.max);var e=ADBOOST.multiplier;if(CONTENT.fill(t,{bonus:e+"x"}),!ADBOOST.remaining||!ADPLAYER.hasRewardedLoaded)return UPSALE.rewardEnabled=!1,i.element.text="Come back later!",void(r.enabled=!1);r.enabled=!0,i.element.text="Increase up to "+ADBOOST.remaining+" times more"})),on("UPSALE:onAdBoostAccept",(function increase(){ADBOOST.increase()}))};var ADBOOST=new function(){var n=this;on("TOY:onFinalize",(function init(){for(var n=0;n<6;n++){var i="ADBT_"+n;r.push(TIMER.spawn({id:i,duration:144e5,persistent:!0})),on(i+":onTimeUp",refresh)}refresh()}));var r=[];function refresh(){for(var i in n.amount=0,r)r[i].isPlaying&&n.amount++;n.multiplier=set("ADBOOST",2*n.amount||1),n.remaining=n.max-n.amount,n.nextMultiplier=n.remaining<=0?2*n.amount:2*(n.amount+1),fire("IDLE:Refresh")}n.multiplier=1,n.nextMultiplier=2,n.amount=0,n.max=6,n.refresh=refresh,n.increase=function(){for(var n in r)if(!r[n].isPlaying){r[n].start();break}refresh()}};var FlyBonus=pc.createScript("flyBonus");FlyBonus.attributes.add("types",{type:"json",schema:[{name:"key",title:"Key",type:"string"},{name:"symbol",title:"Symbol",type:"string"},{name:"quantity",title:"Quantity",type:"number",default:1},{title:"Preset",name:"preset",type:"string",enum:[{None:"None"},{Idle:"Idle"}],default:"None"}],array:!0}),FlyBonus.prototype.initialize=function(){var e,t,n=this,o=n.entity,a=new pc.Vec3,y=new pc.Vec2,l=!0,i=o.findByName("Body"),u=o.findByName("Container"),r=new Cue(!0);for(let e in n.types){let t=n.types[e],o=t.quantity||1;for(let e=0;e<o;e++)r.push(t)}function show(){l=!1,e=!0,i.enabled=!0,a.x=-900,a.y=RANDOM.spectrum(600)-600,y.x=RANDOM.value(20,10)/5,y.y=RANDOM.value(20,10)/10,t=r.get()||{key:"Default",symbol:"Symbol_Emote"},fill(u,t),ANIMATION.bounceScaleTo(i)}function delaySpawn(){return e=!1,i.enabled=!1,delay(show,1)}!function hide(){i.enabled=!1}(),n.onUpdate=function(){e&&(a.x+=y.x,a.y+=y.y,i.setLocalPosition(a.x,a.y,0),a.x<900||l||(l=!0,ANIMATION.bounceScaleTo(i,1,.1,.5,EASING.SineIn),delay(delaySpawn,.5)))},u.onMouseDown=function(e){fire("FLYBONUS:"+t.key),s[t.preset]&&s[t.preset](),delaySpawn()};var s=n.PRESETS={};return s.Idle=function(){UPSALE.rewardBonus(null,{profits:IDLE.getHourlyProduction(.005),currency:"Cash",title:"CASH DROP!"})},show()},FlyBonus.prototype.update=function(e){this.onUpdate()};class FW_Vehicle_control extends FW_Sequence{init(){const e=this,t=e.group;let o,n,i,r,l,a,s,p,c,u,S,f,F,y,m=0,d=!1,X=!1,C=0,h=0,v=1;var g;t.on("generated",(function onVehicleGenerated(e){o=e})),t.on("simulate",(function activateControls(){n=o.physical,i=n.body,r=n.motor1,l=n.motor2,e.start()})),t.on("contact",(function onContact(e,t,o){"wheel:front"===e?o?(d=!0,a=0):a=1:"wheel:back"===e&&(o?(X=!0,s=0):s=1);if(!c)return;fire("JUMPLIGHT:SetState","On",{duration:.1}),SFX.play("Smash",{volume:decimal(.2,.05)})})),t.on("stop",(function stopSequence(){C=0,h=0,e.stop()})),on("ui:invert",(function onInvertSetting(e){v=e?-1:1})),e.onUpdate=function update(){},e.onFixedUpdate=function fixedUpdate(e){C=0,h=0,u=!1;let t=i.motionState.position.x;t<m&&(m=t);a&&++a>7&&(d=!1,a=0);s&&++s>7&&(X=!1,s=0);let o=c,x=F;F=d&&X,c=!d&&!X,c&&!o&&function setOnAir(){fire("CarFX:Stop")}();F&&!x&&function setLand(){f=0,SCORE.multiplier>1&&(SCORE.increase(5),FX2D.TEXT.pop({text:"SPINS X "+SCORE.multiplier}),SCORE.resetMultiplier());S=1;for(const e of n.bodies)e.resetTorques()}();c&&function checkAirFlips(){const e=i.motionState.rotation;S>2.5&&e<0&&(SFX.play("Throw2"),fire("GAMEACTION:onFlip"),++f>=2&&(SFX.play("Positive"),SCORE.increaseMultiplier(),FX3D.SHOCKWAVE.play({sprite:"FX_Condense",billboard:!0,x:i.motionState.position.x,y:i.motionState.position.y,z:0,scale:.3,endScale:.5,time:.4})));S=e}();y=GAMEPAD||{},y.isActive&&(y.Left&&(C=1,h=v,c||(u=!0,function pressBrakes(){if(g)return;if(!d&&!X)return;g=!0,fire("BACKLIGHTS:SetState","On",{duration:.5}),SFX.play("Brake_Screech",{volume:.24});for(const e of n.bodies){e.resetForces();const t=e.linvel();t.x=0,e.setLinvel(t)}i.applyImpulse({x:3,y:0})}())),y.Right&&(C=-1,h=-v,c||(u=!0)),(y.Up||y.Space)&&function jump(){if(c)return;d=X=!1,s=a=0,c=!0,fire("CarFX:Stop"),SFX.stop("CarEngineLoop"),SFX.play("Smash",{volume:decimal(.2,.05)}),SFX.play("Boing sound 4",{volume:.4}),SFX.play("Throw2");for(const e of n.bodies){e.resetForces(),e.resetTorques();const t=e.linvel();t.y=10,e.setLinvel(t);const o=e.angvel();e.setAngvel(-o),e.applyTorqueImpulse(.2,!0)}}());y.Left||function releaseBrakes(){g=!1}();p==u||c||(p&&(SFX.play("Car Horn-Honk_4"),fire("CarFX:Stop"),SFX.stop("CarEngineLoop")),u&&(y.Right&&(X&&fire("CarFX:Play","DustWheels",.3),fire("BACKLIGHTS:SetState","On",{duration:.5})),fire("CarFX:Play","Smoke"),SFX.play("CarEngineLoop",{volume:.5}),SFX.play("EngineStart")));p=u,e>1/60&&(e=1/60);const E=i.linvel(),T=(Math.abs(i.angvel()),E.x*E.x),A=Math.sign(E.x),I=40*e;let L=C,O=h,_=-A*I;(L>0&&T>60||L<0&&T<-60)&&(L*=-1);0!==L&&T<60?_=L*I:_*=e;r.configureMotorVelocity(_,.1*e),l.configureMotorVelocity(_,.1*e),c||(L>0&&(_*=.1),i.applyImpulse({x:_,y:0}));if(c&&O){let t=.5*e;t=O>0?6*-t:3*t,i.applyImpulse({x:.2*_,y:0}),i.applyTorqueImpulse(t,!0)}}}}pc.registerScript(FW_Vehicle_control,"FW_Vehicle_control");class FW_Level_prepare extends FW_Sequence{init(){const e=this,t=e.group,n=[],o=new pc.Vec3,c=new pc.Vec3,s=new pc.Vec3;let i,l,a,r,p,d,h=0;function _generateSections(e){for(let t=0;t<e;t++){const e=new pc.Entity("Section");e.colliders=[],i.addChild(e);const t=PROGRESSION.get();_generatePattern(t),_generateMesh(t,e)}t.fire("road-end",o)}function _generatePattern(e){const t=.5,c=-1;n.length=0;let s=o.clone();const i=[],l=e.isGap;let a,r,p,d,u,g,C,f;if(l){const m=e.count;let S=[];a=s.clone(),h+=2,r=new pc.Vec3(c*h,a.y,0);const V=0+a.y,y=pc.math.clamp(V,t,5);h+=2,p=new pc.Vec3(c*h,y,0);const w=2;h+=w,d=new pc.Vec3(c*h,y,0);let P=2*Math.floor(a.distance(d))+2;i.push(a,r,p,d),S.push(a,d);const v=new CurvePath({points:i,precision:P,collapsed:!1});v.extremes=S,v.gap=l,n.push(v);let R=y;for(let e=0;e<m;++e){S=[];h+=3,f=new pc.Vec3(c*h,R,0),h+=w,u=new pc.Vec3(c*h,R,0);const e=0+R,a=pc.math.clamp(e,t,5);h+=2,g=new pc.Vec3(c*h,a,0),h+=2,C=new pc.Vec3(c*h,a,0),R=C.y,s=C,o.copy(s),i.length=0,i.push(f,u,g,C),S=[f,C],C.used=!0,P=2*Math.floor(f.distance(C))+2;const r=new CurvePath({points:i,precision:P});r.extremes=S,r.gap=l,n.push(r)}}else{a=s,h+=e.c1,r=new pc.Vec3(c*h,a.y,0);let l=a.y+e.y2+spectrumDecimal(1);l=pc.math.clamp(l,t,999),h+=e.c2,p=new pc.Vec3(c*h,l,0),h+=e.m1,d=new pc.Vec3(c*h,l,0),h+=e.m2,u=new pc.Vec3(c*h,l,0);let f=PROGRESSION.height,m=e.y4+spectrumDecimal(f,f/2);m=pc.math.clamp(m,t,15),h+=e.c4,g=new pc.Vec3(c*h,m,0),h+=e.end,C=new pc.Vec3(c*h,m,0),s=C,o.copy(s);const S=[],V=Math.floor(a.distance(C))+2;i.push(a,r,p,d,d,u,g,C);for(let e=0;e<i.length;e++){const t=i[e];t.used||(e%4!=0&&e!==i.length-1||(t.used=!0,S.push(t)))}const y=new CurvePath({points:i,precision:V});y.extremes=S,y.gap=!1,y.obstacleSlots=[],y.coinSlots=[],e.spike1&&y.obstacleSlots.push(y.getCurveValue(0,.5)),e.spike2&&y.obstacleSlots.push(y.getCurveValue(1,.5)),e.coins&&(y.coinSlots.push(y.getCurveValue(1,.2),y.getCurveValue(1,.4),y.getCurveValue(1,.6),y.getCurveValue(1,.8)),y.coinSlots.push(y.getCurveValue(0,.2),y.getCurveValue(0,.4),y.getCurveValue(0,.6),y.getCurveValue(0,.8))),e.coinEnd&&y.coinSlots.push(y.getCurveValue(1,.8)),n.push(y)}}function _generateMesh(e,t){const o={color1:CONFIG.Road.color1,color2:CONFIG.Road.color2,material:l,width:3},i={width:.2,height:.2,precision:8,verticalOffset:.1},h={topWidth:.23,bottomWidth:.14,bevel:.02},u=[],g=[],C=[],f=[],m=APP.batcher.getGroupByName("ROAD");for(let l=0,r=n.length;l<r;l++){const r=[],p=n[l],d=new MeshRoad({road:o,curb:i,column:h,vertices:p.lut,extremes:p.extremes,gap:p.gap,batchGroup:m});if((e.spike1||e.spike2)&&p?.obstacleSlots.length>0)for(const e of p.obstacleSlots){let n,o,{p:i,n:l}=e,r=chance();r?(n=f,o=a.Hammer.instantiate()):(n=g,o=a.Spikes.instantiate()),t.addChild(o),o.setPosition(i.x,i.z,0),c.set(i.x,i.z,0),s.set(l.x,l.z,0),s.dot(pc.Vec3.UP)>.5&&(s.x*=-1,s.y*=-1),c.add(s),o.lookAt(c),o.rotateLocal(90,0,90),n.push(i,180-MATH.signedAngle(s,pc.Vec3.UP,new pc.Vec3(0,0,1)),o),r||(i=extract(i),i.z+=1.4,o=a.Coin.instantiate(),t.addChild(o),o.setPosition(i.x,i.z,0),C.push(i,180-MATH.signedAngle(s,pc.Vec3.UP,new pc.Vec3(0,0,1)),o))}if(e.coins||e.coinEnd)for(const n of p.coinSlots){const o=a.Coin.instantiate(),{p:i,n:l}=n;t.addChild(o),e.coinEnd&&(i.x+=e.coinEnd.x,i.z+=e.coinEnd.y),o.setPosition(i.x,i.z,0),c.set(i.x,i.z,0),s.set(l.x,l.z,0),s.dot(pc.Vec3.UP)>.5&&(s.x*=-1,s.y*=-1),c.add(s),o.lookAt(c),o.rotateLocal(90,0,90),C.push(i,180-MATH.signedAngle(s,pc.Vec3.UP,new pc.Vec3(0,0,1)),o)}t.addChild(d);for(const e of p.lut)r.push(e.x,e.z);u.push({vertices:r,gap:p.gap})}u.length>0&&_addPhysicsPolylines(u,t.colliders),g.length>0&&function _addPhysicsSpikes(e,t){for(let n=0,o=e.length-2;n<o;n+=3){const o=e[n],c=r.ColliderDesc.ball(1.5).setTranslation(o.x,o.z).setSensor(!0),s=p.createCollider(c);s.event="spikes",t.push(s)}}(g,t.colliders),C.length>0&&function _addPhysicsCoins(e,t){for(let n=0,o=e.length-2;n<o;n+=3){const o=e[n],c=e[n+1]*pc.math.DEG_TO_RAD,s=r.ColliderDesc.capsule(0,1).setTranslation(o.x,o.z+1.4).setRotation(c).setSensor(!0),i=p.createCollider(s);i.event="coin",i.entity=e[n+2],t.push(i)}}(C,t.colliders),f.length>0&&function _addPhysicsHammers(e,t,n){for(let n=0,o=e.length-2;n<o;n+=3){const o=e[n],c=e[n+1]*pc.math.DEG_TO_RAD,s=r.ColliderDesc.cuboid(.5,1.14).setTranslation(o.x,o.z).setRotation(c).setSensor(!0),i=p.createCollider(s);i.event="hammer",i.pivot=e[n+2].findByName("Pivot"),t.push(i),d.add(i.handle)}}(f,t.colliders)}function _addPhysicsPolylines(e,t){for(const n of e){let{vertices:e,gap:o}=n;if(o){const t=e.length;e.unshift(e[0],e[1]-5);const n=e[t-2],o=e[t-1]-5;e.push(n,o)}const c=r.ColliderDesc.polyline(new Float32Array(e)).setFriction(1),s=p.createCollider(c);s.event="ground",t.push(s)}}t.on("cue-created",(function generateStart(){o.set(-4,.5,0),h=4;const e=a.Start.instantiate();e.colliders=[],i.addChild(e),r=RAPIER2D.RAPIER,p=RAPIER2D.world,d=RAPIER2D.kinematics;const t=r.ColliderDesc.halfspace(pc.Vec3.UP).setFriction(1);p.createCollider(t).event="ground",_addPhysicsPolylines([{vertices:[4,20,4,.5,-4,.5],gap:!1}],e.colliders),_generateSections(CONFIG.Road.sectionsCount+CONFIG.Road.keepCount)})),t.on("need-sections",(function addNewSections(e){for(let t=0;t<e;t++){for(const e of i.children[0].colliders)p.removeCollider(e);i.children[0].destroy()}_generateSections(e)})),e.preload=async function preload(){i&&i.destroy();i=new pc.Entity("Road Container");const t=await ASSETS.loadAssetAsync(CONFIG.Road.material);l=t.resource,SCENES.Game.addChild(i),a=await ASSETS.loadTemplatesAsync(["Start","Finish","Coin","Spikes","Hammer"],{namedObject:!0,skipInstantiate:!0}),e.preloaded()}}}pc.registerScript(FW_Level_prepare,"FW_Level_prepare");class CurvePath{constructor({points:e,precision:t,opts:n={}}){const o=this,c=APP.scene.layers.getLayerById(pc.LAYERID_UI),r=[],a=[],s=e,l=new pc.Vec3,u=new pc.Vec3;let i=0,g=0;o.debugDraw=function debugDraw(){for(let e=1,t=a.length;e<t;++e){const t=a[e-1],n=a[e];l.set(t.x,t.z,t.y),u.set(n.x,n.z,n.y),APP.drawLine(l,u,pc.Color.BLUE,!1,c)}},o.getValue=function getValue(e){const t=(e=pc.math.clamp(e,0,1))*i;let n=0;for(const e of r){if(!(t>n+e.length)){const o=(t-n)/e.length;return e.curve.get(o)}n+=e.length}},o.getCurveValue=function getCurveValue(e,t){const n=r[e].curve;let o=n.normal(t);isNaN(o.x)&&(o=pc.Vec3.FORWARD);return{p:n.get(t),n:o}},o.lut=a,e||console.warn("Warning! Trying to create a curve path, without providing a list of points that would be used as curve points.");for(let e=0;e<s.length-1;e+=4){if(!s[e+1]){console.warn("Curve Path requires 4 points minimum.");break}_addSection(s[e],s[e+1],s[e+2],s[e+3])}function _addSection(e,t,n,o){const c={normalizedLength:0};c.start=e,c.c1=t,c.c2=n,c.end=o,c.index=g++,c.curve=new Bezier(e.x,e.z,e.y,t.x,t.z,t.y,n.x,n.z,n.y,o.x,o.z,o.y),c.length=c.curve.length(),i+=c.length,r.push(c)}r.length>0&&(!function _normalizeSections(){for(let e=0,t=r.length;e<t;++e){const t=r[e],n=0===e?0:r[e-1].end,o=t.length/i,c=pc.math.clamp(n+o,0,1);t.start=n,t.end=c,t.normalizedLength=o}}(),function _generateLuts(){for(const e of r)a.push(...e.curve.getLUT(t))}())}}class MeshRoad extends pc.Entity{constructor({road:e,curb:n,column:a,vertices:t,extremes:s,gap:c,batchGroup:o}){super("Mesh Road");const r=this,i=new RoadInstance(e,t,c),d=new CurbInstance(e,n,t,c);!function _calculateColumnSpacing(){const e=[];for(const n of s)e.push({height:n.y+.7*Math.random()+.3,offsetX:n.x});a.variants=e}();const u=new ColumnInstance(e,n,a),h=APP.scene.layers.getLayerByName("WORLD2");r.addComponent("render",{type:"asset",meshInstances:[i.instance,d.instance,u.instance],material:e.material,layers:[h.id],castShadows:!0,castShadowsLightmap:!1,isStatic:!0,receiveShadows:!1}),r.debugDraw=function debugDraw(){},r.roadInstance=i,r.curbInstance=d,r.columnInstance=u}}class RoadInstance{constructor(t,s,e){const o=[],n=new Float32Array(3*s.length*2*2);!function _updatePositionsAndColors(){const c=.5*t.width;let r=0;n[r++]=s[0].x,n[r++]=s[0].z,n[r++]=s[0].y+c,n[r++]=s[0].x,n[r++]=s[0].z,n[r++]=s[0].y-c;let l=!0;const a=.5*s.length;for(let h=0,i=s.length;h<i;h++){const i=s[h],p=h<a||e?t.color1:t.color2,u=h<a||e?t.color2:t.color1;let g=l?p:u;o.push(g.r,g.g,g.b,1),o.push(g.r,g.g,g.b,1),o.push(g.r,g.g,g.b,1),o.push(g.r,g.g,g.b,1),l=!l,n[r++]=i.x,n[r++]=i.z,n[r++]=i.y+c,n[r++]=i.x,n[r++]=i.z,n[r++]=i.y-c,n[r++]=i.x,n[r++]=i.z,n[r++]=i.y+c,n[r++]=i.x,n[r++]=i.z,n[r++]=i.y-c}}();const c=function _generateIndices(){const t=[],e=2*s.length;for(let s=0;s<e-1;++s){const e=2*s;t.push(e+0,e+1,e+2,e+1,e+3,e+2)}return t}(),r=pc.calculateNormals(n,c),l=new pc.Mesh(APP.graphicsDevice);l.clear(!0,!1),l.setPositions(n),l.setIndices(c),l.setColors(o),l.setNormals(r),l.update(pc.PRIMITIVE_TRIANGLES),this.instance=new pc.MeshInstance(l,t.material)}}class ColumnInstance{constructor(t,e,o){const s=[],n=new Float32Array(2*o.variants.length*64*3);!function _updatePositionsAndColors(){const r=.5*t.width-(o.offsetZ||0),c=.5*e.width,a=.5*o.topWidth,l=.5*o.bottomWidth,i=o.bevel,f=t.color1;let h=0;for(const t of o.variants){const e=t.height,o=t.offsetX;let u;for(u=0;u<4;++u)n[h++]=o-a,n[h++]=e,n[h++]=r+c-a,n[h++]=o+a,n[h++]=e,n[h++]=r+c-a,n[h++]=o+a,n[h++]=e,n[h++]=r+c+a,n[h++]=o-a,n[h++]=e,n[h++]=r+c+a;for(let t=0;t<2;++t){const s=0===t,f=s?e:0,p=s?a:l,d=s?4:2;for(u=0;u<d;++u)n[h++]=o-p-i,n[h++]=f-i,n[h++]=r+c-p,n[h++]=o-p,n[h++]=f-i,n[h++]=r+c-p-i,n[h++]=o+p,n[h++]=f-i,n[h++]=r+c-p-i,n[h++]=o+p+i,n[h++]=f-i,n[h++]=r+c-p,n[h++]=o+p+i,n[h++]=f-i,n[h++]=r+c+p,n[h++]=o+p,n[h++]=f-i,n[h++]=r+c+p+i,n[h++]=o-p,n[h++]=f-i,n[h++]=r+c+p+i,n[h++]=o-p-i,n[h++]=f-i,n[h++]=r+c+p}for(let t=0;t<64;++t)s.push(f.r,f.g,f.b,1);for(u=0;u<4;++u)n[h++]=o-a,n[h++]=e,n[h++]=-r-c-a,n[h++]=o+a,n[h++]=e,n[h++]=-r-c-a,n[h++]=o+a,n[h++]=e,n[h++]=-r-c+a,n[h++]=o-a,n[h++]=e,n[h++]=-r-c+a;for(let t=0;t<2;++t){const s=0===t,f=s?e:0,p=s?a:l,d=s?4:2;for(u=0;u<d;++u)n[h++]=o-p-i,n[h++]=f-i,n[h++]=-r-c-p,n[h++]=o-p,n[h++]=f-i,n[h++]=-r-c-p-i,n[h++]=o+p,n[h++]=f-i,n[h++]=-r-c-p-i,n[h++]=o+p+i,n[h++]=f-i,n[h++]=-r-c-p,n[h++]=o+p+i,n[h++]=f-i,n[h++]=-r-c+p,n[h++]=o+p,n[h++]=f-i,n[h++]=-r-c+p+i,n[h++]=o-p,n[h++]=f-i,n[h++]=-r-c+p+i,n[h++]=o-p-i,n[h++]=f-i,n[h++]=-r-c+p}for(let t=0;t<64;++t)s.push(f.r,f.g,f.b,1)}}();const r=function _generateIndices(){const t=[];let e=0;for(let s=0,n=o.variants.length;s<n;++s)for(let o=0;o<2;++o)t.push(e+0,e+2,e+1,e+0,e+3,e+2),t.push(e+7,e+4,e+16,e+7,e+16,e+23,e+8,e+25,e+24,e+12,e+13,e+18,e+12,e+18,e+17,e+9,e+27,e+26,e+5,e+6,e+20,e+5,e+20,e+19,e+10,e+29,e+28,e+14,e+15,e+22,e+14,e+22,e+21,e+11,e+31,e+30),t.push(e+32,e+33,e+49,e+32,e+49,e+48,e+41,e+42,e+58,e+41,e+58,e+57,e+34,e+35,e+51,e+34,e+51,e+50,e+43,e+44,e+60,e+43,e+60,e+59,e+36,e+37,e+53,e+36,e+53,e+52,e+45,e+46,e+62,e+45,e+62,e+61,e+38,e+39,e+55,e+38,e+55,e+54,e+47,e+40,e+56,e+47,e+56,e+63),e+=64;return t}(),c=pc.calculateNormals(n,r),a=new pc.Mesh(APP.graphicsDevice);a.clear(),a.setPositions(n),a.setNormals(c),a.setIndices(r),a.setColors(s),a.update(pc.PRIMITIVE_TRIANGLES),this.instance=new pc.MeshInstance(a,t.material),this.debugDraw=function debugDraw(){if(!n||n&&0===n.length)return;const t=APP.scene.layers.getLayerByName("UI");for(let e=0,o=n.length;e<o;e+=3){const o=new pc.Vec3(n[e],n[e+1],n[e+2]),s=new pc.Vec3(n[e+3],n[e+4],n[e+5]);if(s.equals(pc.Vec3.ZERO))break;APP.drawLine(o,s,pc.Color.MAGENTA,!1,t)}}}}class MotionState{constructor(t){const e=new pc.Vec3;let n=0;this.update=function update(o,i){const s=t.translation(),a=t.rotation(),c=t.linvel(),r=t.angvel(),l=o*i;e.x=s.x+c.x*l,e.y=s.y+c.y*l,n=a+r*l},Object.defineProperties(this,{position:{get:()=>e},rotation:{get:()=>n}})}}class CurbInstance{constructor(t,e,o,s){const n=[],c=new Float32Array(2*o.length*(e.precision+3)*3*2);!function _updatePositionsAndColors(){const r=e.precision,l=.5*t.width,i=.5*e.width,a=e.height,h=e.verticalOffset;let u=0,p=!1,f=!0;const g=.5*o.length*(s?0:1);for(let e=0,I=o.length;e<I;e++){const I=o[e];p=!p;for(let o=0;o<2;++o){const o=e<g||s?t.color1:t.color2,b=e<g||s?t.color2:t.color1,P=p?b:o;p=!p;let d=0;for(let t=0;t<r+1;++t)c[u++]=I.x,c[u++]=I.z+i*Math.sin(d)+h,c[u++]=I.y+l+i*Math.cos(d),n.push(P.r,P.g,P.b,1),d+=Math.PI/r;n.push(P.r,P.g,P.b,1),n.push(P.r,P.g,P.b,1),c[u++]=I.x,c[u++]=I.z-a+h,c[u++]=I.y+l-i,c[u++]=I.x,c[u++]=I.z-a+h,c[u++]=I.y+l+i,f=!1}}p=!p;for(let e=0,s=o.length;e<s;e++){const s=o[e];p=!p;for(let o=0;o<2;++o){const o=e<g?t.color1:t.color2,I=e<g?t.color2:t.color1,b=p?I:o;p=!p;let P=0;for(let t=0;t<r+1;++t)c[u++]=s.x,c[u++]=s.z+i*Math.sin(P)+h,c[u++]=s.y-l-i*Math.cos(P),n.push(b.r,b.g,b.b,1),P+=Math.PI/r;n.push(b.r,b.g,b.b,1),n.push(b.r,b.g,b.b,1),c[u++]=s.x,c[u++]=s.z-a+h,c[u++]=s.y-l+i,c[u++]=s.x,c[u++]=s.z-a+h,c[u++]=s.y-l-i,f=!1}}}();const r=function _generateIndices(){const t=e.precision,s=[],n=2*o.length,c=t+3;for(let e=0;e<n-1;++e){if(e%2==0)continue;const o=e*c,n=o+c;for(let e=0;e<t+3;++e){if(e===t+2){s.push(o,n,n+e,o+e,o,n+e);break}s.push(o+e,o+e+1,n+e,o+e+1,n+e+1,n+e)}}for(let e=n;e<n-1+n;++e){if(e%2==0)continue;const o=e*c,n=o+c;for(let e=0;e<t+3;++e){if(e===t+2){s.push(o,n+e,n,o+e,n+e,o);break}s.push(o+e,n+e,o+e+1,o+e+1,n+e,n+e+1)}}return s}(),l=pc.calculateNormals(c,r),i=new pc.Mesh(APP.graphicsDevice);i.clear(),i.setPositions(c),i.setNormals(l),i.setIndices(r),i.setColors(n),i.update(pc.PRIMITIVE_TRIANGLES),this.instance=new pc.MeshInstance(i,t.material),this.debugDraw=function debugDraw(){if(!c||c&&0===c.length)return;const t=APP.scene.layers.getLayerByName("UI");for(let e=0,o=c.length;e<o;e+=6){const o=new pc.Vec3(c[e],c[e+1],c[e+2]),s=new pc.Vec3(c[e+3],c[e+4],c[e+5]);APP.drawLine(o,s,pc.Color.WHITE,!1,t)}}}}var WheelsGameplay=pc.createScript("wheelsGameplay");WheelsGameplay.prototype.initialize=function(){var e=GAMEPLAY.set(this);let n;var t=!0;e.onReady=function(){n=!1,log("GAMEPLAY PREPARE"),fire("gameplay:prepare")},e.start=function(){if(fire("PARALLAX:Disable"),n)return fire("GAME:onReveal");log("GAMEPLAY CALL START"),GAME.start()},e.onReveal=function(){log("GAMEPLAY ON REVEAL"),fire("CAMERAFOLLOW:Reset"),CAMERA.entity.setPosition(0,0,0),fire("PARALLAX:Reset"),fire("CAMERAFOLLOW:Follow",VEHICLE.body),GAMEPAD.enable(),delay((function(){fire("PARALLAX:Enable"),t&&(t=!1,pc.platform.mobile||POPUPS.show("Dialog",{title:"Controls",text:"Use WASD to control your vehicle. SPACEBAR to jump."}))}),1)},e.onStart=function(){log("GAMEPLAY ONSTART"),i=!1},e.onSpectating=function(){},e.onEnd=function(){FX3D.CONFETTI.sides()};new DelayUnique;var i=!1;on("VEHICLE:Die",(function(){e.die()})),e.die=function(){!i&&GAME.isAlive&&(i=!0,FX2D.DAMAGE.play(),CAMERA.shake3D(.2,.2),TITLE.show({template:"TryAgain",title:"FAILED",subtitle:null}),SFX.play("Negative"),GAMEPAD.disable(),delay((function(){GAME.die()}),1))},e.onAskContinue=function(){GAMEPAD.disable()},e.onContinue=function(){i=!1,n=!0,fire("gameplay:prepare")},e.onExit=function(){PROGRESSION.reset()},e.pause=function(){},e.resume=function(){}};var WheelsConfig=pc.createScript("wheelsConfig");WheelsConfig.attributes.add("color1",{title:"Color 1",type:"rgb"}),WheelsConfig.attributes.add("color2",{title:"Color 2",type:"rgb"}),WheelsConfig.attributes.add("material",{title:"Road Material",type:"asset",assetType:"material"}),WheelsConfig.attributes.add("sectionsCount",{title:"Sections Count",type:"number",default:5,description:"Amount of new sections to create, as well as old sections to destroy."}),WheelsConfig.attributes.add("keepCount",{title:"Keep Count",type:"number",default:2,description:"Amount of sections to remain. For example, 2 - would mean destroy [Sections Count] of old sections, keep the current 2, then add [Sections Count] of new sections. This prevents the ground from disappearing under the vehicle."}),WheelsConfig.attributes.add("distance",{title:"Distance",type:"number",default:15,description:"Distance to the end of the road, when reached would trigger new sections generation."}),WheelsConfig.prototype.initialize=function(){CONFIG.add("Road",this)};var WheelsSettingsPopup=pc.createScript("wheelsSettingsPopup");WheelsSettingsPopup.prototype.initialize=function(){SCREEN.call(this),this.onClick=function(e,t){if("Fullscreen"==e)return document.body.requestFullscreen();if("Quality"==e)return QUALITY.setQuality(t.value);if("Music"==e||"Sound"==e)return fire(e+":Mute",t.value);if("ResetButton"==e)return DIALOG.reset((function onReset(){DATA.reset()}));if("BackButton"==e)return SCREENS.show("Home");if("Invert"==e)return fire("ui:invert",t.value);POPUPS.hide()}};let RAPIER2D={};class FW_Physics_prepare extends FW_Sequence{init(){const e=this,r=e.group;let d;function rapierLoaded(){e.preloaded()}e.preload=async function preload(){window.RAPIER2D?rapierLoaded():(await ASSETS.loadAssetsAsync([ASSETS.find("physics2d.js","script"),ASSETS.find("rapier2d.wasm","wasm")]),off("rapier2d:loaded",rapierLoaded),on("rapier2d:loaded",rapierLoaded))},e.configure=function configure(){d&&(RAPIER2D.world.free(),RAPIER2D={});const i=new pc.Vec2(0,-12);d=window.RAPIER2D,RAPIER2D.RAPIER=d,RAPIER2D.world=new d.World(i),RAPIER2D.events=new d.EventQueue(!0),RAPIER2D.kinematics=new Set,r.fire("world-prepared"),e.configured()}}}pc.registerScript(FW_Physics_prepare,"FW_Physics_prepare");class FW_Physics_debug_draw extends FW_Sequence{init(){const e=this,n=e.group,r=[];let c,t=!1;n.on("simulate",(function enableDebugDraw(){e.start()})),APP.keyboard.on(pc.EVENT_KEYDOWN,(e=>{e.key===pc.KEY_Q&&(t=!t)})),e.configure=function configure(){c=APP.scene.layers.getLayerById(pc.LAYERID_UI),e.configured()},e.onUpdate=function update(e){t&&function _debugRender(){const e=RAPIER2D.world.debugRender();r.length=0;for(let n=0,c=e.vertices.length;n<c-1;n+=2)r.push(e.vertices[n],e.vertices[n+1],0);APP.drawLineArrays(r,e.colors,!1,c)}()}}}pc.registerScript(FW_Physics_debug_draw,"FW_Physics_debug_draw");var VEHICLE;class FW_Vehicle extends FW_Manager{init(){const e=this.scene,n=this.group;VEHICLE=this,e.on("ready",(function simulate(){n.fire("simulate")})),e.on("physics:world-prepared",(function generateTruck(){n.fire("generate")})),e.on("physics:wheel-contact",(function onContact(e,i,t){n.fire("contact",e,i,t)})),e.on("physics:game-over",(function die(){})),n.on("generated",(function notifyGenerated(n){VEHICLE.body=n.visual.body,e.fire("vehicle:generated",n)}))}}pc.registerScript(FW_Vehicle,"FW_Vehicle");class FW_Vehicle_prepare extends FW_Sequence{init(){const e=this,i=e.group,s=0,t=2,n={bodySize:{x:.2,y:.2},radius:.335,chassis:{front:{x:-.34,y:-.3},back:{x:.34,y:-.3}},stiffness:1e4,limits:[0,.2],mass:{mass:.5,center:{x:-.18-.5,y:0},inertia:.01}};let a,o,c;i.on("generate",(function generate(){c&&c.destroy();c=new pc.Entity("Vehicle Container"),SCENES.Game.addChild(c),a=o.instantiate(),a.enabled=!0,a.visual={},a.physical={},a.pivots={},a.config=n,c.addChild(a),function _findTruckParts(){const e=a.visual;e.body=a.findByName("Body"),e.frontWheels=a.findByName("Front Wheels"),e.backWheels=a.findByName("Back Wheels"),e.backSpringPivot=a.findByName("Back Spring Pivot"),e.frontSpringPivot=a.findByName("Front Spring Pivot"),e.driverPivot=a.findByName("Driver Pivot");const i=a.findByName("Chassis");e.cFront=i.findByName("Front"),e.cMiddle=i.findByName("Middle"),e.cBack=i.findByName("Back")}(),function _addPhysics(){const e=RAPIER2D.RAPIER,i=RAPIER2D.world,o=a.physical,c=new e.ColliderDesc(new e.Capsule(n.bodySize.x,n.bodySize.y)).setMassProperties(n.mass.mass,n.mass.center,n.mass.inertia).setRotation(.5*Math.PI).setCollisionGroups(262146),r=new e.RigidBodyDesc(e.RigidBodyType.Dynamic).setCanSleep(!1).setTranslation(s,t),l=i.createRigidBody(r);i.createCollider(c,l),l.motionState=new MotionState(l),o.body=l;const d=new e.ColliderDesc(new e.Ball(.15)).setTranslation(.05,.45).setActiveEvents(e.ActiveEvents.COLLISION_EVENTS).setCollisionGroups(131076);i.createCollider(d,l).event="driver";const y=new e.RigidBodyDesc(e.RigidBodyType.Dynamic).setCanSleep(!1).setTranslation(s+n.chassis.front.x,t+n.chassis.front.y),p=new e.ColliderDesc(new e.Ball(.05)).setCollisionGroups(524292),m=i.createRigidBody(y);i.createCollider(p,m),o.chassis1=m;const B=new e.RigidBodyDesc(e.RigidBodyType.Dynamic).setCanSleep(!1).setTranslation(s+n.chassis.back.x,t+n.chassis.back.y),C=new e.ColliderDesc(new e.Ball(.05)).setCollisionGroups(524292),h=i.createRigidBody(B);i.createCollider(C,h),o.chassis2=h;const f=new e.ColliderDesc(new e.Ball(n.radius)).setFriction(0).setActiveEvents(e.ActiveEvents.COLLISION_EVENTS).setCollisionGroups(131075),S=new e.RigidBodyDesc(e.RigidBodyType.Dynamic).setUserData(2).setCanSleep(!1).setCcdEnabled(!0).setTranslation(s+n.chassis.front.x,t+n.chassis.front.y),v=i.createRigidBody(S);i.createCollider(f,v).event="wheel:front",v.motionState=new MotionState(v),o.wheel1=v;const u=new e.ColliderDesc(new e.Ball(n.radius)).setActiveEvents(e.ActiveEvents.COLLISION_EVENTS).setFriction(0).setCollisionGroups(131075),g=new e.RigidBodyDesc(e.RigidBodyType.Dynamic).setCanSleep(!1).setCcdEnabled(!0).setTranslation(s+n.chassis.back.x,t+n.chassis.back.y),w=i.createRigidBody(g);i.createCollider(u,w).event="wheel:back",w.motionState=new MotionState(w),o.wheel2=w;const D=e.JointData.revolute({x:0,y:0},{x:0,y:0}),E=i.createImpulseJoint(D,m,v,!0);o.motor1=E;const R=e.JointData.revolute({x:0,y:0},{x:0,y:0}),b=i.createImpulseJoint(R,h,w,!0);o.motor2=b;const T={x:0,y:1},x=n.limits,N=n.stiffness,k=e.JointData.prismatic(n.chassis.front,{x:0,y:0},T);k.limitsEnabled=!0,k.limits=x;i.createImpulseJoint(k,l,m,!0).configureMotorPosition(0,N,0);const I=e.JointData.prismatic(n.chassis.back,{x:0,y:0},T);I.limitsEnabled=!0,I.limits=x;i.createImpulseJoint(I,l,h,!0).configureMotorPosition(0,N,0),o.bodies=[l,m,h,v,w]}(),i.fire("generated",a)})),e.preload=async function preload(){o=await ASSETS.loadTemplateAsync("Truck",{skipInstantiate:!0}),e.preloaded()}}}pc.registerScript(FW_Vehicle_prepare,"FW_Vehicle_prepare");class FW_Vehicle_simulate extends FW_Sequence{init(){const t=this,e=t.group,o=new pc.Vec3(0,0,90),n=new pc.Vec3,s=new pc.Quat;let i;var a=new pc.Entity;function _syncWheel(t,e,o){const i=e.motionState.position,c=e.motionState.rotation;a.setPosition(i.x,i.y,0);let l=t.getLocalPosition();localToLocal(a,t.parent,n);let u=l.x+(n.x-l.x)/4;t.setLocalPosition(u,l.y,0),s.setFromEulerAngles(0,0,c*pc.math.RAD_TO_DEG),t.setRotation(s),o&&t.rotateLocal(o.x,o.y,o.z)}addChild(a,APP.root),e.on("generated",(function onVehicleGenerated(t){i=t})),e.on("simulate",(function startSimulation(){t.start()})),e.on("stop",(function stopSimulation(){t.stop()})),APP.keyboard.on(pc.EVENT_KEYDOWN,(t=>{t.key===pc.KEY_1&&function respawn(){const t=i.config.chassis,e=i.physical,o=i.visual.body,n=o.getPosition();n.y+=4,o.setPosition(n),o.setRotation(pc.Quat.IDENTITY);const s={x:n.x+t.front.x,y:n.y+t.front.y},a={x:n.x+t.back.x,y:n.y+t.back.y},__resetBody=(t,e)=>{t.resetForces(),t.resetTorques(),t.setTranslation({x:e.x,y:e.y},!0),t.setRotation(0,!0),t.setLinvel(pc.Vec2.ZERO),t.setAngvel(0)};__resetBody(e.body,n),__resetBody(e.chassis1,s),__resetBody(e.wheel1,s),__resetBody(e.chassis2,a),__resetBody(e.wheel2,a)}()})),t.onUpdate=function update(t){!function _syncTruck(){const t=i.visual,e=i.physical;(function _sync(t,e,o){const n=e.motionState.position,i=e.motionState.rotation;s.setFromEulerAngles(0,0,i*pc.math.RAD_TO_DEG),t.setPosition(n.x,n.y,0),t.setRotation(s),o&&t.rotateLocal(o.x,o.y,o.z)})(t.body,e.body,o),_syncWheel(t.frontWheels,e.wheel1,o),_syncWheel(t.backWheels,e.wheel2,o)}()},t.updateMotionStates=function updateMotionStates(t,e){const o=i.physical;o.body.motionState.update(t,e),o.wheel1.motionState.update(t,e),o.wheel2.motionState.update(t,e)}}}pc.registerScript(FW_Vehicle_simulate,"FW_Vehicle_simulate");var PROGRESSION;class FW_Level_difficulty extends FW_Sequence{init(){const e=this,c=e.group,n=new CueProgression("endlessPrefill");e.height=0,PROGRESSION=e,c.on("prepare-level",(function generate(){c.fire("cue-created")}));const i={Short:{c1:2,c2:2,y2:2,m1:2,m2:2,c4:2,y4:0,end:2,coins:!0},Medium:{c1:4,c2:4,y2:2,m1:4,m2:4,c4:4,y4:0,end:4,coins:!0}};let t=new Cue(!0);for(let e in i)t.push(i[e]);const y={Short:{c1:2,c2:2,y2:2.1,m1:0,m2:0,c4:0,y4:2.1,end:2},Medium:{c1:3,c2:2,y2:3,m1:0,m2:7,c4:5,y4:0,end:7,coinEnd:{x:10,y:4}},Huge:{c1:7,c2:0,y2:7,m1:0,m2:7,c4:5,y4:0,end:7,coinEnd:{x:10,y:8}}};let m=new Cue(!0);for(let e in y)m.push(y[e]);const d={Double:{c1:2,c2:2,y2:1,m1:.6,m2:.6,c4:2,y4:0,end:10,spike2:!0},Back:{c1:2,c2:2,y2:1,m1:.6,m2:.6,c4:2,y4:0,end:10,spike2:!0},Long:{c1:3,c2:3,y2:1,m1:3,m2:3,c4:3,y4:0,end:3,spike1:!0}};let l=new Cue(!0);for(let e in d)l.push(d[e]);const u={Small:{c1:3,c2:-1,y2:3,m1:3,m2:12,c4:6,y4:0,end:3,coinEnd:{x:10,y:3}},Medium:{c1:2,c2:1,y2:3,m1:1,m2:20,c4:-10,y4:0,end:20,coinEnd:{x:15,y:4}},Large:{c1:2,c2:1,y2:5,m1:1,m2:20,c4:-10,y4:0,end:20,coinEnd:{x:15,y:6}}};let o=new Cue(!0);for(let e in u)o.push(u[e]);const r={Small:{c1:3,c2:3,y2:3,m1:3,m2:3,c4:3,y4:0,end:3,coinEnd:{x:0,y:3}},Medium:{c1:4,c2:4,y2:4,m1:4,m2:4,c4:4,y4:0,end:4,coinEnd:{x:0,y:3}},Medium2:{c1:7,c2:7,y2:7,m1:0,m2:7,c4:7,y4:0,end:7,coinEnd:{x:10,y:7}},Large:{c1:5,c2:5,y2:5,m1:5,m2:5,c4:5,y4:0,end:5,coinEnd:{x:0,y:3}},Huge:{c1:7,c2:15,y2:7,m1:7,m2:7,c4:0,y4:0,end:7,coinEnd:{x:4,y:7}},Mini:{c1:1,c2:1,y2:1,m1:1,m2:1,c4:1,y4:0,end:1},Mini2:{c1:1,c2:1,y2:2,m1:1,m2:1,c4:1,y4:0,end:1},Ripple:{c1:1,c2:1,y2:3,m1:1,m2:1,c4:1,y4:0,end:1},Ladder:{c1:1,c2:1,y2:3,m1:1,m2:5,c4:1,y4:0,end:1}};r.Small={c1:1,c2:1,y2:3,m1:1,m2:5,c4:1,y4:0,end:1};let s=new Cue(!0);for(let e in r)s.push(r[e]);let h=new Cue(!0);h.push(m),h.push(s),h.push(o);let g,f=[];let p=0;e.reset=function(){n.reset(),f=[],p=0,e.height=2},e.get=function(){if(function getDifficulty(){if(++p<2)return;p=0;let c=n.get();e.height=2,"easy"==c&&(e.height=2);"medium"==c&&(e.height=4);"hard"==c&&(e.height=8);"crazy"==c&&(e.height=10);log("difficulty",e.height)}(),f.length)return f.shift();let c=t.get(),i=l.get(),y=h.get().get(),m=h.get().get();return f=[c,y,y,i,m,m,i,y,m,i,i,i,i],g=copy(f),f.shift()}}}pc.registerScript(FW_Level_difficulty,"FW_Level_difficulty");class FW_Level_simulate extends FW_Sequence{init(){const e=this,n=e.group,t=new pc.Vec3;let i,o,c;n.on("vehicle-generated",(function onVehicleGenerated(e){i=e})),n.on("simulate",(function simulate(){e.start()})),n.on("road-end",(function updateLastPoint(e){t.copy(e)})),e.onUpdate=function update(e){i.visual.body.getPosition().x-t.x<o&&n.fire("need-sections",c)},e.configure=function configure(){o=CONFIG.Road.distance,c=CONFIG.Road.sectionsCount,e.configured()}}}pc.registerScript(FW_Level_simulate,"FW_Level_simulate");(()=>{var t,e,n,a,E={583:(t,e,n)=>{"use strict";n.d(e,{F:()=>i});class i{constructor(){this.fconv=new Float64Array(1),this.uconv=new Uint32Array(this.fconv.buffer),this.data=new Array,this.size=0}set(t,e){let n=this.index(t);for(;this.data.length<=n;)this.data.push(null);null==this.data[n]&&(this.size+=1),this.data[n]=e}len(){return this.size}delete(t){let e=this.index(t);e<this.data.length&&(null!=this.data[e]&&(this.size-=1),this.data[e]=null)}clear(){this.data=new Array}get(t){let e=this.index(t);return e<this.data.length?this.data[e]:null}forEach(t){for(const e of this.data)null!=e&&t(e)}getAll(){return this.data.filter((t=>null!=t))}index(t){return this.fconv[0]=t,this.uconv[0]}}},874:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{_:()=>o,m:()=>c});var E=n(302),x=n(791),D=t([E,x]);[E,x]=D.then?(await D)():D;class o{}class c{constructor(t,e,n,a,x){this.params=e,this.bodies=n,this.colliders=a,this.queries=x,this.raw=new E.vg(t),this.rawCharacterCollision=new E.Wx,this._applyImpulsesToDynamicBodies=!1,this._characterMass=null}free(){this.raw&&(this.raw.free(),this.rawCharacterCollision.free()),this.raw=void 0,this.rawCharacterCollision=void 0}up(){return this.raw.up()}setUp(t){let e=x.ut.intoRaw(t);return this.raw.setUp(e)}applyImpulsesToDynamicBodies(){return this._applyImpulsesToDynamicBodies}setApplyImpulsesToDynamicBodies(t){this._applyImpulsesToDynamicBodies=t}characterMass(){return this._characterMass}setCharacterMass(t){this._characterMass=t}offset(){return this.raw.offset()}setOffset(t){this.raw.setOffset(t)}slideEnabled(){return this.raw.slideEnabled()}setSlideEnabled(t){this.raw.setSlideEnabled(t)}autostepMaxHeight(){return this.raw.autostepMaxHeight()}autostepMinWidth(){return this.raw.autostepMinWidth()}autostepIncludesDynamicBodies(){return this.raw.autostepIncludesDynamicBodies()}autostepEnabled(){return this.raw.autostepEnabled()}enableAutostep(t,e,n){this.raw.enableAutostep(t,e,n)}disableAutostep(){return this.raw.disableAutostep()}maxSlopeClimbAngle(){return this.raw.maxSlopeClimbAngle()}setMaxSlopeClimbAngle(t){this.raw.setMaxSlopeClimbAngle(t)}minSlopeSlideAngle(){return this.raw.minSlopeSlideAngle()}setMinSlopeSlideAngle(t){this.raw.setMinSlopeSlideAngle(t)}snapToGroundDistance(){return this.raw.snapToGroundDistance()}enableSnapToGround(t){this.raw.enableSnapToGround(t)}disableSnapToGround(){this.raw.disableSnapToGround()}snapToGroundEnabled(){return this.raw.snapToGroundEnabled()}computeColliderMovement(t,e,n,a,E){let D=x.ut.intoRaw(e);this.raw.computeColliderMovement(this.params.dt,this.bodies.raw,this.colliders.raw,this.queries.raw,t.handle,D,this._applyImpulsesToDynamicBodies,this._characterMass,n,a,this.colliders.castClosure(E)),D.free()}computedMovement(){return x.ut.fromRaw(this.raw.computedMovement())}computedGrounded(){return this.raw.computedGrounded()}numComputedCollisions(){return this.raw.numComputedCollisions()}computedCollision(t,e){if(!this.raw.computedCollision(t,this.rawCharacterCollision))return null;{let t=this.rawCharacterCollision;(e=null!=e?e:new o).translationApplied=x.ut.fromRaw(t.translationApplied()),e.translationRemaining=x.ut.fromRaw(t.translationRemaining()),e.toi=t.toi(),e.witness1=x.ut.fromRaw(t.worldWitness1()),e.witness2=x.ut.fromRaw(t.worldWitness2()),e.normal1=x.ut.fromRaw(t.worldNormal1()),e.normal2=x.ut.fromRaw(t.worldNormal2())}}}a()}catch(t){a(t)}}))},434:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{_:()=>E._,m:()=>E.m});var E=n(874),x=t([E]);E=(x.then?(await x)():x)[0],a()}catch(t){a(t)}}))},153:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{K:()=>s});var E=n(302),x=t([E]);E=(x.then?(await x)():x)[0];class s{constructor(t){this.raw=t||new E.LE}free(){this.raw.free(),this.raw=void 0}}a()}catch(t){a(t)}}))},730:(t,e,n)=>{"use strict";var a;n.d(e,{j:()=>a}),function(t){t[t.Average=0]="Average",t[t.Min=1]="Min",t[t.Multiply=2]="Multiply",t[t.Max=3]="Max"}(a||(a={}))},697:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{C1:()=>h,JW:()=>d,Vt:()=>x,_h:()=>w,au:()=>u,dl:()=>E,eZ:()=>p,s2:()=>l});var E,x,D=n(791),kt=n(302),Bt=t([D,kt]);[D,kt]=Bt.then?(await Bt)():Bt,function(t){t[t.Revolute=0]="Revolute",t[t.Fixed=1]="Fixed",t[t.Prismatic=2]="Prismatic"}(E||(E={})),function(t){t[t.AccelerationBased=0]="AccelerationBased",t[t.ForceBased=1]="ForceBased"}(x||(x={}));class l{constructor(t,e,n){this.rawSet=t,this.bodySet=e,this.handle=n}static newTyped(t,e,n){switch(t.jointType(n)){case E.Revolute:return new u(t,e,n);case E.Prismatic:return new p(t,e,n);case E.Fixed:return new d(t,e,n);default:return new l(t,e,n)}}finalizeDeserialization(t){this.bodySet=t}isValid(){return this.rawSet.contains(this.handle)}body1(){return this.bodySet.get(this.rawSet.jointBodyHandle1(this.handle))}body2(){return this.bodySet.get(this.rawSet.jointBodyHandle2(this.handle))}type(){return this.rawSet.jointType(this.handle)}anchor1(){return D.ut.fromRaw(this.rawSet.jointAnchor1(this.handle))}anchor2(){return D.ut.fromRaw(this.rawSet.jointAnchor2(this.handle))}setAnchor1(t){const e=D.ut.intoRaw(t);this.rawSet.jointSetAnchor1(this.handle,e),e.free()}setAnchor2(t){const e=D.ut.intoRaw(t);this.rawSet.jointSetAnchor2(this.handle,e),e.free()}setContactsEnabled(t){this.rawSet.jointSetContactsEnabled(this.handle,t)}contactsEnabled(){return this.rawSet.jointContactsEnabled(this.handle)}}class h extends l{limitsEnabled(){return this.rawSet.jointLimitsEnabled(this.handle,this.rawAxis())}limitsMin(){return this.rawSet.jointLimitsMin(this.handle,this.rawAxis())}limitsMax(){return this.rawSet.jointLimitsMax(this.handle,this.rawAxis())}setLimits(t,e){this.rawSet.jointSetLimits(this.handle,this.rawAxis(),t,e)}configureMotorModel(t){this.rawSet.jointConfigureMotorModel(this.handle,this.rawAxis(),t)}configureMotorVelocity(t,e){this.rawSet.jointConfigureMotorVelocity(this.handle,this.rawAxis(),t,e)}configureMotorPosition(t,e,n){this.rawSet.jointConfigureMotorPosition(this.handle,this.rawAxis(),t,e,n)}configureMotor(t,e,n,a){this.rawSet.jointConfigureMotor(this.handle,this.rawAxis(),t,e,n,a)}}class d extends l{}class p extends h{rawAxis(){return kt.JM.X}}class u extends h{rawAxis(){return kt.JM.AngX}}class w{constructor(){}static fixed(t,e,n,a){let x=new w;return x.anchor1=t,x.anchor2=n,x.frame1=e,x.frame2=a,x.jointType=E.Fixed,x}static revolute(t,e){let n=new w;return n.anchor1=t,n.anchor2=e,n.jointType=E.Revolute,n}static prismatic(t,e,n){let a=new w;return a.anchor1=t,a.anchor2=e,a.axis=n,a.jointType=E.Prismatic,a}intoRaw(){let t,e,n=D.ut.intoRaw(this.anchor1),a=D.ut.intoRaw(this.anchor2),x=!1,Bt=0,Ht=0;switch(this.jointType){case E.Fixed:let Jt=D.T3.intoRaw(this.frame1),Nt=D.T3.intoRaw(this.frame2);e=kt.cQ.fixed(n,Jt,a,Nt),Jt.free(),Nt.free();break;case E.Prismatic:t=D.ut.intoRaw(this.axis),this.limitsEnabled&&(x=!0,Bt=this.limits[0],Ht=this.limits[1]),e=kt.cQ.prismatic(n,a,t,x,Bt,Ht),t.free();break;case E.Revolute:e=kt.cQ.revolute(n,a)}return n.free(),a.free(),e}}a()}catch(t){a(t)}}))},618:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{l:()=>c});var E=n(302),x=n(583),D=n(697),kt=t([E,D]);[E,D]=kt.then?(await kt)():kt;class c{constructor(t){this.raw=t||new E.Qc,this.map=new x.F,t&&t.forEachJointHandle((e=>{this.map.set(e,D.s2.newTyped(t,null,e))}))}free(){this.raw.free(),this.raw=void 0,this.map.clear(),this.map=void 0}finalizeDeserialization(t){this.map.forEach((e=>e.finalizeDeserialization(t)))}createJoint(t,e,n,a,E){const x=e.intoRaw(),kt=this.raw.createJoint(x,n,a,E);x.free();let Bt=D.s2.newTyped(this.raw,t,kt);return this.map.set(kt,Bt),Bt}remove(t,e){this.raw.remove(t,e),this.unmap(t)}forEachJointHandleAttachedToRigidBody(t,e){this.raw.forEachJointAttachedToRigidBody(t,e)}unmap(t){this.map.delete(t)}len(){return this.map.len()}contains(t){return null!=this.get(t)}get(t){return this.map.get(t)}forEach(t){this.map.forEach(t)}getAll(){return this.map.getAll()}}a()}catch(t){a(t)}}))},988:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{Am:()=>Ht.Am,C1:()=>kt.C1,JW:()=>kt.JW,Jj:()=>E.Jj,Kd:()=>zt.K,RT:()=>D.R,UW:()=>Ht.UW,Vt:()=>kt.Vt,_h:()=>kt._h,au:()=>kt.au,dl:()=>kt.dl,eZ:()=>kt.eZ,h1:()=>Jt.h,ib:()=>E.ib,jK:()=>Nt.j,jp:()=>Ht.jp,lX:()=>Bt.l,rF:()=>x.r,s2:()=>kt.s2,wI:()=>Ht.wI,xr:()=>E.xr,yB:()=>Gt.y,yf:()=>Ht.yf});var E=n(748),x=n(881),D=n(150),kt=n(697),Bt=n(618),Ht=n(704),Jt=n(142),Nt=n(730),zt=n(153),Gt=n(812),Ot=t([E,x,D,kt,Bt,Ht,Jt,zt,Gt]);[E,x,D,kt,Bt,Ht,Jt,zt,Gt]=Ot.then?(await Ot)():Ot,a()}catch(t){a(t)}}))},150:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{R:()=>s});var E=n(302),x=t([E]);E=(x.then?(await x)():x)[0];class s{constructor(t){this.raw=t||new E.zu}free(){this.raw.free(),this.raw=void 0}get dt(){return this.raw.dt}get erp(){return this.raw.erp}get allowedLinearError(){return this.raw.allowedLinearError}get predictionDistance(){return this.raw.predictionDistance}get maxVelocityIterations(){return this.raw.maxVelocityIterations}get maxVelocityFrictionIterations(){return this.raw.maxVelocityFrictionIterations}get maxStabilizationIterations(){return this.raw.maxStabilizationIterations}get minIslandSize(){return this.raw.minIslandSize}get maxCcdSubsteps(){return this.raw.maxCcdSubsteps}set dt(t){this.raw.dt=t}set erp(t){this.raw.erp=t}set allowedLinearError(t){this.raw.allowedLinearError=t}set predictionDistance(t){this.raw.predictionDistance=t}set maxVelocityIterations(t){this.raw.maxVelocityIterations=t}set maxVelocityFrictionIterations(t){this.raw.maxVelocityFrictionIterations=t}set maxStabilizationIterations(t){this.raw.maxStabilizationIterations=t}set minIslandSize(t){this.raw.minIslandSize=t}set maxCcdSubsteps(t){this.raw.maxCcdSubsteps=t}}a()}catch(t){a(t)}}))},812:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{y:()=>s});var E=n(302),x=t([E]);E=(x.then?(await x)():x)[0];class s{constructor(t){this.raw=t||new E.Is}free(){this.raw.free(),this.raw=void 0}forEachActiveRigidBodyHandle(t){this.raw.forEachActiveRigidBodyHandle(t)}}a()}catch(t){a(t)}}))},704:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{Am:()=>d,UW:()=>l,jp:()=>h,wI:()=>c,yf:()=>o});var E=n(302),x=n(697),D=t([x,E]);[x,E]=D.then?(await D)():D;class o{constructor(t,e){this.rawSet=t,this.handle=e}static newTyped(t,e){switch(t.jointType(e)){case x.dl.Revolute:return new d(t,e);case x.dl.Prismatic:return new h(t,e);case x.dl.Fixed:return new l(t,e);default:return new o(t,e)}}isValid(){return this.rawSet.contains(this.handle)}setContactsEnabled(t){this.rawSet.jointSetContactsEnabled(this.handle,t)}contactsEnabled(){return this.rawSet.jointContactsEnabled(this.handle)}}class c extends o{}class l extends o{}class h extends c{rawAxis(){return E.JM.X}}class d extends c{rawAxis(){return E.JM.AngX}}a()}catch(t){a(t)}}))},142:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{h:()=>c});var E=n(302),x=n(583),D=n(704),kt=t([E,D]);[E,D]=kt.then?(await kt)():kt;class c{constructor(t){this.raw=t||new E.fl,this.map=new x.F,t&&t.forEachJointHandle((t=>{this.map.set(t,D.yf.newTyped(this.raw,t))}))}free(){this.raw.free(),this.raw=void 0,this.map.clear(),this.map=void 0}createJoint(t,e,n,a){const E=t.intoRaw(),x=this.raw.createJoint(E,e,n,a);E.free();let kt=D.yf.newTyped(this.raw,x);return this.map.set(x,kt),kt}remove(t,e){this.raw.remove(t,e),this.map.delete(t)}unmap(t){this.map.delete(t)}len(){return this.map.len()}contains(t){return null!=this.get(t)}get(t){return this.map.get(t)}forEach(t){this.map.forEach(t)}forEachJointHandleAttachedToRigidBody(t,e){this.raw.forEachJointAttachedToRigidBody(t,e)}getAll(){return this.map.getAll()}}a()}catch(t){a(t)}}))},748:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{Jj:()=>E,ib:()=>o,xr:()=>c});var E,x=n(791),D=t([x]);x=(D.then?(await D)():D)[0],function(t){t[t.Dynamic=0]="Dynamic",t[t.Fixed=1]="Fixed",t[t.KinematicPositionBased=2]="KinematicPositionBased",t[t.KinematicVelocityBased=3]="KinematicVelocityBased"}(E||(E={}));class o{constructor(t,e,n){this.rawSet=t,this.colliderSet=e,this.handle=n}finalizeDeserialization(t){this.colliderSet=t}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(t,e){return this.rawSet.rbLockTranslations(this.handle,t,e)}lockRotations(t,e){return this.rawSet.rbLockRotations(this.handle,t,e)}setEnabledTranslations(t,e,n){return this.rawSet.rbSetEnabledTranslations(this.handle,t,e,n)}restrictTranslations(t,e,n){this.setEnabledTranslations(t,t,n)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(t){this.rawSet.rbSetDominanceGroup(this.handle,t)}enableCcd(t){this.rawSet.rbEnableCcd(this.handle,t)}translation(){let t=this.rawSet.rbTranslation(this.handle);return x.ut.fromRaw(t)}rotation(){let t=this.rawSet.rbRotation(this.handle);return x.T3.fromRaw(t)}nextTranslation(){let t=this.rawSet.rbNextTranslation(this.handle);return x.ut.fromRaw(t)}nextRotation(){let t=this.rawSet.rbNextRotation(this.handle);return x.T3.fromRaw(t)}setTranslation(t,e){this.rawSet.rbSetTranslation(this.handle,t.x,t.y,e)}setLinvel(t,e){let n=x.ut.intoRaw(t);this.rawSet.rbSetLinvel(this.handle,n,e),n.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(t,e){this.rawSet.rbSetGravityScale(this.handle,t,e)}setRotation(t,e){this.rawSet.rbSetRotation(this.handle,t,e)}setAngvel(t,e){this.rawSet.rbSetAngvel(this.handle,t,e)}setNextKinematicTranslation(t){this.rawSet.rbSetNextKinematicTranslation(this.handle,t.x,t.y)}setNextKinematicRotation(t){this.rawSet.rbSetNextKinematicRotation(this.handle,t)}linvel(){return x.ut.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return this.rawSet.rbAngvel(this.handle)}mass(){return this.rawSet.rbMass(this.handle)}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(t){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,t))}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(t){return this.rawSet.rbSetBodyType(this.handle,t)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(t){this.rawSet.rbSetLinearDamping(this.handle,t)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(t,e){this.rawSet.rbSetAdditionalMass(this.handle,t,e)}setAdditionalMassProperties(t,e,n,a){let E=x.ut.intoRaw(e);this.rawSet.rbSetAdditionalMassProperties(this.handle,t,E,n,a),E.free()}setAngularDamping(t){this.rawSet.rbSetAngularDamping(this.handle,t)}resetForces(t){this.rawSet.rbResetForces(this.handle,t)}resetTorques(t){this.rawSet.rbResetTorques(this.handle,t)}addForce(t,e){const n=x.ut.intoRaw(t);this.rawSet.rbAddForce(this.handle,n,e),n.free()}applyImpulse(t,e){const n=x.ut.intoRaw(t);this.rawSet.rbApplyImpulse(this.handle,n,e),n.free()}addTorque(t,e){this.rawSet.rbAddTorque(this.handle,t,e)}applyTorqueImpulse(t,e){this.rawSet.rbApplyTorqueImpulse(this.handle,t,e)}addForceAtPoint(t,e,n){const a=x.ut.intoRaw(t),E=x.ut.intoRaw(e);this.rawSet.rbAddForceAtPoint(this.handle,a,E,n),a.free(),E.free()}applyImpulseAtPoint(t,e,n){const a=x.ut.intoRaw(t),E=x.ut.intoRaw(e);this.rawSet.rbApplyImpulseAtPoint(this.handle,a,E,n),a.free(),E.free()}}class c{constructor(t){this.status=t,this.translation=x.ut.zeros(),this.rotation=x.T3.identity(),this.gravityScale=1,this.linvel=x.ut.zeros(),this.mass=0,this.massOnly=!1,this.centerOfMass=x.ut.zeros(),this.translationsEnabledX=!0,this.translationsEnabledY=!0,this.angvel=0,this.principalAngularInertia=0,this.rotationsEnabled=!0,this.linearDamping=0,this.angularDamping=0,this.canSleep=!0,this.sleeping=!1,this.ccdEnabled=!1,this.dominanceGroup=0}static dynamic(){return new c(E.Dynamic)}static kinematicPositionBased(){return new c(E.KinematicPositionBased)}static kinematicVelocityBased(){return new c(E.KinematicVelocityBased)}static fixed(){return new c(E.Fixed)}static newDynamic(){return new c(E.Dynamic)}static newKinematicPositionBased(){return new c(E.KinematicPositionBased)}static newKinematicVelocityBased(){return new c(E.KinematicVelocityBased)}static newStatic(){return new c(E.Fixed)}setDominanceGroup(t){return this.dominanceGroup=t,this}setTranslation(t,e){if("number"!=typeof t||"number"!=typeof e)throw TypeError("The translation components must be numbers.");return this.translation={x:t,y:e},this}setRotation(t){return this.rotation=t,this}setGravityScale(t){return this.gravityScale=t,this}setAdditionalMass(t){return this.mass=t,this.massOnly=!0,this}setLinvel(t,e){if("number"!=typeof t||"number"!=typeof e)throw TypeError("The linvel components must be numbers.");return this.linvel={x:t,y:e},this}setAngvel(t){return this.angvel=t,this}setAdditionalMassProperties(t,e,n){return this.mass=t,x.ut.copy(this.centerOfMass,e),this.principalAngularInertia=n,this.massOnly=!1,this}enabledTranslations(t,e){return this.translationsEnabledX=t,this.translationsEnabledY=e,this}restrictTranslations(t,e){return this.enabledTranslations(t,e)}lockTranslations(){return this.restrictTranslations(!1,!1)}lockRotations(){return this.rotationsEnabled=!1,this}setLinearDamping(t){return this.linearDamping=t,this}setAngularDamping(t){return this.angularDamping=t,this}setCanSleep(t){return this.canSleep=t,this}setSleeping(t){return this.sleeping=t,this}setCcdEnabled(t){return this.ccdEnabled=t,this}setUserData(t){return this.userData=t,this}}a()}catch(t){a(t)}}))},881:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{r:()=>l});var E=n(302),x=n(583),D=n(791),kt=n(748),Bt=t([E,kt,D]);[E,kt,D]=Bt.then?(await Bt)():Bt;class l{constructor(t){this.raw=t||new E.fY,this.map=new x.F,t&&t.forEachRigidBodyHandle((e=>{this.map.set(e,new kt.ib(t,null,e))}))}free(){this.raw.free(),this.raw=void 0,this.map.clear(),this.map=void 0}finalizeDeserialization(t){this.map.forEach((e=>e.finalizeDeserialization(t)))}createRigidBody(t,e){let n=D.ut.intoRaw(e.translation),a=D.T3.intoRaw(e.rotation),E=D.ut.intoRaw(e.linvel),x=D.ut.intoRaw(e.centerOfMass),Bt=this.raw.createRigidBody(n,a,e.gravityScale,e.mass,e.massOnly,x,E,e.angvel,e.principalAngularInertia,e.translationsEnabledX,e.translationsEnabledY,e.rotationsEnabled,e.linearDamping,e.angularDamping,e.status,e.canSleep,e.sleeping,e.ccdEnabled,e.dominanceGroup);n.free(),a.free(),E.free(),x.free();const Ht=new kt.ib(this.raw,t,Bt);return Ht.userData=e.userData,this.map.set(Bt,Ht),Ht}remove(t,e,n,a,E){for(let e=0;e<this.raw.rbNumColliders(t);e+=1)n.unmap(this.raw.rbCollider(t,e));a.forEachJointHandleAttachedToRigidBody(t,(t=>a.unmap(t))),E.forEachJointHandleAttachedToRigidBody(t,(t=>E.unmap(t))),this.raw.remove(t,e.raw,n.raw,a.raw,E.raw),this.map.delete(t)}len(){return this.map.len()}contains(t){return null!=this.get(t)}get(t){return this.map.get(t)}forEach(t){this.map.forEach(t)}forEachActiveRigidBody(t,e){t.forEachActiveRigidBodyHandle((t=>{e(this.get(t))}))}getAll(){return this.map.getAll()}}a()}catch(t){a(t)}}))},11:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.r(e),n.d(e,{ActiveCollisionTypes:()=>kt.vq,ActiveEvents:()=>Bt.Md,ActiveHooks:()=>Bt.iX,Ball:()=>kt.ec,BroadPhase:()=>kt.NT,CCDSolver:()=>D.Kd,Capsule:()=>kt.sw,CharacterCollision:()=>Ht._,CoefficientCombineRule:()=>D.jK,Collider:()=>kt.YM,ColliderDesc:()=>kt.ic,ColliderSet:()=>kt.zY,ConvexPolygon:()=>kt.to,Cuboid:()=>kt.jv,DebugRenderBuffers:()=>Bt.tt,DebugRenderPipeline:()=>Bt.kh,EventQueue:()=>Bt.NH,FeatureType:()=>kt.Te,FixedImpulseJoint:()=>D.JW,FixedMultibodyJoint:()=>D.UW,HalfSpace:()=>kt.Fr,Heightfield:()=>kt.f4,ImpulseJoint:()=>D.s2,ImpulseJointSet:()=>D.lX,IntegrationParameters:()=>D.RT,IslandManager:()=>D.yB,JointData:()=>D._h,JointType:()=>D.dl,KinematicCharacterController:()=>Ht.m,MassPropsMode:()=>kt.uV,MotorModel:()=>D.Vt,MultibodyJoint:()=>D.yf,MultibodyJointSet:()=>D.h1,NarrowPhase:()=>kt.L4,PhysicsPipeline:()=>Bt.DJ,PointColliderProjection:()=>kt.Vl,PointProjection:()=>kt.FP,Polyline:()=>kt.aH,PrismaticImpulseJoint:()=>D.eZ,PrismaticMultibodyJoint:()=>D.jp,QueryFilterFlags:()=>Bt._m,QueryPipeline:()=>Bt.Vq,Ray:()=>kt.zH,RayColliderIntersection:()=>kt.No,RayColliderToi:()=>kt.cu,RayIntersection:()=>kt.Gz,RevoluteImpulseJoint:()=>D.au,RevoluteMultibodyJoint:()=>D.Am,RigidBody:()=>D.ib,RigidBodyDesc:()=>D.xr,RigidBodySet:()=>D.rF,RigidBodyType:()=>D.Jj,RotationOps:()=>x.T3,RoundConvexPolygon:()=>kt.DM,RoundCuboid:()=>kt.iA,RoundTriangle:()=>kt.$R,Segment:()=>kt.XX,SerializationPipeline:()=>Bt.y9,Shape:()=>kt.bn,ShapeColliderTOI:()=>kt.mB,ShapeContact:()=>kt.Qi,ShapeTOI:()=>kt.GJ,ShapeType:()=>kt.DY,SolverFlags:()=>Bt.Nv,TempContactForceEvent:()=>Bt.qV,TempContactManifold:()=>kt.eL,TriMesh:()=>kt.az,Triangle:()=>kt.CJ,UnitImpulseJoint:()=>D.C1,UnitMultibodyJoint:()=>D.wI,Vector2:()=>x.FM,VectorOps:()=>x.ut,World:()=>Bt.q3,version:()=>d});var E=n(302),x=n(791),D=n(988),kt=n(698),Bt=n(784),Ht=n(434),Jt=t([E,x,D,kt,Bt,Ht]);function d(){return(0,E.i8)()}[E,x,D,kt,Bt,Ht]=Jt.then?(await Jt)():Jt,a()}catch(Nt){a(Nt)}}))},553:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{N:()=>s});var E=n(302),x=t([E]);E=(x.then?(await x)():x)[0];class s{constructor(t){this.raw=t||new E.FU}free(){this.raw.free(),this.raw=void 0}}a()}catch(t){a(t)}}))},939:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{YM:()=>w,ic:()=>_,uV:()=>x,vq:()=>E});var E,x,D=n(791),kt=n(730),Bt=n(332),Ht=n(783),Jt=n(805),Nt=n(740),zt=n(362),Gt=t([Bt,D,Jt,Nt,zt,Ht]);[Bt,D,Jt,Nt,zt,Ht]=Gt.then?(await Gt)():Gt,function(t){t[t.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",t[t.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",t[t.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",t[t.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",t[t.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",t[t.FIXED_FIXED=32]="FIXED_FIXED",t[t.DEFAULT=15]="DEFAULT",t[t.ALL=60943]="ALL"}(E||(E={}));class w{constructor(t,e,n,a){this.colliderSet=t,this.handle=e,this._parent=n,this._shape=a}finalizeDeserialization(t){null!=this.handle&&(this._parent=t.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=Bt.bn.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return D.ut.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return D.T3.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(t){this.colliderSet.raw.coSetSensor(this.handle,t)}setShape(t){let e=t.intoRaw();this.colliderSet.raw.coSetShape(this.handle,e),e.free(),this._shape=t}setRestitution(t){this.colliderSet.raw.coSetRestitution(this.handle,t)}setFriction(t){this.colliderSet.raw.coSetFriction(this.handle,t)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(t){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,t)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(t){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,t)}setCollisionGroups(t){this.colliderSet.raw.coSetCollisionGroups(this.handle,t)}setSolverGroups(t){this.colliderSet.raw.coSetSolverGroups(this.handle,t)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(t){this.colliderSet.raw.coSetActiveHooks(this.handle,t)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(t){this.colliderSet.raw.coSetActiveEvents(this.handle,t)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(t){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,t)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(t){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,t)}setDensity(t){this.colliderSet.raw.coSetDensity(this.handle,t)}setMass(t){this.colliderSet.raw.coSetMass(this.handle,t)}setMassProperties(t,e,n){let a=D.ut.intoRaw(e);this.colliderSet.raw.coSetMassProperties(this.handle,t,a,n),a.free()}setTranslation(t){this.colliderSet.raw.coSetTranslation(this.handle,t.x,t.y)}setTranslationWrtParent(t){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,t.x,t.y)}setRotation(t){this.colliderSet.raw.coSetRotation(this.handle,t)}setRotationWrtParent(t){this.colliderSet.raw.coSetRotationWrtParent(this.handle,t)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return D.ut.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}radius(){return this.colliderSet.raw.coRadius(this.handle)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let t=this.colliderSet.raw.coHeightfieldScale(this.handle);return D.ut.fromRaw(t)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(t){let e=D.ut.intoRaw(t),n=this.colliderSet.raw.coContainsPoint(this.handle,e);return e.free(),n}projectPoint(t,e){let n=D.ut.intoRaw(t),a=Jt.F.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,n,e));return n.free(),a}intersectsRay(t,e){let n=D.ut.intoRaw(t.origin),a=D.ut.intoRaw(t.dir),E=this.colliderSet.raw.coIntersectsRay(this.handle,n,a,e);return n.free(),a.free(),E}castShape(t,e,n,a,E,x,kt){let Bt=D.ut.intoRaw(t),Ht=D.ut.intoRaw(n),Jt=D.T3.intoRaw(a),zt=D.ut.intoRaw(E),Gt=e.intoRaw(),Ot=Nt.G.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,Bt,Gt,Ht,Jt,zt,x,kt));return Bt.free(),Ht.free(),Jt.free(),zt.free(),Gt.free(),Ot}castCollider(t,e,n,a,E){let x=D.ut.intoRaw(t),kt=D.ut.intoRaw(n),Bt=Nt.m.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,x,e.handle,kt,a,E));return x.free(),kt.free(),Bt}intersectsShape(t,e,n){let a=D.ut.intoRaw(e),E=D.T3.intoRaw(n),x=t.intoRaw(),kt=this.colliderSet.raw.coIntersectsShape(this.handle,x,a,E);return a.free(),E.free(),x.free(),kt}contactShape(t,e,n,a){let E=D.ut.intoRaw(e),x=D.T3.intoRaw(n),kt=t.intoRaw(),Bt=zt.Q.fromRaw(this.colliderSet.raw.coContactShape(this.handle,kt,E,x,a));return E.free(),x.free(),kt.free(),Bt}contactCollider(t,e){return zt.Q.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,t.handle,e))}castRay(t,e,n){let a=D.ut.intoRaw(t.origin),E=D.ut.intoRaw(t.dir),x=this.colliderSet.raw.coCastRay(this.handle,a,E,e,n);return a.free(),E.free(),x}castRayAndGetNormal(t,e,n){let a=D.ut.intoRaw(t.origin),E=D.ut.intoRaw(t.dir),x=Ht.Gz.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,a,E,e,n));return a.free(),E.free(),x}}!function(t){t[t.Density=0]="Density",t[t.Mass=1]="Mass",t[t.MassProps=2]="MassProps"}(x||(x={}));class _{constructor(t){this.shape=t,this.massPropsMode=x.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=D.T3.identity(),this.translation=D.ut.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=kt.j.Average,this.restitutionCombineRule=kt.j.Average,this.activeCollisionTypes=E.DEFAULT,this.activeEvents=0,this.activeHooks=0,this.mass=0,this.centerOfMass=D.ut.zeros(),this.contactForceEventThreshold=0,this.principalAngularInertia=0,this.rotationsEnabled=!0}static ball(t){const e=new Bt.ec(t);return new _(e)}static capsule(t,e){const n=new Bt.sw(t,e);return new _(n)}static segment(t,e){const n=new Bt.XX(t,e);return new _(n)}static triangle(t,e,n){const a=new Bt.CJ(t,e,n);return new _(a)}static roundTriangle(t,e,n,a){const E=new Bt.$R(t,e,n,a);return new _(E)}static polyline(t,e){const n=new Bt.aH(t,e);return new _(n)}static trimesh(t,e){const n=new Bt.az(t,e);return new _(n)}static cuboid(t,e){const n=new Bt.jv(t,e);return new _(n)}static roundCuboid(t,e,n){const a=new Bt.iA(t,e,n);return new _(a)}static halfspace(t){const e=new Bt.Fr(t);return new _(e)}static heightfield(t,e){const n=new Bt.f4(t,e);return new _(n)}static convexHull(t){const e=new Bt.to(t,!1);return new _(e)}static convexPolyline(t){const e=new Bt.to(t,!0);return new _(e)}static roundConvexHull(t,e){const n=new Bt.DM(t,e,!1);return new _(n)}static roundConvexPolyline(t,e){const n=new Bt.DM(t,e,!0);return new _(n)}setTranslation(t,e){if("number"!=typeof t||"number"!=typeof e)throw TypeError("The translation components must be numbers.");return this.translation={x:t,y:e},this}setRotation(t){return this.rotation=t,this}setSensor(t){return this.isSensor=t,this}setDensity(t){return this.massPropsMode=x.Density,this.density=t,this}setMass(t){return this.massPropsMode=x.Mass,this.mass=t,this}setMassProperties(t,e,n){return this.massPropsMode=x.MassProps,this.mass=t,D.ut.copy(this.centerOfMass,e),this.principalAngularInertia=n,this}setRestitution(t){return this.restitution=t,this}setFriction(t){return this.friction=t,this}setFrictionCombineRule(t){return this.frictionCombineRule=t,this}setRestitutionCombineRule(t){return this.restitutionCombineRule=t,this}setCollisionGroups(t){return this.collisionGroups=t,this}setSolverGroups(t){return this.solverGroups=t,this}setActiveHooks(t){return this.activeHooks=t,this}setActiveEvents(t){return this.activeEvents=t,this}setActiveCollisionTypes(t){return this.activeCollisionTypes=t,this}setContactForceEventThreshold(t){return this.contactForceEventThreshold=t,this}}a()}catch(t){a(t)}}))},476:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{z:()=>l});var E=n(302),x=n(583),D=n(791),kt=n(939),Bt=t([E,kt,D]);[E,kt,D]=Bt.then?(await Bt)():Bt;class l{constructor(t){this.raw=t||new E.IQ,this.map=new x.F,t&&t.forEachColliderHandle((t=>{this.map.set(t,new kt.YM(this,t,null))}))}free(){this.raw.free(),this.raw=void 0,this.map.clear(),this.map=void 0}castClosure(t){return e=>t?t(this.get(e)):void 0}finalizeDeserialization(t){this.map.forEach((e=>e.finalizeDeserialization(t)))}createCollider(t,e,n){let a=null!=n&&null!=n;if(a&&isNaN(n))throw Error("Cannot create a collider with a parent rigid-body handle that is not a number.");let E=e.shape.intoRaw(),x=D.ut.intoRaw(e.translation),Bt=D.T3.intoRaw(e.rotation),Ht=D.ut.intoRaw(e.centerOfMass),Jt=this.raw.createCollider(E,x,Bt,e.massPropsMode,e.mass,Ht,e.principalAngularInertia,e.density,e.friction,e.restitution,e.frictionCombineRule,e.restitutionCombineRule,e.isSensor,e.collisionGroups,e.solverGroups,e.activeCollisionTypes,e.activeHooks,e.activeEvents,e.contactForceEventThreshold,a,a?n:0,t.raw);E.free(),x.free(),Bt.free(),Ht.free();let Nt=a?t.get(n):null,zt=new kt.YM(this,Jt,Nt,e.shape);return this.map.set(Jt,zt),zt}remove(t,e,n,a){this.raw.remove(t,e.raw,n.raw,a),this.unmap(t)}unmap(t){this.map.delete(t)}get(t){return this.map.get(t)}len(){return this.map.len()}contains(t){return null!=this.get(t)}forEach(t){this.map.forEach(t)}getAll(){return this.map.getAll()}}a()}catch(t){a(t)}}))},362:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{Q:()=>s});var E=n(791),x=t([E]);E=(x.then?(await x)():x)[0];class s{constructor(t,e,n,a,E){this.distance=t,this.point1=e,this.point2=n,this.normal1=a,this.normal2=E}static fromRaw(t){if(!t)return null;const e=new s(t.distance(),E.ut.fromRaw(t.point1()),E.ut.fromRaw(t.point2()),E.ut.fromRaw(t.normal1()),E.ut.fromRaw(t.normal2()));return t.free(),e}}a()}catch(t){a(t)}}))},44:(t,e,n)=>{"use strict";var a;n.d(e,{T:()=>a}),function(t){t[t.Vertex=0]="Vertex",t[t.Face=1]="Face",t[t.Unknown=2]="Unknown"}(a||(a={}))},698:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{$R:()=>D.$R,CJ:()=>D.CJ,DM:()=>D.DM,DY:()=>D.DY,FP:()=>Nt.F,Fr:()=>D.Fr,GJ:()=>zt.G,Gz:()=>Jt.Gz,L4:()=>x.L,NT:()=>E.N,No:()=>Jt.No,Qi:()=>Gt.Q,Te:()=>Ht.T,Vl:()=>Nt.V,XX:()=>D.XX,YM:()=>kt.YM,aH:()=>D.aH,az:()=>D.az,bn:()=>D.bn,cu:()=>Jt.cu,eL:()=>x.e,ec:()=>D.ec,f4:()=>D.f4,iA:()=>D.iA,ic:()=>kt.ic,jv:()=>D.jv,mB:()=>zt.m,sw:()=>D.sw,to:()=>D.to,uV:()=>kt.uV,vq:()=>kt.vq,zH:()=>Jt.zH,zY:()=>Bt.z});var E=n(553),x=n(134),D=n(332),kt=n(939),Bt=n(476),Ht=n(44),Jt=n(783),Nt=n(805),zt=n(740),Gt=n(362),Ot=t([E,x,D,kt,Bt,Jt,Nt,zt,Gt]);[E,x,D,kt,Bt,Jt,Nt,zt,Gt]=Ot.then?(await Ot)():Ot,a()}catch(t){a(t)}}))},134:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{L:()=>o,e:()=>c});var E=n(302),x=n(791),D=t([E,x]);[E,x]=D.then?(await D)():D;class o{constructor(t){this.raw=t||new E.uU,this.tempManifold=new c(null)}free(){this.raw.free(),this.raw=void 0}contactsWith(t,e){this.raw.contacts_with(t,e)}intersectionsWith(t,e){this.raw.intersections_with(t,e)}contactPair(t,e,n){const a=this.raw.contact_pair(t,e);if(a){const e=a.collider1()!=t;let E;for(E=0;E<a.numContactManifolds();++E)this.tempManifold.raw=a.contactManifold(E),this.tempManifold.raw&&n(this.tempManifold,e),this.tempManifold.free();a.free()}}intersectionPair(t,e){return this.raw.intersection_pair(t,e)}}class c{constructor(t){this.raw=t}free(){this.raw.free(),this.raw=void 0}normal(){return x.ut.fromRaw(this.raw.normal())}localNormal1(){return x.ut.fromRaw(this.raw.local_n1())}localNormal2(){return x.ut.fromRaw(this.raw.local_n2())}subshape1(){return this.raw.subshape1()}subshape2(){return this.raw.subshape2()}numContacts(){return this.raw.num_contacts()}localContactPoint1(t){return x.ut.fromRaw(this.raw.contact_local_p1(t))}localContactPoint2(t){return x.ut.fromRaw(this.raw.contact_local_p2(t))}contactDist(t){return this.raw.contact_dist(t)}contactFid1(t){return this.raw.contact_fid1(t)}contactFid2(t){return this.raw.contact_fid2(t)}contactImpulse(t){return this.raw.contact_impulse(t)}contactTangentImpulse(t){return this.raw.contact_tangent_impulse(t)}numSolverContacts(){return this.raw.num_solver_contacts()}solverContactPoint(t){return x.ut.fromRaw(this.raw.solver_contact_point(t))}solverContactDist(t){return this.raw.solver_contact_dist(t)}solverContactFriction(t){return this.raw.solver_contact_friction(t)}solverContactRestitution(t){return this.raw.solver_contact_restitution(t)}solverContactTangentVelocity(t){return x.ut.fromRaw(this.raw.solver_contact_tangent_velocity(t))}}a()}catch(t){a(t)}}))},805:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{F:()=>o,V:()=>c});var E=n(791),x=n(44),D=t([E]);E=(D.then?(await D)():D)[0];class o{constructor(t,e){this.point=t,this.isInside=e}static fromRaw(t){if(!t)return null;const e=new o(E.ut.fromRaw(t.point()),t.isInside());return t.free(),e}}class c{constructor(t,e,n,a,E){this.featureType=x.T.Unknown,this.featureId=void 0,this.collider=t,this.point=e,this.isInside=n,void 0!==E&&(this.featureId=E),void 0!==a&&(this.featureType=a)}static fromRaw(t,e){if(!e)return null;const n=new c(t.get(e.colliderHandle()),E.ut.fromRaw(e.point()),e.isInside(),e.featureType(),e.featureId());return e.free(),n}}a()}catch(t){a(t)}}))},783:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{Gz:()=>c,No:()=>l,cu:()=>h,zH:()=>o});var E=n(791),x=n(44),D=t([E]);E=(D.then?(await D)():D)[0];class o{constructor(t,e){this.origin=t,this.dir=e}pointAt(t){return{x:this.origin.x+this.dir.x*t,y:this.origin.y+this.dir.y*t}}}class c{constructor(t,e,n,a){this.featureType=x.T.Unknown,this.featureId=void 0,this.toi=t,this.normal=e,void 0!==a&&(this.featureId=a),void 0!==n&&(this.featureType=n)}static fromRaw(t){if(!t)return null;const e=new c(t.toi(),E.ut.fromRaw(t.normal()),t.featureType(),t.featureId());return t.free(),e}}class l{constructor(t,e,n,a,E){this.featureType=x.T.Unknown,this.featureId=void 0,this.collider=t,this.toi=e,this.normal=n,void 0!==E&&(this.featureId=E),void 0!==a&&(this.featureType=a)}static fromRaw(t,e){if(!e)return null;const n=new l(t.get(e.colliderHandle()),e.toi(),E.ut.fromRaw(e.normal()),e.featureType(),e.featureId());return e.free(),n}}class h{constructor(t,e){this.collider=t,this.toi=e}static fromRaw(t,e){if(!e)return null;const n=new h(t.get(e.colliderHandle()),e.toi());return e.free(),n}}a()}catch(t){a(t)}}))},332:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{$R:()=>g,CJ:()=>b,DM:()=>C,DY:()=>E,Fr:()=>w,XX:()=>f,aH:()=>v,az:()=>S,bn:()=>p,ec:()=>u,f4:()=>T,iA:()=>m,jv:()=>_,sw:()=>y,to:()=>R});var E,x=n(791),D=n(302),kt=n(362),Bt=n(805),Ht=n(783),Jt=n(740),Nt=t([x,Jt,kt,Bt,Ht,D]);[x,Jt,kt,Bt,Ht,D]=Nt.then?(await Nt)():Nt;class p{static fromRaw(t,e){const n=t.coShapeType(e);let a,D,kt,Bt,Ht,Jt,Nt;switch(n){case E.Ball:return new u(t.coRadius(e));case E.Cuboid:return a=t.coHalfExtents(e),new _(a.x,a.y);case E.RoundCuboid:return a=t.coHalfExtents(e),D=t.coRoundRadius(e),new m(a.x,a.y,D);case E.Capsule:return Ht=t.coHalfHeight(e),Jt=t.coRadius(e),new y(Ht,Jt);case E.Segment:return kt=t.coVertices(e),new f(x.ut.new(kt[0],kt[1]),x.ut.new(kt[2],kt[3]));case E.Polyline:return kt=t.coVertices(e),Bt=t.coIndices(e),new v(kt,Bt);case E.Triangle:return kt=t.coVertices(e),new b(x.ut.new(kt[0],kt[1]),x.ut.new(kt[2],kt[3]),x.ut.new(kt[4],kt[5]));case E.RoundTriangle:return kt=t.coVertices(e),D=t.coRoundRadius(e),new g(x.ut.new(kt[0],kt[1]),x.ut.new(kt[2],kt[3]),x.ut.new(kt[4],kt[5]),D);case E.HalfSpace:return Nt=x.ut.fromRaw(t.coHalfspaceNormal(e)),new w(Nt);case E.TriMesh:return kt=t.coVertices(e),Bt=t.coIndices(e),new S(kt,Bt);case E.HeightField:const zt=t.coHeightfieldScale(e),Gt=t.coHeightfieldHeights(e);return new T(Gt,zt);case E.ConvexPolygon:return kt=t.coVertices(e),new R(kt,!1);case E.RoundConvexPolygon:return kt=t.coVertices(e),D=t.coRoundRadius(e),new C(kt,D,!1);default:throw new Error("unknown shape type: "+n)}}castShape(t,e,n,a,E,D,kt,Bt,Ht){let Nt=x.ut.intoRaw(t),zt=x.T3.intoRaw(e),Gt=x.ut.intoRaw(n),Ot=x.ut.intoRaw(E),Lt=x.T3.intoRaw(D),Vt=x.ut.intoRaw(kt),Wt=this.intoRaw(),Xt=a.intoRaw(),qt=Jt.G.fromRaw(null,Wt.castShape(Nt,zt,Gt,Xt,Ot,Lt,Vt,Bt,Ht));return Nt.free(),zt.free(),Gt.free(),Ot.free(),Lt.free(),Vt.free(),Wt.free(),Xt.free(),qt}intersectsShape(t,e,n,a,E){let D=x.ut.intoRaw(t),kt=x.T3.intoRaw(e),Bt=x.ut.intoRaw(a),Ht=x.T3.intoRaw(E),Jt=this.intoRaw(),Nt=n.intoRaw(),zt=Jt.intersectsShape(D,kt,Nt,Bt,Ht);return D.free(),kt.free(),Bt.free(),Ht.free(),Jt.free(),Nt.free(),zt}contactShape(t,e,n,a,E,D){let Bt=x.ut.intoRaw(t),Ht=x.T3.intoRaw(e),Jt=x.ut.intoRaw(a),Nt=x.T3.intoRaw(E),zt=this.intoRaw(),Gt=n.intoRaw(),Ot=kt.Q.fromRaw(zt.contactShape(Bt,Ht,Gt,Jt,Nt,D));return Bt.free(),Ht.free(),Jt.free(),Nt.free(),zt.free(),Gt.free(),Ot}containsPoint(t,e,n){let a=x.ut.intoRaw(t),E=x.T3.intoRaw(e),D=x.ut.intoRaw(n),kt=this.intoRaw(),Bt=kt.containsPoint(a,E,D);return a.free(),E.free(),D.free(),kt.free(),Bt}projectPoint(t,e,n,a){let E=x.ut.intoRaw(t),D=x.T3.intoRaw(e),kt=x.ut.intoRaw(n),Ht=this.intoRaw(),Jt=Bt.F.fromRaw(Ht.projectPoint(E,D,kt,a));return E.free(),D.free(),kt.free(),Ht.free(),Jt}intersectsRay(t,e,n,a){let E=x.ut.intoRaw(e),D=x.T3.intoRaw(n),kt=x.ut.intoRaw(t.origin),Bt=x.ut.intoRaw(t.dir),Ht=this.intoRaw(),Jt=Ht.intersectsRay(E,D,kt,Bt,a);return E.free(),D.free(),kt.free(),Bt.free(),Ht.free(),Jt}castRay(t,e,n,a,E){let D=x.ut.intoRaw(e),kt=x.T3.intoRaw(n),Bt=x.ut.intoRaw(t.origin),Ht=x.ut.intoRaw(t.dir),Jt=this.intoRaw(),Nt=Jt.castRay(D,kt,Bt,Ht,a,E);return D.free(),kt.free(),Bt.free(),Ht.free(),Jt.free(),Nt}castRayAndGetNormal(t,e,n,a,E){let D=x.ut.intoRaw(e),kt=x.T3.intoRaw(n),Bt=x.ut.intoRaw(t.origin),Jt=x.ut.intoRaw(t.dir),Nt=this.intoRaw(),zt=Ht.Gz.fromRaw(Nt.castRayAndGetNormal(D,kt,Bt,Jt,a,E));return D.free(),kt.free(),Bt.free(),Jt.free(),Nt.free(),zt}}!function(t){t[t.Ball=0]="Ball",t[t.Cuboid=1]="Cuboid",t[t.Capsule=2]="Capsule",t[t.Segment=3]="Segment",t[t.Polyline=4]="Polyline",t[t.Triangle=5]="Triangle",t[t.TriMesh=6]="TriMesh",t[t.HeightField=7]="HeightField",t[t.ConvexPolygon=9]="ConvexPolygon",t[t.RoundCuboid=10]="RoundCuboid",t[t.RoundTriangle=11]="RoundTriangle",t[t.RoundConvexPolygon=12]="RoundConvexPolygon",t[t.HalfSpace=13]="HalfSpace"}(E||(E={}));class u extends p{constructor(t){super(),this.type=E.Ball,this.radius=t}intoRaw(){return D.X7.ball(this.radius)}}class w extends p{constructor(t){super(),this.type=E.HalfSpace,this.normal=t}intoRaw(){let t=x.ut.intoRaw(this.normal),e=D.X7.halfspace(t);return t.free(),e}}class _ extends p{constructor(t,e){super(),this.type=E.Cuboid,this.halfExtents=x.ut.new(t,e)}intoRaw(){return D.X7.cuboid(this.halfExtents.x,this.halfExtents.y)}}class m extends p{constructor(t,e,n){super(),this.type=E.RoundCuboid,this.halfExtents=x.ut.new(t,e),this.borderRadius=n}intoRaw(){return D.X7.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.borderRadius)}}class y extends p{constructor(t,e){super(),this.type=E.Capsule,this.halfHeight=t,this.radius=e}intoRaw(){return D.X7.capsule(this.halfHeight,this.radius)}}class f extends p{constructor(t,e){super(),this.type=E.Segment,this.a=t,this.b=e}intoRaw(){let t=x.ut.intoRaw(this.a),e=x.ut.intoRaw(this.b),n=D.X7.segment(t,e);return t.free(),e.free(),n}}class b extends p{constructor(t,e,n){super(),this.type=E.Triangle,this.a=t,this.b=e,this.c=n}intoRaw(){let t=x.ut.intoRaw(this.a),e=x.ut.intoRaw(this.b),n=x.ut.intoRaw(this.c),a=D.X7.triangle(t,e,n);return t.free(),e.free(),n.free(),a}}class g extends p{constructor(t,e,n,a){super(),this.type=E.RoundTriangle,this.a=t,this.b=e,this.c=n,this.borderRadius=a}intoRaw(){let t=x.ut.intoRaw(this.a),e=x.ut.intoRaw(this.b),n=x.ut.intoRaw(this.c),a=D.X7.roundTriangle(t,e,n,this.borderRadius);return t.free(),e.free(),n.free(),a}}class v extends p{constructor(t,e){super(),this.type=E.Polyline,this.vertices=t,this.indices=null!=e?e:new Uint32Array(0)}intoRaw(){return D.X7.polyline(this.vertices,this.indices)}}class S extends p{constructor(t,e){super(),this.type=E.TriMesh,this.vertices=t,this.indices=e}intoRaw(){return D.X7.trimesh(this.vertices,this.indices)}}class R extends p{constructor(t,e){super(),this.type=E.ConvexPolygon,this.vertices=t,this.skipConvexHullComputation=!!e}intoRaw(){return this.skipConvexHullComputation?D.X7.convexPolyline(this.vertices):D.X7.convexHull(this.vertices)}}class C extends p{constructor(t,e,n){super(),this.type=E.RoundConvexPolygon,this.vertices=t,this.borderRadius=e,this.skipConvexHullComputation=!!n}intoRaw(){return this.skipConvexHullComputation?D.X7.roundConvexPolyline(this.vertices,this.borderRadius):D.X7.roundConvexHull(this.vertices,this.borderRadius)}}class T extends p{constructor(t,e){super(),this.type=E.HeightField,this.heights=t,this.scale=e}intoRaw(){let t=x.ut.intoRaw(this.scale),e=D.X7.heightfield(this.heights,t);return t.free(),e}}a()}catch(t){a(t)}}))},740:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{G:()=>s,m:()=>o});var E=n(791),x=t([E]);E=(x.then?(await x)():x)[0];class s{constructor(t,e,n,a,E){this.toi=t,this.witness1=e,this.witness2=n,this.normal1=a,this.normal2=E}static fromRaw(t,e){if(!e)return null;const n=new s(e.toi(),E.ut.fromRaw(e.witness1()),E.ut.fromRaw(e.witness2()),E.ut.fromRaw(e.normal1()),E.ut.fromRaw(e.normal2()));return e.free(),n}}class o extends s{constructor(t,e,n,a,E,x){super(e,n,a,E,x),this.collider=t}static fromRaw(t,e){if(!e)return null;const n=new o(t.get(e.colliderHandle()),e.toi(),E.ut.fromRaw(e.witness1()),E.ut.fromRaw(e.witness2()),E.ut.fromRaw(e.normal1()),E.ut.fromRaw(e.normal2()));return e.free(),n}}a()}catch(t){a(t)}}))},791:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{FM:()=>s,T3:()=>c,ut:()=>o});var E=n(302),x=t([E]);E=(x.then?(await x)():x)[0];class s{constructor(t,e){this.x=t,this.y=e}}class o{static new(t,e){return new s(t,e)}static zeros(){return o.new(0,0)}static fromRaw(t){if(!t)return null;let e=o.new(t.x,t.y);return t.free(),e}static intoRaw(t){return new E.WF(t.x,t.y)}static copy(t,e){t.x=e.x,t.y=e.y}}class c{static identity(){return 0}static fromRaw(t){if(!t)return null;let e=t.angle;return t.free(),e}static intoRaw(t){return E.$Z.fromAngle(t)}}a()}catch(t){a(t)}}))},682:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{k:()=>o,t:()=>s});var E=n(302),x=t([E]);E=(x.then?(await x)():x)[0];class s{constructor(t,e){this.vertices=t,this.colors=e}}class o{constructor(t){this.raw=t||new E.wb}free(){this.raw.free(),this.raw=void 0,this.vertices=void 0,this.colors=void 0}render(t,e,n,a,E){this.raw.render(t.raw,e.raw,n.raw,a.raw,E.raw),this.vertices=this.raw.vertices(),this.colors=this.raw.colors()}}a()}catch(t){a(t)}}))},116:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{Md:()=>E,NH:()=>l,qV:()=>c});var E,x=n(302),D=n(791),kt=t([D,x]);[D,x]=kt.then?(await kt)():kt,function(t){t[t.COLLISION_EVENTS=1]="COLLISION_EVENTS",t[t.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"}(E||(E={}));class c{free(){this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return D.ut.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return D.ut.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class l{constructor(t,e){this.raw=e||new x.we(t)}free(){this.raw.free(),this.raw=void 0}drainCollisionEvents(t){this.raw.drainCollisionEvents(t)}drainContactForceEvents(t){let e=new c;this.raw.drainContactForceEvents((n=>{e.raw=n,t(e),e.free()}))}clear(){this.raw.clear()}}a()}catch(t){a(t)}}))},784:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{DJ:()=>x.D,Md:()=>kt.Md,NH:()=>kt.NH,Nv:()=>Bt.N,Vq:()=>Jt.V,_m:()=>Jt._,iX:()=>Bt.i,kh:()=>Ht.k,q3:()=>E.q,qV:()=>kt.qV,tt:()=>Ht.t,y9:()=>D.y});var E=n(135),x=n(777),D=n(542),kt=n(116),Bt=n(356),Ht=n(682),Jt=n(157),Nt=t([E,x,D,kt,Ht,Jt]);[E,x,D,kt,Ht,Jt]=Nt.then?(await Nt)():Nt,a()}catch(t){a(t)}}))},356:(t,e,n)=>{"use strict";var a,E;n.d(e,{N:()=>E,i:()=>a}),function(t){t[t.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",t[t.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"}(a||(a={})),function(t){t[t.EMPTY=0]="EMPTY",t[t.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"}(E||(E={}))},777:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{D:()=>o});var E=n(302),x=n(791),D=t([E,x]);[E,x]=D.then?(await D)():D;class o{constructor(t){this.raw=t||new E._q}free(){this.raw.free(),this.raw=void 0}step(t,e,n,a,E,D,kt,Bt,Ht,Jt,Nt,zt){let Gt=x.ut.intoRaw(t);Nt?this.raw.stepWithEvents(Gt,e.raw,n.raw,a.raw,E.raw,D.raw,kt.raw,Bt.raw,Ht.raw,Jt.raw,Nt.raw,zt,zt?zt.filterContactPair:null,zt?zt.filterIntersectionPair:null):this.raw.step(Gt,e.raw,n.raw,a.raw,E.raw,D.raw,kt.raw,Bt.raw,Ht.raw,Jt.raw),Gt.free()}}a()}catch(t){a(t)}}))},157:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{V:()=>d,_:()=>E});var E,x=n(302),D=n(783),kt=n(805),Bt=n(740),Ht=n(791),Jt=t([x,Ht,D,kt,Bt]);[x,Ht,D,kt,Bt]=Jt.then?(await Jt)():Jt,function(t){t[t.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",t[t.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",t[t.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",t[t.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",t[t.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",t[t.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",t[t.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",t[t.ONLY_FIXED=6]="ONLY_FIXED"}(E||(E={}));class d{constructor(t){this.raw=t||new x.nv}free(){this.raw.free(),this.raw=void 0}update(t,e,n){this.raw.update(t.raw,e.raw,n.raw)}castRay(t,e,n,a,E,x,kt,Bt,Jt,Nt){let zt=Ht.ut.intoRaw(n.origin),Gt=Ht.ut.intoRaw(n.dir),Ot=D.cu.fromRaw(e,this.raw.castRay(t.raw,e.raw,zt,Gt,a,E,x,kt,Bt,Jt,Nt));return zt.free(),Gt.free(),Ot}castRayAndGetNormal(t,e,n,a,E,x,kt,Bt,Jt,Nt){let zt=Ht.ut.intoRaw(n.origin),Gt=Ht.ut.intoRaw(n.dir),Ot=D.No.fromRaw(e,this.raw.castRayAndGetNormal(t.raw,e.raw,zt,Gt,a,E,x,kt,Bt,Jt,Nt));return zt.free(),Gt.free(),Ot}intersectionsWithRay(t,e,n,a,E,x,kt,Bt,Jt,Nt,zt){let Gt=Ht.ut.intoRaw(n.origin),Ot=Ht.ut.intoRaw(n.dir);this.raw.intersectionsWithRay(t.raw,e.raw,Gt,Ot,a,E,(t=>x(D.No.fromRaw(e,t))),kt,Bt,Jt,Nt,zt),Gt.free(),Ot.free()}intersectionWithShape(t,e,n,a,E,x,D,kt,Bt,Jt){let Nt=Ht.ut.intoRaw(n),zt=Ht.T3.intoRaw(a),Gt=E.intoRaw(),Ot=this.raw.intersectionWithShape(t.raw,e.raw,Nt,zt,Gt,x,D,kt,Bt,Jt);return Nt.free(),zt.free(),Gt.free(),Ot}projectPoint(t,e,n,a,E,x,D,Bt,Jt){let Nt=Ht.ut.intoRaw(n),zt=kt.V.fromRaw(e,this.raw.projectPoint(t.raw,e.raw,Nt,a,E,x,D,Bt,Jt));return Nt.free(),zt}projectPointAndGetFeature(t,e,n,a,E,x,D,Bt){let Jt=Ht.ut.intoRaw(n),Nt=kt.V.fromRaw(e,this.raw.projectPointAndGetFeature(t.raw,e.raw,Jt,a,E,x,D,Bt));return Jt.free(),Nt}intersectionsWithPoint(t,e,n,a,E,x,D,kt,Bt){let Jt=Ht.ut.intoRaw(n);this.raw.intersectionsWithPoint(t.raw,e.raw,Jt,a,E,x,D,kt,Bt),Jt.free()}castShape(t,e,n,a,E,x,D,kt,Jt,Nt,zt,Gt,Ot){let Lt=Ht.ut.intoRaw(n),Vt=Ht.T3.intoRaw(a),Wt=Ht.ut.intoRaw(E),Xt=x.intoRaw(),qt=Bt.m.fromRaw(e,this.raw.castShape(t.raw,e.raw,Lt,Vt,Wt,Xt,D,kt,Jt,Nt,zt,Gt,Ot));return Lt.free(),Vt.free(),Wt.free(),Xt.free(),qt}intersectionsWithShape(t,e,n,a,E,x,D,kt,Bt,Jt,Nt){let zt=Ht.ut.intoRaw(n),Gt=Ht.T3.intoRaw(a),Ot=E.intoRaw();this.raw.intersectionsWithShape(t.raw,e.raw,zt,Gt,Ot,x,D,kt,Bt,Jt,Nt),zt.free(),Gt.free(),Ot.free()}collidersWithAabbIntersectingAabb(t,e,n){let a=Ht.ut.intoRaw(t),E=Ht.ut.intoRaw(e);this.raw.collidersWithAabbIntersectingAabb(a,E,n),a.free(),E.free()}}a()}catch(t){a(t)}}))},542:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{y:()=>c});var E=n(302),x=n(791),D=n(135),kt=t([E,x,D]);[E,x,D]=kt.then?(await kt)():kt;class c{constructor(t){this.raw=t||new E.w0}free(){this.raw.free(),this.raw=void 0}serializeAll(t,e,n,a,E,D,kt,Bt,Ht){let Jt=x.ut.intoRaw(t);const Nt=this.raw.serializeAll(Jt,e.raw,n.raw,a.raw,E.raw,D.raw,kt.raw,Bt.raw,Ht.raw);return Jt.free(),Nt}deserializeAll(t){return D.q.fromRaw(this.raw.deserializeAll(t))}}a()}catch(t){a(t)}}))},135:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.d(e,{q:()=>g});var E=n(553),x=n(134),D=n(476),kt=n(150),Bt=n(812),Ht=n(881),Jt=n(618),Nt=n(142),zt=n(153),Gt=n(791),Ot=n(777),Lt=n(157),Vt=n(542),Wt=n(682),Xt=n(874),qt=t([kt,Bt,E,x,Ht,D,Jt,Nt,zt,Lt,Ot,Vt,Wt,Gt,Xt]);[kt,Bt,E,x,Ht,D,Jt,Nt,zt,Lt,Ot,Vt,Wt,Gt,Xt]=qt.then?(await qt)():qt;class g{constructor(t,e,n,a,Gt,Xt,qt,Ut,Kt,Yt,Qt,$t,Zt,te){this.gravity=t,this.integrationParameters=new kt.R(e),this.islands=new Bt.y(n),this.broadPhase=new E.N(a),this.narrowPhase=new x.L(Gt),this.bodies=new Ht.r(Xt),this.colliders=new D.z(qt),this.impulseJoints=new Jt.l(Ut),this.multibodyJoints=new Nt.h(Kt),this.ccdSolver=new zt.K(Yt),this.queryPipeline=new Lt.V(Qt),this.physicsPipeline=new Ot.D($t),this.serializationPipeline=new Vt.y(Zt),this.debugRenderPipeline=new Wt.k(te),this.characterControllers=new Set,this.impulseJoints.finalizeDeserialization(this.bodies),this.bodies.finalizeDeserialization(this.colliders),this.colliders.finalizeDeserialization(this.bodies)}free(){this.integrationParameters.free(),this.islands.free(),this.broadPhase.free(),this.narrowPhase.free(),this.bodies.free(),this.colliders.free(),this.impulseJoints.free(),this.multibodyJoints.free(),this.ccdSolver.free(),this.queryPipeline.free(),this.physicsPipeline.free(),this.serializationPipeline.free(),this.debugRenderPipeline.free(),this.characterControllers.forEach((t=>t.free())),this.integrationParameters=void 0,this.islands=void 0,this.broadPhase=void 0,this.narrowPhase=void 0,this.bodies=void 0,this.colliders=void 0,this.ccdSolver=void 0,this.impulseJoints=void 0,this.multibodyJoints=void 0,this.queryPipeline=void 0,this.physicsPipeline=void 0,this.serializationPipeline=void 0,this.debugRenderPipeline=void 0,this.characterControllers=void 0}static fromRaw(t){return t?new g(Gt.ut.fromRaw(t.takeGravity()),t.takeIntegrationParameters(),t.takeIslandManager(),t.takeBroadPhase(),t.takeNarrowPhase(),t.takeBodies(),t.takeColliders(),t.takeImpulseJoints(),t.takeMultibodyJoints()):null}takeSnapshot(){return this.serializationPipeline.serializeAll(this.gravity,this.integrationParameters,this.islands,this.broadPhase,this.narrowPhase,this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints)}static restoreSnapshot(t){return(new Vt.y).deserializeAll(t)}debugRender(){return this.debugRenderPipeline.render(this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints,this.narrowPhase),new Wt.t(this.debugRenderPipeline.vertices,this.debugRenderPipeline.colors)}step(t,e){this.physicsPipeline.step(this.gravity,this.integrationParameters,this.islands,this.broadPhase,this.narrowPhase,this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints,this.ccdSolver,t,e),this.queryPipeline.update(this.islands,this.bodies,this.colliders)}get timestep(){return this.integrationParameters.dt}set timestep(t){this.integrationParameters.dt=t}get maxVelocityIterations(){return this.integrationParameters.maxVelocityIterations}set maxVelocityIterations(t){this.integrationParameters.maxVelocityIterations=t}get maxVelocityFrictionIterations(){return this.integrationParameters.maxVelocityFrictionIterations}set maxVelocityFrictionIterations(t){this.integrationParameters.maxVelocityFrictionIterations=t}get maxStabilizationIterations(){return this.integrationParameters.maxStabilizationIterations}set maxStabilizationIterations(t){this.integrationParameters.maxStabilizationIterations=t}createRigidBody(t){return this.bodies.createRigidBody(this.colliders,t)}createCharacterController(t){let e=new Xt.m(t,this.integrationParameters,this.bodies,this.colliders,this.queryPipeline);return this.characterControllers.add(e),e}removeCharacterController(t){this.characterControllers.delete(t),t.free()}createCollider(t,e){let n=e?e.handle:void 0;return this.colliders.createCollider(this.bodies,t,n)}createImpulseJoint(t,e,n,a){return this.impulseJoints.createJoint(this.bodies,t,e.handle,n.handle,a)}createMultibodyJoint(t,e,n,a){return this.multibodyJoints.createJoint(t,e.handle,n.handle,a)}getRigidBody(t){return this.bodies.get(t)}getCollider(t){return this.colliders.get(t)}getImpulseJoint(t){return this.impulseJoints.get(t)}getMultibodyJoint(t){return this.multibodyJoints.get(t)}removeRigidBody(t){this.bodies&&this.bodies.remove(t.handle,this.islands,this.colliders,this.impulseJoints,this.multibodyJoints)}removeCollider(t,e){this.colliders&&this.colliders.remove(t.handle,this.islands,this.bodies,e)}removeImpulseJoint(t,e){this.impulseJoints&&this.impulseJoints.remove(t.handle,e)}removeMultibodyJoint(t,e){this.impulseJoints&&this.multibodyJoints.remove(t.handle,e)}forEachCollider(t){this.colliders.forEach(t)}forEachRigidBody(t){this.bodies.forEach(t)}forEachActiveRigidBody(t){this.bodies.forEachActiveRigidBody(this.islands,t)}castRay(t,e,n,a,E,x,D,kt){return this.queryPipeline.castRay(this.bodies,this.colliders,t,e,n,a,E,x?x.handle:null,D?D.handle:null,this.colliders.castClosure(kt))}castRayAndGetNormal(t,e,n,a,E,x,D,kt){return this.queryPipeline.castRayAndGetNormal(this.bodies,this.colliders,t,e,n,a,E,x?x.handle:null,D?D.handle:null,this.colliders.castClosure(kt))}intersectionsWithRay(t,e,n,a,E,x,D,kt,Bt){this.queryPipeline.intersectionsWithRay(this.bodies,this.colliders,t,e,n,a,E,x,D?D.handle:null,kt?kt.handle:null,this.colliders.castClosure(Bt))}intersectionWithShape(t,e,n,a,E,x,D,kt){let Bt=this.queryPipeline.intersectionWithShape(this.bodies,this.colliders,t,e,n,a,E,x?x.handle:null,D?D.handle:null,this.colliders.castClosure(kt));return null!=Bt?this.colliders.get(Bt):null}projectPoint(t,e,n,a,E,x,D){return this.queryPipeline.projectPoint(this.bodies,this.colliders,t,e,n,a,E?E.handle:null,x?x.handle:null,this.colliders.castClosure(D))}projectPointAndGetFeature(t,e,n,a,E,x){return this.queryPipeline.projectPointAndGetFeature(this.bodies,this.colliders,t,e,n,a?a.handle:null,E?E.handle:null,this.colliders.castClosure(x))}intersectionsWithPoint(t,e,n,a,E,x,D){this.queryPipeline.intersectionsWithPoint(this.bodies,this.colliders,t,this.colliders.castClosure(e),n,a,E?E.handle:null,x?x.handle:null,this.colliders.castClosure(D))}castShape(t,e,n,a,E,x,D,kt,Bt,Ht,Jt){return this.queryPipeline.castShape(this.bodies,this.colliders,t,e,n,a,E,x,D,kt,Bt?Bt.handle:null,Ht?Ht.handle:null,this.colliders.castClosure(Jt))}intersectionsWithShape(t,e,n,a,E,x,D,kt,Bt){this.queryPipeline.intersectionsWithShape(this.bodies,this.colliders,t,e,n,this.colliders.castClosure(a),E,x,D?D.handle:null,kt?kt.handle:null,this.colliders.castClosure(Bt))}collidersWithAabbIntersectingAabb(t,e,n){this.queryPipeline.collidersWithAabbIntersectingAabb(t,e,this.colliders.castClosure(n))}contactsWith(t,e){this.narrowPhase.contactsWith(t.handle,this.colliders.castClosure(e))}intersectionsWith(t,e){this.narrowPhase.intersectionsWith(t.handle,this.colliders.castClosure(e))}contactPair(t,e,n){this.narrowPhase.contactPair(t.handle,e.handle,n)}intersectionPair(t,e){return this.narrowPhase.intersectionPair(t.handle,e.handle)}}a()}catch(t){a(t)}}))},495:(t,e,n)=>{"use strict";n.a(t,(async(t,a)=>{try{n.r(e),n.d(e,{ActiveCollisionTypes:()=>E.ActiveCollisionTypes,ActiveEvents:()=>E.ActiveEvents,ActiveHooks:()=>E.ActiveHooks,Ball:()=>E.Ball,BroadPhase:()=>E.BroadPhase,CCDSolver:()=>E.CCDSolver,Capsule:()=>E.Capsule,CharacterCollision:()=>E.CharacterCollision,CoefficientCombineRule:()=>E.CoefficientCombineRule,Collider:()=>E.Collider,ColliderDesc:()=>E.ColliderDesc,ColliderSet:()=>E.ColliderSet,ConvexPolygon:()=>E.ConvexPolygon,Cuboid:()=>E.Cuboid,DebugRenderBuffers:()=>E.DebugRenderBuffers,DebugRenderPipeline:()=>E.DebugRenderPipeline,EventQueue:()=>E.EventQueue,FeatureType:()=>E.FeatureType,FixedImpulseJoint:()=>E.FixedImpulseJoint,FixedMultibodyJoint:()=>E.FixedMultibodyJoint,HalfSpace:()=>E.HalfSpace,Heightfield:()=>E.Heightfield,ImpulseJoint:()=>E.ImpulseJoint,ImpulseJointSet:()=>E.ImpulseJointSet,IntegrationParameters:()=>E.IntegrationParameters,IslandManager:()=>E.IslandManager,JointData:()=>E.JointData,JointType:()=>E.JointType,KinematicCharacterController:()=>E.KinematicCharacterController,MassPropsMode:()=>E.MassPropsMode,MotorModel:()=>E.MotorModel,MultibodyJoint:()=>E.MultibodyJoint,MultibodyJointSet:()=>E.MultibodyJointSet,NarrowPhase:()=>E.NarrowPhase,PhysicsPipeline:()=>E.PhysicsPipeline,PointColliderProjection:()=>E.PointColliderProjection,PointProjection:()=>E.PointProjection,Polyline:()=>E.Polyline,PrismaticImpulseJoint:()=>E.PrismaticImpulseJoint,PrismaticMultibodyJoint:()=>E.PrismaticMultibodyJoint,QueryFilterFlags:()=>E.QueryFilterFlags,QueryPipeline:()=>E.QueryPipeline,Ray:()=>E.Ray,RayColliderIntersection:()=>E.RayColliderIntersection,RayColliderToi:()=>E.RayColliderToi,RayIntersection:()=>E.RayIntersection,RevoluteImpulseJoint:()=>E.RevoluteImpulseJoint,RevoluteMultibodyJoint:()=>E.RevoluteMultibodyJoint,RigidBody:()=>E.RigidBody,RigidBodyDesc:()=>E.RigidBodyDesc,RigidBodySet:()=>E.RigidBodySet,RigidBodyType:()=>E.RigidBodyType,RotationOps:()=>E.RotationOps,RoundConvexPolygon:()=>E.RoundConvexPolygon,RoundCuboid:()=>E.RoundCuboid,RoundTriangle:()=>E.RoundTriangle,Segment:()=>E.Segment,SerializationPipeline:()=>E.SerializationPipeline,Shape:()=>E.Shape,ShapeColliderTOI:()=>E.ShapeColliderTOI,ShapeContact:()=>E.ShapeContact,ShapeTOI:()=>E.ShapeTOI,ShapeType:()=>E.ShapeType,SolverFlags:()=>E.SolverFlags,TempContactForceEvent:()=>E.TempContactForceEvent,TempContactManifold:()=>E.TempContactManifold,TriMesh:()=>E.TriMesh,Triangle:()=>E.Triangle,UnitImpulseJoint:()=>E.UnitImpulseJoint,UnitMultibodyJoint:()=>E.UnitMultibodyJoint,Vector2:()=>E.Vector2,VectorOps:()=>E.VectorOps,World:()=>E.World,default:()=>D,version:()=>E.version});var E=n(11),x=t([E]);const D=E=(x.then?(await x)():x)[0];a()}catch(t){a(t)}}))},302:(t,e,n)=>{"use strict";n.a(t,(async(a,E)=>{try{n.d(e,{$B:()=>bt,$Z:()=>st,FU:()=>k,HT:()=>mt,IQ:()=>B,Is:()=>U,JM:()=>Wt,LE:()=>H,M1:()=>_t,Mv:()=>It,Ne:()=>ft,Or:()=>Ft,Py:()=>xt,Qc:()=>X,Qj:()=>Mt,R:()=>St,TY:()=>Tt,VD:()=>gt,WF:()=>pt,Wx:()=>J,X7:()=>ct,_q:()=>$,am:()=>Rt,bj:()=>Et,cQ:()=>W,fP:()=>Pt,fY:()=>at,fl:()=>Y,i8:()=>v,jp:()=>Ct,lB:()=>At,nv:()=>et,o$:()=>yt,oH:()=>Dt,pT:()=>wt,pm:()=>vt,uU:()=>Q,ug:()=>ut,vg:()=>K,w0:()=>ot,w_:()=>jt,wb:()=>G,we:()=>V,zu:()=>q});var x=n(500);t=n.hmd(t);var D=a([x]);x=(D.then?(await D)():D)[0];const kt=new Array(32).fill(void 0);function c(t){return kt[t]}kt.push(void 0,null,!0,!1);let Bt=kt.length;function h(t){t<36||(kt[t]=Bt,Bt=t)}function d(t){const e=c(t);return h(t),e}function p(t){Bt===kt.length&&kt.push(kt.length+1);const e=Bt;return Bt=kt[e],kt[e]=t,e}function u(t){return null==t}let Ht=new Float64Array;function _(){return 0===Ht.byteLength&&(Ht=new Float64Array(x.memory.buffer)),Ht}let Jt=new Int32Array;function y(){return 0===Jt.byteLength&&(Jt=new Int32Array(x.memory.buffer)),Jt}let Nt=new("undefined"==typeof TextDecoder?(0,t.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});Nt.decode();let zt=new Uint8Array;function g(t,e){return Nt.decode((0===zt.byteLength&&(zt=new Uint8Array(x.memory.buffer)),zt).subarray(t,t+e))}function v(){try{const n=x.__wbindgen_add_to_stack_pointer(-16);x.version(n);var t=y()[n/4+0],e=y()[n/4+1];return g(t,e)}finally{x.__wbindgen_add_to_stack_pointer(16),x.__wbindgen_free(t,e)}}function S(t,e){if(!(t instanceof e))throw new Error(`expected instance of ${e.name}`);return t.ptr}let Gt=new Float32Array;function C(){return 0===Gt.byteLength&&(Gt=new Float32Array(x.memory.buffer)),Gt}let Ot=32;function A(t){if(1==Ot)throw new Error("out of js stack");return kt[--Ot]=t,Ot}function P(t,e){return C().subarray(t/4,t/4+e)}let Lt=new Uint32Array;function I(){return 0===Lt.byteLength&&(Lt=new Uint32Array(x.memory.buffer)),Lt}let Vt=0;function M(t,e){const n=e(4*t.length);return C().set(t,n/4),Vt=t.length,n}function j(t,e){const n=e(4*t.length);return I().set(t,n/4),Vt=t.length,n}function F(t,e){try{return t.apply(this,e)}catch(t){x.__wbindgen_exn_store(p(t))}}Object.freeze({Revolute:0,0:"Revolute",Fixed:1,1:"Fixed",Prismatic:2,2:"Prismatic",Generic:3,3:"Generic"}),Object.freeze({AccelerationBased:0,0:"AccelerationBased",ForceBased:1,1:"ForceBased"});const Wt=Object.freeze({X:0,0:"X",Y:1,1:"Y",AngX:2,2:"AngX"});Object.freeze({Dynamic:0,0:"Dynamic",Fixed:1,1:"Fixed",KinematicPositionBased:2,2:"KinematicPositionBased",KinematicVelocityBased:3,3:"KinematicVelocityBased"}),Object.freeze({Vertex:0,0:"Vertex",Face:1,1:"Face",Unknown:2,2:"Unknown"}),Object.freeze({Ball:0,0:"Ball",Cuboid:1,1:"Cuboid",Capsule:2,2:"Capsule",Segment:3,3:"Segment",Polyline:4,4:"Polyline",Triangle:5,5:"Triangle",TriMesh:6,6:"TriMesh",HeightField:7,7:"HeightField",Compound:8,8:"Compound",ConvexPolygon:9,9:"ConvexPolygon",RoundCuboid:10,10:"RoundCuboid",RoundTriangle:11,11:"RoundTriangle",RoundConvexPolygon:12,12:"RoundConvexPolygon",HalfSpace:13,13:"HalfSpace"});class k{static __wrap(t){const e=Object.create(k.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawbroadphase_free(t)}constructor(){const t=x.rawbroadphase_new();return k.__wrap(t)}}class H{static __wrap(t){const e=Object.create(H.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawccdsolver_free(t)}constructor(){const t=x.rawccdsolver_new();return H.__wrap(t)}}class J{static __wrap(t){const e=Object.create(J.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawcharactercollision_free(t)}constructor(){const t=x.rawcharactercollision_new();return J.__wrap(t)}handle(){return x.rawcharactercollision_handle(this.ptr)}translationApplied(){const t=x.rawcharactercollision_translationApplied(this.ptr);return pt.__wrap(t)}translationRemaining(){const t=x.rawcharactercollision_translationRemaining(this.ptr);return pt.__wrap(t)}toi(){return x.rawcharactercollision_toi(this.ptr)}worldWitness1(){const t=x.rawcharactercollision_worldWitness1(this.ptr);return pt.__wrap(t)}worldWitness2(){const t=x.rawcharactercollision_worldWitness2(this.ptr);return pt.__wrap(t)}worldNormal1(){const t=x.rawcharactercollision_worldNormal1(this.ptr);return pt.__wrap(t)}worldNormal2(){const t=x.rawcharactercollision_worldNormal2(this.ptr);return pt.__wrap(t)}}class B{static __wrap(t){const e=Object.create(B.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawcolliderset_free(t)}coTranslation(t){const e=x.rawcolliderset_coTranslation(this.ptr,t);return pt.__wrap(e)}coRotation(t){const e=x.rawcolliderset_coRotation(this.ptr,t);return st.__wrap(e)}coSetTranslation(t,e,n){x.rawcolliderset_coSetTranslation(this.ptr,t,e,n)}coSetTranslationWrtParent(t,e,n){x.rawcolliderset_coSetTranslationWrtParent(this.ptr,t,e,n)}coSetRotation(t,e){x.rawcolliderset_coSetRotation(this.ptr,t,e)}coSetRotationWrtParent(t,e){x.rawcolliderset_coSetRotationWrtParent(this.ptr,t,e)}coIsSensor(t){return 0!==x.rawcolliderset_coIsSensor(this.ptr,t)}coShapeType(t){return x.rawcolliderset_coShapeType(this.ptr,t)>>>0}coHalfspaceNormal(t){const e=x.rawcolliderset_coHalfspaceNormal(this.ptr,t);return 0===e?void 0:pt.__wrap(e)}coHalfExtents(t){const e=x.rawcolliderset_coHalfExtents(this.ptr,t);return 0===e?void 0:pt.__wrap(e)}coRadius(t){try{const a=x.__wbindgen_add_to_stack_pointer(-16);x.rawcolliderset_coRadius(a,this.ptr,t);var e=y()[a/4+0],n=C()[a/4+1];return 0===e?void 0:n}finally{x.__wbindgen_add_to_stack_pointer(16)}}coHalfHeight(t){try{const a=x.__wbindgen_add_to_stack_pointer(-16);x.rawcolliderset_coHalfHeight(a,this.ptr,t);var e=y()[a/4+0],n=C()[a/4+1];return 0===e?void 0:n}finally{x.__wbindgen_add_to_stack_pointer(16)}}coRoundRadius(t){try{const a=x.__wbindgen_add_to_stack_pointer(-16);x.rawcolliderset_coRoundRadius(a,this.ptr,t);var e=y()[a/4+0],n=C()[a/4+1];return 0===e?void 0:n}finally{x.__wbindgen_add_to_stack_pointer(16)}}coVertices(t){try{const a=x.__wbindgen_add_to_stack_pointer(-16);x.rawcolliderset_coVertices(a,this.ptr,t);var e=y()[a/4+0],n=y()[a/4+1];let E;return 0!==e&&(E=P(e,n).slice(),x.__wbindgen_free(e,4*n)),E}finally{x.__wbindgen_add_to_stack_pointer(16)}}coIndices(t){try{const D=x.__wbindgen_add_to_stack_pointer(-16);x.rawcolliderset_coIndices(D,this.ptr,t);var e=y()[D/4+0],n=y()[D/4+1];let kt;return 0!==e&&(kt=(a=e,E=n,I().subarray(a/4,a/4+E)).slice(),x.__wbindgen_free(e,4*n)),kt}finally{x.__wbindgen_add_to_stack_pointer(16)}var a,E}coHeightfieldHeights(t){try{const a=x.__wbindgen_add_to_stack_pointer(-16);x.rawcolliderset_coHeightfieldHeights(a,this.ptr,t);var e=y()[a/4+0],n=y()[a/4+1];let E;return 0!==e&&(E=P(e,n).slice(),x.__wbindgen_free(e,4*n)),E}finally{x.__wbindgen_add_to_stack_pointer(16)}}coHeightfieldScale(t){const e=x.rawcolliderset_coHeightfieldScale(this.ptr,t);return 0===e?void 0:pt.__wrap(e)}coParent(t){try{const a=x.__wbindgen_add_to_stack_pointer(-16);x.rawcolliderset_coParent(a,this.ptr,t);var e=y()[a/4+0],n=_()[a/8+1];return 0===e?void 0:n}finally{x.__wbindgen_add_to_stack_pointer(16)}}coFriction(t){return x.rawcolliderset_coFriction(this.ptr,t)}coRestitution(t){return x.rawcolliderset_coRestitution(this.ptr,t)}coDensity(t){return x.rawcolliderset_coDensity(this.ptr,t)}coMass(t){return x.rawcolliderset_coMass(this.ptr,t)}coVolume(t){return x.rawcolliderset_coVolume(this.ptr,t)}coCollisionGroups(t){return x.rawcolliderset_coCollisionGroups(this.ptr,t)>>>0}coSolverGroups(t){return x.rawcolliderset_coSolverGroups(this.ptr,t)>>>0}coActiveHooks(t){return x.rawcolliderset_coActiveHooks(this.ptr,t)>>>0}coActiveCollisionTypes(t){return x.rawcolliderset_coActiveCollisionTypes(this.ptr,t)}coActiveEvents(t){return x.rawcolliderset_coActiveEvents(this.ptr,t)>>>0}coContactForceEventThreshold(t){return x.rawcolliderset_coContactForceEventThreshold(this.ptr,t)}coContainsPoint(t,e){return S(e,pt),0!==x.rawcolliderset_coContainsPoint(this.ptr,t,e.ptr)}coCastShape(t,e,n,a,E,D,kt,Bt){S(e,pt),S(n,ct),S(a,pt),S(E,st),S(D,pt);const Ht=x.rawcolliderset_coCastShape(this.ptr,t,e.ptr,n.ptr,a.ptr,E.ptr,D.ptr,kt,Bt);return 0===Ht?void 0:dt.__wrap(Ht)}coCastCollider(t,e,n,a,E,D){S(e,pt),S(a,pt);const kt=x.rawcolliderset_coCastCollider(this.ptr,t,e.ptr,n,a.ptr,E,D);return 0===kt?void 0:lt.__wrap(kt)}coIntersectsShape(t,e,n,a){return S(e,ct),S(n,pt),S(a,st),0!==x.rawcolliderset_coIntersectsShape(this.ptr,t,e.ptr,n.ptr,a.ptr)}coContactShape(t,e,n,a,E){S(e,ct),S(n,pt),S(a,st);const D=x.rawcolliderset_coContactShape(this.ptr,t,e.ptr,n.ptr,a.ptr,E);return 0===D?void 0:ht.__wrap(D)}coContactCollider(t,e,n){const a=x.rawcolliderset_coContactCollider(this.ptr,t,e,n);return 0===a?void 0:ht.__wrap(a)}coProjectPoint(t,e,n){S(e,pt);const a=x.rawcolliderset_coProjectPoint(this.ptr,t,e.ptr,n);return tt.__wrap(a)}coIntersectsRay(t,e,n,a){return S(e,pt),S(n,pt),0!==x.rawcolliderset_coIntersectsRay(this.ptr,t,e.ptr,n.ptr,a)}coCastRay(t,e,n,a,E){return S(e,pt),S(n,pt),x.rawcolliderset_coCastRay(this.ptr,t,e.ptr,n.ptr,a,E)}coCastRayAndGetNormal(t,e,n,a,E){S(e,pt),S(n,pt);const D=x.rawcolliderset_coCastRayAndGetNormal(this.ptr,t,e.ptr,n.ptr,a,E);return 0===D?void 0:nt.__wrap(D)}coSetSensor(t,e){x.rawcolliderset_coSetSensor(this.ptr,t,e)}coSetRestitution(t,e){x.rawcolliderset_coSetRestitution(this.ptr,t,e)}coSetFriction(t,e){x.rawcolliderset_coSetFriction(this.ptr,t,e)}coFrictionCombineRule(t){return x.rawcolliderset_coFrictionCombineRule(this.ptr,t)>>>0}coSetFrictionCombineRule(t,e){x.rawcolliderset_coSetFrictionCombineRule(this.ptr,t,e)}coRestitutionCombineRule(t){return x.rawcolliderset_coRestitutionCombineRule(this.ptr,t)>>>0}coSetRestitutionCombineRule(t,e){x.rawcolliderset_coSetRestitutionCombineRule(this.ptr,t,e)}coSetCollisionGroups(t,e){x.rawcolliderset_coSetCollisionGroups(this.ptr,t,e)}coSetSolverGroups(t,e){x.rawcolliderset_coSetSolverGroups(this.ptr,t,e)}coSetActiveHooks(t,e){x.rawcolliderset_coSetActiveHooks(this.ptr,t,e)}coSetActiveEvents(t,e){x.rawcolliderset_coSetActiveEvents(this.ptr,t,e)}coSetActiveCollisionTypes(t,e){x.rawcolliderset_coSetActiveCollisionTypes(this.ptr,t,e)}coSetShape(t,e){S(e,ct),x.rawcolliderset_coSetShape(this.ptr,t,e.ptr)}coSetContactForceEventThreshold(t,e){x.rawcolliderset_coSetContactForceEventThreshold(this.ptr,t,e)}coSetDensity(t,e){x.rawcolliderset_coSetDensity(this.ptr,t,e)}coSetMass(t,e){x.rawcolliderset_coSetMass(this.ptr,t,e)}coSetMassProperties(t,e,n,a){S(n,pt),x.rawcolliderset_coSetMassProperties(this.ptr,t,e,n.ptr,a)}constructor(){const t=x.rawcolliderset_new();return B.__wrap(t)}len(){return x.rawcolliderset_len(this.ptr)>>>0}contains(t){return 0!==x.rawcolliderset_contains(this.ptr,t)}createCollider(t,e,n,a,E,D,kt,Bt,Ht,Jt,Nt,zt,Gt,Ot,Lt,Vt,Wt,Xt,qt,Ut,Kt,Yt){try{const Zt=x.__wbindgen_add_to_stack_pointer(-16);S(t,ct),S(e,pt),S(n,st),S(D,pt),S(Yt,at),x.rawcolliderset_createCollider(Zt,this.ptr,t.ptr,e.ptr,n.ptr,a,E,D.ptr,kt,Bt,Ht,Jt,Nt,zt,Gt,Ot,Lt,Vt,Wt,Xt,qt,Ut,Kt,Yt.ptr);var Qt=y()[Zt/4+0],$t=_()[Zt/8+1];return 0===Qt?void 0:$t}finally{x.__wbindgen_add_to_stack_pointer(16)}}remove(t,e,n,a){S(e,U),S(n,at),x.rawcolliderset_remove(this.ptr,t,e.ptr,n.ptr,a)}isHandleValid(t){return 0!==x.rawcolliderset_contains(this.ptr,t)}forEachColliderHandle(t){try{x.rawcolliderset_forEachColliderHandle(this.ptr,A(t))}finally{kt[Ot++]=void 0}}}class N{static __wrap(t){const e=Object.create(N.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawcontactforceevent_free(t)}collider1(){return x.rawcharactercollision_handle(this.ptr)}collider2(){return x.rawcontactforceevent_collider2(this.ptr)}total_force(){const t=x.rawcontactforceevent_total_force(this.ptr);return pt.__wrap(t)}total_force_magnitude(){return x.rawcontactforceevent_total_force_magnitude(this.ptr)}max_force_direction(){const t=x.rawcontactforceevent_max_force_direction(this.ptr);return pt.__wrap(t)}max_force_magnitude(){return x.rawcontactforceevent_max_force_magnitude(this.ptr)}}class z{static __wrap(t){const e=Object.create(z.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawcontactmanifold_free(t)}normal(){const t=x.rawcontactmanifold_normal(this.ptr);return pt.__wrap(t)}local_n1(){const t=x.rawcontactmanifold_local_n1(this.ptr);return pt.__wrap(t)}local_n2(){const t=x.rawcontactmanifold_local_n2(this.ptr);return pt.__wrap(t)}subshape1(){return x.rawcontactmanifold_subshape1(this.ptr)>>>0}subshape2(){return x.rawcontactmanifold_subshape2(this.ptr)>>>0}num_contacts(){return x.rawcontactmanifold_num_contacts(this.ptr)>>>0}contact_local_p1(t){const e=x.rawcontactmanifold_contact_local_p1(this.ptr,t);return 0===e?void 0:pt.__wrap(e)}contact_local_p2(t){const e=x.rawcontactmanifold_contact_local_p2(this.ptr,t);return 0===e?void 0:pt.__wrap(e)}contact_dist(t){return x.rawcontactmanifold_contact_dist(this.ptr,t)}contact_fid1(t){return x.rawcontactmanifold_contact_fid1(this.ptr,t)>>>0}contact_fid2(t){return x.rawcontactmanifold_contact_fid2(this.ptr,t)>>>0}contact_impulse(t){return x.rawcontactmanifold_contact_impulse(this.ptr,t)}contact_tangent_impulse(t){return x.rawcontactmanifold_contact_tangent_impulse(this.ptr,t)}num_solver_contacts(){return x.rawcontactmanifold_num_solver_contacts(this.ptr)>>>0}solver_contact_point(t){const e=x.rawcontactmanifold_solver_contact_point(this.ptr,t);return 0===e?void 0:pt.__wrap(e)}solver_contact_dist(t){return x.rawcontactmanifold_solver_contact_dist(this.ptr,t)}solver_contact_friction(t){return x.rawcontactmanifold_solver_contact_friction(this.ptr,t)}solver_contact_restitution(t){return x.rawcontactmanifold_solver_contact_restitution(this.ptr,t)}solver_contact_tangent_velocity(t){const e=x.rawcontactmanifold_solver_contact_tangent_velocity(this.ptr,t);return pt.__wrap(e)}}class O{static __wrap(t){const e=Object.create(O.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawcontactpair_free(t)}collider1(){return x.rawcontactpair_collider1(this.ptr)}collider2(){return x.rawcontactpair_collider2(this.ptr)}numContactManifolds(){return x.rawcontactpair_numContactManifolds(this.ptr)>>>0}contactManifold(t){const e=x.rawcontactpair_contactManifold(this.ptr,t);return 0===e?void 0:z.__wrap(e)}}class G{static __wrap(t){const e=Object.create(G.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawdebugrenderpipeline_free(t)}constructor(){const t=x.rawdebugrenderpipeline_new();return G.__wrap(t)}vertices(){return d(x.rawdebugrenderpipeline_vertices(this.ptr))}colors(){return d(x.rawdebugrenderpipeline_colors(this.ptr))}render(t,e,n,a,E){S(t,at),S(e,B),S(n,X),S(a,Y),S(E,Q),x.rawdebugrenderpipeline_render(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E.ptr)}}class L{static __wrap(t){const e=Object.create(L.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawdeserializedworld_free(t)}takeGravity(){const t=x.rawdeserializedworld_takeGravity(this.ptr);return 0===t?void 0:pt.__wrap(t)}takeIntegrationParameters(){const t=x.rawdeserializedworld_takeIntegrationParameters(this.ptr);return 0===t?void 0:q.__wrap(t)}takeIslandManager(){const t=x.rawdeserializedworld_takeIslandManager(this.ptr);return 0===t?void 0:U.__wrap(t)}takeBroadPhase(){const t=x.rawdeserializedworld_takeBroadPhase(this.ptr);return 0===t?void 0:k.__wrap(t)}takeNarrowPhase(){const t=x.rawdeserializedworld_takeNarrowPhase(this.ptr);return 0===t?void 0:Q.__wrap(t)}takeBodies(){const t=x.rawdeserializedworld_takeBodies(this.ptr);return 0===t?void 0:at.__wrap(t)}takeColliders(){const t=x.rawdeserializedworld_takeColliders(this.ptr);return 0===t?void 0:B.__wrap(t)}takeImpulseJoints(){const t=x.rawdeserializedworld_takeImpulseJoints(this.ptr);return 0===t?void 0:X.__wrap(t)}takeMultibodyJoints(){const t=x.rawdeserializedworld_takeMultibodyJoints(this.ptr);return 0===t?void 0:Y.__wrap(t)}}class V{static __wrap(t){const e=Object.create(V.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_raweventqueue_free(t)}constructor(t){const e=x.raweventqueue_new(t);return V.__wrap(e)}drainCollisionEvents(t){try{x.raweventqueue_drainCollisionEvents(this.ptr,A(t))}finally{kt[Ot++]=void 0}}drainContactForceEvents(t){try{x.raweventqueue_drainContactForceEvents(this.ptr,A(t))}finally{kt[Ot++]=void 0}}clear(){x.raweventqueue_clear(this.ptr)}}class W{static __wrap(t){const e=Object.create(W.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawgenericjoint_free(t)}static prismatic(t,e,n,a,E,D){S(t,pt),S(e,pt),S(n,pt);const kt=x.rawgenericjoint_prismatic(t.ptr,e.ptr,n.ptr,a,E,D);return 0===kt?void 0:W.__wrap(kt)}static fixed(t,e,n,a){S(t,pt),S(e,st),S(n,pt),S(a,st);const E=x.rawgenericjoint_fixed(t.ptr,e.ptr,n.ptr,a.ptr);return W.__wrap(E)}static revolute(t,e){S(t,pt),S(e,pt);const n=x.rawgenericjoint_revolute(t.ptr,e.ptr);return 0===n?void 0:W.__wrap(n)}}class X{static __wrap(t){const e=Object.create(X.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawimpulsejointset_free(t)}jointType(t){return x.rawimpulsejointset_jointType(this.ptr,t)>>>0}jointBodyHandle1(t){return x.rawimpulsejointset_jointBodyHandle1(this.ptr,t)}jointBodyHandle2(t){return x.rawimpulsejointset_jointBodyHandle2(this.ptr,t)}jointFrameX1(t){const e=x.rawimpulsejointset_jointFrameX1(this.ptr,t);return st.__wrap(e)}jointFrameX2(t){const e=x.rawimpulsejointset_jointFrameX2(this.ptr,t);return st.__wrap(e)}jointAnchor1(t){const e=x.rawimpulsejointset_jointAnchor1(this.ptr,t);return pt.__wrap(e)}jointAnchor2(t){const e=x.rawimpulsejointset_jointAnchor2(this.ptr,t);return pt.__wrap(e)}jointSetAnchor1(t,e){S(e,pt),x.rawimpulsejointset_jointSetAnchor1(this.ptr,t,e.ptr)}jointSetAnchor2(t,e){S(e,pt),x.rawimpulsejointset_jointSetAnchor2(this.ptr,t,e.ptr)}jointContactsEnabled(t){return 0!==x.rawimpulsejointset_jointContactsEnabled(this.ptr,t)}jointSetContactsEnabled(t,e){x.rawimpulsejointset_jointSetContactsEnabled(this.ptr,t,e)}jointLimitsEnabled(t,e){return 0!==x.rawimpulsejointset_jointLimitsEnabled(this.ptr,t,e)}jointLimitsMin(t,e){return x.rawimpulsejointset_jointLimitsMin(this.ptr,t,e)}jointLimitsMax(t,e){return x.rawimpulsejointset_jointLimitsMax(this.ptr,t,e)}jointSetLimits(t,e,n,a){x.rawimpulsejointset_jointSetLimits(this.ptr,t,e,n,a)}jointConfigureMotorModel(t,e,n){x.rawimpulsejointset_jointConfigureMotorModel(this.ptr,t,e,n)}jointConfigureMotorVelocity(t,e,n,a){x.rawimpulsejointset_jointConfigureMotorVelocity(this.ptr,t,e,n,a)}jointConfigureMotorPosition(t,e,n,a,E){x.rawimpulsejointset_jointConfigureMotorPosition(this.ptr,t,e,n,a,E)}jointConfigureMotor(t,e,n,a,E,D){x.rawimpulsejointset_jointConfigureMotor(this.ptr,t,e,n,a,E,D)}constructor(){const t=x.rawimpulsejointset_new();return X.__wrap(t)}createJoint(t,e,n,a){return S(t,W),x.rawimpulsejointset_createJoint(this.ptr,t.ptr,e,n,a)}remove(t,e){x.rawimpulsejointset_remove(this.ptr,t,e)}len(){return x.rawimpulsejointset_len(this.ptr)>>>0}contains(t){return 0!==x.rawimpulsejointset_contains(this.ptr,t)}forEachJointHandle(t){try{x.rawimpulsejointset_forEachJointHandle(this.ptr,A(t))}finally{kt[Ot++]=void 0}}forEachJointAttachedToRigidBody(t,e){try{x.rawimpulsejointset_forEachJointAttachedToRigidBody(this.ptr,t,A(e))}finally{kt[Ot++]=void 0}}}class q{static __wrap(t){const e=Object.create(q.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawintegrationparameters_free(t)}constructor(){const t=x.rawintegrationparameters_new();return q.__wrap(t)}get dt(){return x.rawintegrationparameters_dt(this.ptr)}get erp(){return x.rawintegrationparameters_erp(this.ptr)}get allowedLinearError(){return x.rawintegrationparameters_allowedLinearError(this.ptr)}get predictionDistance(){return x.rawintegrationparameters_predictionDistance(this.ptr)}get maxVelocityIterations(){return x.rawintegrationparameters_maxVelocityIterations(this.ptr)>>>0}get maxVelocityFrictionIterations(){return x.rawintegrationparameters_maxVelocityFrictionIterations(this.ptr)>>>0}get maxStabilizationIterations(){return x.rawintegrationparameters_maxStabilizationIterations(this.ptr)>>>0}get minIslandSize(){return x.rawintegrationparameters_minIslandSize(this.ptr)>>>0}get maxCcdSubsteps(){return x.rawintegrationparameters_maxCcdSubsteps(this.ptr)>>>0}set dt(t){x.rawintegrationparameters_set_dt(this.ptr,t)}set erp(t){x.rawintegrationparameters_set_erp(this.ptr,t)}set allowedLinearError(t){x.rawintegrationparameters_set_allowedLinearError(this.ptr,t)}set predictionDistance(t){x.rawintegrationparameters_set_predictionDistance(this.ptr,t)}set maxVelocityIterations(t){x.rawintegrationparameters_set_maxVelocityIterations(this.ptr,t)}set maxVelocityFrictionIterations(t){x.rawintegrationparameters_set_maxVelocityFrictionIterations(this.ptr,t)}set maxStabilizationIterations(t){x.rawintegrationparameters_set_maxStabilizationIterations(this.ptr,t)}set minIslandSize(t){x.rawintegrationparameters_set_minIslandSize(this.ptr,t)}set maxCcdSubsteps(t){x.rawintegrationparameters_set_maxCcdSubsteps(this.ptr,t)}}class U{static __wrap(t){const e=Object.create(U.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawislandmanager_free(t)}constructor(){const t=x.rawislandmanager_new();return U.__wrap(t)}forEachActiveRigidBodyHandle(t){try{x.rawislandmanager_forEachActiveRigidBodyHandle(this.ptr,A(t))}finally{kt[Ot++]=void 0}}}class K{static __wrap(t){const e=Object.create(K.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawkinematiccharactercontroller_free(t)}constructor(t){const e=x.rawkinematiccharactercontroller_new(t);return K.__wrap(e)}up(){const t=x.rawkinematiccharactercontroller_up(this.ptr);return pt.__wrap(t)}setUp(t){S(t,pt),x.rawkinematiccharactercontroller_setUp(this.ptr,t.ptr)}offset(){return x.rawkinematiccharactercontroller_offset(this.ptr)}setOffset(t){x.rawkinematiccharactercontroller_setOffset(this.ptr,t)}slideEnabled(){return 0!==x.rawkinematiccharactercontroller_slideEnabled(this.ptr)}setSlideEnabled(t){x.rawkinematiccharactercontroller_setSlideEnabled(this.ptr,t)}autostepMaxHeight(){try{const n=x.__wbindgen_add_to_stack_pointer(-16);x.rawkinematiccharactercontroller_autostepMaxHeight(n,this.ptr);var t=y()[n/4+0],e=C()[n/4+1];return 0===t?void 0:e}finally{x.__wbindgen_add_to_stack_pointer(16)}}autostepMinWidth(){try{const n=x.__wbindgen_add_to_stack_pointer(-16);x.rawkinematiccharactercontroller_autostepMinWidth(n,this.ptr);var t=y()[n/4+0],e=C()[n/4+1];return 0===t?void 0:e}finally{x.__wbindgen_add_to_stack_pointer(16)}}autostepIncludesDynamicBodies(){const t=x.rawkinematiccharactercontroller_autostepIncludesDynamicBodies(this.ptr);return 16777215===t?void 0:0!==t}autostepEnabled(){return 0!==x.rawkinematiccharactercontroller_autostepEnabled(this.ptr)}enableAutostep(t,e,n){x.rawkinematiccharactercontroller_enableAutostep(this.ptr,t,e,n)}disableAutostep(){x.rawkinematiccharactercontroller_disableAutostep(this.ptr)}maxSlopeClimbAngle(){return x.rawkinematiccharactercontroller_maxSlopeClimbAngle(this.ptr)}setMaxSlopeClimbAngle(t){x.rawkinematiccharactercontroller_setMaxSlopeClimbAngle(this.ptr,t)}minSlopeSlideAngle(){return x.rawkinematiccharactercontroller_minSlopeSlideAngle(this.ptr)}setMinSlopeSlideAngle(t){x.rawkinematiccharactercontroller_setMinSlopeSlideAngle(this.ptr,t)}snapToGroundDistance(){try{const n=x.__wbindgen_add_to_stack_pointer(-16);x.rawkinematiccharactercontroller_snapToGroundDistance(n,this.ptr);var t=y()[n/4+0],e=C()[n/4+1];return 0===t?void 0:e}finally{x.__wbindgen_add_to_stack_pointer(16)}}enableSnapToGround(t){x.rawkinematiccharactercontroller_enableSnapToGround(this.ptr,t)}disableSnapToGround(){x.rawkinematiccharactercontroller_disableSnapToGround(this.ptr)}snapToGroundEnabled(){return 0!==x.rawkinematiccharactercontroller_snapToGroundEnabled(this.ptr)}computeColliderMovement(t,e,n,a,E,D,Bt,Ht,Jt,Nt,zt){try{S(e,at),S(n,B),S(a,et),S(D,pt),x.rawkinematiccharactercontroller_computeColliderMovement(this.ptr,t,e.ptr,n.ptr,a.ptr,E,D.ptr,Bt,!u(Ht),u(Ht)?0:Ht,Jt,!u(Nt),u(Nt)?0:Nt,A(zt))}finally{kt[Ot++]=void 0}}computedMovement(){const t=x.rawkinematiccharactercontroller_computedMovement(this.ptr);return pt.__wrap(t)}computedGrounded(){return 0!==x.rawkinematiccharactercontroller_computedGrounded(this.ptr)}numComputedCollisions(){return x.rawkinematiccharactercontroller_numComputedCollisions(this.ptr)>>>0}computedCollision(t,e){return S(e,J),0!==x.rawkinematiccharactercontroller_computedCollision(this.ptr,t,e.ptr)}}class Y{static __wrap(t){const e=Object.create(Y.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawmultibodyjointset_free(t)}jointType(t){return x.rawmultibodyjointset_jointType(this.ptr,t)>>>0}jointFrameX1(t){const e=x.rawmultibodyjointset_jointFrameX1(this.ptr,t);return st.__wrap(e)}jointFrameX2(t){const e=x.rawmultibodyjointset_jointFrameX2(this.ptr,t);return st.__wrap(e)}jointAnchor1(t){const e=x.rawmultibodyjointset_jointAnchor1(this.ptr,t);return pt.__wrap(e)}jointAnchor2(t){const e=x.rawmultibodyjointset_jointAnchor2(this.ptr,t);return pt.__wrap(e)}jointContactsEnabled(t){return 0!==x.rawmultibodyjointset_jointContactsEnabled(this.ptr,t)}jointSetContactsEnabled(t,e){x.rawmultibodyjointset_jointSetContactsEnabled(this.ptr,t,e)}jointLimitsEnabled(t,e){return 0!==x.rawmultibodyjointset_jointLimitsEnabled(this.ptr,t,e)}jointLimitsMin(t,e){return x.rawmultibodyjointset_jointLimitsMin(this.ptr,t,e)}jointLimitsMax(t,e){return x.rawmultibodyjointset_jointLimitsMax(this.ptr,t,e)}constructor(){const t=x.rawmultibodyjointset_new();return Y.__wrap(t)}createJoint(t,e,n,a){return S(t,W),x.rawmultibodyjointset_createJoint(this.ptr,t.ptr,e,n,a)}remove(t,e){x.rawmultibodyjointset_remove(this.ptr,t,e)}contains(t){return 0!==x.rawmultibodyjointset_contains(this.ptr,t)}forEachJointHandle(t){try{x.rawmultibodyjointset_forEachJointHandle(this.ptr,A(t))}finally{kt[Ot++]=void 0}}forEachJointAttachedToRigidBody(t,e){try{x.rawmultibodyjointset_forEachJointAttachedToRigidBody(this.ptr,t,A(e))}finally{kt[Ot++]=void 0}}}class Q{static __wrap(t){const e=Object.create(Q.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawnarrowphase_free(t)}constructor(){const t=x.rawnarrowphase_new();return Q.__wrap(t)}contacts_with(t,e){x.rawnarrowphase_contacts_with(this.ptr,t,p(e))}contact_pair(t,e){const n=x.rawnarrowphase_contact_pair(this.ptr,t,e);return 0===n?void 0:O.__wrap(n)}intersections_with(t,e){x.rawnarrowphase_intersections_with(this.ptr,t,p(e))}intersection_pair(t,e){return 0!==x.rawnarrowphase_intersection_pair(this.ptr,t,e)}}class ${static __wrap(t){const e=Object.create($.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawphysicspipeline_free(t)}constructor(){const t=x.rawphysicspipeline_new();return $.__wrap(t)}step(t,e,n,a,E,D,kt,Bt,Ht,Jt){S(t,pt),S(e,q),S(n,U),S(a,k),S(E,Q),S(D,at),S(kt,B),S(Bt,X),S(Ht,Y),S(Jt,H),x.rawphysicspipeline_step(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E.ptr,D.ptr,kt.ptr,Bt.ptr,Ht.ptr,Jt.ptr)}stepWithEvents(t,e,n,a,E,D,kt,Bt,Ht,Jt,Nt,zt,Gt,Ot){S(t,pt),S(e,q),S(n,U),S(a,k),S(E,Q),S(D,at),S(kt,B),S(Bt,X),S(Ht,Y),S(Jt,H),S(Nt,V),x.rawphysicspipeline_stepWithEvents(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E.ptr,D.ptr,kt.ptr,Bt.ptr,Ht.ptr,Jt.ptr,Nt.ptr,p(zt),p(Gt),p(Ot))}}class Z{static __wrap(t){const e=Object.create(Z.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawpointcolliderprojection_free(t)}colliderHandle(){return x.rawcharactercollision_handle(this.ptr)}point(){const t=x.rawpointcolliderprojection_point(this.ptr);return pt.__wrap(t)}isInside(){return 0!==x.rawpointcolliderprojection_isInside(this.ptr)}featureType(){return x.rawpointcolliderprojection_featureType(this.ptr)>>>0}featureId(){try{const n=x.__wbindgen_add_to_stack_pointer(-16);x.rawpointcolliderprojection_featureId(n,this.ptr);var t=y()[n/4+0],e=y()[n/4+1];return 0===t?void 0:e>>>0}finally{x.__wbindgen_add_to_stack_pointer(16)}}}class tt{static __wrap(t){const e=Object.create(tt.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawpointprojection_free(t)}point(){const t=x.rawkinematiccharactercontroller_up(this.ptr);return pt.__wrap(t)}isInside(){return 0!==x.rawpointprojection_isInside(this.ptr)}}class et{static __wrap(t){const e=Object.create(et.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawquerypipeline_free(t)}constructor(){const t=x.rawquerypipeline_new();return et.__wrap(t)}update(t,e,n){S(t,U),S(e,at),S(n,B),x.rawquerypipeline_update(this.ptr,t.ptr,e.ptr,n.ptr)}castRay(t,e,n,a,E,D,Bt,Ht,Jt,Nt,zt){try{S(t,at),S(e,B),S(n,pt),S(a,pt);const Gt=x.rawquerypipeline_castRay(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E,D,Bt,!u(Ht),u(Ht)?0:Ht,!u(Jt),u(Jt)?0:Jt,!u(Nt),u(Nt)?0:Nt,A(zt));return 0===Gt?void 0:it.__wrap(Gt)}finally{kt[Ot++]=void 0}}castRayAndGetNormal(t,e,n,a,E,D,Bt,Ht,Jt,Nt,zt){try{S(t,at),S(e,B),S(n,pt),S(a,pt);const Gt=x.rawquerypipeline_castRayAndGetNormal(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E,D,Bt,!u(Ht),u(Ht)?0:Ht,!u(Jt),u(Jt)?0:Jt,!u(Nt),u(Nt)?0:Nt,A(zt));return 0===Gt?void 0:rt.__wrap(Gt)}finally{kt[Ot++]=void 0}}intersectionsWithRay(t,e,n,a,E,D,Bt,Ht,Jt,Nt,zt,Gt){try{S(t,at),S(e,B),S(n,pt),S(a,pt),x.rawquerypipeline_intersectionsWithRay(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E,D,A(Bt),Ht,!u(Jt),u(Jt)?0:Jt,!u(Nt),u(Nt)?0:Nt,!u(zt),u(zt)?0:zt,A(Gt))}finally{kt[Ot++]=void 0,kt[Ot++]=void 0}}intersectionWithShape(t,e,n,a,E,D,Bt,Ht,Jt,Nt){try{const Lt=x.__wbindgen_add_to_stack_pointer(-16);S(t,at),S(e,B),S(n,pt),S(a,st),S(E,ct),x.rawquerypipeline_intersectionWithShape(Lt,this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E.ptr,D,!u(Bt),u(Bt)?0:Bt,!u(Ht),u(Ht)?0:Ht,!u(Jt),u(Jt)?0:Jt,A(Nt));var zt=y()[Lt/4+0],Gt=_()[Lt/8+1];return 0===zt?void 0:Gt}finally{x.__wbindgen_add_to_stack_pointer(16),kt[Ot++]=void 0}}projectPoint(t,e,n,a,E,D,Bt,Ht,Jt){try{S(t,at),S(e,B),S(n,pt);const Nt=x.rawquerypipeline_projectPoint(this.ptr,t.ptr,e.ptr,n.ptr,a,E,!u(D),u(D)?0:D,!u(Bt),u(Bt)?0:Bt,!u(Ht),u(Ht)?0:Ht,A(Jt));return 0===Nt?void 0:Z.__wrap(Nt)}finally{kt[Ot++]=void 0}}projectPointAndGetFeature(t,e,n,a,E,D,Bt,Ht){try{S(t,at),S(e,B),S(n,pt);const Jt=x.rawquerypipeline_projectPointAndGetFeature(this.ptr,t.ptr,e.ptr,n.ptr,a,!u(E),u(E)?0:E,!u(D),u(D)?0:D,!u(Bt),u(Bt)?0:Bt,A(Ht));return 0===Jt?void 0:Z.__wrap(Jt)}finally{kt[Ot++]=void 0}}intersectionsWithPoint(t,e,n,a,E,D,Bt,Ht,Jt){try{S(t,at),S(e,B),S(n,pt),x.rawquerypipeline_intersectionsWithPoint(this.ptr,t.ptr,e.ptr,n.ptr,A(a),E,!u(D),u(D)?0:D,!u(Bt),u(Bt)?0:Bt,!u(Ht),u(Ht)?0:Ht,A(Jt))}finally{kt[Ot++]=void 0,kt[Ot++]=void 0}}castShape(t,e,n,a,E,D,Bt,Ht,Jt,Nt,zt,Gt,Lt){try{S(t,at),S(e,B),S(n,pt),S(a,st),S(E,pt),S(D,ct);const Vt=x.rawquerypipeline_castShape(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E.ptr,D.ptr,Bt,Ht,Jt,!u(Nt),u(Nt)?0:Nt,!u(zt),u(zt)?0:zt,!u(Gt),u(Gt)?0:Gt,A(Lt));return 0===Vt?void 0:lt.__wrap(Vt)}finally{kt[Ot++]=void 0}}intersectionsWithShape(t,e,n,a,E,D,Bt,Ht,Jt,Nt,zt){try{S(t,at),S(e,B),S(n,pt),S(a,st),S(E,ct),x.rawquerypipeline_intersectionsWithShape(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E.ptr,A(D),Bt,!u(Ht),u(Ht)?0:Ht,!u(Jt),u(Jt)?0:Jt,!u(Nt),u(Nt)?0:Nt,A(zt))}finally{kt[Ot++]=void 0,kt[Ot++]=void 0}}collidersWithAabbIntersectingAabb(t,e,n){try{S(t,pt),S(e,pt),x.rawquerypipeline_collidersWithAabbIntersectingAabb(this.ptr,t.ptr,e.ptr,A(n))}finally{kt[Ot++]=void 0}}}class rt{static __wrap(t){const e=Object.create(rt.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawraycolliderintersection_free(t)}colliderHandle(){return x.rawcharactercollision_handle(this.ptr)}normal(){const t=x.rawraycolliderintersection_normal(this.ptr);return pt.__wrap(t)}toi(){return x.rawraycolliderintersection_toi(this.ptr)}featureType(){return x.rawpointcolliderprojection_featureType(this.ptr)>>>0}featureId(){try{const n=x.__wbindgen_add_to_stack_pointer(-16);x.rawpointcolliderprojection_featureId(n,this.ptr);var t=y()[n/4+0],e=y()[n/4+1];return 0===t?void 0:e>>>0}finally{x.__wbindgen_add_to_stack_pointer(16)}}}class it{static __wrap(t){const e=Object.create(it.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawraycollidertoi_free(t)}colliderHandle(){return x.rawcharactercollision_handle(this.ptr)}toi(){return x.rawraycolliderintersection_toi(this.ptr)}}class nt{static __wrap(t){const e=Object.create(nt.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawrayintersection_free(t)}normal(){const t=x.rawrayintersection_normal(this.ptr);return pt.__wrap(t)}toi(){return x.rawintegrationparameters_dt(this.ptr)}featureType(){return x.rawrayintersection_featureType(this.ptr)>>>0}featureId(){try{const n=x.__wbindgen_add_to_stack_pointer(-16);x.rawrayintersection_featureId(n,this.ptr);var t=y()[n/4+0],e=y()[n/4+1];return 0===t?void 0:e>>>0}finally{x.__wbindgen_add_to_stack_pointer(16)}}}class at{static __wrap(t){const e=Object.create(at.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawrigidbodyset_free(t)}rbTranslation(t){const e=x.rawrigidbodyset_rbTranslation(this.ptr,t);return pt.__wrap(e)}rbRotation(t){const e=x.rawrigidbodyset_rbRotation(this.ptr,t);return st.__wrap(e)}rbSleep(t){x.rawrigidbodyset_rbSleep(this.ptr,t)}rbIsSleeping(t){return 0!==x.rawrigidbodyset_rbIsSleeping(this.ptr,t)}rbIsMoving(t){return 0!==x.rawrigidbodyset_rbIsMoving(this.ptr,t)}rbNextTranslation(t){const e=x.rawrigidbodyset_rbNextTranslation(this.ptr,t);return pt.__wrap(e)}rbNextRotation(t){const e=x.rawrigidbodyset_rbNextRotation(this.ptr,t);return st.__wrap(e)}rbSetTranslation(t,e,n,a){x.rawrigidbodyset_rbSetTranslation(this.ptr,t,e,n,a)}rbSetRotation(t,e,n){x.rawrigidbodyset_rbSetRotation(this.ptr,t,e,n)}rbSetLinvel(t,e,n){S(e,pt),x.rawrigidbodyset_rbSetLinvel(this.ptr,t,e.ptr,n)}rbSetAngvel(t,e,n){x.rawrigidbodyset_rbSetAngvel(this.ptr,t,e,n)}rbSetNextKinematicTranslation(t,e,n){x.rawrigidbodyset_rbSetNextKinematicTranslation(this.ptr,t,e,n)}rbSetNextKinematicRotation(t,e){x.rawrigidbodyset_rbSetNextKinematicRotation(this.ptr,t,e)}rbRecomputeMassPropertiesFromColliders(t,e){S(e,B),x.rawrigidbodyset_rbRecomputeMassPropertiesFromColliders(this.ptr,t,e.ptr)}rbSetAdditionalMass(t,e,n){x.rawrigidbodyset_rbSetAdditionalMass(this.ptr,t,e,n)}rbSetAdditionalMassProperties(t,e,n,a,E){S(n,pt),x.rawrigidbodyset_rbSetAdditionalMassProperties(this.ptr,t,e,n.ptr,a,E)}rbLinvel(t){const e=x.rawrigidbodyset_rbLinvel(this.ptr,t);return pt.__wrap(e)}rbAngvel(t){return x.rawrigidbodyset_rbAngvel(this.ptr,t)}rbLockTranslations(t,e,n){x.rawrigidbodyset_rbLockTranslations(this.ptr,t,e,n)}rbSetEnabledTranslations(t,e,n,a){x.rawrigidbodyset_rbSetEnabledTranslations(this.ptr,t,e,n,a)}rbLockRotations(t,e,n){x.rawrigidbodyset_rbLockRotations(this.ptr,t,e,n)}rbDominanceGroup(t){return x.rawrigidbodyset_rbDominanceGroup(this.ptr,t)}rbSetDominanceGroup(t,e){x.rawrigidbodyset_rbSetDominanceGroup(this.ptr,t,e)}rbEnableCcd(t,e){x.rawrigidbodyset_rbEnableCcd(this.ptr,t,e)}rbMass(t){return x.rawrigidbodyset_rbMass(this.ptr,t)}rbWakeUp(t){x.rawrigidbodyset_rbWakeUp(this.ptr,t)}rbIsCcdEnabled(t){return 0!==x.rawrigidbodyset_rbIsCcdEnabled(this.ptr,t)}rbNumColliders(t){return x.rawrigidbodyset_rbNumColliders(this.ptr,t)>>>0}rbCollider(t,e){return x.rawrigidbodyset_rbCollider(this.ptr,t,e)}rbBodyType(t){return x.rawrigidbodyset_rbBodyType(this.ptr,t)>>>0}rbSetBodyType(t,e){x.rawrigidbodyset_rbSetBodyType(this.ptr,t,e)}rbIsFixed(t){return 0!==x.rawrigidbodyset_rbIsFixed(this.ptr,t)}rbIsKinematic(t){return 0!==x.rawrigidbodyset_rbIsKinematic(this.ptr,t)}rbIsDynamic(t){return 0!==x.rawrigidbodyset_rbIsDynamic(this.ptr,t)}rbLinearDamping(t){return x.rawrigidbodyset_rbLinearDamping(this.ptr,t)}rbAngularDamping(t){return x.rawrigidbodyset_rbAngularDamping(this.ptr,t)}rbSetLinearDamping(t,e){x.rawrigidbodyset_rbSetLinearDamping(this.ptr,t,e)}rbSetAngularDamping(t,e){x.rawrigidbodyset_rbSetAngularDamping(this.ptr,t,e)}rbGravityScale(t){return x.rawrigidbodyset_rbGravityScale(this.ptr,t)}rbSetGravityScale(t,e,n){x.rawrigidbodyset_rbSetGravityScale(this.ptr,t,e,n)}rbResetForces(t,e){x.rawrigidbodyset_rbResetForces(this.ptr,t,e)}rbResetTorques(t,e){x.rawrigidbodyset_rbResetTorques(this.ptr,t,e)}rbAddForce(t,e,n){S(e,pt),x.rawrigidbodyset_rbAddForce(this.ptr,t,e.ptr,n)}rbApplyImpulse(t,e,n){S(e,pt),x.rawrigidbodyset_rbApplyImpulse(this.ptr,t,e.ptr,n)}rbAddTorque(t,e,n){x.rawrigidbodyset_rbAddTorque(this.ptr,t,e,n)}rbApplyTorqueImpulse(t,e,n){x.rawrigidbodyset_rbApplyTorqueImpulse(this.ptr,t,e,n)}rbAddForceAtPoint(t,e,n,a){S(e,pt),S(n,pt),x.rawrigidbodyset_rbAddForceAtPoint(this.ptr,t,e.ptr,n.ptr,a)}rbApplyImpulseAtPoint(t,e,n,a){S(e,pt),S(n,pt),x.rawrigidbodyset_rbApplyImpulseAtPoint(this.ptr,t,e.ptr,n.ptr,a)}rbUserData(t){return x.rawrigidbodyset_rbUserData(this.ptr,t)>>>0}rbSetUserData(t,e){x.rawrigidbodyset_rbSetUserData(this.ptr,t,e)}constructor(){const t=x.rawrigidbodyset_new();return at.__wrap(t)}createRigidBody(t,e,n,a,E,D,kt,Bt,Ht,Jt,Nt,zt,Gt,Ot,Lt,Vt,Wt,Xt,qt){return S(t,pt),S(e,st),S(D,pt),S(kt,pt),x.rawrigidbodyset_createRigidBody(this.ptr,t.ptr,e.ptr,n,a,E,D.ptr,kt.ptr,Bt,Ht,Jt,Nt,zt,Gt,Ot,Lt,Vt,Wt,Xt,qt)}remove(t,e,n,a,E){S(e,U),S(n,B),S(a,X),S(E,Y),x.rawrigidbodyset_remove(this.ptr,t,e.ptr,n.ptr,a.ptr,E.ptr)}len(){return x.rawrigidbodyset_len(this.ptr)>>>0}contains(t){return 0!==x.rawrigidbodyset_contains(this.ptr,t)}forEachRigidBodyHandle(t){try{x.rawrigidbodyset_forEachRigidBodyHandle(this.ptr,A(t))}finally{kt[Ot++]=void 0}}}class st{static __wrap(t){const e=Object.create(st.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawrotation_free(t)}static identity(){const t=x.rawrotation_identity();return st.__wrap(t)}static fromAngle(t){const e=x.rawrotation_fromAngle(t);return st.__wrap(e)}get im(){return x.rawrotation_im(this.ptr)}get re(){return x.rawintegrationparameters_dt(this.ptr)}get angle(){return x.rawrotation_angle(this.ptr)}}class ot{static __wrap(t){const e=Object.create(ot.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawserializationpipeline_free(t)}constructor(){const t=x.rawserializationpipeline_new();return ot.__wrap(t)}serializeAll(t,e,n,a,E,D,kt,Bt,Ht){return S(t,pt),S(e,q),S(n,U),S(a,k),S(E,Q),S(D,at),S(kt,B),S(Bt,X),S(Ht,Y),d(x.rawserializationpipeline_serializeAll(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E.ptr,D.ptr,kt.ptr,Bt.ptr,Ht.ptr))}deserializeAll(t){const e=x.rawserializationpipeline_deserializeAll(this.ptr,p(t));return 0===e?void 0:L.__wrap(e)}}class ct{static __wrap(t){const e=Object.create(ct.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawshape_free(t)}static cuboid(t,e){const n=x.rawshape_cuboid(t,e);return ct.__wrap(n)}static roundCuboid(t,e,n){const a=x.rawshape_roundCuboid(t,e,n);return ct.__wrap(a)}static ball(t){const e=x.rawshape_ball(t);return ct.__wrap(e)}static halfspace(t){S(t,pt);const e=x.rawshape_halfspace(t.ptr);return ct.__wrap(e)}static capsule(t,e){const n=x.rawshape_capsule(t,e);return ct.__wrap(n)}static polyline(t,e){const n=M(t,x.__wbindgen_malloc),a=Vt,E=j(e,x.__wbindgen_malloc),D=Vt,kt=x.rawshape_polyline(n,a,E,D);return ct.__wrap(kt)}static trimesh(t,e){const n=M(t,x.__wbindgen_malloc),a=Vt,E=j(e,x.__wbindgen_malloc),D=Vt,kt=x.rawshape_trimesh(n,a,E,D);return ct.__wrap(kt)}static heightfield(t,e){const n=M(t,x.__wbindgen_malloc),a=Vt;S(e,pt);const E=x.rawshape_heightfield(n,a,e.ptr);return ct.__wrap(E)}static segment(t,e){S(t,pt),S(e,pt);const n=x.rawshape_segment(t.ptr,e.ptr);return ct.__wrap(n)}static triangle(t,e,n){S(t,pt),S(e,pt),S(n,pt);const a=x.rawshape_triangle(t.ptr,e.ptr,n.ptr);return ct.__wrap(a)}static roundTriangle(t,e,n,a){S(t,pt),S(e,pt),S(n,pt);const E=x.rawshape_roundTriangle(t.ptr,e.ptr,n.ptr,a);return ct.__wrap(E)}static convexHull(t){const e=M(t,x.__wbindgen_malloc),n=Vt,a=x.rawshape_convexHull(e,n);return 0===a?void 0:ct.__wrap(a)}static roundConvexHull(t,e){const n=M(t,x.__wbindgen_malloc),a=Vt,E=x.rawshape_roundConvexHull(n,a,e);return 0===E?void 0:ct.__wrap(E)}static convexPolyline(t){const e=M(t,x.__wbindgen_malloc),n=Vt,a=x.rawshape_convexPolyline(e,n);return 0===a?void 0:ct.__wrap(a)}static roundConvexPolyline(t,e){const n=M(t,x.__wbindgen_malloc),a=Vt,E=x.rawshape_roundConvexPolyline(n,a,e);return 0===E?void 0:ct.__wrap(E)}castShape(t,e,n,a,E,D,kt,Bt,Ht){S(t,pt),S(e,st),S(n,pt),S(a,ct),S(E,pt),S(D,st),S(kt,pt);const Jt=x.rawshape_castShape(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E.ptr,D.ptr,kt.ptr,Bt,Ht);return 0===Jt?void 0:dt.__wrap(Jt)}intersectsShape(t,e,n,a,E){return S(t,pt),S(e,st),S(n,ct),S(a,pt),S(E,st),0!==x.rawshape_intersectsShape(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E.ptr)}contactShape(t,e,n,a,E,D){S(t,pt),S(e,st),S(n,ct),S(a,pt),S(E,st);const kt=x.rawshape_contactShape(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E.ptr,D);return 0===kt?void 0:ht.__wrap(kt)}containsPoint(t,e,n){return S(t,pt),S(e,st),S(n,pt),0!==x.rawshape_containsPoint(this.ptr,t.ptr,e.ptr,n.ptr)}projectPoint(t,e,n,a){S(t,pt),S(e,st),S(n,pt);const E=x.rawshape_projectPoint(this.ptr,t.ptr,e.ptr,n.ptr,a);return tt.__wrap(E)}intersectsRay(t,e,n,a,E){return S(t,pt),S(e,st),S(n,pt),S(a,pt),0!==x.rawshape_intersectsRay(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E)}castRay(t,e,n,a,E,D){return S(t,pt),S(e,st),S(n,pt),S(a,pt),x.rawshape_castRay(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E,D)}castRayAndGetNormal(t,e,n,a,E,D){S(t,pt),S(e,st),S(n,pt),S(a,pt);const kt=x.rawshape_castRayAndGetNormal(this.ptr,t.ptr,e.ptr,n.ptr,a.ptr,E,D);return 0===kt?void 0:nt.__wrap(kt)}}class lt{static __wrap(t){const e=Object.create(lt.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawshapecollidertoi_free(t)}colliderHandle(){return x.rawcharactercollision_handle(this.ptr)}toi(){return x.rawraycolliderintersection_toi(this.ptr)}witness1(){const t=x.rawraycolliderintersection_normal(this.ptr);return pt.__wrap(t)}witness2(){const t=x.rawshapecollidertoi_witness2(this.ptr);return pt.__wrap(t)}normal1(){const t=x.rawcontactforceevent_max_force_direction(this.ptr);return pt.__wrap(t)}normal2(){const t=x.rawshapecollidertoi_normal2(this.ptr);return pt.__wrap(t)}}class ht{static __wrap(t){const e=Object.create(ht.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawshapecontact_free(t)}distance(){return x.rawintegrationparameters_predictionDistance(this.ptr)}point1(){const t=x.rawkinematiccharactercontroller_up(this.ptr);return pt.__wrap(t)}point2(){const t=x.rawshapecontact_point2(this.ptr);return pt.__wrap(t)}normal1(){const t=x.rawshapecontact_normal1(this.ptr);return pt.__wrap(t)}normal2(){const t=x.rawshapecontact_normal2(this.ptr);return pt.__wrap(t)}}class dt{static __wrap(t){const e=Object.create(dt.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawshapetoi_free(t)}toi(){return x.rawintegrationparameters_dt(this.ptr)}witness1(){const t=x.rawrayintersection_normal(this.ptr);return pt.__wrap(t)}witness2(){const t=x.rawshapetoi_witness2(this.ptr);return pt.__wrap(t)}normal1(){const t=x.rawshapetoi_normal1(this.ptr);return pt.__wrap(t)}normal2(){const t=x.rawshapetoi_normal2(this.ptr);return pt.__wrap(t)}}class pt{static __wrap(t){const e=Object.create(pt.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();x.__wbg_rawvector_free(t)}static zero(){const t=x.rawvector_zero();return pt.__wrap(t)}constructor(t,e){const n=x.rawvector_new(t,e);return pt.__wrap(n)}get x(){return x.rawintegrationparameters_dt(this.ptr)}set x(t){x.rawintegrationparameters_set_dt(this.ptr,t)}get y(){return x.rawrotation_im(this.ptr)}set y(t){x.rawvector_set_y(this.ptr,t)}xy(){const t=x.rawvector_xy(this.ptr);return pt.__wrap(t)}yx(){const t=x.rawvector_yx(this.ptr);return pt.__wrap(t)}}function ut(t){d(t)}function wt(t){return p(t)}function _t(t,e){const n=c(e),a="number"==typeof n?n:void 0;_()[t/8+1]=u(a)?0:a,y()[t/4+0]=!u(a)}function mt(t){const e=c(t);return"boolean"==typeof e?e?1:0:2}function yt(t){return"function"==typeof c(t)}function ft(t){return p(rt.__wrap(t))}function bt(t){return p(N.__wrap(t))}function gt(){return F((function(t,e,n){return p(c(t).call(c(e),c(n)))}),arguments)}function vt(){return F((function(t,e,n,a){return p(c(t).call(c(e),c(n),c(a)))}),arguments)}function St(){return F((function(t,e,n,a,E){return p(c(t).call(c(e),c(n),c(a),c(E)))}),arguments)}function Rt(t,e,n,a){return p(c(t).bind(c(e),c(n),c(a)))}function Ct(t){return p(c(t).buffer)}function Tt(t,e,n){return p(new Uint8Array(c(t),e>>>0,n>>>0))}function At(t){return p(new Uint8Array(c(t)))}function Pt(t,e,n){c(t).set(c(e),n>>>0)}function Et(t){return c(t).length}function It(t,e,n){return p(new Float32Array(c(t),e>>>0,n>>>0))}function xt(t,e,n){c(t).set(c(e),n>>>0)}function Mt(t){return c(t).length}function jt(t){return p(new Float32Array(t>>>0))}function Ft(t,e){throw new Error(g(t,e))}function Dt(){return p(x.memory)}E()}catch(Xt){E(Xt)}}))},500:(t,e,n)=>{"use strict";n.a(t,(async(a,E)=>{try{var x,D=a([x=n(302)]),[x]=D.then?(await D)():D;await n.v(e,t.id,"125db5b4dc61294ca8b6",{"./rapier_wasm2d_bg.js":{__wbindgen_object_drop_ref:x.ug,__wbindgen_number_new:x.pT,__wbindgen_number_get:x.M1,__wbindgen_boolean_get:x.HT,__wbindgen_is_function:x.o$,__wbg_rawraycolliderintersection_new:x.Ne,__wbg_rawcontactforceevent_new:x.$B,__wbg_call_168da88779e35f61:x.VD,__wbg_call_3999bee59e9f7719:x.pm,__wbg_call_e1f72c051cdab859:x.R,__wbg_bind_10dfe70e95d2a480:x.am,__wbg_buffer_3f3d764d4747d564:x.jp,__wbg_newwithbyteoffsetandlength_d9aa266703cb98be:x.TY,__wbg_new_8c3f0052272a457a:x.lB,__wbg_set_83db9690f9353e79:x.fP,__wbg_length_9e1ae1900cb0fbd5:x.bj,__wbg_newwithbyteoffsetandlength_be22e5fcf4f69ab4:x.Mv,__wbg_set_0e0314cf6675c1b9:x.Py,__wbg_length_9a2deed95d22668d:x.Qj,__wbg_newwithlength_a7168e4a1e8f5e12:x.w_,__wbindgen_throw:x.Or,__wbindgen_memory:x.oH}}),E()}catch(t){E(t)}}),1)}},x={};function s(t){var e=x[t];if(void 0!==e)return e.exports;var n=x[t]={id:t,loaded:!1,exports:{}};return E[t](n,n.exports,s),n.loaded=!0,n.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",a=t=>{t&&!t.d&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},s.a=(E,x,D)=>{var kt;D&&((kt=[]).d=1);var Bt,Ht,Jt,Nt=new Set,zt=E.exports,Gt=new Promise(((t,e)=>{Jt=e,Ht=t}));Gt[e]=zt,Gt[t]=t=>(kt&&t(kt),Nt.forEach(t),Gt.catch((t=>{}))),E.exports=Gt,x((E=>{var x;Bt=(E=>E.map((E=>{if(null!==E&&"object"==typeof E){if(E[t])return E;if(E.then){var x=[];x.d=0,E.then((t=>{D[e]=t,a(x)}),(t=>{D[n]=t,a(x)}));var D={};return D[t]=t=>t(x),D}}var kt={};return kt[t]=t=>{},kt[e]=E,kt})))(E);var s=()=>Bt.map((t=>{if(t[n])throw t[n];return t[e]})),D=new Promise((e=>{(x=()=>e(s)).r=0;var r=t=>t!==kt&&!Nt.has(t)&&(Nt.add(t),t&&!t.d&&(x.r++,t.push(x)));Bt.map((e=>e[t](r)))}));return x.r?D:s()}),(t=>(t?Jt(Gt[n]=t):Ht(zt),a(kt)))),kt&&(kt.d=0)},s.d=(t,e)=>{for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.v=(t,e,n,a)=>{var E=fetch(s.p+"rapier2d.wasm");return"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(E,a).then((e=>Object.assign(t,e.instance.exports))):E.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,a))).then((e=>Object.assign(t,e.instance.exports)))},(()=>{var t;s.g.importScripts&&(t=s.g.location+"");var e=s.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t})(),s.v=(t,e,n,a)=>{const E=pc.Application.getApplication().assets.find("rapier2d.wasm").getFileUrl();var x=fetch(E);return"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(x,a).then((e=>Object.assign(t,e.instance.exports))):x.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,a))).then((e=>Object.assign(t,e.instance.exports)))},Promise.resolve().then(s.bind(s,495)).then((t=>{window.RAPIER2D||(window.RAPIER2D=t,pc.Application.getApplication().fire("rapier2d:loaded"))}))})();var Script=pc.createScript("script");Script.prototype.initialize=function(){const t=this;function init(e){const a=t.app.assets.find("road","material").resource,i=t.app.batcher.getGroupByName("ROAD"),c=new Float32Array([e+1,e+1,e+1,e+1,e+2,e+1,e+1,e+2,e+2]),s=[0,1,2],p=new pc.Mesh(t.app.graphicsDevice);p.clear(!0,!1),p.setPositions(c),p.setIndices(s),p.setNormals(pc.calculateNormals(c,s)),p.update(pc.PRIMITIVE_TRIANGLES);const n=new pc.MeshInstance(p,a),r=new pc.Entity;r.addComponent("render",{type:"asset",meshInstances:[n],material:a,batchGroupId:i.id,castShadows:!1,castShadowsLightmap:!1,isStatic:!0,receiveShadows:!1}),t.app.root.addChild(r)}init(0),init(1)},Script.prototype.update=function(t){};var ExplosionVehicle=pc.createScript("explosionVehicle");ExplosionVehicle.prototype.initialize=function(){var e=this.entity,n=!1;on("VEHICLE:Die",(function die(){if(n||!e.enabled)return;n=!0,i.enabled=a.enabled=!1,t.enabled=!0,o.enabled=l.enabled=!0,resetLocals([o,l]);let d={min:.1,max:.3,rot:1};ANIMATION.explode(o,d),ANIMATION.explode(l,d),FX3D.EXPLOSION.boom({entity:e})})),on("VEHICLE:Continue",onContinue);var i=e.findByName("Front Wheels"),a=e.findByName("Back Wheels"),o=e.findByName("FrontFake"),l=e.findByName("BackFake");getLocals([o,l]);var t=e.findByName("Fire");function onContinue(){n=!1,i.enabled=a.enabled=!0,t.enabled=o.enabled=l.enabled=!1}onContinue()};var Hammer=pc.createScript("hammer");Hammer.prototype.initialize=function(){var e=this.entity;function goUp(){e&&e.enabled&&(ANIMATION.rotateTo(e,new pc.Vec3(50,0,0),1,EASING.ElasticOut),delay(goDown,2))}function goDown(){e&&e.enabled&&(ANIMATION.rotateTo(e,new pc.Vec3(60,0,0),.2,EASING.SineOut),delay((function(){ANIMATION.rotateTo(e,new pc.Vec3(-5,0,0),.5,EASING.BounceOut)}),.2),delay(goUp,2))}!function setState(){if(chance())return function setUp(){e.setLocalEulerAngles(50,0,0),delay(goDown,2)}();!function setDown(){e.setLocalEulerAngles(-5,0,0),delay(goUp,2)}()}()};